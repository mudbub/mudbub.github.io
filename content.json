{"meta":{"title":"MUDBUB.COM","subtitle":"Stay hungry Stay foolish","description":"","author":"Falkon","url":"http://mudbub.com","root":"/"},"pages":[{"title":"YOU PROBABLY WANT TO LOOK AT MY INFO","date":"2020-03-08T17:09:09.000Z","updated":"2021-04-20T06:48:32.093Z","comments":true,"path":"about/index.html","permalink":"http://mudbub.com/about/index.html","excerpt":"","text":"&nbsp;&nbsp;Name：&nbsp;&nbsp;&nbsp;&nbsp;Falkon&nbsp;Job：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DBA&nbsp;E-mail：&nbsp;&nbsp;&nbsp;&nbsp;mudbub@163.com&nbsp;Location：Xi’an ShaanXi&nbsp;Bio：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我是一名Linux和数据库爱好者，一直从事相关工作。很早就有了写博客的想法，但是一直没有付诸于行动，后来发现自己学习的相关知识，没有形成任何输出性的东西来帮助自己和别人。希望在写博客的过程中不断进步，也希望大家能共同进步。下面有我的联系方式，如果在博客中发现了任何错误和问题，请及时联系我以便修正（暗号：我不删库）。&nbsp;Hobby：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;摄影 &nbsp;&nbsp;"},{"title":"Categories","date":"2021-01-27T09:36:46.094Z","updated":"2021-01-27T02:43:13.116Z","comments":true,"path":"categories/index.html","permalink":"http://mudbub.com/categories/index.html","excerpt":"","text":""},{"title":"Tags","date":"2021-01-27T09:36:46.095Z","updated":"2021-01-27T02:44:33.720Z","comments":true,"path":"tags/index.html","permalink":"http://mudbub.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"PostgreSQL离线下载与安装","slug":"database/installed-postgresql13-on-centos7","date":"2021-06-22T02:57:31.326Z","updated":"2021-06-22T08:57:04.567Z","comments":true,"path":"2021/06/22/database/installed-postgresql13-on-centos7/","link":"","permalink":"http://mudbub.com/2021/06/22/database/installed-postgresql13-on-centos7/","excerpt":"","text":"1. 软件包说明 软件包 描述 postgresql-client libraries and client binaries postgresql-server core database server postgresql-contrib additional supplied modules postgresql-devel libraries and headers for C language development 2. 下载离线安装包 Direct RPM download -&gt; direct download-&gt;选择对应的版本对应的操作系统 -&gt; PostgreSQL Database Server 13 PGDG -&gt; 下载离线安装包 3. 进行PostgresSQL的安装12345678[root@db-postgresql13 home]# rpm -ivh postgresql13-*warning: postgresql13-13.3-1PGDG.rhel7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 442df0f8: NOKEYPreparing... ################################# [100%]Updating / installing... 1:postgresql13-libs-13.3-1PGDG.rhel################################# [ 25%] 2:postgresql13-13.3-1PGDG.rhel7 ################################# [ 50%] 3:postgresql13-server-13.3-1PGDG.rh################################# [ 75%] 4:postgresql13-contrib-13.3-1PGDG.r################################# [100%] 4. 初始化db12[root@db-postgresql13 home]# /usr/pgsql-13/bin/postgresql-13-setup initdbInitializing database ... OK 5. 启动PostgreSQL服务1234567891011121314151617181920212223242526272829[root@db-postgresql13 home]# systemctl start postgresql-13# 查看服务状态[root@db-postgresql13 ~]# systemctl status postgresql-13● postgresql-13.service - PostgreSQL 13 database server Loaded: loaded (/usr/lib/systemd/system/postgresql-13.service; disabled; vendor preset: disabled) Active: active (running) since Tue 2021-06-22 10:58:04 CST; 13min ago Docs: https://www.postgresql.org/docs/13/static/ Process: 13539 ExecStartPre=/usr/pgsql-13/bin/postgresql-13-check-db-dir $&#123;PGDATA&#125; (code=exited, status=0/SUCCESS) Main PID: 13545 (postmaster) Tasks: 8 CGroup: /system.slice/postgresql-13.service ├─13545 /usr/pgsql-13/bin/postmaster -D /var/lib/pgsql/13/data/ ├─13547 postgres: logger ├─13549 postgres: checkpointer ├─13550 postgres: background writer ├─13551 postgres: walwriter ├─13552 postgres: autovacuum launcher ├─13553 postgres: stats collector └─13554 postgres: logical replication launcher Jun 22 10:58:04 db-postgresql13 systemd[1]: Starting PostgreSQL 13 database server...Jun 22 10:58:04 db-postgresql13 postmaster[13545]: 2021-06-22 10:58:04.147 CST [13545] LOG: redirecting log output to logging collector processJun 22 10:58:04 db-postgresql13 postmaster[13545]: 2021-06-22 10:58:04.147 CST [13545] HINT: Future log output will appear in directory \"log\".Jun 22 10:58:04 db-postgresql13 systemd[1]: Started PostgreSQL 13 database server.# 加入开机启动[root@db-postgresql13 ~]# systemctl enable postgresql-13Created symlink from /etc/systemd/system/multi-user.target.wants/postgresql-13.service to /usr/lib/systemd/system/postgresql-13.service. 6. 进入PostgreSQL数据库12345678910111213141516171819202122232425# 切换到postgres用户[root@db-postgresql13 ~]# su - postgresLast login: Tue Jun 22 11:13:17 CST 2021 on pts/1# 查看postgresql版本-bash-4.2$ psql --versionpsql (PostgreSQL) 13.3# 进入数据库-bash-4.2$ psqlpsql (13.3)Type \"help\" for help.postgres=# \\l List of databases Name | Owner | Encoding | Collate | Ctype | Access privileges -----------+----------+----------+-------------+-------------+----------------------- postgres | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | template0 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres template1 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres(3 rows)postgres=#","categories":[{"name":"PostgreSQL","slug":"PostgreSQL","permalink":"http://mudbub.com/categories/PostgreSQL/"}],"tags":[{"name":"Install","slug":"Install","permalink":"http://mudbub.com/tags/Install/"},{"name":"PostgreSQL","slug":"PostgreSQL","permalink":"http://mudbub.com/tags/PostgreSQL/"}],"author":["Falkon"]},{"title":"ol6_x86_64_userspace_ksplice","slug":"linux/Error-getting-repository-data-for-ol6_x86_64_userspace_ksplice-repository-not-found","date":"2021-06-18T01:33:37.540Z","updated":"2021-06-22T08:59:30.633Z","comments":true,"path":"2021/06/18/linux/Error-getting-repository-data-for-ol6_x86_64_userspace_ksplice-repository-not-found/","link":"","permalink":"http://mudbub.com/2021/06/18/linux/Error-getting-repository-data-for-ol6_x86_64_userspace_ksplice-repository-not-found/","excerpt":"","text":"1. ODA（Oracle Database Appliance）在OAK 18.6以上的版本，每间隔半小时会在/var/mail/root邮件中提示一个错误Error getting repository data for ol6_x86_64_userspace_ksplice, repository not found,具体邮件内容如下：1234567891011121314151617181920212223242526272829From root@valdb01.oracle.com Wed Jun 16 19:09:02 2021Return-Path: &lt;root@valdb01.oracle.com&gt;Received: from valdb01.oracle.com (localhost [127.0.0.1]) by valdb01.oracle.com (8.14.7/8.14.7) with ESMTP id 15GB92da008414 for &lt;root@valdb01.oracle.com&gt;; Wed, 16 Jun 2021 19:09:02 +0800Received: (from root@localhost) by valdb01.oracle.com (8.14.7/8.14.7/Submit) id 15GB924p008263; Wed, 16 Jun 2021 19:09:02 +0800Date: Wed, 16 Jun 2021 19:09:02 +0800Message-Id: &lt;202106161109.15GB924p008263@valdb01.oracle.com&gt;From: \"(Cron Daemon)\" &lt;root@valdb01.oracle.com&gt;To: root@valdb01.oracle.comSubject: Cron &lt;root@valdb01&gt; export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin &amp;&amp; [ -x /usr/bin/ksplice ] &amp;&amp; (/usr/bin/ksplice --cron user upgrade; /usr/bin/ksplice --cron xen upgrade)Content-Type: text/plain; charset=UTF-8Auto-Submitted: auto-generatedPrecedence: bulkX-Cron-Env: &lt;XDG_SESSION_ID=91&gt;X-Cron-Env: &lt;XDG_RUNTIME_DIR=/run/user/0&gt;X-Cron-Env: &lt;LANG=en_US.UTF-8&gt;X-Cron-Env: &lt;SHELL=/bin/sh&gt;X-Cron-Env: &lt;HOME=/root&gt;X-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;X-Cron-Env: &lt;LOGNAME=root&gt;X-Cron-Env: &lt;USER=root&gt;Error getting repository data for ol7_x86_64_userspace_ksplice, repository not found 2. 在Oracle官网可以看到关于Ksplice的相关介绍。Linux系统会定期接收核心操作系统组件的安全更新，这些操作需要打补丁和重启。在传统的操作上需要手动获取并安装更新的RPM包，并且需要安排停机时间，将服务器进行重启，以便更新的到新的程序包的版本。但是随着系统的建设变得越来月复杂，存在许多相互的依赖关系，对应服务和应用程序的访问必须尽可能的保持不中断。通过Ksplice，可以使用最新的内核和关键用户空间安全和错误修复更新。从而保证系统的安全性和高可用性。3. 通过对官网文档关于Ksplice的解读，发现这是一个会自动进行内核安全更新的一个工具，但是在ODA的使用环境绝大数都是拒绝连接外网，Ksplice在执行的使用需要使用ULN（Unbreakable Linux Network），但是YUM源中没有Ksplice的repo，，所以在Ksplice在发起更新的时候发现没有对应的repo。即便有也不能连接外网。关于Ksplice具体的脚本路径和内容如下：12345678910111213141516171819[root@valdb01 cron.d]# pwd/etc/cron.d[root@valdb01 cron.d]# [root@valdb01 cron.d]# cat ksplice # Replaced by Ksplice on 2020-11-23# /etc/cron.d/ksplice: cron job for the Ksplice client## PLEASE DO NOT MODIFY THIS CRON JOB.# Instead, contact Ksplice Support at ksplice-support_ww@oracle.com.## The offsets below are chosen specifically to distribute server load# and allow for Ksplice server maintenance windows. This cron job# also only contacts the Ksplice server every Nth time it runs,# depending on a load control setting on the Ksplice server.## If you would like to adjust the frequency with which your# systems check for updates, please contact Ksplice Support at# ksplice-support_ww@oracle.com9,39 * * * * root export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin &amp;&amp; [ -x /usr/bin/ksplice ] &amp;&amp; (/usr/bin/ksplice --cron user upgrade; /usr/bin/ksplice --cron xen upgrade) 4. 既然不能连接外网，那么我们通过将Ksplice的脚本移出cron.d，放到其他位置，来解决因这个脚本定时运行而导致的这个错误。123456789101112131415161718[root@valdb01 cron.d]# lltotal 20-rw-r--r--. 1 root root 128 Jun 9 2019 0hourly-rw-r--r--. 1 root root 817 Nov 23 2020 ksplice-rw-r--r--. 1 root root 108 Apr 1 2020 raid-check-rw-------. 1 root root 235 Apr 1 2020 sysstat-rw-r--r--. 1 root root 748 Nov 23 2020 uptrack# 移动[root@valdb01 cron.d]# mv ksplice /root/Extras/# 检查[root@valdb01 cron.d]# lltotal 20-rw-r--r--. 1 root root 128 Jun 9 2019 0hourly-rw-r--r--. 1 root root 108 Apr 1 2020 raid-check-rw-------. 1 root root 235 Apr 1 2020 sysstat-rw-r--r--. 1 root root 748 Nov 23 2020 uptrack","categories":[{"name":"Oracle Database Appliance","slug":"Oracle-Database-Appliance","permalink":"http://mudbub.com/categories/Oracle-Database-Appliance/"}],"tags":[{"name":"Ksplice","slug":"Ksplice","permalink":"http://mudbub.com/tags/Ksplice/"}],"author":["Falkon"]},{"title":"Alter database move datafile","slug":"database/alter-database-move-datafile-to","date":"2021-05-07T02:03:27.903Z","updated":"2021-05-07T07:40:23.490Z","comments":true,"path":"2021/05/07/database/alter-database-move-datafile-to/","link":"","permalink":"http://mudbub.com/2021/05/07/database/alter-database-move-datafile-to/","excerpt":"","text":"在我们日常工作中，会经常发现客户的数据库因为应用方操作问题导致数据文件没有建立在正确的位置上，在数据库意外关闭后，发现某个节点无法启动，无法启动的节点报ORA-01157、ORA-01110的错误，在12.2以前的版本我们需要将表空间offline后进行移动，或者删除后重建，后者会造成数据的丢失。在12.2以后的版本中Oracle提供了可以在线移动数据文件的操作，很大方便了DBA的日常工作，下面演示了19c CDB数据库中PDB1的数据文件路径创建错误的境况下，如何在线移动数据文件。 查看现有的数据文件 1234567891011121314151617181920212223242526272829SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO 4 TESTPDB READ WRITE NOSQL&gt;SQL&gt;SQL&gt;SQL&gt; alter session set container=pdb1;Session altered.SQL&gt;SQL&gt;SQL&gt;SQL&gt; select file_name from dba_data_files;FILE_NAME--------------------------------------------------------------------------------+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.10620026676 rows selected. 模拟数据文件路径创建错误 12345678910111213141516SQL&gt; create tablespace test01 datafile '/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf' size 1m;Tablespace created.SQL&gt;SQL&gt; select file_name from dba_data_files;FILE_NAME--------------------------------------------------------------------------------+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.1062002667/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf 节点1和节点2关闭PDB后重启 123456789101112131415161718SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 MOUNTED 4 TESTPDB READ WRITE NOSQL&gt;SQL&gt;SQL&gt;SQL&gt;SQL&gt; alter pluggable database pdb1 open;alter pluggable database pdb1 open*ERROR at line 1:ORA-01157: cannot identify/lock data file 25 - see DBWR trace fileORA-01110: data file 25:'/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf' 在节点1移动数据文件到正确路径 123456789101112131415161718SQL&gt; alter database move datafile '/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf' to '+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/test01.dbf';Database altered.SQL&gt;SQL&gt; select file_name from dba_data_files;FILE_NAME--------------------------------------------------------------------------------+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.1062002667+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/test01.dbf7 rows selected. 再次启动节点2的PDB123456789101112SQL&gt; alter pluggable database pdb1 open;Pluggable database altered.SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO 4 TESTPDB READ WRITE NOSQL&gt; 在数据文件移动到正确的位置后，PDB已经可以正常启动","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"Datafile","slug":"Datafile","permalink":"http://mudbub.com/tags/Datafile/"}],"author":["Falkon"]},{"title":"Linux SSH限制IP登录","slug":"linux/ssh-limit-ip-login","date":"2021-04-22T07:13:20.110Z","updated":"2021-05-06T07:07:38.807Z","comments":true,"path":"2021/04/22/linux/ssh-limit-ip-login/","link":"","permalink":"http://mudbub.com/2021/04/22/linux/ssh-limit-ip-login/","excerpt":"在不开启防火墙的情况下，通过使用hosts的方式来实现限制某些IP登录到主机 方法1 通过配置hosts.allow和hosts.deny实现SSH限制IP登录","text":"在不开启防火墙的情况下，通过使用hosts的方式来实现限制某些IP登录到主机 方法1 通过配置hosts.allow和hosts.deny实现SSH限制IP登录 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# 在/etc/hosts.allow添加允许的IP地址或者IP段## hosts.allow This file contains access rules which are used to# allow or deny connections to network services that# either use the tcp_wrappers library or that have been# started through a tcp_wrappers-enabled xinetd.## See 'man 5 hosts_options' and 'man 5 hosts_access'# for information on rule syntax.# See 'man tcpd' for information on tcp_wrappers#sshd:192.168.56.1:allow# 在/etc/hosts.deny中拒绝所有## hosts.deny This file contains access rules which are used to# deny connections to network services that either use# the tcp_wrappers library or that have been# started through a tcp_wrappers-enabled xinetd.## The rules in this file can also be set up in# /etc/hosts.allow with a 'deny' option instead.## See 'man 5 hosts_options' and 'man 5 hosts_access'# for information on rule syntax.# See 'man tcpd' for information on tcp_wrappers#sshd:ALL# 重启sshd服务[root@localhost ~]# service sshd restartStopping sshd: [ OK ]Starting sshd: [ OK ]# 测试把/etc/hosts.allow修改为非本机IP登录[C:\\~]$ ssh 192.168.56.20Connecting to 192.168.56.20:22...Connection established.To escape to local shell, press 'Ctrl+Alt+]'.Connection closing...Socket close.Connection closed by foreign host.Disconnected from remote host(192.168.56.20:22) at 15:20:29.Type `help' to learn how to use Xshell prompt. 方法2 在sshd_config添加allowusers，限制SSH的IP访问 123456789# 在sshd_config的末尾添加如下内容，其说明为允许某个IP的某个用户登录[root@localhost ~]# cat /etc/ssh/sshd_config | grep allowusersallowusers root@192.168.56.1# 重启sshd服务[root@localhost ~]# service sshd restartStopping sshd: [ OK ]Starting sshd: [ OK ]","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"SSH","slug":"SSH","permalink":"http://mudbub.com/tags/SSH/"}],"author":["Falkon"]},{"title":"ALUA port group messages","slug":"linux/alua-port-group-messages","date":"2021-04-12T01:35:25.065Z","updated":"2021-04-30T07:50:25.891Z","comments":true,"path":"2021/04/12/linux/alua-port-group-messages/","link":"","permalink":"http://mudbub.com/2021/04/12/linux/alua-port-group-messages/","excerpt":"","text":"环境CentOS Linux release 7.9.2009 (Core) Messages日志 12345678Apr 8 07:44:27 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:44:33 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:44:41 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:44:46 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:44:59 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:45:02 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:45:07 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:45:14 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA 原因如果存储支持ALUA（非对称逻辑单元访问），这些消息将显示检测到端口组及其支持的ALUA的状态。 处理这些消息只是一些信息，不能表明在使用的环境有没有问题，如果现在使用的系统中有问题则这些消息具有参考的价值。 附加信息Example： Apr 8 07:44:27 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:44:33 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:44:41 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:44:46 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:44:59 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNAApr 8 07:45:02 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:45:07 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNAApr 8 07:45:14 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA tolUsNA中的每字母代表SCSI多路径配置中由LUN服务的目标端口组的非对称访问状态Transitioning/Offline/LBA/Unavail/Standby/Non-Opt active/Active. 在初始化和配置目标端口组时，改配置规定了目标端口组可以使用哪些的非对称端口组状态进行报告，大写字母记录的状态是当前报告的目标端口组对给定的LUN能够使用的非对称访问状态. 对记录信息进行细分 &#39;alua: port group 3e9&#39;此消息部分标识要报告的目标端口组，在本例中端口组是3e9 &#39;state N preferred&#39;目标端口组所处的非对称访问的当前状态，此时目标端口组3e9的状态是Non-Optimized &#39;supports tolUsNA&#39; 报告目标端口组提供的一组受支持的非对称访问状态，在这种情况下，目标端口组3e9的多路径配置支持Unavailable, Non-Optimized Active and Active-Optimized","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"ALUA","slug":"ALUA","permalink":"http://mudbub.com/tags/ALUA/"}],"author":["Falkon"]},{"title":"Rename SYS","slug":"database/oracle-rename-sys","date":"2021-03-31T01:19:17.478Z","updated":"2021-05-07T07:50:32.610Z","comments":true,"path":"2021/03/31/database/oracle-rename-sys/","link":"","permalink":"http://mudbub.com/2021/03/31/database/oracle-rename-sys/","excerpt":"","text":"等保2.0其中的一项要求，重命名默认的SYS和SYSTEM账户。根据测试12.2.0.1的之前版本是可以进行重命名的，但是启动数据库会报ORA-01092、ORA-00600错误，12.2.0.1以后的版本进行重命名操作提示无权限，MOS官网也告知是不能从命名这些账户，文章ID 2552175.1，但是可以通过禁用或者锁定的方式来进行SYS和SYSTEM的访问控制，具体测试如下 12.2.0.1重命名SYS 1234567891011121314151617181920212223242526SQL&gt; update user$ set name='SYSDB21' where user#=0;1 row updated. -- 检查修改后的结果SQL&gt; select name,user# from user$ where user#=0;NAME USER#------------------------------ ----------SYSDB21 0-- 重新启动数据库进行验证SQL&gt; startup ORACLE instance started.Total System Global Area 2304909312 bytesFixed Size 2290896 bytesVariable Size 721423152 bytesDatabase Buffers 1577058304 bytesRedo Buffers 4136960 bytesDatabase mounted.ORA-01092: ORACLE instance terminated. Disconnection forcedORA-00600: internal error code, arguments: [kokasgi1], [], [], [], [], [], [],[], [], [], [], []Process ID: 32096Session ID: 1 Serial number: 5 12.2.0.1之前的版本都可以重新命名SYS和SYSTEM用户，但带来的结果是数据库无法启动，因此针对等保给出要求，建议采用禁用SYS用户和SYSTEM 19.0.0.0重命名SYS 12345678910111213141516171819SQL&gt; select banner from v$version;BANNER--------------------------------------------------------------------------------Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionSQL&gt; select name,user# from user$ where name='SYS';NAME USER#------------------------------ ----------SYS 0SQL&gt; update user$ set name='SYSDB20' where user#=0;update user$ set name='SYSDB20' where user#=0 *ERROR at line 1:ORA-01031: insufficient privileges 通过其他的方式来禁用或者锁定SYSTEM用户 1234567891011121314151617181920212223242526272829-- 锁定SYS用户SQL&gt; alter user sys account lock;User altered.-- 重启数据库验证SQL&gt; startupORACLE instance started.Total System Global Area 2304909312 bytesFixed Size 2290896 bytesVariable Size 721423152 bytesDatabase Buffers 1577058304 bytesRedo Buffers 4136960 bytesDatabase mounted.Database opened.-- 连接验证[oracle@oracle ~]$ sqlplus sys/yourpassword@10.10.251.58/ora as sysdbaSQL*Plus: Release 12.1.0.1.0 Production on Fri Apr 23 02:51:47 2021Copyright (c) 1982, 2013, Oracle. All rights reserved.ERROR:ORA-28000: the account is lockedEnter user-name:","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"SYS","slug":"SYS","permalink":"http://mudbub.com/tags/SYS/"},{"name":"ORA-01031","slug":"ORA-01031","permalink":"http://mudbub.com/tags/ORA-01031/"}],"author":["Falkon"]},{"title":"ODA X8-2 HA RAID模式错误处理","slug":"database/oda-x8-2-ha-nvme-raid","date":"2021-03-26T09:28:17.607Z","updated":"2021-03-26T10:18:28.188Z","comments":true,"path":"2021/03/26/database/oda-x8-2-ha-nvme-raid/","link":"","permalink":"http://mudbub.com/2021/03/26/database/oda-x8-2-ha-nvme-raid/","excerpt":"","text":"客户的一套ODA X8-2 HA的数据库一体机说是无法罐装系统，看完之后发现工程师电脑的JDK版本有有问题，无法调用ODA一体机的虚拟控制台，在使用自己电脑罐装系统后发现有一台节点的本地磁盘变成了两块，默认是两块NVMe的SSD做好了RAID，进入BIOS查看后发现有问题的节点（节点1）的Boot Option和节点2的不一样。具体如下： 节点1和节点2的Boot Option对比 12345节点1Boot Option #1 [Oracle DB Appliance (P4: INTEL SSDSCKKB480GB)]节点2Boot Option #1 [Oracle DB Appliance (Intel Volume0)] 检查PCH SATA Configuration 123456节点1Configure SATA as [AHCI]节点2Configure SATA as [RAID]发下节点的1的模式被修改成了AHCI 将节点的模式改回RAID后，创建RAID名称Volume0，创建完成后保存配置重启。重新启动后检查RAID模式是否正常，然后再重新刷机。 刷机完成后检查正常，数据库可以正常安装和使用","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ODA","slug":"ODA","permalink":"http://mudbub.com/tags/ODA/"},{"name":"RAID","slug":"RAID","permalink":"http://mudbub.com/tags/RAID/"}],"author":["Falkon"]},{"title":"Oracle常见误操作数据恢复","slug":"database/oracle-database-misoperation-recovery","date":"2021-03-26T07:33:31.629Z","updated":"2021-03-26T10:19:40.162Z","comments":true,"path":"2021/03/26/database/oracle-database-misoperation-recovery/","link":"","permalink":"http://mudbub.com/2021/03/26/database/oracle-database-misoperation-recovery/","excerpt":"","text":"SQL&gt; select flashback_on from v$database; 123FLASHBACK_ON------------------NO 查看插入的数据 123456789101112131415161718192021222324252627SQL&gt; select * from t1; ID NAME---------- -------------------------------------------------- 1 Music 2 Movies 3 TV Shows 4 Audiobooks 5 90???s Music 6 Audiobooks 7 Movies 8 Music 9 Music Videos 10 TV Shows 11 Brazilian Music ID NAME---------- -------------------------------------------------- 12 Classical 13 Classical 101 - Deep Cuts 14 Classical 101 - Next Steps 15 Classical 101 - The Basics 16 Grunge 17 Heavy Metal Classic 18 On-The-Go 118 rows selected. drop t1表 123456789101112131415161718192021222324252627282930313233343536SQL&gt; drop table t1;Table dropped.SQL&gt; flashback table t1 to before drop;Flashback complete.SQL&gt; SQL&gt; select * from t1; ID NAME---------- -------------------------------------------------- 1 Music 2 Movies 3 TV Shows 4 Audiobooks 5 90???s Music 6 Audiobooks 7 Movies 8 Music 9 Music Videos 10 TV Shows 11 Brazilian Music ID NAME---------- -------------------------------------------------- 12 Classical 13 Classical 101 - Deep Cuts 14 Classical 101 - Next Steps 15 Classical 101 - The Basics 16 Grunge 17 Heavy Metal Classic 18 On-The-Go 118 rows selected. delete t1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374SQL&gt; delete from t1;18 rows deleted.SQL&gt; commit;Commit complete.SQL&gt; SQL&gt; select * from t1;no rows selectedSQL&gt; SQL&gt; select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss'); ID NAME---------- -------------------------------------------------- 1 Music 2 Movies 3 TV Shows 4 Audiobooks 5 90???s Music 6 Audiobooks 7 Movies 8 Music 9 Music Videos 10 TV Shows 11 Brazilian Music ID NAME---------- -------------------------------------------------- 12 Classical 13 Classical 101 - Deep Cuts 14 Classical 101 - Next Steps 15 Classical 101 - The Basics 16 Grunge 17 Heavy Metal Classic 18 On-The-Go 118 rows selected.SQL&gt; insert into t1(id,name) select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss');18 rows created.SQL&gt; select * from t1; ID NAME---------- -------------------------------------------------- 1 Music 2 Movies 3 TV Shows 4 Audiobooks 5 90???s Music 6 Audiobooks 7 Movies 8 Music 9 Music Videos 10 TV Shows 11 Brazilian Music ID NAME---------- -------------------------------------------------- 12 Classical 13 Classical 101 - Deep Cuts 14 Classical 101 - Next Steps 15 Classical 101 - The Basics 16 Grunge 17 Heavy Metal Classic 18 On-The-Go 118 rows selected. delete t1表的部分数据 12345678910111213141516171819202122232425262728293031323334353637383940SQL&gt; delete from t1 where id &gt; 10;8 rows deleted.SQL&gt; select * from t1; ID NAME---------- -------------------------------------------------- 1 Music 2 Movies 3 TV Shows 4 Audiobooks 5 90???s Music 6 Audiobooks 7 Movies 8 Music 9 Music Videos 10 TV Shows10 rows selected.SQL&gt; commit;Commit complete.SQL&gt; select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss') where id &gt; 10; ID NAME---------- -------------------------------------------------- 11 Brazilian Music 12 Classical 13 Classical 101 - Deep Cuts 14 Classical 101 - Next Steps 15 Classical 101 - The Basics 16 Grunge 17 Heavy Metal Classic 18 On-The-Go 18 rows selected. truncate t1表 1234567891011SQL&gt; truncate table t1;Table truncated.SQL&gt; select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss');select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss') *ERROR at line 1:ORA-01466: unable to read data - table definition has changed#truncate 不会产生日志和回滚段空间的使用，不能使用闪回恢复，如需要恢复需要借助第三方工具进行，如ODU,BBED等 drop table purge t1表1234567891011SQL&gt; drop table t1 purge;Table dropped.SQL&gt; flashback table t1 to before drop;flashback table t1 to before drop*ERROR at line 1:ORA-38305: object not in RECYCLE BIN#purge参数删除的表不进回收站，闪回不可以，如果需要恢复参见truncate table","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"Recovery","slug":"Recovery","permalink":"http://mudbub.com/tags/Recovery/"},{"name":"Flashback","slug":"Flashback","permalink":"http://mudbub.com/tags/Flashback/"}],"author":["Falkon"]},{"title":"WARNING too many parse errors","slug":"database/warning-too-many-parse-errors","date":"2021-03-22T05:12:25.735Z","updated":"2021-04-20T06:46:46.748Z","comments":true,"path":"2021/03/22/database/warning-too-many-parse-errors/","link":"","permalink":"http://mudbub.com/2021/03/22/database/warning-too-many-parse-errors/","excerpt":"","text":"客户数据库巡检的过程中发现大量的WARNING: too many parse errors，客户的数据库版本为12.2.0.1，从12.2开始，当解析失败超过一定的次数，alert日志会记录相关信息，以便对解析失败的语句进行排查 通过查询MOS，_kks_parse_error_warning参数控制相关记录，默认是每100次解析失败便会写入alert日志。 查看参数默认值 12345678910111213141516171819SQL&gt; set linesize 200SQL&gt; col name for a52 SQL&gt; col value for a24SQL&gt; col description for a50SQL&gt; SQL&gt; SQL&gt; select a.ksppinm name,b.ksppstvl value,a.ksppdesc description from x$ksppi a,x$ksppcv b where a.inst_id = USERENV ('Instance') and b.inst_id = USERENV ('Instance') and a.indx = b.indx and upper(a.ksppinm) like upper('%&amp;param%') order by name; 2 3 4 5 6 Enter value for param: _kks_parse_error_warningold 6: and upper(a.ksppinm) like upper('%&amp;param%') order by namenew 6: and upper(a.ksppinm) like upper('%_kks_parse_error_warning%') order by nameNAME VALUE DESCRIPTION-------------------------- ---------------- --------------------------------------------------_kks_parse_error_warning 100 Parse error warning 为了重现这个错误，将这个默认参数修改为1 123SQL&gt; alter system set \"_kks_parse_error_warning\"=1;System altered. 分别在CDB和PDB中执行一条错误的查询语句 12345678910111213141516SQL&gt; select * from t1;select * from t1 *ERROR at line 1:ORA-00942: table or view does not existSQL&gt; alter session set container=pdb1;Session altered.SQL&gt; select * from t2;select * from t2 *ERROR at line 1:ORA-00942: table or view does not exist 观察测试日志信息 1234567891011121314151617181920212223Thread 1 advanced to log sequence 101 (LGWR switch), current SCN: 14562135 Current log# 1 seq# 101 mem# 0: +DATA/GRASDT/ONLINELOG/group_1.270.1061811373 Current log# 1 seq# 101 mem# 1: +RECO/GRASDT/ONLINELOG/group_1.260.10618113772021-03-22T04:05:52.735099+08:00ARC1 (PID:14385): Archived Log entry 149 added for T-1.S-100 ID 0xc81485a7 LAD:12021-03-22T12:41:20.018404+08:00ALTER SYSTEM SET _kks_parse_error_warning=1 SCOPE=BOTH;2021-03-22T12:41:58.818554+08:00WARNING: too many parse errors, count=1 SQL hash=0x85dd68f7 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;PARSE ERROR: ospid=24715, error=942 for statement: 2021-03-22T12:41:58.819084+08:00select * from t1Additional information: hd=0x85c676a8 phd=0xa9e0e438 flg=0x28 cisid=0 sid=0 ciuid=0 uid=0 sqlid=27uhu2q2xuu7r...Current username=SYS...Application: sqlplus@db-oracle-193-grasdt01 (TNS V1-V3) Action: 2021-03-22T12:43:10.832224+08:00PDB1(3):WARNING: too many parse errors, count=1 SQL hash=0x4895f57f &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;PDB1(3):PARSE ERROR: ospid=24715, error=942 for statement: 2021-03-22T12:43:10.832785+08:00PDB1(3):select * from t2PDB1(3):Additional information: hd=0xb4706f70 phd=0x9ba64de0 flg=0x28 cisid=0 sid=0 ciuid=0 uid=0 sqlid=741xfy549bxbzPDB1(3):...Current username=SYSPDB1(3):...Application: sqlplus@db-oracle-193-grasdt01 (TNS V1-V3) Action: 总结根据以上测试，发现_kks_parse_error_warning这个参数控制着解析失败后达到参数设置的值，在alert日志中出现WARNING: too many parse errors，可以通过设置_kks_parse_error_warning参数的值为0来规避alert日志的告警信息，但一般不建议这么错，最好是根据日志中的提示，找到相应的语句进行修改。确保这条语句是正确合法的。","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"Parse","slug":"Parse","permalink":"http://mudbub.com/tags/Parse/"}],"author":["Falkon"]},{"title":"Linux crontab工作定义详解","slug":"linux/crontab-time-format-explain-in-detail","date":"2021-02-22T06:20:36.760Z","updated":"2021-04-30T07:50:57.196Z","comments":true,"path":"2021/02/22/linux/crontab-time-format-explain-in-detail/","link":"","permalink":"http://mudbub.com/2021/02/22/linux/crontab-time-format-explain-in-detail/","excerpt":"","text":"工作定义示例 12345678# Example of job definition:# .---------------- minute (0 - 59)# | .------------- hour (0 - 23)# | | .---------- day of month (1 - 31)# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# | | | | |# * * * * * user-name command to be executed 由上面的示例可以看到，整个crontab由三个部分组成：第一部分为时间；第二部分为用户；第三部分为命令。我们着重理解时间部分的定义，时间部分默认由5个*组成，从左至右分别代表分钟（0-59）、小时（0-23）、天（1-31）、月（1-12）、周（0-6），从下面的示例中来理解这些时间之间是如何配合的。 加入我们的数据库需要在每天晚上11点进行备份，脚本我们已经写好了，那么我们要如何来设置这个计划任务呢？首先我们看下分钟的部分，因为11点是整时，正常的时间显示是：PM 11:00，由于这里是24小时制，所以正确的时间写法是：23:00，由于crontab的时间格式为分钟在前，小时在后，那么时间的写法为：00 23，我们可以如下所示编写计划任务。 10 23 * * * backup-database.sh 脚本写好后，我们需要测试备份脚本，不可能等到晚上11点，我们想每隔10分钟执行一次数据库备份，以便来测试备份脚本，我们需要怎么做呢？我们可以通过/来对时间间隔进行处理，如下所示： 1*/10 * * * * backup-database.sh 那么如果每隔2小时或者两天、两个月呢？同理，只要在相应的时间位置上*/2就可以。 如果我们这样写*/2 */2 */2 */2 */2会出现什么样的效果呢 ，留给各位的思考，哈哈哈？ 上面演示的都是安装固定的时间或者固定的间隔时间在进行计划任务的，但是我们根据备份周期的要求，备份只能在周一至周五运行，周六和周天不执行备份，那么我们可以使用-来指定从什么时间到什么时间，如下所示： 10 23 * * 0-4 backup-database.sh 其他的指定时间段同理，比如从0-10分钟这个时间段（如果后面的小时为*，如：0-10 * * * *，表示每个小时的0-10分钟都会运行脚本），我们看下时间段内复杂的写法，0-10 0-10 1-10 1-6 0-4，这样的写法代表，1至10月的1号-10号的0点-10点的0份-10分运行这个脚本，这里有个特殊的地方最后一些的周一至周五的时间和1号-10号的时间是怎么处理的","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"Crontab","slug":"Crontab","permalink":"http://mudbub.com/tags/Crontab/"}],"author":["Falkon"]},{"title":"在Docker中备份MySQL，备份文件中没有数据","slug":"linux/backup-in-the-docker-dumpfile-0","date":"2021-02-20T16:46:34.382Z","updated":"2021-04-30T07:50:36.489Z","comments":true,"path":"2021/02/21/linux/backup-in-the-docker-dumpfile-0/","link":"","permalink":"http://mudbub.com/2021/02/21/linux/backup-in-the-docker-dumpfile-0/","excerpt":"","text":"在Docker中使用脚本备份MySQL的时候出现一个奇怪的问题，产生的备份文件大小都为零，没有任何数据。但是手动执行脚本文件时候，备份文件中数据是完整的。 备份脚本如下 123456[root@docker-host ~]# cat backup-mysql-redmine.sh #!/bin/bashbak_dir=\"/backups/mysql-redmine\"bak_time=`date +%Y%m%d-%H-%M-%S`docker exec -it c51994799113 mysqldump -uroot -proot redmine &gt; $bak_dir/redmine-$bak_time.sql 计划任务如下 12[root@docker-host ~]# crontab -l*/5 * * * * /root/backup-mysql-redmine.sh crontab产生备份文件如下 12345[root@docker-host mysql-redmine]# lltotal 0-rw-r--r--. 1 root root 0 Feb 21 00:45 redmine-20210221-00-45-01.sql-rw-r--r--. 1 root root 0 Feb 21 00:50 redmine-20210221-00-50-01.sqlYou have new mail in /var/spool/mail/root 系统产生的邮件内容 12345678910111213141516171819202122232425262728You have new mail in /var/spool/mail/root[root@docker-host mysql-redmine]# [root@docker-host mysql-redmine]# [root@docker-host mysql-redmine]# more /var/spool/mail/root From root@docker-host.localdomain Sat Feb 20 21:55:01 2021Return-Path: &lt;root@docker-host.localdomain&gt;X-Original-To: rootDelivered-To: root@docker-host.localdomainReceived: by docker-host.localdomain (Postfix, from userid 0) id D3D0E619B686; Sat, 20 Feb 2021 21:55:01 +0800 (CST)From: \"(Cron Daemon)\" &lt;root@docker-host.localdomain&gt;To: root@docker-host.localdomainSubject: Cron &lt;root@docker-host&gt; /root/backup-mysql-redmine.shContent-Type: text/plain; charset=UTF-8Auto-Submitted: auto-generatedPrecedence: bulkX-Cron-Env: &lt;XDG_SESSION_ID=6&gt;X-Cron-Env: &lt;XDG_RUNTIME_DIR=/run/user/0&gt;X-Cron-Env: &lt;LANG=en_US.UTF-8&gt;X-Cron-Env: &lt;SHELL=/bin/sh&gt;X-Cron-Env: &lt;HOME=/root&gt;X-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;X-Cron-Env: &lt;LOGNAME=root&gt;X-Cron-Env: &lt;USER=root&gt;Message-Id: &lt;20210220135501.D3D0E619B686@docker-host.localdomain&gt;Date: Sat, 20 Feb 2021 21:55:01 +0800 (CST)the input device is not a TTY 分析上面的备份命令中从mysqldump之后的命令我们是理解的，跟正常的MySQL的备份使用是一致的，那么问题应该出现在docker exec -it c51994799113这半条命令里面，首先docker exec根据官网的描述是：Run a command in a running container，意思是说在容器中运行命令，那么排除了这条命令出现问题的可能。其次c51994799113这个只是MySQL的容器ID，那么问题应该就出现在-it这个参数上了，执行docker exec --help来查看命令的帮助： 12345678910111213141516[root@docker-host ~]# docker exec --helpUsage: docker exec [OPTIONS] CONTAINER COMMAND [ARG...]Run a command in a running containerOptions: -d, --detach Detached mode: run command in the background --detach-keys string Override the key sequence for detaching a container -e, --env list Set environment variables --env-file list Read in a file of environment variables -i, --interactive Keep STDIN open even if not attached --privileged Give extended privileges to the command -t, --tty Allocate a pseudo-TTY -u, --user string Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;]) -w, --workdir string Working directory inside the container 在帮助中找到tty相关，描述为分配一个伪tty终端。 总结TTY是终端设备的统称，来源于Teletypes，或者teletypewriters。the input device is not a TTY 这句话的意思是：后台Linux执行的时候不是终端设备。一般在docker里执行命令的时候都喜欢加上-it这个参数，这个参数表示终端设备，所以Docker执行后台任务或者程序时去掉-it这个参数就可以了。","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://mudbub.com/tags/Docker/"},{"name":"MySQL","slug":"MySQL","permalink":"http://mudbub.com/tags/MySQL/"}],"author":["Falkon"]},{"title":"CentOS 7.9 安装 Docker","slug":"linux/docker-installation-for-centos79","date":"2021-02-20T15:02:32.735Z","updated":"2021-04-30T07:51:06.484Z","comments":true,"path":"2021/02/20/linux/docker-installation-for-centos79/","link":"","permalink":"http://mudbub.com/2021/02/20/linux/docker-installation-for-centos79/","excerpt":"","text":"查看操作系统版本 12[root@docker-host ~]# cat /etc/redhat-release CentOS Linux release 7.9.2009 (Core) 安装yum-utils 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566[root@docker-host ~]# yum -y install yum-utilsLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfile * base: mirrors.aliyun.com * extras: mirrors.aliyun.com * updates: mirrors.aliyun.comResolving Dependencies--&gt; Running transaction check---&gt; Package yum-utils.noarch 0:1.1.31-54.el7_8 will be installed--&gt; Processing Dependency: python-kitchen for package: yum-utils-1.1.31-54.el7_8.noarch--&gt; Processing Dependency: libxml2-python for package: yum-utils-1.1.31-54.el7_8.noarch--&gt; Running transaction check---&gt; Package libxml2-python.x86_64 0:2.9.1-6.el7.5 will be installed---&gt; Package python-kitchen.noarch 0:1.1.1-5.el7 will be installed--&gt; Processing Dependency: python-chardet for package: python-kitchen-1.1.1-5.el7.noarch--&gt; Running transaction check---&gt; Package python-chardet.noarch 0:2.2.1-3.el7 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved================================================================================== Package Arch Version Repository Size==================================================================================Installing: yum-utils noarch 1.1.31-54.el7_8 base 122 kInstalling for dependencies: libxml2-python x86_64 2.9.1-6.el7.5 base 247 k python-chardet noarch 2.2.1-3.el7 base 227 k python-kitchen noarch 1.1.1-5.el7 base 267 kTransaction Summary==================================================================================Install 1 Package (+3 Dependent packages)Total download size: 863 kInstalled size: 4.3 MDownloading packages:Delta RPMs disabled because /usr/bin/applydeltarpm not installed.(1/4): libxml2-python-2.9.1-6.el7.5.x86_64.rpm | 247 kB 00:00:00 (2/4): yum-utils-1.1.31-54.el7_8.noarch.rpm | 122 kB 00:00:00 (3/4): python-chardet-2.2.1-3.el7.noarch.rpm | 227 kB 00:00:00 (4/4): python-kitchen-1.1.1-5.el7.noarch.rpm | 267 kB 00:00:00 ----------------------------------------------------------------------------------Total 1.5 MB/s | 863 kB 00:00 Running transaction checkRunning transaction testTransaction test succeededRunning transaction Installing : python-chardet-2.2.1-3.el7.noarch 1/4 Installing : python-kitchen-1.1.1-5.el7.noarch 2/4 Installing : libxml2-python-2.9.1-6.el7.5.x86_64 3/4 Installing : yum-utils-1.1.31-54.el7_8.noarch 4/4 Verifying : libxml2-python-2.9.1-6.el7.5.x86_64 1/4 Verifying : python-kitchen-1.1.1-5.el7.noarch 2/4 Verifying : yum-utils-1.1.31-54.el7_8.noarch 3/4 Verifying : python-chardet-2.2.1-3.el7.noarch 4/4 Installed: yum-utils.noarch 0:1.1.31-54.el7_8 Dependency Installed: libxml2-python.x86_64 0:2.9.1-6.el7.5 python-chardet.noarch 0:2.2.1-3.el7 python-kitchen.noarch 0:1.1.1-5.el7 Complete! 添加阿里的yum（docker）源 12345[root@docker-host ~]# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repoLoaded plugins: fastestmirroradding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repograbbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.reporepo saved to /etc/yum.repos.d/docker-ce.repo 更新yum软件包索引 12345678910111213[root@docker-host ~]# yum makecache fastLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfile * base: mirrors.aliyun.com * extras: mirrors.aliyun.com * updates: mirrors.aliyun.combase | 3.6 kB 00:00:00 docker-ce-stable | 3.5 kB 00:00:00 extras | 2.9 kB 00:00:00 updates | 2.9 kB 00:00:00 (1/2): docker-ce-stable/7/x86_64/primary_db | 55 kB 00:00:01 (2/2): docker-ce-stable/7/x86_64/updateinfo | 55 B 00:00:02 Metadata Cache Created 安装docker 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163[root@docker-host ~]# yum -y install docker-ce docker-ce-cli containerd.ioLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfile * base: mirrors.aliyun.com * extras: mirrors.aliyun.com * updates: mirrors.aliyun.comResolving Dependencies--&gt; Running transaction check---&gt; Package containerd.io.x86_64 0:1.4.3-3.1.el7 will be installed--&gt; Processing Dependency: container-selinux &gt;= 2:2.74 for package: containerd.io-1.4.3-3.1.el7.x86_64--&gt; Processing Dependency: libseccomp for package: containerd.io-1.4.3-3.1.el7.x86_64---&gt; Package docker-ce.x86_64 3:20.10.3-3.el7 will be installed--&gt; Processing Dependency: docker-ce-rootless-extras for package: 3:docker-ce-20.10.3-3.el7.x86_64--&gt; Processing Dependency: libcgroup for package: 3:docker-ce-20.10.3-3.el7.x86_64---&gt; Package docker-ce-cli.x86_64 1:20.10.3-3.el7 will be installed--&gt; Running transaction check---&gt; Package container-selinux.noarch 2:2.119.2-1.911c772.el7_8 will be installed--&gt; Processing Dependency: policycoreutils-python for package: 2:container-selinux-2.119.2-1.911c772.el7_8.noarch---&gt; Package docker-ce-rootless-extras.x86_64 0:20.10.3-3.el7 will be installed--&gt; Processing Dependency: fuse-overlayfs &gt;= 0.7 for package: docker-ce-rootless-extras-20.10.3-3.el7.x86_64--&gt; Processing Dependency: slirp4netns &gt;= 0.4 for package: docker-ce-rootless-extras-20.10.3-3.el7.x86_64---&gt; Package libcgroup.x86_64 0:0.41-21.el7 will be installed---&gt; Package libseccomp.x86_64 0:2.3.1-4.el7 will be installed--&gt; Running transaction check---&gt; Package fuse-overlayfs.x86_64 0:0.7.2-6.el7_8 will be installed--&gt; Processing Dependency: libfuse3.so.3(FUSE_3.2)(64bit) for package: fuse-overlayfs-0.7.2-6.el7_8.x86_64--&gt; Processing Dependency: libfuse3.so.3(FUSE_3.0)(64bit) for package: fuse-overlayfs-0.7.2-6.el7_8.x86_64--&gt; Processing Dependency: libfuse3.so.3()(64bit) for package: fuse-overlayfs-0.7.2-6.el7_8.x86_64---&gt; Package policycoreutils-python.x86_64 0:2.5-34.el7 will be installed--&gt; Processing Dependency: setools-libs &gt;= 3.3.8-4 for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libsemanage-python &gt;= 2.5-14 for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: audit-libs-python &gt;= 2.1.3-4 for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: python-IPy for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libqpol.so.1(VERS_1.4)(64bit) for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libqpol.so.1(VERS_1.2)(64bit) for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libapol.so.4(VERS_4.0)(64bit) for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: checkpolicy for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libqpol.so.1()(64bit) for package: policycoreutils-python-2.5-34.el7.x86_64--&gt; Processing Dependency: libapol.so.4()(64bit) for package: policycoreutils-python-2.5-34.el7.x86_64---&gt; Package slirp4netns.x86_64 0:0.4.3-4.el7_8 will be installed--&gt; Running transaction check---&gt; Package audit-libs-python.x86_64 0:2.8.5-4.el7 will be installed---&gt; Package checkpolicy.x86_64 0:2.5-8.el7 will be installed---&gt; Package fuse3-libs.x86_64 0:3.6.1-4.el7 will be installed---&gt; Package libsemanage-python.x86_64 0:2.5-14.el7 will be installed---&gt; Package python-IPy.noarch 0:0.75-6.el7 will be installed---&gt; Package setools-libs.x86_64 0:3.3.8-4.el7 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved================================================================================== Package Arch Version Repository Size==================================================================================Installing: containerd.io x86_64 1.4.3-3.1.el7 docker-ce-stable 33 M docker-ce x86_64 3:20.10.3-3.el7 docker-ce-stable 27 M docker-ce-cli x86_64 1:20.10.3-3.el7 docker-ce-stable 33 MInstalling for dependencies: audit-libs-python x86_64 2.8.5-4.el7 base 76 k checkpolicy x86_64 2.5-8.el7 base 295 k container-selinux noarch 2:2.119.2-1.911c772.el7_8 extras 40 k docker-ce-rootless-extras x86_64 20.10.3-3.el7 docker-ce-stable 9.0 M fuse-overlayfs x86_64 0.7.2-6.el7_8 extras 54 k fuse3-libs x86_64 3.6.1-4.el7 extras 82 k libcgroup x86_64 0.41-21.el7 base 66 k libseccomp x86_64 2.3.1-4.el7 base 56 k libsemanage-python x86_64 2.5-14.el7 base 113 k policycoreutils-python x86_64 2.5-34.el7 base 457 k python-IPy noarch 0.75-6.el7 base 32 k setools-libs x86_64 3.3.8-4.el7 base 620 k slirp4netns x86_64 0.4.3-4.el7_8 extras 81 kTransaction Summary==================================================================================Install 3 Packages (+13 Dependent packages)Total download size: 104 MInstalled size: 428 MDownloading packages:(1/16): audit-libs-python-2.8.5-4.el7.x86_64.rpm | 76 kB 00:00:00 (2/16): checkpolicy-2.5-8.el7.x86_64.rpm | 295 kB 00:00:00 (3/16): container-selinux-2.119.2-1.911c772.el7_8.noarch.r | 40 kB 00:00:00 warning: /var/cache/yum/x86_64/7/docker-ce-stable/packages/containerd.io-1.4.3-3.1.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEYPublic key for containerd.io-1.4.3-3.1.el7.x86_64.rpm is not installed(4/16): containerd.io-1.4.3-3.1.el7.x86_64.rpm | 33 MB 00:00:20 (5/16): docker-ce-20.10.3-3.el7.x86_64.rpm | 27 MB 00:00:25 (6/16): fuse-overlayfs-0.7.2-6.el7_8.x86_64.rpm | 54 kB 00:00:00 (7/16): libcgroup-0.41-21.el7.x86_64.rpm | 66 kB 00:00:00 (8/16): fuse3-libs-3.6.1-4.el7.x86_64.rpm | 82 kB 00:00:00 (9/16): libseccomp-2.3.1-4.el7.x86_64.rpm | 56 kB 00:00:00 (10/16): libsemanage-python-2.5-14.el7.x86_64.rpm | 113 kB 00:00:00 (11/16): python-IPy-0.75-6.el7.noarch.rpm | 32 kB 00:00:00 (12/16): policycoreutils-python-2.5-34.el7.x86_64.rpm | 457 kB 00:00:00 (13/16): setools-libs-3.3.8-4.el7.x86_64.rpm | 620 kB 00:00:00 (14/16): slirp4netns-0.4.3-4.el7_8.x86_64.rpm | 81 kB 00:00:00 (15/16): docker-ce-rootless-extras-20.10.3-3.el7.x86_64.rp | 9.0 MB 00:00:04 (16/16): docker-ce-cli-20.10.3-3.el7.x86_64.rpm | 33 MB 00:00:09 ----------------------------------------------------------------------------------Total 3.4 MB/s | 104 MB 00:30 Retrieving key from https://download.docker.com/linux/centos/gpgImporting GPG key 0x621E9F35: Userid : \"Docker Release (CE rpm) &lt;docker@docker.com&gt;\" Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35 From : https://download.docker.com/linux/centos/gpgRunning transaction checkRunning transaction testTransaction test succeededRunning transaction Installing : libseccomp-2.3.1-4.el7.x86_64 1/16 Installing : libcgroup-0.41-21.el7.x86_64 2/16 Installing : slirp4netns-0.4.3-4.el7_8.x86_64 3/16 Installing : 1:docker-ce-cli-20.10.3-3.el7.x86_64 4/16 Installing : setools-libs-3.3.8-4.el7.x86_64 5/16 Installing : audit-libs-python-2.8.5-4.el7.x86_64 6/16 Installing : python-IPy-0.75-6.el7.noarch 7/16 Installing : libsemanage-python-2.5-14.el7.x86_64 8/16 Installing : fuse3-libs-3.6.1-4.el7.x86_64 9/16 Installing : fuse-overlayfs-0.7.2-6.el7_8.x86_64 10/16 Installing : checkpolicy-2.5-8.el7.x86_64 11/16 Installing : policycoreutils-python-2.5-34.el7.x86_64 12/16 Installing : 2:container-selinux-2.119.2-1.911c772.el7_8.noarch 13/16 Installing : containerd.io-1.4.3-3.1.el7.x86_64 14/16 Installing : docker-ce-rootless-extras-20.10.3-3.el7.x86_64 15/16 Installing : 3:docker-ce-20.10.3-3.el7.x86_64 16/16 Verifying : checkpolicy-2.5-8.el7.x86_64 1/16 Verifying : fuse3-libs-3.6.1-4.el7.x86_64 2/16 Verifying : 3:docker-ce-20.10.3-3.el7.x86_64 3/16 Verifying : fuse-overlayfs-0.7.2-6.el7_8.x86_64 4/16 Verifying : libsemanage-python-2.5-14.el7.x86_64 5/16 Verifying : slirp4netns-0.4.3-4.el7_8.x86_64 6/16 Verifying : 2:container-selinux-2.119.2-1.911c772.el7_8.noarch 7/16 Verifying : python-IPy-0.75-6.el7.noarch 8/16 Verifying : libseccomp-2.3.1-4.el7.x86_64 9/16 Verifying : containerd.io-1.4.3-3.1.el7.x86_64 10/16 Verifying : policycoreutils-python-2.5-34.el7.x86_64 11/16 Verifying : docker-ce-rootless-extras-20.10.3-3.el7.x86_64 12/16 Verifying : audit-libs-python-2.8.5-4.el7.x86_64 13/16 Verifying : setools-libs-3.3.8-4.el7.x86_64 14/16 Verifying : 1:docker-ce-cli-20.10.3-3.el7.x86_64 15/16 Verifying : libcgroup-0.41-21.el7.x86_64 16/16 Installed: containerd.io.x86_64 0:1.4.3-3.1.el7 docker-ce.x86_64 3:20.10.3-3.el7 docker-ce-cli.x86_64 1:20.10.3-3.el7 Dependency Installed: audit-libs-python.x86_64 0:2.8.5-4.el7 checkpolicy.x86_64 0:2.5-8.el7 container-selinux.noarch 2:2.119.2-1.911c772.el7_8 docker-ce-rootless-extras.x86_64 0:20.10.3-3.el7 fuse-overlayfs.x86_64 0:0.7.2-6.el7_8 fuse3-libs.x86_64 0:3.6.1-4.el7 libcgroup.x86_64 0:0.41-21.el7 libseccomp.x86_64 0:2.3.1-4.el7 libsemanage-python.x86_64 0:2.5-14.el7 policycoreutils-python.x86_64 0:2.5-34.el7 python-IPy.noarch 0:0.75-6.el7 setools-libs.x86_64 0:3.3.8-4.el7 slirp4netns.x86_64 0:0.4.3-4.el7_8 Complete! 启动docker 1[root@docker-host ~]# systemctl start docker 查看docker服务的状态 12345678910111213141516171819202122[root@docker-host ~]# systemctl status docker● docker.service - Docker Application Container Engine Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled) Active: active (running) since Sat 2021-02-20 20:06:57 CST; 10s ago Docs: https://docs.docker.com Main PID: 1833 (dockerd) Tasks: 8 Memory: 43.0M CGroup: /system.slice/docker.service └─1833 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/contai...Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.564408982...cFeb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.564424867...cFeb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.564434731...cFeb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.587687027...\"Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.701550790...\"Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.745648406...\"Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.758999502...3Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.759132059...\"Feb 20 20:06:57 docker-host systemd[1]: Started Docker Application Container ...e.Feb 20 20:06:57 docker-host dockerd[1833]: time=\"2021-02-20T20:06:57.793207055...\"Hint: Some lines were ellipsized, use -l to show in full. 添加开机启动 12[root@docker-host ~]# systemctl enable dockerCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service. 查看docker版本 1234567891011121314151617181920212223242526272829[root@docker-host ~]# docker versionClient: Docker Engine - Community Version: 20.10.3 API version: 1.41 Go version: go1.13.15 Git commit: 48d30b5 Built: Fri Jan 29 14:34:14 2021 OS/Arch: linux/amd64 Context: default Experimental: trueServer: Docker Engine - Community Engine: Version: 20.10.3 API version: 1.41 (minimum version 1.12) Go version: go1.13.15 Git commit: 46229ca Built: Fri Jan 29 14:32:37 2021 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1.4.3 GitCommit: 269548fa27e0089a8b8278fc4fc781d7f65a939b runc: Version: 1.0.0-rc92 GitCommit: ff819c7e9184c13b7c2607fe6c30ae19403a7aff docker-init: Version: 0.19.0 GitCommit: de40ad0 修改或新增docker镜像源 12345[root@docker-host docker]# vi /etc/docker/daemon.json[root@docker-host docker]# cat /etc/docker/daemon.json &#123;\"registry-mirrors\": [\"https://bytkgxyr.mirror.aliyuncs.com\",\"https://registry.docker-cn.com\",\"http://hub-mirror.c.163.com\"]&#125; 测试docker 1234567891011121314151617181920212223242526[root@docker-host docker]# docker run hello-worldUnable to find image 'hello-world:latest' locallylatest: Pulling from library/hello-worldDigest: sha256:31b9c7d48790f0d8c50ab433d9c3b7e17666d6993084c002c2ff1ca09b96391dStatus: Downloaded newer image for hello-world:latestHello from Docker!This message shows that your installation appears to be working correctly.To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub. (amd64) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal.To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bashShare images, automate workflows, and more with a free Docker ID: https://hub.docker.com/For more examples and ideas, visit: https://docs.docker.com/get-started/","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://mudbub.com/tags/Docker/"}],"author":["Falkon"]},{"title":"ZABBIX SERVER IS NOT RENNING THE INFORMATION DISPLAYED MAY NOT BE CORRECT","slug":"linux/zabbix50-server-is-not-running","date":"2021-01-27T09:37:22.776Z","updated":"2021-04-30T07:52:14.040Z","comments":true,"path":"2021/01/27/linux/zabbix50-server-is-not-running/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/zabbix50-server-is-not-running/","excerpt":"Zabbix 5.0 启动后总是弹出ZABBIX SERVER IS NOT RENNING: THE INFORMATION DISPLAYED MAY NOT BE CORRECT，服务器上的zabbix_server和zabbix_client状态都正常，根据网上的资料应该是selinux没有关闭，仔细查看才发现Linux 6.x和Linux 7.x的selinux永久关闭的配置文件的路径时不一样的，处理完错误后赶紧写个操作记录供大家参考学习。","text":"Zabbix 5.0 启动后总是弹出ZABBIX SERVER IS NOT RENNING: THE INFORMATION DISPLAYED MAY NOT BE CORRECT，服务器上的zabbix_server和zabbix_client状态都正常，根据网上的资料应该是selinux没有关闭，仔细查看才发现Linux 6.x和Linux 7.x的selinux永久关闭的配置文件的路径时不一样的，处理完错误后赶紧写个操作记录供大家参考学习。 查看队列显示如下错误 12345connection to Zabbix server \"localhost\" failed. Possible reasons:1. incorrect server IP/DNS in the \"zabbix.conf.php\";2. incorrect DNS server configuration.Permission denied 查看操作系统版本 12[root@pe-sysmonitor-zabbix ~]# cat /etc/redhat-release CentOS Linux release 8.1.1911 (Core) 查看Zabbix版本 12345678[root@pe-sysmonitor-zabbix ~]# /usr/local/zabbix/sbin/zabbix_server -Vzabbix_server (Zabbix) 5.0.1Revision c2a0b03480 25 May 2020, compilation time: Jun 10 2020 22:18:13Copyright (C) 2020 Zabbix SIALicense GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl.html&gt;.This is free software: you are free to change and redistribute it according tothe license. There is NO WARRANTY, to the extent permitted by law. 查看selinux状态 12[root@pe-sysmonitor-zabbix ~]# getenforce enforcing 关闭selinux并重启 12345# 注意：selinux从7.x往后的永久修改关闭的文件跟6.x有很大的却别，6.x关闭的文件为/etc/sysconfig/selinux，而7.x及以后的版本修改的文件为/etc/selinux/config[root@pe-sysmonitor-zabbix ~]# vi /etc/selinux/config #SELINUX=disabled[root@pe-sysmonitor-zabbix ~]# reboot[root@pe-sysmonitor-zabbix ~]# getenforce Disabled","categories":[{"name":"DevOps","slug":"DevOps","permalink":"http://mudbub.com/categories/DevOps/"}],"tags":[{"name":"Zabbix","slug":"Zabbix","permalink":"http://mudbub.com/tags/Zabbix/"}],"author":["Falkon"]},{"title":"Zabbix 5.0 编译安装","slug":"linux/zabbix50-compile-installation","date":"2021-01-27T09:37:22.770Z","updated":"2021-04-30T07:52:04.364Z","comments":true,"path":"2021/01/27/linux/zabbix50-compile-installation/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/zabbix50-compile-installation/","excerpt":"平台：Oracle Linux 7.8 数据库：MySQL 8.0 中间件：Apache 2.4 PHP：PHP 7.2","text":"平台：Oracle Linux 7.8 数据库：MySQL 8.0 中间件：Apache 2.4 PHP：PHP 7.2 关闭SELINUX 1[root@pe-sysmonitor-zabbix ~]# sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux 关闭防火墙 1[root@pe-sysmonitor-zabbix ~]# systemctl disable --now firewalld 安装LAMP 1[root@pe-sysmonitor-zabbix ~]# dnf install -y httpd php php-gd php-ldap php-mysqlnd php-json php-bcmath php-mbstring php-xml mysql mysql-server mysql-devel libevent-devel pcre-devel gcc gcc-c++ make libcurl-devel curl-* net-snmp* libxml2-* wget tar 启动相关组件并设置为开机启动 12[root@pe-sysmonitor-zabbix ~]# systemctl enable --now httpd mysqlnd php-fpm[root@pe-sysmonitor-zabbix ~]# systemctl start httpd mysqld php-fpm 解压并编译Zabbix5.0源码 123[root@pe-sysmonitor-zabbix ~]# tar -zxvf /opt/zabbix-5.0.1.tar.gz[root@pe-sysmonitor-zabbix ~]# cd /opt/zabbix-5.0.1[root@pe-sysmonitor-zabbix ~]# /configure --prefix=/usr/local/zabbix --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl --with-libxml2 登录mysql数据库，建立zabbix数据库用户等相关信息，先安装的数据为mysql8.0，直接root用户可登录 123456789101112131415161718192021222324252627282930313233343536[root@pe-sysmonitor-zabbix mysql]# mysql -u rootWelcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 8Server version: 8.0.17 Source distributionCopyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || sys |+--------------------+4 rows in set (0.01 sec)mysql&gt; mysql&gt; mysql&gt; mysql&gt; create database zabbix character set utf8 collate utf8_bin;Query OK, 1 row affected, 2 warnings (0.06 sec)mysql&gt; create user zabbix@localhost identified by 'welcome1';Query OK, 0 rows affected (0.04 sec)mysql&gt; grant all privileges on zabbix.* to zabbix@localhost;Query OK, 0 rows affected (0.02 sec) mysql&gt; quit 按顺序导入sql 123[root@pe-sysmonitor-zabbix ~]# mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/schema.sql[root@pe-sysmonitor-zabbix ~]# mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/images.sql[root@pe-sysmonitor-zabbix ~]# mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/data.sql 修改zabbix server配置文件的数据库密码，配置文件位置：/usr/local/zabbix/etc/zabbix_server.conf 123...DBPassword=welcome1... 为zabbix server添加systemd启动文件 123456789101112131415161718192021222324vi /lib/systemd/system/zabbix-server.service[Unit]Description=Zabbix ServerAfter=syslog.targetAfter=network.targetAfter=mysql.serviceAfter=mysqld.serviceAfter=mariadb.serviceAfter=postgresql.service[Service]Environment=\"CONFFILE=/usr/local/zabbix/etc/zabbix_server.conf\"EnvironmentFile=-/etc/sysconfig/zabbix-serverType=forkingRestart=on-failurePIDFile=/tmp/zabbix_server.pidKillMode=control-groupExecStart=/usr/local/zabbix/sbin/zabbix_server -c $CONFFILEExecStop=/bin/kill -SIGTERM $MAINPIDRestartSec=10sTimeoutSec=0[Install]WantedBy=multi-user.target 为zabbix agent添加systemd启动文件 123456789101112131415161718192021vi /lib/systemd/system/zabbix-agent.service[Unit]Description=Zabbix AgentAfter=syslog.targetAfter=network.target[Service]Environment=\"CONFFILE=/usr/local/zabbix/etc/zabbix_agentd.conf\"EnvironmentFile=-/etc/sysconfig/zabbix-agentType=forkingRestart=on-failurePIDFile=/tmp/zabbix_agentd.pidKillMode=control-groupExecStart=/usr/local/zabbix/sbin/zabbix_agentd -c $CONFFILEExecStop=/bin/kill -SIGTERM $MAINPIDRestartSec=10sUser=zabbixGroup=zabbix[Install]WantedBy=multi-user.target 设置为开机启动并启动zabbix server和zabbix agent 12345678910111213141516171819202122[root@pe-sysmonitor-zabbix ~]# systemctl enable --now zabbix-server[root@pe-sysmonitor-zabbix ~]# systemctl enable --now zabbix-agent[root@pe-sysmonitor-zabbix ~]# systemctl start zabbix-server[root@pe-sysmonitor-zabbix ~]# systemctl start zabbix-agent# 观察/tmp/zabbix_server.log有无错误，如果出现如下错误需要对zabbix用户增加授权# mysql&gt; grant SUPER,SESSION_VARIABLES_ADMIN on *.* to 'zabbix'@'localhost';865:20200610:225723.864 Starting Zabbix Server. Zabbix 5.0.1 (revision c2a0b03480).865:20200610:225723.864 ****** Enabled features ******865:20200610:225723.864 SNMP monitoring: YES865:20200610:225723.864 IPMI monitoring: NO865:20200610:225723.864 Web monitoring: YES865:20200610:225723.864 VMware monitoring: YES865:20200610:225723.864 SMTP authentication: YES865:20200610:225723.864 ODBC: NO865:20200610:225723.864 SSH support: NO865:20200610:225723.864 IPv6 support: NO865:20200610:225723.864 TLS support: NO865:20200610:225723.864 ******************************865:20200610:225723.864 using configuration file: /usr/local/zabbix/etc/zabbix_server.conf865:20200610:225723.870 [Z3001] connection to database 'zabbix' failed: [1227] Access denied; you need (at least one of) the SUPER, SYSTEM_VARIABLES_ADMIN or SESSION_VARIABLES_ADMIN privilege(s) for this operation865:20200610:225723.870 Cannot connect to the database. Exiting... 检查zabbix server的启动状态 123456789101112131415161718192021222324252627282930313233343536373839404142434445[root@pe-sysmonitor-zabbix ~]# systemctl status zabbix-server● zabbix-server.service - Zabbix Server Loaded: loaded (/usr/lib/systemd/system/zabbix-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2020-06-10 22:59:57 CST; 11h ago Process: 926 ExecStart=/usr/local/zabbix/sbin/zabbix_server -c $CONFFILE (code=exited, status=0/SUCCESS) Main PID: 928 (zabbix_server) Tasks: 38 (limit: 23588) Memory: 47.8M CGroup: /system.slice/zabbix-server.service ├─928 /usr/local/zabbix/sbin/zabbix_server -c /usr/local/zabbix/etc/zabbix_server.conf ├─929 /usr/local/zabbix/sbin/zabbix_server: configuration syncer [synced configuration in 0.036692 sec, idle 60 sec] ├─930 /usr/local/zabbix/sbin/zabbix_server: housekeeper [deleted 60 hist/trends, 0 items/triggers, 0 events, 0 sessions, 0 alarms, 0 audit items, 0 records in 0.034538 sec, id&gt; ├─931 /usr/local/zabbix/sbin/zabbix_server: timer #1 [updated 0 hosts, suppressed 0 events in 0.000782 sec, idle 59 sec] ├─932 /usr/local/zabbix/sbin/zabbix_server: http poller #1 [got 0 values in 0.000887 sec, idle 5 sec] ├─933 /usr/local/zabbix/sbin/zabbix_server: discoverer #1 [processed 0 rules in 0.000880 sec, idle 60 sec] ├─934 /usr/local/zabbix/sbin/zabbix_server: history syncer #1 [processed 0 values, 0 triggers in 0.000036 sec, idle 1 sec] ├─935 /usr/local/zabbix/sbin/zabbix_server: history syncer #2 [processed 0 values, 0 triggers in 0.000049 sec, idle 1 sec] ├─936 /usr/local/zabbix/sbin/zabbix_server: history syncer #3 [processed 0 values, 0 triggers in 0.000027 sec, idle 1 sec] ├─937 /usr/local/zabbix/sbin/zabbix_server: history syncer #4 [processed 0 values, 0 triggers in 0.000030 sec, idle 1 sec] ├─938 /usr/local/zabbix/sbin/zabbix_server: escalator #1 [processed 0 escalations in 0.001530 sec, idle 3 sec] ├─939 /usr/local/zabbix/sbin/zabbix_server: proxy poller #1 [exchanged data with 0 proxies in 0.000028 sec, idle 5 sec] ├─940 /usr/local/zabbix/sbin/zabbix_server: self-monitoring [processed data in 0.000035 sec, idle 1 sec] ├─941 /usr/local/zabbix/sbin/zabbix_server: task manager [processed 0 task(s) in 0.000552 sec, idle 5 sec] ├─942 /usr/local/zabbix/sbin/zabbix_server: poller #1 [got 0 values in 0.000041 sec, idle 1 sec] ├─943 /usr/local/zabbix/sbin/zabbix_server: poller #2 [got 1 values in 0.000554 sec, idle 1 sec] ├─944 /usr/local/zabbix/sbin/zabbix_server: poller #3 [got 0 values in 0.000038 sec, idle 1 sec] ├─945 /usr/local/zabbix/sbin/zabbix_server: poller #4 [got 0 values in 0.000022 sec, idle 1 sec] ├─946 /usr/local/zabbix/sbin/zabbix_server: poller #5 [got 0 values in 0.000022 sec, idle 1 sec] ├─947 /usr/local/zabbix/sbin/zabbix_server: unreachable poller #1 [got 0 values in 0.000020 sec, idle 5 sec] ├─948 /usr/local/zabbix/sbin/zabbix_server: trapper #1 [processed data in 0.000532 sec, waiting for connection] ├─949 /usr/local/zabbix/sbin/zabbix_server: trapper #2 [processed data in 0.000589 sec, waiting for connection] ├─950 /usr/local/zabbix/sbin/zabbix_server: trapper #3 [processed data in 0.000450 sec, waiting for connection] ├─951 /usr/local/zabbix/sbin/zabbix_server: trapper #4 [processed data in 0.000663 sec, waiting for connection] ├─952 /usr/local/zabbix/sbin/zabbix_server: trapper #5 [processed data in 0.000391 sec, waiting for connection] ├─953 /usr/local/zabbix/sbin/zabbix_server: icmp pinger #1 [got 0 values in 0.000022 sec, idle 5 sec] ├─954 /usr/local/zabbix/sbin/zabbix_server: alert manager #1 [sent 0, failed 0 alerts, idle 5.005964 sec during 5.006082 sec] ├─955 /usr/local/zabbix/sbin/zabbix_server: alerter #1 started ├─956 /usr/local/zabbix/sbin/zabbix_server: alerter #2 started ├─957 /usr/local/zabbix/sbin/zabbix_server: alerter #3 started ├─958 /usr/local/zabbix/sbin/zabbix_server: preprocessing manager #1 [queued 0, processed 6 values, idle 5.002700 sec during 5.002968 sec] ├─959 /usr/local/zabbix/sbin/zabbix_server: preprocessing worker #1 started ├─960 /usr/local/zabbix/sbin/zabbix_server: preprocessing worker #2 started ├─961 /usr/local/zabbix/sbin/zabbix_server: preprocessing worker #3 started ├─962 /usr/local/zabbix/sbin/zabbix_server: lld manager #1 [processed 0 LLD rules during 5.004781 sec] ├─963 /usr/local/zabbix/sbin/zabbix_server: lld worker #1 [processed 1 LLD rules, idle 3598.022039 sec during 3598.152512 sec] 拷贝zabbix的前端文件到apache默认的web目录，进行前端安装 12[root@pe-sysmonitor-zabbix ~]# cp -r /opt/zabbix-5.0.0/ui/* /var/www/html/[root@pe-sysmonitor-zabbix ~]# chown -R apache:apache /var/www/html/ 配置php参数 12345[root@pe-sysmonitor-zabbix ~]# sed -i 's#post_max_size = 8M#post_max_size = 16M#' /etc/php.ini[root@pe-sysmonitor-zabbix ~]# sed -i 's#max_execution_time = 30#max_execution_time = 300#' /etc/php.ini[root@pe-sysmonitor-zabbix ~]# sed -i 's#max_input_time = 60#max_input_time = 300#' /etc/php.ini[root@pe-sysmonitor-zabbix ~]# sed -i 's#;date.timezone =#date.timezone = Asia/Shanghai#' /etc/php.ini[root@pe-sysmonitor-zabbix ~]# systemctl restart php-fpm 配置完成后使用浏览器访问Zabbix服务的ip进行web初始化 检查各个组件是否正常 输入Zabbix数据库密码 Zabbix服务器详情 初始化汇总信息 初始化安装，如果提示无法创建配置，点击页面上的链接下载配置文件上传到指定位置，并修改属组为apache:apache 初始化完成后登录，默认账号：Admin，密码：zabbix Zabbix主页","categories":[{"name":"DevOps","slug":"DevOps","permalink":"http://mudbub.com/categories/DevOps/"}],"tags":[{"name":"Zabbix","slug":"Zabbix","permalink":"http://mudbub.com/tags/Zabbix/"}],"author":["Falkon"]},{"title":"Zabbix5.0添加中文","slug":"linux/zabbix50-add-chinese-language","date":"2021-01-27T09:37:22.765Z","updated":"2021-04-30T07:51:54.687Z","comments":true,"path":"2021/01/27/linux/zabbix50-add-chinese-language/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/zabbix50-add-chinese-language/","excerpt":"Zabbix安装完成后模式英文显示，问了方便后期的使用，将通过安装相关中文包，将语言由原来的英文切换到中文","text":"Zabbix安装完成后模式英文显示，问了方便后期的使用，将通过安装相关中文包，将语言由原来的英文切换到中文 检查中文依赖包和相关组件的安装 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970[root@pe-sysmonitor-zabbix ~]# locale -a | grep zh_CN[root@pe-sysmonitor-zabbix ~]# dnf install langpacks-zh_CN.noarchCentOS-BaseOS-8 - Media 243 kB/s | 3.9 kB 00:00CentOS-AppStream-8 - Media 505 kB/s | 4.3 kB 00:00Dependencies resolved.============================================================================================================================================================================ Package Architecture Version Repository Size============================================================================================================================================================================Installing: langpacks-zh_CN noarch 1.0-12.el8 c8-media-AppStream 9.6 kInstalling weak dependencies: glibc-langpack-zh x86_64 2.28-72.el8 c8-media-BaseOS 2.1 MTransaction Summary============================================================================================================================================================================Install 2 PackagesTotal size: 2.2 MInstalled size: 15 MIs this ok [y/N]: yDownloading Packages:Running transaction checkTransaction check succeeded.Running transaction testTransaction test succeeded.Running transaction Preparing : 1/1 Installing : glibc-langpack-zh-2.28-72.el8.x86_64 1/2 Installing : langpacks-zh_CN-1.0-12.el8.noarch 2/2 Running scriptlet: langpacks-zh_CN-1.0-12.el8.noarch 2/2 Verifying : glibc-langpack-zh-2.28-72.el8.x86_64 1/2 Verifying : langpacks-zh_CN-1.0-12.el8.noarch 2/2Installed: langpacks-zh_CN-1.0-12.el8.noarch glibc-langpack-zh-2.28-72.el8.x86_64Complete![root@pe-sysmonitor-zabbix ~]# dnf install glibc-commonLast metadata expiration check: 0:00:25 ago on Tue 18 Aug 2020 03:24:08 PM CST.Package glibc-common-2.28-72.el8.x86_64 is already installed.Dependencies resolved.Nothing to do.Complete![root@pe-sysmonitor-zabbix ~]# dnf reinstall glibc-commonLast metadata expiration check: 0:02:55 ago on Tue 18 Aug 2020 03:24:08 PM CST.Dependencies resolved.============================================================================================================================================================================ Package Architecture Version Repository Size============================================================================================================================================================================Reinstalling: glibc-common x86_64 2.28-72.el8 c8-media-BaseOS 811 kTransaction Summary============================================================================================================================================================================Total size: 811 kInstalled size: 3.6 MIs this ok [y/N]: yDownloading Packages:Running transaction checkTransaction check succeeded.Running transaction testTransaction test succeeded.Running transaction Preparing : 1/1 Reinstalling : glibc-common-2.28-72.el8.x86_64 1/2 Cleanup : glibc-common-2.28-72.el8.x86_64 2/2 Running scriptlet: glibc-common-2.28-72.el8.x86_64 2/2 Verifying : glibc-common-2.28-72.el8.x86_64 1/2 Verifying : glibc-common-2.28-72.el8.x86_64 2/2Reinstalled: glibc-common-2.28-72.el8.x86_64Complete! 查看中文包安装后的信息 12345[root@pe-sysmonitor-zabbix ~]# locale -a | grep zh_CNzh_CNzh_CN.gb18030zh_CN.gbkzh_CN.utf8 切换到中文后，部分监控项出现乱码 上传字体把C:\\Windows\\Fonts下的黑体（simhei.ttf）字体上传到Zabbix服务器，并复制到/var/www/html/assets/fonts目录（注意文件权限），每个人的Zabbix的安装目录都不一样，查找下对应的assets/fonts即可,上传完成后修改include/defines.inc.php，具体修改内容如下：复制define(‘ZBX_GRAPH_FONT_NAME’, ‘DejaVuSans’); // font file name这一行并注释掉修改字体名称为我们上传的字体define(‘ZBX_GRAPH_FONT_NAME’, ‘DejaVuSans’); // font file name 刷新后再次查看监控项中文已经正常显示","categories":[{"name":"DevOps","slug":"DevOps","permalink":"http://mudbub.com/categories/DevOps/"}],"tags":[{"name":"Zabbix","slug":"Zabbix","permalink":"http://mudbub.com/tags/Zabbix/"}],"author":["Falkon"]},{"title":"Openfiler安装配置","slug":"linux/openfiler-installation-and-configuration","date":"2021-01-27T09:37:22.758Z","updated":"2021-03-26T10:26:46.372Z","comments":true,"path":"2021/01/27/linux/openfiler-installation-and-configuration/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/openfiler-installation-and-configuration/","excerpt":"在workstation或者virtual box中创建一个内核为其他内核2.6x 64位的虚拟机，添加两块网卡，使用两块网卡来模拟磁盘多路径聚合，两块大小分别为10g和50g的硬盘，10g做为openfiler系统的安装磁盘，50g用来做LUN","text":"在workstation或者virtual box中创建一个内核为其他内核2.6x 64位的虚拟机，添加两块网卡，使用两块网卡来模拟磁盘多路径聚合，两块大小分别为10g和50g的硬盘，10g做为openfiler系统的安装磁盘，50g用来做LUN 挂在镜像，直接按回车 进入下一步 选择键盘 选择系统安装磁盘，添加两块磁盘，一定不要另外一块磁盘 选择卡网，默认选择后面再配置 选择时区 设置root密码 进入下一步进行安装 安装进度 安装完成后重启 启动后显示了web GUI信息 配置静态IP地址 123456789101112131415161718192021# 配置eth0[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0 # Intel Corporation 82545EM Gigabit Ethernet Controller (Copper)DEVICE=eth0BOOTPROTO=yesHWADDR=00:0C:29:9A:3B:BAONBOOT=yesIPADDR=192.168.112.154NETMASK=255.255.255.0GATEWAY=192.168.112.1# 配置eth1[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth1 # Intel Corporation 82545EM Gigabit Ethernet Controller (Copper)DEVICE=eth1BOOTPROTO=staticHWADDR=00:0C:29:9A:3B:C4ONBOOT=yesIPADDR=192.168.112.155NETMASK=255.255.255.0GATEWAY=192.168.112.1 访问web GUI页面，默认的用户名为openfiler，密码为password status显示当前NAS的物理信息 开启iSCSI target 点击System设置目标主机信息，Network/Host可以填写IP地址或者是主机名，如果是主机名的话，需要配置hosts解析 点击Volume-&gt;Block Devices创建PV，系统预留5%，整块磁盘创建完成后，剩余的5%无法创建 &nbsp; &nbsp; 点击Volume-&gt;Volume Groups创建VG &nbsp; 点击Volume-&gt;Add Volume创建LV 点击Volume-&gt;iSCSI Targets-&gt;Target Configuration设置IQN 点击Volume-&gt;iSCSI Targets-&gt;LUN Mapping挂载LUN 点击Volume-&gt;iSCSI Targets-&gt;Network ACL设置目标主机访问权限 目标主机安装iSCSI包 12345678910111213141516171819202122232425262728293031323334353637383940[root@dev01 ~]# yum -y install iscsi-initiator-utilsLoaded plugins: security, ulninfoSetting up Install ProcessResolving Dependencies--&gt; Running transaction check---&gt; Package iscsi-initiator-utils.x86_64 0:6.2.0.873-27.0.3.el6_9 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved=============================================================================================================================================================================================================== Package Arch Version Repository Size===============================================================================================================================================================================================================Installing: iscsi-initiator-utils x86_64 6.2.0.873-27.0.3.el6_9 public_ol6_latest 738 kTransaction Summary===============================================================================================================================================================================================================Install 1 Package(s)Total download size: 738 kInstalled size: 2.5 MDownloading Packages:warning: rpmts_HdrFromFdno: Header V3 RSA/SHA256 Signature, key ID ec551f03: NOKEYRetrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracleImporting GPG key 0xEC551F03: Userid : Oracle OSS group (Open Source Software group) &lt;build@oss.oracle.com&gt; Package: 6:oraclelinux-release-6Server-10.0.2.x86_64 (@anaconda-OracleLinuxServer-201806251353.x86_64/6.10) From : /etc/pki/rpm-gpg/RPM-GPG-KEY-oracleRunning rpm_check_debugRunning Transaction TestTransaction Test SucceededRunning Transaction Installing : iscsi-initiator-utils-6.2.0.873-27.0.3.el6_9.x86_64 1/1 Verifying : iscsi-initiator-utils-6.2.0.873-27.0.3.el6_9.x86_64 1/1 Installed: iscsi-initiator-utils.x86_64 0:6.2.0.873-27.0.3.el6_9 Complete! 查找存储对外提供的卷 1234[root@dev01 ~]# iscsiadm -m discovery -t st -p 192.168.112.154Starting iscsid: [ OK ]192.168.112.154:3260,1 iqn.2006-01.com.openfiler:tsn.dev019527192.168.112.155:3260,1 iqn.2006-01.com.openfiler:tsn.dev019527 映射逻辑卷到系统中 12345678910111213141516171819202122[root@dev01 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.154:3260 -lLogging in to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.154,3260] (multiple)Login to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.154,3260] successful.[root@dev01 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.155:3260 -lLogging in to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.155,3260] (multiple)Login to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.155,3260] successful.# 查看LUN的映射，两条路径对应两块分盘Disk /dev/sdb: 51.2 GB, 51170508800 bytes64 heads, 32 sectors/track, 48800 cylindersUnits = cylinders of 2048 * 512 = 1048576 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk identifier: 0x00000000Disk /dev/sdc: 51.2 GB, 51170508800 bytes64 heads, 32 sectors/track, 48800 cylindersUnits = cylinders of 2048 * 512 = 1048576 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk identifier: 0x00000000 设置开机自动映射 12[root@dev01 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.154:3260 -o update -n node.startup -v automatic[root@dev01 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.155:3260 -o update -n node.startup -v automatic 安装多路径包 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[root@dev01 ~]# yum -y install device-mapper-multipathLoaded plugins: security, ulninfoSetting up Install ProcessResolving Dependencies--&gt; Running transaction check---&gt; Package device-mapper-multipath.x86_64 0:0.4.9-106.0.1.el6 will be installed--&gt; Processing Dependency: device-mapper-multipath-libs = 0.4.9-106.0.1.el6 for package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64--&gt; Processing Dependency: libmultipath.so()(64bit) for package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64--&gt; Processing Dependency: libmpathpersist.so.0()(64bit) for package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64--&gt; Running transaction check---&gt; Package device-mapper-multipath-libs.x86_64 0:0.4.9-106.0.1.el6 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved=============================================================================================================================================================================================================== Package Arch Version Repository Size===============================================================================================================================================================================================================Installing: device-mapper-multipath x86_64 0.4.9-106.0.1.el6 public_ol6_latest 134 kInstalling for dependencies: device-mapper-multipath-libs x86_64 0.4.9-106.0.1.el6 public_ol6_latest 205 kTransaction Summary===============================================================================================================================================================================================================Install 2 Package(s)Total download size: 339 kInstalled size: 699 kDownloading Packages:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------Total 39 MB/s | 339 kB 00:00 Running rpm_check_debugRunning Transaction TestTransaction Test SucceededRunning Transaction Installing : device-mapper-multipath-libs-0.4.9-106.0.1.el6.x86_64 1/2 Installing : device-mapper-multipath-0.4.9-106.0.1.el6.x86_64 2/2 Verifying : device-mapper-multipath-libs-0.4.9-106.0.1.el6.x86_64 1/2 Verifying : device-mapper-multipath-0.4.9-106.0.1.el6.x86_64 2/2 Installed: device-mapper-multipath.x86_64 0:0.4.9-106.0.1.el6 Dependency Installed: device-mapper-multipath-libs.x86_64 0:0.4.9-106.0.1.el6 Complete!# 复制multipath.conf到etc[root@dev01 ~]# cp /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf /etc/ 配置多路径聚合 1234567891011121314151617181920212223242526# 获取磁盘的WWID号[root@dev01 ~]# scsi_id -g -u -d /dev/sdb 14f504e46494c4552523758456c352d437752492d59774b6e[root@dev01 ~]# scsi_id -g -u -d /dev/sdc14f504e46494c4552523758456c352d437752492d59774b6e# 编辑multipath.confdefaults &#123; user_friendly_names yes&#125;blacklist &#123; devnode \"^sda\" &#125; multipaths &#123; multipath &#123; wwid \"14f504e46494c4552523758456c352d437752492d59774b6e\" alias lv_dev01 path_grouping_policy multibus path_selector \"round-robin 0\" failback manual rr_weight priorities no_path_retry 5 &#125;&#125; 查看聚合后的磁盘信息 1234567891011121314[root@dev01 ~]# multipath -lllv_dev01 (14f504e46494c4552523758456c352d437752492d59774b6e) dm-3 OPNFILER,VIRTUAL-DISKsize=48G features='1 queue_if_no_path' hwhandler='0' wp=rw`-+- policy='round-robin 0' prio=1 status=active |- 3:0:0:0 sdb 8:16 active ready running `- 4:0:0:0 sdc 8:32 active ready running# 查看磁盘映射[root@dev01 ~]# ll /dev/mapper/*crw-rw----. 1 root root 10, 236 Mar 26 15:00 /dev/mapper/controllrwxrwxrwx. 1 root root 7 Mar 30 19:41 /dev/mapper/lv_dev01 -&gt; ../dm-3lrwxrwxrwx. 1 root root 7 Mar 26 15:00 /dev/mapper/VolGroup-lv_home -&gt; ../dm-2lrwxrwxrwx. 1 root root 7 Mar 26 15:00 /dev/mapper/VolGroup-lv_root -&gt; ../dm-0lrwxrwxrwx. 1 root root 7 Mar 26 15:00 /dev/mapper/VolGroup-lv_swap -&gt; ../dm-1 将iSCSI服务和multipathd服务设置为开启启动 12[root@dev01 ~]# chkconfig --level 2345 iscsi on[root@dev01 ~]# chkconfig --level 2345 multipathd on","categories":[{"name":"NAS","slug":"NAS","permalink":"http://mudbub.com/categories/NAS/"}],"tags":[{"name":"Openfiler","slug":"Openfiler","permalink":"http://mudbub.com/tags/Openfiler/"}],"author":["Falkon"]},{"title":"Linux 7.8安装配置VNCSERVER","slug":"linux/linux78-config-vncserver","date":"2021-01-27T09:37:22.752Z","updated":"2021-04-30T07:51:15.891Z","comments":true,"path":"2021/01/27/linux/linux78-config-vncserver/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/linux78-config-vncserver/","excerpt":"查看系统版本12[root@aproddb19c ~]# cat /etc/redhat-release CentOS Linux release 7.8.2003 (Core)","text":"查看系统版本12[root@aproddb19c ~]# cat /etc/redhat-release CentOS Linux release 7.8.2003 (Core) 关闭防火墙 12345678910111213141516171819[root@aproddb19c ~]# systemctl stop firewalld[root@aproddb19c ~]# systemctl status firewalld● firewalld.service - firewalld - dynamic firewall daemon Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled) Active: inactive (dead) Docs: man:firewalld(1)Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --in-interface virbr0 --out-interface virbr...hat chain?).Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --out-interface virbr0 --jump REJECT' faile...y that name.Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --in-interface virbr0 --jump REJECT' failed...y that name.Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol udp --destin...hat chain?).Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol tcp --destin...hat chain?).Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete OUTPUT --out-interface virbr0 --protocol udp --dest...hat chain?).Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol udp --destin...hat chain?).Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol tcp --destin...hat chain?).Jun 30 10:59:48 aproddb19c systemd[1]: Stopping firewalld - dynamic firewall daemon...Jun 30 10:59:49 aproddb19c systemd[1]: Stopped firewalld - dynamic firewall daemon.Hint: Some lines were ellipsized, use -l to show in full.[root@aproddb19c ~]# systemctl disable firewalld 安装vncserver 12345678910111213141516171819202122232425262728[root@aproddb19c ~]# yum -y install tigervnc-serverLoaded plugins: fastestmirror, langpacksLoading mirror speeds from cached hostfileResolving Dependencies--&gt; Running transaction check---&gt; Package tigervnc-server.x86_64 0:1.8.0-19.el7 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved=========================================================================================================================================================================================== Package Arch Version Repository Size===========================================================================================================================================================================================Installing: tigervnc-server x86_64 1.8.0-19.el7 c7-media 216 kTransaction Summary===========================================================================================================================================================================================Install 1 PackageTotal download size: 216 kInstalled size: 510 kDownloading packages:Running transaction checkRunning transaction testTransaction test succeededRunning transaction Installing : tigervnc-server-1.8.0-19.el7.x86_64 1/1 Verifying : tigervnc-server-1.8.0-19.el7.x86_64 1/1 Installed: tigervnc-server.x86_64 0:1.8.0-19.el7 Complete! 复制并修改配置文件 1234567891011121314151617181920[root@aproddb19c ~]# cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@.service[root@aproddb19c ~]# vi /etc/systemd/system/vncserver@.service # 编辑完成后的内容[Unit]Description=Remote desktop service (VNC)After=syslog.target network.target[Service]Type=simple# Clean any existing files in /tmp/.X11-unix environmentExecStartPre=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || :'# ExecStart=/usr/bin/vncserver_wrapper &lt;USER&gt; %iExecStart=/sbin/runuser -l root -c \"/usr/bin/vncserver %i\"PIDFile=/root/.vnc/%H%i.pidExecStop=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || :'[Install]WantedBy=multi-user.target 设置vnc密码 12345[root@aproddb19c ~]# vncpasswdPassword:Verify:Would you like to enter a view-only password (y/n)? A view-only password is not used 启动vnc服务并查看服务的状态 12345678910111213[root@aproddb19c system]# systemctl daemon-reload[root@aproddb19c system]# systemctl start vncserver@:1[root@aproddb19c system]# systemctl status vncserver@:1● vncserver@:1.service - Remote desktop service (VNC) Loaded: loaded (/etc/systemd/system/vncserver@.service; disabled; vendor preset: disabled) Active: active (running) since Sat 2020-06-27 17:27:52 CST; 5s ago Process: 7301 ExecStartPre=/bin/sh -c /usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || : (code=exited, status=0/SUCCESS) Main PID: 7325 (Xvnc) CGroup: /system.slice/system-vncserver.slice/vncserver@:1.service ‣ 7325 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop aproddb19c:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 590...Jun 27 17:27:52 aproddb19c systemd[1]: Starting Remote desktop service (VNC)...Jun 27 17:27:52 aproddb19c systemd[1]: Started Remote desktop service (VNC). 测试连接","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"VNC","slug":"VNC","permalink":"http://mudbub.com/tags/VNC/"}],"author":["Falkon"]},{"title":"Linux扩展swap分区","slug":"linux/linux-extend-swap","date":"2021-01-27T09:37:22.745Z","updated":"2021-03-26T10:26:38.073Z","comments":true,"path":"2021/01/27/linux/linux-extend-swap/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/linux-extend-swap/","excerpt":"查看现有的swap分区大小 12345[root@ystdb11g ~]# free -m total used free shared buffers cachedMem: 1725 1618 106 8 81 872-/+ buffers/cache: 664 1060Swap: 2047 13 2034","text":"查看现有的swap分区大小 12345[root@ystdb11g ~]# free -m total used free shared buffers cachedMem: 1725 1618 106 8 81 872-/+ buffers/cache: 664 1060Swap: 2047 13 2034 增加交换分区文件大小，bs为块大小，count为块的数量，增加2GB大小的swap交换分区，写法如下 123[root@ystdb11g ~]# dd if=/dev/zero of=/opt/swap01 bs=1M count=20482048+0 records in2048+0 records out 设置交换文件 123[root@ystdb11g ~]# mkswap /opt/swap01Setting up swapspace version 1, size = 2097148 KiBno label, UUID=739f980d-ab1a-4858-bcc5-f5389d4365ef 启用交换分区文件 1[root@ystdb11g ~]# swapon /opt/swap01 查看扩展后的交换分区 12345[root@ystdb11g ~]# free -m total used free shared buffers cachedMem: 1725 1631 93 8 2 1041-/+ buffers/cache: 587 1137Swap: 4095 36 4059","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"SWAP","slug":"SWAP","permalink":"http://mudbub.com/tags/SWAP/"}],"author":["Falkon"]},{"title":"Linux下创建模拟僵尸进程并杀死","slug":"linux/linux-create-zombie-processes-and-killed","date":"2021-01-27T09:37:22.740Z","updated":"2021-03-26T10:26:30.474Z","comments":true,"path":"2021/01/27/linux/linux-create-zombie-processes-and-killed/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/linux-create-zombie-processes-and-killed/","excerpt":"僵尸进程是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出，子进程被init接管，子进程退出后init会回收其占用的相关资源。我们都知道进程的工作原理。我们启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。进程停止后，该进程就会从进程表中移除。下面通过一个示例，在Linux下模拟创建僵尸进程，并通过查找僵尸进程并杀死僵尸进程的过程。","text":"僵尸进程是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出，子进程被init接管，子进程退出后init会回收其占用的相关资源。我们都知道进程的工作原理。我们启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。进程停止后，该进程就会从进程表中移除。下面通过一个示例，在Linux下模拟创建僵尸进程，并通过查找僵尸进程并杀死僵尸进程的过程。 创建僵尸进程 123456789101112131415161718192021222324252627282930#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;signal.h&gt;#include &lt;linux/wait.h&gt;int main(int argc,char **argv)&#123; int i=0; pid_t pid=fork(); if(pid==-1) return 0; else if(pid==0) &#123; printf(\"son pid is %d\\n\",getpid()); while(1) &#123; printf(\"son---i=%d\\n\",i); i++; sleep(1); if(i==5) break; &#125; printf(\"son is over!\\n\"); &#125;else if(pid&gt;0) &#123; printf(\"parent pid is %d\\n\",getpid()); while(1) sleep(100); &#125; return 0;&#125; 查看僵尸进程 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748top - 11:20:26 up 5 days, 1 min, 2 users, load average: 0.18, 0.32, 0.44Tasks: 379 total, 1 running, 376 sleeping, 1 stopped, 1 zombie &lt;&lt;&lt;&lt;&lt;&lt; 僵尸进程Cpu(s): 6.1%us, 5.5%sy, 0.0%ni, 84.4%id, 3.8%wa, 0.0%hi, 0.2%si, 0.0%stMem: 4045668k total, 3835188k used, 210480k free, 231976k buffersSwap: 4194300k total, 1039544k used, 3154756k free, 2101984k cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 4577 grid RT 0 1103m 128m 58m S 3.9 3.2 58:10.06 ocssd.bin 9946 root RT 0 828m 95m 60m S 3.9 2.4 171:54.39 osysmond.bin10158 root RT -5 826m 158m 66m S 3.9 4.0 112:46.22 ologgerd 18 root 20 0 0 0 0 S 1.9 0.0 9:53.31 rcuos/1 4474 grid 20 0 1137m 38m 24m S 1.9 1.0 25:10.52 oraagent.bin 5594 oracle -2 0 1953m 40m 40m S 1.9 1.0 140:08.02 oracle 5608 oracle 20 0 1966m 65m 57m S 1.9 1.7 26:11.98 oracle 5614 oracle -2 0 1968m 686m 675m S 1.9 17.4 20:10.71 oracle19583 root 20 0 0 0 0 S 1.9 0.0 0:01.02 kworker/u4:126619 root 20 0 0 0 0 S 1.9 0.0 0:00.02 kworker/u4:026717 root 20 0 15216 2240 1720 R 1.9 0.1 0:00.02 top 1 root 20 0 19396 1736 1532 S 0.0 0.0 0:04.20 init 2 root 20 0 0 0 0 S 0.0 0.0 0:00.07 kthreadd 3 root 20 0 0 0 0 S 0.0 0.0 2:33.69 ksoftirqd/0 5 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kworker/0:0H 7 root 20 0 0 0 0 S 0.0 0.0 20:46.80 rcu_sched 8 root 20 0 0 0 0 S 0.0 0.0 0:00.00 rcu_bh 9 root 20 0 0 0 0 S 0.0 0.0 9:45.87 rcuos/0 10 root 20 0 0 0 0 S 0.0 0.0 0:00.00 rcuob/0 11 root RT 0 0 0 0 S 0.0 0.0 0:01.38 migration/0 12 root RT 0 0 0 0 S 0.0 0.0 0:01.40 watchdog/0 13 root RT 0 0 0 0 S 0.0 0.0 0:01.38 watchdog/1 14 root RT 0 0 0 0 S 0.0 0.0 0:01.33 migration/1 15 root 20 0 0 0 0 S 0.0 0.0 2:01.14 ksoftirqd/1 17 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kworker/1:0H 19 root 20 0 0 0 0 S 0.0 0.0 0:00.00 rcuob/1 20 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 khelper 21 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kdevtmpfs 22 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 netns 23 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 perf 24 root 20 0 0 0 0 S 0.0 0.0 0:00.49 khungtaskd 25 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 writeback 26 root 25 5 0 0 0 S 0.0 0.0 0:00.00 ksmd 28 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 crypto 29 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kintegrityd 30 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 bioset 31 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kblockd 32 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 ata_sff 33 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 md 36 root 20 0 0 0 0 S 0.0 0.0 0:08.09 kswapd0:0 37 root 20 0 0 0 0 S 0.0 0.0 0:00.00 fsnotify_mark 查找具体的僵尸进程 1234[root@rac1 ~]# ps aux | grep ZUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMANDroot 26698 0.0 0.0 0 0 pts/0 Z+ 11:20 0:00 [test] &lt;defunct&gt;root 26732 0.0 0.0 103392 2076 pts/1 S+ 11:20 0:00 grep Z 查找僵尸进程的父进程 12345678[root@rac1 ~]# ps aux | grep testroot 26697 0.0 0.0 3984 400 pts/0 S+ 11:20 0:00 ./testroot 26698 0.0 0.0 0 0 pts/0 Z+ 11:20 0:00 [test] &lt;defunct&gt; &lt;&lt;&lt;&lt;&lt;&lt;&lt; 进程子IDroot 26874 0.0 0.0 103388 2148 pts/1 S+ 11:20 0:00 grep test[root@rac1 ~]# ps -ef | grep 26698root 26698 26697 0 11:20 pts/0 00:00:00 [test] &lt;defunct&gt; &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; 进程父IDroot 26906 23344 0 11:20 pts/1 00:00:00 grep 26698 杀死僵尸进程 1[root@rac1 ~]# kill -s 9 26697","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/tags/Linux/"},{"name":"Zombie","slug":"Zombie","permalink":"http://mudbub.com/tags/Zombie/"}],"author":["Falkon"]},{"title":"CentOS 8 Mini installed then installation Desktop","slug":"linux/centos8-mini-installed-then-install-desktop","date":"2021-01-27T09:37:22.734Z","updated":"2021-04-30T07:50:47.124Z","comments":true,"path":"2021/01/27/linux/centos8-mini-installed-then-install-desktop/","link":"","permalink":"http://mudbub.com/2021/01/27/linux/centos8-mini-installed-then-install-desktop/","excerpt":"CentOS 8 系列默认以文本模式或者最小化安装，后期图形桌面的安装和图形桌面的卸载过程。","text":"CentOS 8 系列默认以文本模式或者最小化安装，后期图形桌面的安装和图形桌面的卸载过程。 列出可以安装的选项 123456789101112131415161718192021222324[root@yongstoneinc yum.repos.d]# yum grouplistCentOS-BaseOS-8 - Media 71 MB/s | 2.2 MB 00:00CentOS-AppStream-8 - Media 85 MB/s | 5.7 MB 00:00Available Environment Groups: Server with GUI Server Workstation Custom Operating System Virtualization HostInstalled Environment Groups: Minimal InstallAvailable Groups: Legacy UNIX Compatibility Container Management Development Tools .NET Core Development Graphical Administration Tools Headless Management Network Servers RPM Development Tools Scientific Support Security Tools Smart Card Support System Tools 安装Server with GUI 1234567891011[root@yongstoneinc yum.repos.d]# yum groupinstall \"Server with GUI\"Last metadata expiration check: 0:05:31 ago on Thu 13 Aug 2020 12:47:36 AM CST.no group 'dns-server' from environment 'graphical-server-environment'No match for group package \"insights-client\"No match for group package \"hpijs\"No match for group package \"centos-release-eula\"Dependencies resolved.......Transaction Summary==============================================================================================Install 929 Packages 将模式的命令行模式修改图形模式 12345[root@yongstoneinc ~]# systemctl get-defaultmulti-user.target[root@yongstoneinc ~]# systemctl set-default graphical.targetRemoved /etc/systemd/system/default.target.Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/graphical.target. 卸载Server with GUI 1234567891011[root@yongstoneinc yum.repos.d]# yum groupremove \"Server with GUI\"Last metadata expiration check: 0:05:31 ago on Thu 13 Aug 2020 12:47:36 AM CST.no group 'dns-server' from environment 'graphical-server-environment'No match for group package \"insights-client\"No match for group package \"hpijs\"No match for group package \"centos-release-eula\"Dependencies resolved.......Transaction Summary==============================================================================================Install 929 Packages","categories":[{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"}],"tags":[{"name":"CentOS8","slug":"CentOS8","permalink":"http://mudbub.com/tags/CentOS8/"}],"author":["Falkon"]},{"title":"The plug-in BI Publisher Configuration has failed its perform method","slug":"database/the-plug-in-bi-publisher-configuration-has-failed-its-perform-method","date":"2021-01-27T09:37:22.726Z","updated":"2021-03-26T10:25:08.419Z","comments":true,"path":"2021/01/27/database/the-plug-in-bi-publisher-configuration-has-failed-its-perform-method/","link":"","permalink":"http://mudbub.com/2021/01/27/database/the-plug-in-bi-publisher-configuration-has-failed-its-perform-method/","excerpt":"平台：Oracle Linux 7.8 数据库： Oracle database 19c EMCC： 13.4.0.0.0 19c &amp; EMCC13.4安装到%78日志报The plug-in BI Publisher Configuration has failed its perform method CfmLogger_2020-06-07_03-20-28-PM.log 12345678INFO: oracle.sysman.top.oms:start writingINFO: oracle.sysman.top.oms:data written successfullyINFO: oracle.sysman.top.oms:file flush successfullyINFO: oracle.sysman.top.oms:file closed successfullyINFO: oracle.sysman.top.oms:The plug-in BI Publisher Configuration has failed its perform methodINFO: Cfm.save() was calledINFO: Cfm.save(): 5 aggregate instances savedINFO: done waiting for Action from 18:05:05.846","text":"平台：Oracle Linux 7.8 数据库： Oracle database 19c EMCC： 13.4.0.0.0 19c &amp; EMCC13.4安装到%78日志报The plug-in BI Publisher Configuration has failed its perform method CfmLogger_2020-06-07_03-20-28-PM.log 12345678INFO: oracle.sysman.top.oms:start writingINFO: oracle.sysman.top.oms:data written successfullyINFO: oracle.sysman.top.oms:file flush successfullyINFO: oracle.sysman.top.oms:file closed successfullyINFO: oracle.sysman.top.oms:The plug-in BI Publisher Configuration has failed its perform methodINFO: Cfm.save() was calledINFO: Cfm.save(): 5 aggregate instances savedINFO: done waiting for Action from 18:05:05.846 bipca_20200607165716.log 12345678910111213141516171819[] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: lockEM] Starting BI Publisher ...[2020-06-07T17:02:16.942+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: execCommand] Executing the command: /u01/app/oracle/Middleware/bin/emctl start oms -bip_only -debug[2020-06-07T17:02:17.544+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Oracle Enterprise Manager Cloud Control 13c Release 4[2020-06-07T17:02:17.544+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Copyright (c) 1996, 2020 Oracle Corporation. All rights reserved.[2020-06-07T17:02:18.332+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Starting BI Publisher Server only.[2020-06-07T17:02:18.342+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Starting BI Publisher Server at: Jun 7, 2020 17:02:18 PM CST[2020-06-07T17:02:18.342+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Starting BI Publisher Server ...[2020-06-07T17:05:03.342+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] WebTier Could Not Be Started.[2020-06-07T17:05:03.347+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Error Occurred: WebTier Could Not Be Started.[2020-06-07T17:05:03.347+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 46] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.ProcessOutputReader] [SRC_METHOD: run] Please check /u01/app/oracle/gc_inst/em/EMGC_OMS1/sysman/log/emctl.log for error details[2020-06-07T17:05:03.381+08:00] [sysman] [NOTIFICATION] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: execCommand] Exit code from command: 1[2020-06-07T17:05:03.381+08:00] [sysman] [ERROR] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: execCommand] [2020-06-07T17:05:03.383+08:00] [sysman] [ERROR] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: lockEM] Failed to start Enterprise Manager. Diagnostic code 1.[2020-06-07T17:05:03.384+08:00] [sysman] [ERROR] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: extendDomainWithBIP] See log at /u01/app/oracle/Middleware/cfgtoollogs/bip/bipca_20200607165716.log for details.[2020-06-07T17:05:03.384+08:00] [sysman] [ERROR] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: handleFatalError] Error extending domain[2020-06-07T17:05:03.385+08:00] [sysman] [ERROR] [] [oracle.sysman.bipca] [host: pe-dbmonitor-emcc] [nwaddr: 10.10.251.102] [tid: 1] [userId: oracle] [ecid: ba168280-6f23-49f3-ac9f-cb73fd25b363-00000002,0] [SRC_CLASS: oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA] [SRC_METHOD: handleFatalError] Fatal error:[[java.lang.Exception: See log at /u01/app/oracle/Middleware/cfgtoollogs/bip/bipca_20200607165716.log for details. at oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA.extendDomainWithBIP(BIPCA.java:3924) at oracle.sysman.sdkImpl.core.ip.model.bipca.BIPCA.main(BIPCA.java:2176) emctl.log 12345672020-06-07 17:05:02,602 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: INFO: /u01/app/oracle/Middleware/ohs/bin/httpd: error while loading shared libraries: libclntshcore.so.12.1: cannot open shared object file: No such file or directory2020-06-07 17:05:02,906 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: Jun 07, 2020 5:05:02 PM oracle.ohs.plugin.nodemanager.OhsRunCommand execute2020-06-07 17:05:02,906 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: SEVERE: /u01/app/oracle/Middleware/ohs/bin/launch httpd -DOHS_MPM_WORKER -d /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/config/fmwconfig/components/OHS/instances/ohs1 -k start -f /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/config/fmwconfig/components/OHS/instances/ohs1/httpd.conf: exit status = 1272020-06-07 17:05:02,906 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: Jun 07, 2020 5:05:02 PM oracle.ohs.plugin.nodemanager.OhsProcessHandler buildProcess2020-06-07 17:05:02,906 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: INFO: Check the instance log file for more information: /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/servers/ohs1/logs/ohs1.log2020-06-07 17:05:02,906 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: Jun 07, 2020 5:05:02 PM oracle.ohs.plugin.nodemanager.OhsProcessManagementPlugin$ProcessImpl buildIoException2020-06-07 17:05:02,907 [Thread-1] INFO commands.BaseCommand run.610 - &lt;OUT&gt;NMProcess: SEVERE: Failed to start the server ohs1 处理方法 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[oracle@pe-dbmonitor-emcc Middleware]$ cp ./bi/products/Essbase/EssbaseServer/bin/libclntshcore.so.12.1 /u01/app/oracle/Middleware/lib/[oracle@pe-dbmonitor-emcc Middleware]$ cd bin/[oracle@pe-dbmonitor-emcc bin]$ ./emctl stop oms -all -forceOracle Enterprise Manager Cloud Control 13c Release 4 Copyright (c) 1996, 2020 Oracle Corporation. All rights reserved.Stopping Oracle Management Server...WebTier Successfully StoppedNode Manager Not RunningOracle Management Server is DownJVMD Engine is DownBI Publisher Server is Down[oracle@pe-dbmonitor-emcc bin]$ ./emctl start oms -admin_onlyOracle Enterprise Manager Cloud Control 13c Release 4 Copyright (c) 1996, 2020 Oracle Corporation. All rights reserved.Starting Admin Server only...Admin Server Successfully Started # 如果图形界面未关闭，点击retry按钮，完成后运行root脚本[root@pe-dbmonitor-emcc ~]# /u01/app/oracle/Middleware/allroot.sh Starting to execute allroot.sh ......... Starting to execute /u01/app/oracle/Middleware/root.sh ......Performing root user operation.The following environment variables are set as: ORACLE_OWNER= oracle ORACLE_HOME= /u01/app/oracle/MiddlewareEnter the full pathname of the local bin directory: [/usr/local/bin]: The contents of \"dbhome\" have not changed. No need to overwrite.The file \"oraenv\" already exists in /usr/local/bin. Overwrite it? (y/n) [n]: The file \"coraenv\" already exists in /usr/local/bin. Overwrite it? (y/n) [n]: y Copying coraenv to /usr/local/bin ...Entries will be added to the /etc/oratab file as needed byDatabase Configuration Assistant when a database is createdFinished running generic part of root script.Now product-specific root actions will be performed./etc existCreating /etc/oragchomelist file.../u01/app/oracle/MiddlewareFinished product-specific root actions./etc existFinished execution of /u01/app/oracle/Middleware/root.sh ......Starting to execute /u01/app/oracle/MiddlewareAgent/agent_13.4.0.0.0/root.sh ......Finished product-specific root actions./etc existFinished execution of /u01/app/oracle/MiddlewareAgent/agent_13.4.0.0.0/root.sh ...# 如果图形界面已经被关闭，请参考官方文档[2637385.1]","categories":[{"name":"Oracle Enterprise Manager Cloud Control","slug":"Oracle-Enterprise-Manager-Cloud-Control","permalink":"http://mudbub.com/categories/Oracle-Enterprise-Manager-Cloud-Control/"}],"tags":[{"name":"EMCC","slug":"EMCC","permalink":"http://mudbub.com/tags/EMCC/"},{"name":"19c","slug":"19c","permalink":"http://mudbub.com/tags/19c/"}],"author":["Falkon"]},{"title":"SQL Server 2019 Installation for CentOS 7.8","slug":"database/installed-sqlserver-2019-on-centos78","date":"2021-01-27T09:37:22.716Z","updated":"2021-03-26T10:24:59.887Z","comments":true,"path":"2021/01/27/database/installed-sqlserver-2019-on-centos78/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-sqlserver-2019-on-centos78/","excerpt":"Microsoft SQL Server For Linux installation packages descriptionmssql-cli.x86_64 : Microsoft SQL Server CLImssql-mlservices-mlm-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mlm-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mml-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mml-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-packages-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-packages-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-python-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-server.x86_64 : Microsoft SQL Server Relational Database Enginemssql-server-extensibility.x86_64 : Extensibility support for Microsoft SQL Server Relational Database Enginemssql-server-extensibility-java.x86_64 : Extensibility Java language support for Microsoft SQL Server Relational Database Enginemssql-server-fts.x86_64 : Microsoft SQL Server Full Text Searchmssql-server-ha.x86_64 : High Availability support for Microsoft SQL Server Relational Database Enginemssql-server-is.x86_64 : Microsoft SQL Server Integration Servicesmssql-tools.x86_64 : Tools for Microsoft(R) SQL Server (R)mssql-server-polybase-15.0.4073.23-4.x86_64 : Microsoft SQL Server Polybase for SQL server,Oracle,Teradata,Mongodbmssql-server-polybase-hadoop-15.0.4073.23-4.x86 : Microsoft SQL Server Polybase for Hadoop","text":"Microsoft SQL Server For Linux installation packages descriptionmssql-cli.x86_64 : Microsoft SQL Server CLImssql-mlservices-mlm-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mlm-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mml-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-mml-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-packages-py-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-packages-r-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-mlservices-python-9.4.5.x86_64.x86_64 : Microsoft Machine Learning Servicesmssql-server.x86_64 : Microsoft SQL Server Relational Database Enginemssql-server-extensibility.x86_64 : Extensibility support for Microsoft SQL Server Relational Database Enginemssql-server-extensibility-java.x86_64 : Extensibility Java language support for Microsoft SQL Server Relational Database Enginemssql-server-fts.x86_64 : Microsoft SQL Server Full Text Searchmssql-server-ha.x86_64 : High Availability support for Microsoft SQL Server Relational Database Enginemssql-server-is.x86_64 : Microsoft SQL Server Integration Servicesmssql-tools.x86_64 : Tools for Microsoft(R) SQL Server (R)mssql-server-polybase-15.0.4073.23-4.x86_64 : Microsoft SQL Server Polybase for SQL server,Oracle,Teradata,Mongodbmssql-server-polybase-hadoop-15.0.4073.23-4.x86 : Microsoft SQL Server Polybase for Hadoop MSSQL 2019在Centos 7.8上的安装 配置hosts 1234567[root@lmssql2019 home]# cat /etc/hosts127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 localhost localhost.localdomain localhost6 localhost6.localdomain6# Microsoft SQL Server hosts configuration10.10.251.147 lmssql2019 关闭防火墙 1234[root@lmssql2019 home]# systemctl stop firewalld[root@lmssql2019 home]# systemctl disable firewalldRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.servic 永久关闭selinux 12345678910111213[root@lmssql2019 home]# vi /etc/sysconfig/selinux # This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=disabled# SELINUXTYPE= can take one of three values:# targeted - Targeted processes are protected,# minimum - Modification of targeted policy. Only selected processes are protected.# mls - Multi Level Security protection.SELINUXTYPE=targete 使用sftp上传安装包 123456789[root@lmssql2019 home]# lltotal 274000drwx------. 3 cts8 cts8 78 Dec 22 20:22 cts8-rw-r--r--. 1 root root 807292 Dec 22 22:19 msodbcsql17-17.6.1.1-1.x86_64.rpm-rw-r--r--. 1 root root 58954712 Dec 22 22:19 mssql-cli-1.0.0-1.el7.x86_64.rpm-rw-r--r--. 1 root root 220310804 Dec 22 21:32 mssql-server-15.0.4073.23-4.x86_64.rpm-rw-r--r--. 1 root root 228628 Dec 22 22:19 mssql-tools-17.6.1.1-1.x86_64.rpm-rw-r--r--. 1 root root 217872 Dec 22 22:27 unixODBC-2.3.7-1.rh.x86_64.rpm-rw-r--r--. 1 root root 43504 Dec 22 22:19 unixODBC-devel-2.3.7-1.rh.x86_64.rpm 安装MSSQL数据库 12345678910[root@lmssql2019 home]# rpm -ivh mssql-server-15.0.4073.23-4.x86_64.rpm warning: mssql-server-15.0.4073.23-4.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]Updating / installing... 1:mssql-server-15.0.4073.23-4 ################################# [100%]+--------------------------------------------------------------+Please run 'sudo /opt/mssql/bin/mssql-conf setup'to complete the setup of Microsoft SQL Server+--------------------------------------------------------------+ 配置MSSQL数据库 123456789101112131415161718192021222324252627282930313233343536373839[root@lmssql2019 home]# /opt/mssql/bin/mssql-conf setupusermod: no changesChoose an edition of SQL Server: 1) Evaluation (free, no production use rights, 180-day limit) 2) Developer (free, no production use rights) 3) Express (free) 4) Web (PAID) 5) Standard (PAID) 6) Enterprise (PAID) - CPU Core utilization restricted to 20 physical/40 hyperthreaded 7) Enterprise Core (PAID) - CPU Core utilization up to Operating System Maximum 8) I bought a license through a retail sales channel and have a product key to enter.Details about editions can be found athttps://go.microsoft.com/fwlink/?LinkId=2109348&amp;clcid=0x409Use of PAID editions of this software requires separate licensing through aMicrosoft Volume Licensing program.By choosing a PAID edition, you are verifying that you have the appropriatenumber of licenses in place to install and run this software.Enter your edition(1-8): 5 #选择标准版，客户购买的是标准版The license terms for this product can be found in/usr/share/doc/mssql-server or downloaded from:https://go.microsoft.com/fwlink/?LinkId=2104294&amp;clcid=0x409 # 许可条款The privacy statement can be viewed at:https://go.microsoft.com/fwlink/?LinkId=853010&amp;clcid=0x409 # 隐私声明Do you accept the license terms? [Yes/No]:yesEnter the SQL Server system administrator password: # 如果用户无特殊要求，默认密码为PP--ssw00rdConfirm the SQL Server system administrator password: Configuring SQL Server...The licensing PID was successfully processed. The new edition is [Standard Edition].ForceFlush is enabled for this instance. ForceFlush feature is enabled for log durability.Created symlink from /etc/systemd/system/multi-user.target.wants/mssql-server.service to /usr/lib/systemd/system/mssql-server.service.Setup has completed successfully. SQL Server is now starting. 查看mssql-server的服务状态 123456789101112131415161718192021[root@lmssql2019 home]# systemctl status mssql-server● mssql-server.service - Microsoft SQL Server Database Engine Loaded: loaded (/usr/lib/systemd/system/mssql-server.service; enabled; vendor preset: disabled) Active: active (running) since Tue 2020-12-22 21:42:41 CST; 38min ago Docs: https://docs.microsoft.com/en-us/sql/linux Main PID: 12580 (sqlservr) CGroup: /system.slice/mssql-server.service ├─12580 /opt/mssql/bin/sqlservr └─12604 /opt/mssql/bin/sqlservrDec 22 21:42:48 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:48.90 spid9s ....Dec 22 21:42:50 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:50.42 spid9s ....Dec 22 21:42:50 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:50.42 spid9s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.41 spid9s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.45 spid28s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.45 spid28s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.57 spid28s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.57 spid8s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.74 spid14s ....Dec 22 21:42:51 lmssql2019 sqlservr[12580]: 2020-12-22 21:42:51.74 spid14s ....Hint: Some lines were ellipsized, use -l to show in full. 设置mssql-server开机启动 1[root@lmssql2019 home]# systemctl enable mssql-server 安装客户端 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697# 安装依赖，从ISO镜像安装[root@lmssql2019 yum.repos.d]# yum -y install libunwindLoaded plugins: fastestmirror, langpacksLoading mirror speeds from cached hostfilec7-media | 3.6 kB 00:00:00 (1/2): c7-media/group_gz | 153 kB 00:00:00 (2/2): c7-media/primary_db | 3.3 MB 00:00:00 Resolving Dependencies--&gt; Running transaction check---&gt; Package libunwind.x86_64 2:1.2-2.el7 will be installed--&gt; Finished Dependency ResolutionDependencies Resolved================================================================================== Package Arch Version Repository Size==================================================================================Installing: libunwind x86_64 2:1.2-2.el7 c7-media 57 kTransaction Summary==================================================================================Install 1 PackageTotal download size: 57 kInstalled size: 150 kDownloading packages:warning: /media/Packages/libunwind-1.2-2.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEYPublic key for libunwind-1.2-2.el7.x86_64.rpm is not installedRetrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7Importing GPG key 0xF4A80EB5: Userid : \"CentOS-7 Key (CentOS 7 Official Signing Key) &lt;security@centos.org&gt;\" Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5 Package : centos-release-7-8.2003.0.el7.centos.x86_64 (@anaconda) From : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7Running transaction checkRunning transaction testTransaction test succeededRunning transactionWarning: RPMDB altered outside of yum. Installing : 2:libunwind-1.2-2.el7.x86_64 1/1 Verifying : 2:libunwind-1.2-2.el7.x86_64 1/1 Installed: libunwind.x86_64 2:1.2-2.el7 Complete!# 安装unixODBC[root@lmssql2019 home]# rpm -ivh unixODBC-2.3.7-1.rh.x86_64.rpm warning: unixODBC-2.3.7-1.rh.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]Updating / installing... 1:unixODBC-2.3.7-1.rh ################################# [100%][root@lmssql2019 home]# [root@lmssql2019 home]# rpm -ivh unixODBC-devel-2.3.7-1.rh.x86_64.rpm warning: unixODBC-devel-2.3.7-1.rh.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]Updating / installing... 1:unixODBC-devel-2.3.7-1.rh ################################# [100%]# 安装msodbcsql[root@lmssql2019 home]# rpm -ivh msodbcsql17-17.6.1.1-1.x86_64.rpm warning: msodbcsql17-17.6.1.1-1.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]The license terms for this product can be downloaded fromhttps://aka.ms/odbc17eula and found in/usr/share/doc/msodbcsql17/LICENSE.txt . By entering 'YES',you indicate that you accept the license terms.Do you accept the license terms? (Enter YES or NO)yesUpdating / installing... 1:msodbcsql17-17.6.1.1-1 ################################# [100%]# 安装mssql-tools[root@lmssql2019 home]# rpm -ivh mssql-tools-17.6.1.1-1.x86_64.rpm warning: mssql-tools-17.6.1.1-1.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]The license terms for this product can be downloaded fromhttp://go.microsoft.com/fwlink/?LinkId=746949 and found in/usr/share/doc/mssql-tools/LICENSE.txt . By entering 'YES',you indicate that you accept the license terms.Do you accept the license terms? (Enter YES or NO)yesUpdating / installing... 1:mssql-tools-17.6.1.1-1 ################################# [100%]# 安装[root@lmssql2019 home]# rpm -ivh mssql-cli-1.0.0-1.el7.x86_64.rpm warning: mssql-cli-1.0.0-1.el7.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID be1229cf: NOKEYPreparing... ################################# [100%]Updating / installing... 1:mssql-cli-1.0.0-1.el7 ################################# [100%] 设置环境变量 123[root@lmssql2019 home]# echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' &gt;&gt; ~/.bash_profile[root@lmssql2019 home]# echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' &gt;&gt; ~/.bashrc[root@lmssql2019 home]# source ~/.bashrc 黑屏客户端测试 1234567891011[root@lmssql2019 ~]# sqlcmd -S localhost -U sa -P PP--ssw00rd1&gt; select name from sys.databases2&gt; goname ---------------------------------------------------master tempdb model msdb (4 rows affected)1&gt; 版本查看 1234567[root@lmssql2019 home]# sqlcmd -S localhost -U SA -Q 'select @@VERSION'Password: Microsoft SQL Server 2019 (RTM-CU8) (KB4577194) - 15.0.4073.23 (X64) Sep 23 2020 16:03:08 Copyright (C) 2019 Microsoft Corporation Standard Edition (64-bit) on Linux (CentOS Linux 7 (Core)) &lt;X64&gt; mssql-cli测试 1234567891011121314[root@lmssql2019 home]# mssql-cli -U saPassword: master&gt; select name from sys.databases; Time: 0.453s+--------+| name ||--------|| master || tempdb || model || msdb |+--------+(4 rows affected)master&gt;","categories":[{"name":"SQL Server","slug":"SQL-Server","permalink":"http://mudbub.com/categories/SQL-Server/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"PDB","slug":"PDB","permalink":"http://mudbub.com/tags/PDB/"}],"author":["Falkon"]},{"title":"Linux Installation Oracle 12c","slug":"database/installed-oracle12c-on-rhel","date":"2021-01-27T09:37:22.710Z","updated":"2021-03-26T10:24:44.971Z","comments":true,"path":"2021/01/27/database/installed-oracle12c-on-rhel/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-oracle12c-on-rhel/","excerpt":"1. 资源描述 CentOS 6.10 操作系统可选择6.x系列其他的版本 Oracle 12.2.0.1 点击链接找到对应操作系统的版本下载即可 Virtual Box 5.2.22 虚拟机软件可选择最新版，建议使用5系列，比较稳定 VNC Viewer 6.18 远程桌面工具，可选用最新版 Xshell 5 远程终端工具5系列官网已经不提供下载了，可选择6系列，有使用限制，单个窗口最大可开4个标签，可选择其他终端工具比如Putty，MobaXterm等","text":"1. 资源描述 CentOS 6.10 操作系统可选择6.x系列其他的版本 Oracle 12.2.0.1 点击链接找到对应操作系统的版本下载即可 Virtual Box 5.2.22 虚拟机软件可选择最新版，建议使用5系列，比较稳定 VNC Viewer 6.18 远程桌面工具，可选用最新版 Xshell 5 远程终端工具5系列官网已经不提供下载了，可选择6系列，有使用限制，单个窗口最大可开4个标签，可选择其他终端工具比如Putty，MobaXterm等 2. 操作系统检查与配置 查看操作系统版本 12[root@localhost ~]# cat /etc/redhat-releaseCentOS release 6.10 (Final) 查看内存，swap 123456# 内存建议1G以上，swap建议4G以上否则在安装检查的时候会报错[root@localhost ~]# free -m total used free shared buffers cachedMem: 1878 702 1175 2 52 378-/+ buffers/cache: 270 1607Swap: 4095 0 4095 调整swap大小 12345678910111213141516171819# 创建分区，位置可自定，bs参数为块大小，count参数为个数[root@localhost ~]# dd if=/dev/zero of=/home/swap bs=1M count=20482048+0 records in2048+0 records out2147483648 bytes (2.1 GB) copied, 2.72688 s, 788 MB/s# 将分区变成swap分区[root@localhost ~]# mkswap /home/swapmkswap: /home/swap: warning: don't erase bootbits sectors on whole disk. Use -f to force.Setting up swapspace version 1, size = 2097148 KiBno label, UUID=21751eac-33ad-4fe0-8b13-3bccc34973b9# 使分区生效[root@localhost ~]# swapon /home/swap# 修改fstab添加开机启动[root@localhost ~]# vi /etc/fstab/home/swap swap swap defaults 0 0 查看磁盘空间 1234567# Oracle安装目录的可用空间建议15G以上，安装操作系统磁盘建议32G以上[root@localhost ~]# df -hFilesystem Size Used Avail Use% Mounted on/dev/mapper/VolGroup-LogVol00 28G 7.3G 19G 29% /tmpfs 940M 76K 939M 1% /dev/shm/dev/sda1 190M 40M 141M 22% /boot 配置IP地址 12345678910111213141516# 编辑ifcfg-eth0[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0# 参照下列示例修改后六行，Virtual Box的虚拟网关为192.168.56.1# 在host-only模式下你的IP地址需要在192.168.56这个网段# 在生产环境下，数据库是和交换机连在一起的，具体的IP需要和应用在同# 一个网段或者VLAN中DEVICE=eth0HWADDR=08:00:27:7F:BA:FDTYPE=EthernetUUID=0948b812-ae70-4159-9564-bde690e7befaONBOOT=yesNM_CONTROLLED=yesBOOTPROTO=staticIPADDR=192.168.56.104NETMASK=255.255.255.0GATEWAY=192.168.56.1 修改network 12345678# 修改主机名，一般建议为：应用-类型版本的模式，这样方便的终端登陆时候，# 看到主机名就知道这台服务器的作用，以及为哪个应用提供服务，如果上面有# 多个库，建议为mpp(Multi Application)-类型版本的模式# 编辑network配置文件[root@localhost ~]# vi /etc/sysconfig/network# 将localhost.localdomain修改为自定的主机名NETWORKING=yesHOSTNAME=app-db12c 修改hosts 12[root@localhost ~]# vi /etc/hosts192.168.56.104 app-db12c 修改防火墙 1234# 关闭防火墙[root@localhost ~]# service iptables stop# 禁止开机启动防火墙[root@localhost ~]# chkconfig iptables off 修改selinux 12345678910111213# 关闭Linux增强，编辑selinx配置文件[root@localhost ~]# vi /etc/sysconfig/selinux# 将SELINUX=enforcing修改SELINUX=disabled# This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=disabled# SELINUXTYPE= can take one of these two values:# targeted - Targeted processes are protected,# mls - Multi Level Security protection.SELINUXTYPE=targeted 3. 创建用户组及用户 创建用户组 123[root@app-db12c ~]# groupadd oinstall[root@app-db12c ~]# groupadd dba[root@app-db12c ~]# groupadd oper 创建用户并设置密码 12345678[root@app-db12c ~]# useradd -g oinstall -G dba,oper oracle[root@app-db12c ~]# passwd oracleChanging password for user oracle.New password:BAD PASSWORD: it is based on a dictionary wordBAD PASSWORD: is too simpleRetype new password:passwd: all authentication tokens updated successfully. 检查用户组及用户 123[root@app-db12c ~]# su - oracle[oracle@app-db12c ~]$ iduid=500(oracle) gid=500(oinstall) groups=500(oinstall),501(dba),502(oper) 4. 创建安装目录 创建Oracle软件安装目录 1[root@app-db12c ~]# mkdir -p /u01/app/oracle 更改属组并授权 12[root@app-db12c ~]# chown -R oracle:oinstall /u01/[root@app-db12c ~]# chmod -R 775 /u01/app/oracle/ 5. 修改资源限制 修改sysctl.conf 123456789101112[root@app-db12c ~]# vi /etc/sysctl.conffs.aio-max-nr = 1048576fs.file-max = 6815744kernel.shmall = 2097152kernel.shmmax = 536870912kernel.shmmni = 4096kernel.sem = 250 32000 100 128net.ipv4.ip_local_port_range = 9000 65500net.core.rmem_default = 262144net.core.rmem_max = 4194304net.core.wmem_default = 262144net.core.wmem_max = 1048576 修改limets.conf 1234567891011121314151617181920[root@app-db12c ~]# vi /etc/security/limits.conforacle soft nproc 2047oracle hard nproc 16384oracle soft nofile 4096oracle hard nofile 65536oracle soft stack 10240oracle hard stack 32768# 修改完成后验证参数，需要重启[oracle@app-db12c ~]$ ulimit -Sn4096[oracle@app-db12c ~]$ ulimit -Hn65536[oracle@app-db12c ~]$ ulimit -Su2047[oracle@app-db12c ~]$ ulimit -Hu16384[oracle@app-db12c ~]$ ulimit -Ss10240[oracle@app-db12c ~]$ ulimit -Hs32768 6. 安装依赖包 查看官方文档中所需的依赖包 1234567891011121314151617181920212223242526272829303132333435363738394041424344binutils-2.20.51.0.2-5.36.el6 (x86_64)compat-libcap1-1.10-1 (x86_64)compat-libstdc++-33-3.2.3-69.el6 (x86_64)compat-libstdc++-33-3.2.3-69.el6 (i686)e2fsprogs-1.41.12-14.el6 (x86_64)e2fsprogs-libs-1.41.12-14.el6 (x86_64)glibc-2.12-1.7.el6 (i686)glibc-2.12-1.7.el6 (x86_64)glibc-devel-2.12-1.7.el6 (x86_64)glibc-devel-2.12-1.7.el6 (i686)kshlibgcc-4.4.4-13.el6 (i686)libgcc-4.4.4-13.el6 (x86_64)libstdc++-4.4.4-13.el6 (x86_64)libstdc++-4.4.4-13.el6 (i686)libstdc++-devel-4.4.4-13.el6 (x86_64)libstdc++-devel-4.4.4-13.el6 (i686)libaio-0.3.107-10.el6 (x86_64)libaio-0.3.107-10.el6 (i686)libaio-devel-0.3.107-10.el6 (x86_64)libaio-devel-0.3.107-10.el6 (i686)libXtst-1.0.99.2 (x86_64)libXtst-1.0.99.2 (i686)libX11-1.5.0-4.el6 (i686)libX11-1.5.0-4.el6 (x86_64)libXau-1.0.6-4.el6 (i686)libXau-1.0.6-4.el6 (x86_64)libxcb-1.8.1-1.el6 (i686)libxcb-1.8.1-1.el6 (x86_64)libXi-1.3 (x86_64)libXi-1.3 (i686)libXrender (i686)libXrender (x86_64)libXrender-devel (i686)libXrender-devel (x86_64)make-3.81-19.el6net-tools-1.60-110.el6_2.x86_64 (for Oracle RAC and Oracle Clusterware)nfs-utils-1.2.3-15.0.1 (for Oracle ACFS)sysstat-9.0.4-11.el6 (x86_64)smartmontools-5.43-1.el6.x86_64unixODBC-2.2.14-11.el6 (x86_64)unixODBC-2.2.14-11.el6.i686unixODBC-devel-2.2.14-11.el6 (x86_64)unixODBC-devel-2.2.14-11.el6.i686 配置yum源 1234567[root@app-db12c ~]# vi /etc/yum.repos.d/CentOS-Base.repo[base]name=CentOS-$releasever - Basebaseurl=file:///mediaenable=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6 安装依赖 12345678# 在虚拟机中添加操作系统镜像并挂载[root@app-db11g media]# mount /dev/cdrom /media/mount: block device /dev/sr0 is write-protected, mounting read-only# 使用yum install命令安装依赖包[root@app-db11g ~]# yum install -y compat-libcap1 compat-libstdc++-33 compat-libstdc++-33 gcc gcc-c++ glibc glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel make sysstat unixODBC unixODBC-devel 7. 安装数据库软件 配置oracle用户的bash_profile 12345[oracle@app-db11g ~]$ vi ~/.bash_profileexport ORACLE_SID=prod1export ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1export PATH=$ORACLE_HOME/bin:$PATH 上用sftp上传安装包到服务器，完成后使用unzip命令解压 12[root@app-db12c ~]# ls /home/linuxx64_12201_database.zip 配置VNC Server 123[root@app-db12c ~]# vi /etc/sysconfig/vncserversVNCSERVERS=\"2:root\"VNCSERVERARGS[2]=\"-geometry 1024x768\" 设置或者重置vnc密码 123[root@app-db12c ~]# vncpasswdPassword:Verify: 启动VNC Server 1234567891011[root@app-db12c ~]# service vncserver startStarting VNC server: 2:root xauth: file /root/.Xauthority does not existxauth: (stdin):1: bad display name \"app-db12c:2\" in \"add\" commandNew 'app-db12c:2 (root)' desktop is app-db12c:2Creating default startup script /root/.vnc/xstartupStarting applications specified in /root/.vnc/xstartupLog file is /root/.vnc/app-db12c:2.log [ OK ] 使用VNC Viewer连接由于我的操作系统是Fedora 29，所以使用的Remmina远程桌面工具，其实连接方式是一样的注意IP地址后面的冒号，在连接上远程桌面后在终端root用户和oracle都要执行xhost +命令，然后cd /home/database执行./runInstaller 不执行安全更新 只安装数据软件 选择单实例安装 选择企业版 指定安装目录 指定oraInventory目录 指定用户组 安装信息汇总 安装进度 执行root脚本，安装完成 12345678910111213141516171819202122232425262728293031323334[root@app-db12c ~]# /u01/app/oraInventory/orainstRoot.shChanging permissions of /u01/app/oraInventory.Adding read,write permissions for group.Removing read,write,execute permissions for world.Changing groupname of /u01/app/oraInventory to oinstall.The execution of the script is complete.[root@app-db12c ~]# /u01/app/oracle/product/12.2.0/dbhome_1/root.shPerforming root user operation.The following environment variables are set as: ORACLE_OWNER= oracle ORACLE_HOME= /u01/app/oracle/product/12.2.0/dbhome_1Enter the full pathname of the local bin directory: [/usr/local/bin]: Copying dbhome to /usr/local/bin ... Copying oraenv to /usr/local/bin ... Copying coraenv to /usr/local/bin ...Creating /etc/oratab file...Entries will be added to the /etc/oratab file as needed byDatabase Configuration Assistant when a database is createdFinished running generic part of root script.Now product-specific root actions will be performed.Do you want to setup Oracle Trace File Analyzer (TFA) now ? yes|[no] :Oracle Trace File Analyzer (TFA - User Mode) is available at : /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/bin/tfactlOROracle Trace File Analyzer (TFA - Daemon Mode) can be installed by running this script : /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/install/roottfa.sh 8. 配置监听 执行netca配置监听 选择增加 监听名称 监听协议 监听端口 不配置另一个监听 监听配置完成 9. 创建数据库 选择创建数据库 选择高级配置 选择创建数据库的类型类型有通用或事务、数据仓库和自定义，我们选择通用或事务，也就是常说的OLTP 填写SID注意：下面是12c的新特性，创建容器库的选项，包括填写一个PDB名称，默认也可以 存储选项 闪回区和归档 选择监听 安全策略配置 设置内存、进程、字符集、连接模式 EM配置 设置统一密码 创建数据库选项 创建信息汇总 创建进度 创建完成 10. 数据库测试 查看数据库版本123456789SQL&gt; select banner from v$version;BANNER--------------------------------------------------------------------------------Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit ProductionPL/SQL Release 12.2.0.1.0 - ProductionCORE 12.2.0.1.0 ProductionTNS for Linux: Version 12.2.0.1.0 - ProductionNLSRTL Version 12.2.0.1.0 - Production 查看CDB状态12345SQL&gt; select instance_name,status from v$instance;INSTANCE_NAME STATUS---------------- ------------orcl OPEN 查看PDB123456SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO 11. Oracle 12c新特性 基本概念Oracle 在12c数据库中引入了多租户环境（Multitenant Environment），允许一个数据库容器（Container Database）简称CDB，可以承载多个可插拔（Pluggable Database）简称PDB。12c以前实例和数据库是一对一，或者多对一的关系，进入12c以后实例和数据库之间的关系可以是一对多，参见官方文档中CDB和PDB的关系图 CDB所包含的组件Rootroot又名CDB$ROOT，存储着Oracle提供的元数据和common users。元数据的一个例子就是Oracle提供的PL/SQL包。common user是每个容器中已知的用户。一个CDB只有一个root。Seedseed又名PDB$SEED，是用于创建新pdb的模板。你不能在seed中添加或者修改对象。一个CDB只有一个seed。PDBsPDB对用户和应用程序而言像是非CDB。 例如，PDB可以包含支持特定应用程序所需的数据和代码。 PDB与Oracle Database 12c之前的Oracle数据库版本完全向后兼容。 12. PDB基本操作 创建PDB1234SQL&gt; create pluggable database pdb2 admin user pdbadmin identified by pdbadmin123 FILE_NAME_CONVERT=('/u01/app/oracle/oradata/orcl/pdbseed','/u01/app/oracle/oradata/orcl/pdb2');Pluggable database created. 查看PDB12345678SQL&gt; select con_id,dbid,name,open_mode from v$pdbs; CON_ID DBID NAME OPEN_MODE---------- ---------- ---------- ---------- 2 1296933544 PDB$SEED READ ONLY 3 4050349150 PDB1 MOUNTED 4 1025185214 PDB2 MOUNTED 5 1117275895 PDB3 MOUNTED 在CDB中开启和关闭PDB1234567891011-- 开启单个PDBSQL&gt; alter pluggable database pdb1 open;-- 开启多个PDBSQL&gt; alter pluggable database all open;-- 关闭单个PDBSQL&gt; alter pluggable database pdb1 close;-- 关闭多个PDBSQL&gt; alter pluggable database all close; 切换PDB12345-- CDB切换到PDB，PDB和PDB之间切换SQL&gt; alter session set container=pdb1;-- PDB切换到CDBSQL&gt; alter session set container=CDB$ROOT; 删除PDB12345678-- 拨出PDBSQL&gt; alter pluggable database pdb2 unplug into '/home/oracle/unplugged_pdbs/pdb_2.xml';-- 删除PDB，保留数据文件SQL&gt; drop pluggable database pdb2 keep datafiles;-- 删除PDB，不保留数据文件SQL&gt; drop pluggable database pdb3 including datafiles;","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"}],"author":["Falkon"]},{"title":"Linux Installation Oracle 12c RAC","slug":"database/installed-oracle12c-rac-on-rhel","date":"2021-01-27T09:37:22.703Z","updated":"2021-03-26T10:24:52.281Z","comments":true,"path":"2021/01/27/database/installed-oracle12c-rac-on-rhel/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-oracle12c-rac-on-rhel/","excerpt":"","text":"","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"RAC","slug":"RAC","permalink":"http://mudbub.com/tags/RAC/"},{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"AFD","slug":"AFD","permalink":"http://mudbub.com/tags/AFD/"}],"author":["Falkon"]},{"title":"Linux Installation Oracle 11g","slug":"database/installed-oracle11g-on-rhel","date":"2021-01-27T09:37:22.698Z","updated":"2021-03-26T10:24:19.368Z","comments":true,"path":"2021/01/27/database/installed-oracle11g-on-rhel/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-oracle11g-on-rhel/","excerpt":"1. 资源描述 CentOS 6.10 操作系统可选择6.x系列其他的版本 Oracle 11.2.0.4 我使用的数据库版本需要MOS才能下载，可选择11.2.0.1版本 Virtual Box 5.2.22 虚拟机软件可选择最新版，建议使用5系列，比较稳定 VNC Viewer 6.18 远程桌面工具，可选用最新版 Xshell 5 远程终端工具5系列官网已经不提供下载了，可选择6系列，有使用限制，单个窗口最大可开4个标签，可选择其他终端工具比如Putty，MobaXterm等","text":"1. 资源描述 CentOS 6.10 操作系统可选择6.x系列其他的版本 Oracle 11.2.0.4 我使用的数据库版本需要MOS才能下载，可选择11.2.0.1版本 Virtual Box 5.2.22 虚拟机软件可选择最新版，建议使用5系列，比较稳定 VNC Viewer 6.18 远程桌面工具，可选用最新版 Xshell 5 远程终端工具5系列官网已经不提供下载了，可选择6系列，有使用限制，单个窗口最大可开4个标签，可选择其他终端工具比如Putty，MobaXterm等 2. 操作系统检查与配置 查看操作系统版本 12[root@localhost ~]# cat /etc/redhat-release CentOS release 6.10 (Final) 查看内存，swap 123456# 内存建议1G以上，swap建议4G以上否则在安装检查的时候会报错[root@localhost ~]# free -m total used free shared buffers cachedMem: 1878 702 1175 2 52 378-/+ buffers/cache: 270 1607Swap: 4095 0 4095 调整swap大小 12345678910111213141516171819# 创建分区，位置可自定，bs参数为块大小，count参数为个数[root@localhost ~]# dd if=/dev/zero of=/home/swap bs=1M count=20482048+0 records in2048+0 records out2147483648 bytes (2.1 GB) copied, 2.72688 s, 788 MB/s# 将分区变成swap分区[root@localhost ~]# mkswap /home/swapmkswap: /home/swap: warning: don't erase bootbits sectors on whole disk. Use -f to force.Setting up swapspace version 1, size = 2097148 KiBno label, UUID=21751eac-33ad-4fe0-8b13-3bccc34973b9# 使分区生效[root@localhost ~]# swapon /home/swap# 修改fstab添加开机启动[root@localhost ~]# vi /etc/fstab/home/swap swap swap defaults 0 0 查看磁盘空间 1234567# Oracle安装目录的可用空间建议15G以上，安装操作系统磁盘建议32G以上[root@localhost ~]# df -hFilesystem Size Used Avail Use% Mounted on/dev/mapper/VolGroup-LogVol00 28G 7.3G 19G 29% /tmpfs 940M 76K 939M 1% /dev/shm/dev/sda1 190M 40M 141M 22% /boot 配置IP地址 12345678910111213141516# 编辑ifcfg-eth0[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0# 参照下列示例修改后六行，Virtual Box的虚拟网关为192.168.56.1# 在host-only模式下你的IP地址需要在192.168.56这个网段# 在生产环境下，数据库是和交换机连在一起的，具体的IP需要和应用在同# 一个网段或者VLAN中DEVICE=eth0HWADDR=08:00:27:7F:BA:FDTYPE=EthernetUUID=0948b812-ae70-4159-9564-bde690e7befaONBOOT=yesNM_CONTROLLED=yesBOOTPROTO=staticIPADDR=192.168.56.103NETMASK=255.255.255.0GATEWAY=192.168.56.1 修改network 12345678# 修改主机名，一般建议为：应用-类型版本的模式，这样方便的终端登陆时候，# 看到主机名就知道这台服务器的作用，以及为哪个应用提供服务，如果上面有# 多个库，建议为mpp(Multi Application)-类型版本的模式# 编辑network配置文件[root@localhost ~]# vi /etc/sysconfig/network# 将localhost.localdomain修改为自定的主机名NETWORKING=yesHOSTNAME=app-db11g 修改hosts 12[root@localhost ~]# vi /etc/hosts192.168.56.103 app-db11g 修改防火墙 1234# 关闭防火墙[root@localhost ~]# service iptables stop# 禁止开机启动防火墙[root@localhost ~]# chkconfig iptables off 修改selinux 12345678910111213# 关闭Linux增强，编辑selinx配置文件[root@localhost ~]# vi /etc/sysconfig/selinux# 将SELINUX=enforcing修改SELINUX=disabled# This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=disabled# SELINUXTYPE= can take one of these two values:# targeted - Targeted processes are protected,# mls - Multi Level Security protection.SELINUXTYPE=targeted 3. 创建用户组及用户 创建用户组123[root@app-db11g ~]# groupadd oinstall[root@app-db11g ~]# groupadd dba[root@app-db11g ~]# groupadd oper 创建用户并设置密码12345678[root@app-db11g ~]# useradd -g oinstall -G dba,oper oracle[root@app-db11g ~]# passwd oracleChanging password for user oracle.New password: BAD PASSWORD: it is based on a dictionary wordBAD PASSWORD: is too simpleRetype new password: passwd: all authentication tokens updated successfully. 检查用户组及用户123[root@app-db11g ~]# su - oracle[oracle@app-db11g ~]$ iduid=500(oracle) gid=500(oinstall) groups=500(oinstall),501(dba),502(oper) 4. 创建安装目录 创建Oracle软件安装目录1[root@app-db11g ~]# mkdir -p /u01/app/oracle 更改属组并授权12[root@app-db11g ~]# chown -R oracle:oinstall /u01/[root@app-db11g ~]# chmod -R 775 /u01/app/oracle/ 5. 修改资源限制 修改sysctl.conf123456789101112[root@app-db11g ~]# vi /etc/sysctl.conffs.aio-max-nr = 1048576fs.file-max = 6815744kernel.shmall = 2097152kernel.shmmax = 536870912kernel.shmmni = 4096kernel.sem = 250 32000 100 128net.ipv4.ip_local_port_range = 9000 65500net.core.rmem_default = 262144net.core.rmem_max = 4194304net.core.wmem_default = 262144net.core.wmem_max = 1048576 修改limets.conf1234567891011121314151617181920[root@app-db11g ~]# vi /etc/security/limits.conforacle soft nproc 2047oracle hard nproc 16384oracle soft nofile 4096oracle hard nofile 65536oracle soft stack 10240oracle hard stack 32768# 修改完成后验证参数，需要重启[oracle@app-db11g ~]$ ulimit -Sn4096[oracle@app-db11g ~]$ ulimit -Hn65536[oracle@app-db11g ~]$ ulimit -Su2047[oracle@app-db11g ~]$ ulimit -Hu16384[oracle@app-db11g ~]$ ulimit -Ss10240[oracle@app-db11g ~]$ ulimit -Hs32768 6. 安装依赖包 查看官方文档中所需的依赖包 123456789101112131415161718192021222324252627binutils-2.20.51.0.2-5.11.el6 (x86_64)compat-libcap1-1.10-1 (x86_64)compat-libstdc++-33-3.2.3-69.el6 (x86_64)compat-libstdc++-33-3.2.3-69.el6.i686kshgcc-4.4.4-13.el6 (x86_64)gcc-c++-4.4.4-13.el6 (x86_64)glibc-2.12-1.7.el6 (i686)glibc-2.12-1.7.el6 (x86_64)glibc-devel-2.12-1.7.el6 (x86_64)glibc-devel-2.12-1.7.el6.i686libgcc-4.4.4-13.el6 (i686)libgcc-4.4.4-13.el6 (x86_64)libstdc++-4.4.4-13.el6 (x86_64)libstdc++-4.4.4-13.el6.i686libstdc++-devel-4.4.4-13.el6 (x86_64)libstdc++-devel-4.4.4-13.el6.i686libaio-0.3.107-10.el6 (x86_64)libaio-0.3.107-10.el6.i686libaio-devel-0.3.107-10.el6 (x86_64)libaio-devel-0.3.107-10.el6.i686make-3.81-19.el6sysstat-9.0.4-11.el6 (x86_64)unixODBC-2.2.14-11.el6 (x86_64)unixODBC-2.2.14-11.el6.i686unixODBC-devel-2.2.14-11.el6 (x86_64)unixODBC-devel-2.2.14-11.el6.i686 配置yum源 1234567[root@app-db11g ~]# vi /etc/yum.repos.d/CentOS-Base.repo[base]name=CentOS-$releasever - Basebaseurl=file:///mediaenable=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6 安装依赖 12345678# 在虚拟机中添加操作系统镜像并挂载[root@app-db11g media]# mount /dev/cdrom /media/mount: block device /dev/sr0 is write-protected, mounting read-only# 使用yum install命令安装依赖包[root@app-db11g ~]# yum install -y compat-libcap1 compat-libstdc++-33 compat-libstdc++-33 gcc gcc-c++ glibc glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel make sysstat unixODBC unixODBC-devel 7. 安装数据库软件 配置oracle用户的bash_profile12345[oracle@app-db11g ~]$ vi ~/.bash_profileexport ORACLE_SID=prod1export ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1export PATH=$ORACLE_HOME/bin:$PATH 上用sftp上传安装包到服务器，完成后使用unzip命令解压123[root@app-db11g ~]# ls /home/p13390677_112040_Linux-x86-64_1of7.zipp13390677_112040_Linux-x86-64_2of7.zip 处理缺少elfultils-libelf-devel-0.97和pdksh-5.2.14依赖包问题12345# 备份cvu_config[root@app-db11g admin]# cp /home/database/stage/cvu/cv/admin/cvu_config /home/database/stage/cvu/cv/admin/cvu_config.bak# 修改cvu_config中的CV_ASSUME_DISTID=OEL4为CV_ASSUME_DISTID=OEL6# Fallback to this distribution idCV_ASSUME_DISTID=OEL6 重启虚拟机1[root@app-db11g ~]# reboot 配置VNC Server123[root@app-db11g ~]# vi /etc/sysconfig/vncserversVNCSERVERS=\"2:root\"VNCSERVERARGS[2]=\"-geometry 1024x768\" 设置或者重置vnc密码123[root@app-db11g ~]# vncpasswdPassword:Verify: 启动VNC Server1234567891011[root@app-db11g ~]# service vncserver startStarting VNC server: 2:root xauth: file /root/.Xauthority does not existxauth: (stdin):1: bad display name \"app-db11g:2\" in \"add\" commandNew 'app-db11g:2 (root)' desktop is app-db11g:2Creating default startup script /root/.vnc/xstartupStarting applications specified in /root/.vnc/xstartupLog file is /root/.vnc/app-db11g:2.log [ OK ] 使用VNC Viewer连接由于我的操作系统是Fedora 29，所以使用的Remmina远程桌面工具，其实连接方式是一样的注意IP地址后面的冒号，在连接上远程桌面后在终端root用户和oracle都要执行xhost +命令，然后cd /home/database执行./runInstaller 不执行安全更新 跳过软件更新 只安装数据库软件 选择单实例安装 选择语言 选择企业版 指定安装路径 创建Inventoy 指定用户组 汇总信息 安装进度 执行root脚本 1234567891011121314151617181920212223242526[root@app-db11g ~]# /u01/app/oraInventory/orainstRoot.sh Changing permissions of /u01/app/oraInventory.Adding read,write permissions for group.Removing read,write,execute permissions for world.Changing groupname of /u01/app/oraInventory to oinstall.The execution of the script is complete.[root@app-db11g ~]# /u01/app/oracle/product/11.2.0/dbhome_1/root.sh Performing root user operation for Oracle 11g The following environment variables are set as: ORACLE_OWNER= oracle ORACLE_HOME= /u01/app/oracle/product/11.2.0/dbhome_1Enter the full pathname of the local bin directory: [/usr/local/bin]: Copying dbhome to /usr/local/bin ... Copying oraenv to /usr/local/bin ... Copying coraenv to /usr/local/bin ...Creating /etc/oratab file...Entries will be added to the /etc/oratab file as needed byDatabase Configuration Assistant when a database is createdFinished running generic part of root script.Now product-specific root actions will be performed.Finished product-specific root actions. 安装完成 8. 配置监听 执行netca配置监听 选择增加 监听名称 监听协议 监听端口 不配置另一个监听 监听配置完成 9. 创建数据库 dbca配置助手欢迎页面 选择创建操作 选择创建数据库的类型类型有通用或事务、数据仓库和自定义，我们选择通用或事务，也就是常说的OLTP 填写SIDGlobal Database Name和SID一致 开启EMEM是Oracle的企业管理器，启动后可以在Web Console对数据库进行监控和操作 设置统一密码 选择文件系统 开启闪回区 不勾选示例 设置内存、进程、字符集、连接模式内存设置为自动管理，进程默认150就可以，正式环境很具使用情况进行调整，连接模式选择专用服务器 字符集选用AL32UTF8或者ZHS16GBK，根据应用需求，这里我们选择ZHS16GBK Database Storage这里可以查看和增加控制文件、数据文件以及REDO日志组 创建数据库 创建过程等待创建完成，约30分钟左右 10. 数据库测试 以sysdba登陆数据库 123456789101112[oracle@app-db11g ~]$ sqlplus / as sysdbaSQL*Plus: Release 11.2.0.4.0 Production on Sun Feb 24 15:05:01 2019Copyright (c) 1982, 2013, Oracle. All rights reserved.Connected to:Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsSQL&gt; 查看数据库状态 12345SQL&gt; select instance_name,status from v$instance;INSTANCE_NAME STATUS---------------- ------------prod1 OPEN 查看数据文件 12345678SQL&gt; select name from v$datafile;NAME--------------------------------------------------/u01/app/oracle/oradata/prod1/system01.dbf/u01/app/oracle/oradata/prod1/sysaux01.dbf/u01/app/oracle/oradata/prod1/undotbs01.dbf/u01/app/oracle/oradata/prod1/users01.dbf","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"11g","slug":"11g","permalink":"http://mudbub.com/tags/11g/"},{"name":"Install","slug":"Install","permalink":"http://mudbub.com/tags/Install/"}],"author":["Falkon"]},{"title":"Linux Installation 11g RAC","slug":"database/installed-oracle11g-rac-on-rhel","date":"2021-01-27T09:37:22.691Z","updated":"2021-03-26T10:24:36.825Z","comments":true,"path":"2021/01/27/database/installed-oracle11g-rac-on-rhel/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-oracle11g-rac-on-rhel/","excerpt":"","text":"","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"11g","slug":"11g","permalink":"http://mudbub.com/tags/11g/"},{"name":"RAC","slug":"RAC","permalink":"http://mudbub.com/tags/RAC/"},{"name":"UDEV","slug":"UDEV","permalink":"http://mudbub.com/tags/UDEV/"}],"author":["Falkon"]},{"title":"Linux Installation Oracle11g GoldenGate","slug":"database/installed-ogg-on-rhel","date":"2021-01-27T09:37:22.686Z","updated":"2021-03-26T10:24:27.588Z","comments":true,"path":"2021/01/27/database/installed-ogg-on-rhel/","link":"","permalink":"http://mudbub.com/2021/01/27/database/installed-ogg-on-rhel/","excerpt":"1. 资源描述 GoldenGate 组件版本选择为12.3.0.1 rlwrap 可以解决Linux下sqlplus提供历史命令浏览、删除错误输入等功能 2. 环境准备 名称 主机名 SID IP地址 源端 ogg-src prod1 192.168.56.103 目标端 ogg-trg prod2 192.168.56.104","text":"1. 资源描述 GoldenGate 组件版本选择为12.3.0.1 rlwrap 可以解决Linux下sqlplus提供历史命令浏览、删除错误输入等功能 2. 环境准备 名称 主机名 SID IP地址 源端 ogg-src prod1 192.168.56.103 目标端 ogg-trg prod2 192.168.56.104 3. 目录及配置 创建安装目录1234# 源端创建目录mkdir -p /u01/app/oracle/product/11.2.0/oggcore_1# 目标端创建目录mkdir -p /u01/app/oracle/product/11.2.0/oggcore_1 配置环境变量每次配置完环境变量别忘了执行source .bash_profile使配置生效1234567891011121314151617# 源端添加环境变量[oracle@ogg-src ~]$ vi .bash_profileexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1export ORACLE_SID=prod1export PATH=$ORACLE_HOME/bin:$PATHexport OGG_HOME=/u01/app/oracle/product/11.2.0/oggcore_1export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$OGG_HOME# 目标端添加环境变量[oracle@ogg-trg ~]$ vi .bash_profileexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1export ORACLE_SID=prod2export PATH=$ORACLE_HOME/bin:$PATHexport OGG_HOME=/u01/app/oracle/product/11.2.0/oggcore_1export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$OGG_HOME 4. 开始安装 解压安装包 1234[root@ogg-src home]# unzip 123014_fbo_ggs_Linux_x64_shiphome.zip# VNC Viewer连接服务器操作[oracle@ogg-src ~]$ cd /home/fbo_ggs_Linux_x64_shiphome/Disk1/[oracle@ogg-src Disk1]$ ./runInstaller 选择数据库版本对应的GoldenGate版本 指定安装目录 汇总信息 安装过程 目标端安装步骤同上 配置OGG快捷命令和回写配置快捷方式和回写需要安装readline和rlwrap两个依赖包，readline系统光盘里有，使用yum命令安装即可，rlwrap包需要下载使用rpm -ivh rlwrap-0.42-1.el6.x86_64.rpm命令安装 12345678910alias ggsci='rlwrap /u01/app/oracle/product/11.2.0/oggcore_1/ggsci'[oracle@ogg-src ~]$ which ggscialias ggsci='rlwrap /u01/app/oracle/product/11.2.0/oggcore_1/ggsci' /usr/bin/rlwrap # 目标端添加并验证alias ggsci='rlwrap /u01/app/oracle/product/11.2.0/oggcore_1/ggsci'[oracle@ogg-trg ~]$ which ggscialias ggsci='rlwrap /u01/app/oracle/product/11.2.0/oggcore_1/ggsci' /usr/bin/rlwrap 5. 测试 源端123456789101112[oracle@ogg-src ~]$ ggsciOracle GoldenGate Command Interpreter for OracleVersion 12.3.0.1.4 OGGCORE_12.3.0.1.0_PLATFORMS_180415.0359_FBOLinux, x64, 64bit (optimized), Oracle 11g on Apr 15 2018 21:16:09Operating system character set identified as UTF-8.Copyright (C) 1995, 2018, Oracle and/or its affiliates. All rights reserved.GGSCI (ogg-src) 1&gt; 目标端123456789101112[oracle@ogg-trg ~]$ ggsciOracle GoldenGate Command Interpreter for OracleVersion 12.3.0.1.4 OGGCORE_12.3.0.1.0_PLATFORMS_180415.0359_FBOLinux, x64, 64bit (optimized), Oracle 11g on Apr 15 2018 21:16:09Operating system character set identified as UTF-8.Copyright (C) 1995, 2018, Oracle and/or its affiliates. All rights reserved.GGSCI (ogg-trg) 1&gt;","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"GoldenGate","slug":"GoldenGate","permalink":"http://mudbub.com/tags/GoldenGate/"}],"author":["Falkon"]},{"title":"PGA_AGGREGATE_TARGET specified is high","slug":"database/pga_aggregate_target-specified-is-high","date":"2021-01-27T09:37:22.679Z","updated":"2021-03-26T10:24:07.375Z","comments":true,"path":"2021/01/27/database/pga_aggregate_target-specified-is-high/","link":"","permalink":"http://mudbub.com/2021/01/27/database/pga_aggregate_target-specified-is-high/","excerpt":"启动数据库出现PGA_AGGREGATE_TARGET specified is high 1234PGA_AGGREGATE_TARGET specified is highErrors in file /u01/app/oracle/diag/rdbms/shdb551/shdb551/trace/shdb551_ora_9494.trc (incident=122887):ORA-00700: soft internal error, arguments: [pga physmem limit], [12752781312], [10969017344], [], [], [], [], [], [], [], [], []Incident details in: /u01/app/oracle/diag/rdbms/shdb551/shdb551/incident/incdir_122887/shdb551_ora_9494_i122887.trc","text":"启动数据库出现PGA_AGGREGATE_TARGET specified is high 1234PGA_AGGREGATE_TARGET specified is highErrors in file /u01/app/oracle/diag/rdbms/shdb551/shdb551/trace/shdb551_ora_9494.trc (incident=122887):ORA-00700: soft internal error, arguments: [pga physmem limit], [12752781312], [10969017344], [], [], [], [], [], [], [], [], []Incident details in: /u01/app/oracle/diag/rdbms/shdb551/shdb551/incident/incdir_122887/shdb551_ora_9494_i122887.trc 查看trace信息,发现是PGA设置过大导致错误 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152[root@sfcpid1 ~]# more /u01/app/oracle/diag/rdbms/sfcpid1/sfcpid1/incident/incdir_163849/sfcpid1_ora_20259_i163849.trcDump file /u01/app/oracle/diag/rdbms/sfcpid1/sfcpid1/incident/incdir_163849/sfcpid1_ora_20259_i163849.trcOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.5.2.0.0Build label: RDBMS_19.3.0.0.0DBRU_LINUX.X64_190417ORACLE_HOME: /u01/app/oracle/product/19.0.0/dbhome_1System name: LinuxNode name: sfcpid1Release: 3.10.0-1127.el7.x86_64Version: #1 SMP Tue Feb 18 16:39:12 EST 2020Machine: x86_64Instance name: sfcpid1Redo thread mounted by this instance: 0 &lt;none&gt;Oracle process number: 0Unix process pid: 20259, image: *** 2020-08-24T16:15:36.805587+08:00[TOC00000]Jump to table of contentsDump continued from file: /u01/app/oracle/diag/rdbms/sfcpid1/sfcpid1/trace/sfcpid1_ora_20259.trc[TOC00001]ORA-00700: soft internal error, arguments: [pga physmem limit], [12752781312], [10969017344], [], [], [], [], [], [], [], [], [][TOC00001-END][TOC00002]========= Dump for incident 163849 (ORA 700 [pga physmem limit]) ========[TOC00003]----- Beginning of Customized Incident Dump(s) ----- WARNING: PGA_AGGREGATE_TARGET (12162 MB) is too high for the amount of physical memory (63921 MB) and SGA size (36608 MB) - it should be less than 10460 MB. ----- End of Customized Incident Dump(s) -----[TOC00003-END]*** 2020-08-24T16:15:36.828334+08:00dbkedDefDump(): Starting incident default dumps (flags=0x2, level=3, mask=0x0)[TOC00004]----- SQL Statement (None) -----Current SQL information unavailable - no session.[TOC00004-END][TOC00005]----- Call Stack Trace -----calling call entry argument values in hex location type point (? means dubious value) -------------------- -------- -------------------- ----------------------------ksedst1()+95 call kgdsdst() 7FFEFD089840 000000002 7FFEFD083B70 ? 7FFEFD083C88 ? 000000000 000000082 ? 根据trace信息里给出的建议值修改PGA 123SQL&gt; alter system set pga_aggregate_target=10460M scope=spfile;System altered. 修改完成后重启数据库，发现错误已经消失","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ORA-00700","slug":"ORA-00700","permalink":"http://mudbub.com/tags/ORA-00700/"}],"author":["Falkon"]},{"title":"Oracle 19.5 Patch 30830913 apply (pdb CDB$ROOT) WITH ERRORS","slug":"database/patch-30830913-apply-with errors","date":"2021-01-27T09:37:22.673Z","updated":"2021-03-26T10:23:59.190Z","comments":true,"path":"2021/01/27/database/patch-30830913-apply-with errors/","link":"","permalink":"http://mudbub.com/2021/01/27/database/patch-30830913-apply-with%20errors/","excerpt":"19.3升级19.5.2，建库出现如下告警","text":"19.3升级19.5.2，建库出现如下告警 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253PDB$SEED(2):***************************************************************PDB$SEED(2):WARNING: Pluggable Database PDB$SEED with pdb id - 2 isPDB$SEED(2): altered with errors or warnings. Please look intoPDB$SEED(2): PDB_PLUG_IN_VIOLATIONS view for more details.PDB$SEED(2):***************************************************************2020-08-09T17:16:00.606239+08:00PDB$SEED(2):Opening pdb with no Resource Manager plan activePDB$SEED(2):joxcsys_required_dirobj_exists: directory object exists with required path /u01/app/oracle/product/19.3.0/dbhome_1/javavm/admin/, pid 14333 cid 22020-08-09T17:16:01.609748+08:00Pluggable database PDB$SEED opened read writeCompleted: alter pluggable database \"PDB$SEED\" open READ WRITE services=NONE2020-08-09T17:16:02.759184+08:00PDB$SEED(2):SERVER COMPONENT id=UTLRP_BGN: timestamp=2020-08-09 17:16:02 Container=PDB$SEED Id=22020-08-09T17:16:08.440218+08:00PDB$SEED(2):TABLE SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY: ADDED INTERVAL PARTITION SYS_P228 (44051) VALUES LESS THAN (TO_DATE(' 2020-08-10 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))PDB$SEED(2):TABLE SYS.WRI$_OPTSTAT_HISTGRM_HISTORY: ADDED INTERVAL PARTITION SYS_P231 (44051) VALUES LESS THAN (TO_DATE(' 2020-08-10 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))2020-08-09T17:22:15.310651+08:00PDB$SEED(2):Resize operation completed for file# 6, old size 348160K, new size 358400K2020-08-09T17:42:36.904868+08:00PDB$SEED(2):Resize operation completed for file# 5, old size 296960K, new size 307200K2020-08-09T18:02:19.222225+08:00Resize operation completed for file# 3, old size 727040K, new size 737280K2020-08-09T18:34:30.481765+08:00PDB$SEED(2):SERVER COMPONENT id=UTLRP_END: timestamp=2020-08-09 18:34:30 Container=PDB$SEED Id=22020-08-09T18:34:33.329925+08:00PDB$SEED(2):PDB$SEED(2):XDB installed.PDB$SEED(2):PDB$SEED(2):XDB initialized.2020-08-09T18:34:38.289646+08:00alter pluggable database \"PDB$SEED\" close immediate force instances=('orcl')2020-08-09T18:34:38.420110+08:00PDB$SEED(2):JIT: pid 19251 requesting stop2020-08-09T18:34:41.794154+08:00PDB$SEED(2):Buffer Cache flush started: 2PDB$SEED(2):Buffer Cache flush finished: 22020-08-09T18:34:42.894106+08:00Pluggable database PDB$SEED closedCompleted: alter pluggable database \"PDB$SEED\" close immediate force instances=('orcl')2020-08-09T18:34:43.348420+08:00alter pluggable database \"PDB$SEED\" open READ ONLY restricted instances=('orcl')PDB$SEED(2):Autotune of undo retention is turned on. PDB$SEED(2):Endian type of dictionary set to littlePDB$SEED(2):Undo initialization finished serial:0 start:782426536 end:782426536 diff:0 ms (0.0 seconds)2020-08-09T18:34:44.340859+08:00PDB$SEED(2):Database Characterset for PDB$SEED is AL32UTF82020-08-09T18:34:45.358778+08:00Violations: Type: 1, Count: 2PDB$SEED(2):***************************************************************PDB$SEED(2):WARNING: Pluggable Database PDB$SEED with pdb id - 2 isPDB$SEED(2): altered with errors or warnings. Please look intoPDB$SEED(2): PDB_PLUG_IN_VIOLATIONS view for more details.PDB$SEED(2):*************************************************************** 检查组件注册信息发现SDO组件的状态为无效 12345678910111213141516171819202122SQL&gt; select comp_id,version,status from dba_registry;COMP_ID VERSION STATUS------------------------------ ------------------------------ --------------------------------------------CATALOG 19.0.0.0.0 VALIDCATPROC 19.0.0.0.0 VALIDRAC 19.0.0.0.0 OPTION OFFJAVAVM 19.0.0.0.0 VALIDXML 19.0.0.0.0 VALIDCATJAVA 19.0.0.0.0 VALIDAPS 19.0.0.0.0 VALIDXDB 19.0.0.0.0 VALIDOWM 19.0.0.0.0 VALIDCONTEXT 19.0.0.0.0 VALIDORDIM 19.0.0.0.0 VALIDCOMP_ID VERSION STATUS------------------------------ ------------------------------ --------------------------------------------SDO 19.0.0.0.0 INVALIDXOQ 19.0.0.0.0 VALIDOLS 19.0.0.0.0 VALIDDV 19.0.0.0.0 VALID 查看PDB_PLUG_IN_VIOLATIONS信息，显示补丁状态为pending 12345678910111213141516171819202122SQL&gt; select * from pdb_plug_in_violations;TIME NAME CAUSE TYPE ERROR_NUMBER LINE MESSAGE STATUS ACTION CON_ID-------------------- ---------- --------------- --------- ------------ ---------- ------------------------------ --------- -------------------- ----------09-AUG-20 06.35.57.8 PDB$SEED SQL Patch ERROR 0 1 19.5.2.0.0 Release_Update_Revi PENDING Call datapatch to in 224974 PM sion 2003300442: APPLY with st stall in the PDB or atus WITH ERRORS in the CDB the CDB09-AUG-20 06.35.57.8 PDB$SEED SQL Patch ERROR 0 2 19.5.2.0.0 Release_Update_Revi PENDING Call datapatch to in 225780 PM sion 2003300442: APPLY with st stall in the PDB or atus WITH ERRORS in the PDB the CDB09-AUG-20 06.36.16.3 PDB1 SQL Patch ERROR 0 1 19.5.2.0.0 Release_Update_Revi PENDING Call datapatch to in 361910 PM sion 2003300442: APPLY with st stall in the PDB or atus WITH ERRORS in the CDB the CDBTIME NAME CAUSE TYPE ERROR_NUMBER LINE MESSAGE STATUS ACTION CON_ID-------------------- ---------- --------------- --------- ------------ ---------- ------------------------------ --------- -------------------- ----------09-AUG-20 06.36.16.3 PDB1 SQL Patch ERROR 0 2 19.5.2.0.0 Release_Update_Revi PENDING Call datapatch to in 362322 PM sion 2003300442: APPLY with st stall in the PDB or atus WITH ERRORS in the PDB the CDB 运行datapatch -verbose报错 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394[oracle@aproddb19c OPatch]$ ./datapatch -verboseSQL Patching tool version 19.5.2.0.0 Production on Sun Aug 9 22:01:50 2020Copyright (c) 2012, 2020, Oracle. All rights reserved.Log file for this invocation: /u01/app/oracle/cfgtoollogs/sqlpatch/sqlpatch_580_2020_08_09_22_01_50/sqlpatch_invocation.logConnecting to database...OKGathering database info...doneNote: Datapatch will only apply or rollback SQL fixes for PDBs that are in an open state, no patches will be applied to closed PDBs. Please refer to Note: Datapatch: Database 12c Post Patch SQL Automation (Doc ID 1585822.1)Bootstrapping registry and package to current versions...doneDetermining current state...doneCurrent state of interim SQL patches: No interim patches foundCurrent state of release update SQL patches: Binary registry: 19.5.2.0.0 Release_Update_Revision 200330044204: Installed PDB CDB$ROOT: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 05.01.13.205235 PM PDB PDB$SEED: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 05.01.18.928517 PM PDB PDB1: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 05.01.18.928517 PMAdding patches to installation queue and performing prereq checks...doneInstallation queue: For the following PDBs: CDB$ROOT PDB$SEED PDB1 No interim patches need to be rolled back Patch 30830913 (Database Release Update Revision : 19.5.2.0.200414 (30830913)): Apply from 19.1.0.0.0 Feature Release to 19.5.2.0.0 Release_Update_Revision 200330044204 No interim patches need to be appliedInstalling patches...Patch installation complete. Total patches installed: 3Validating logfiles...donePatch 30830913 apply (pdb CDB$ROOT): WITH ERRORS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_CDBROOT_2020Aug09_22_02_39.log (errors) -&gt; Error at line 121015: script md/admin/catmdloc.sql - ORA-29516: Aurora assertion failure: Bogus uncaught exception - ORA-00604: error occurred at recursive SQL level 1 - ORA-29532: Java call terminated by uncaught Java exception: - java.lang.ArrayIndexOutOfBoundsException -&gt; Error at line 121071: script md/admin/catmdloc.sql - ORA-29516: Aurora assertion failure: Bogus uncaught exception - ORA-00604: error occurred at recursive SQL level 1 - ORA-29532: Java call terminated by uncaught Java exception: - java.lang.ArrayIndexOutOfBoundsExceptionPatch 30830913 apply (pdb PDB$SEED): WITH ERRORS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_PDBSEED_2020Aug09_22_08_32.log (errors) -&gt; Error at line 186555: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for details -&gt; Error at line 186574: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for details -&gt; Error at line 186617: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for detailsPatch 30830913 apply (pdb PDB1): WITH ERRORS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_PDB1_2020Aug09_22_08_31.log (errors) -&gt; Error at line 121015: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for details -&gt; Error at line 121034: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for details -&gt; Error at line 121077: script md/admin/catmdloc.sql - ORA-29532: Java call terminated by uncaught Java exception: - oracle.aurora.server.tools.loadjava.ToolsError: - Error during loadjava: Failures occurred during processing. - Check trace file for detailsPlease refer to MOS Note 1609718.1 and/or the invocation log/u01/app/oracle/cfgtoollogs/sqlpatch/sqlpatch_580_2020_08_09_22_01_50/sqlpatch_invocation.logfor information on how to resolve the above errors.SQL Patching tool complete on Sun Aug 9 22:44:28 2020 打OJVM补丁 1234567891011121314151617181920212223242526272829303132333435363738394041[oracle@aproddb19c 30128191]$ /u01/app/oracle/product/19.3.0/dbhome_1/OPatch/opatch applyOracle Interim Patch Installer version 12.2.0.1.17Copyright (c) 2020, Oracle Corporation. All rights reserved.Oracle Home : /u01/app/oracle/product/19.3.0/dbhome_1Central Inventory : /u01/app/oraInventory from : /u01/app/oracle/product/19.3.0/dbhome_1/oraInst.locOPatch version : 12.2.0.1.17OUI version : 12.2.0.7.0Log file location : /u01/app/oracle/product/19.3.0/dbhome_1/cfgtoollogs/opatch/opatch2020-08-10_20-54-50PM_1.logVerifying environment and performing prerequisite checks...OPatch continues with these patches: 30128191 Do you want to proceed? [y|n]yUser Responded with: YAll checks passed.Please shutdown Oracle instances running out of this ORACLE_HOME on the local system.(Oracle Home = '/u01/app/oracle/product/19.3.0/dbhome_1')Is the local system ready for patching? [y|n]yUser Responded with: YBacking up files...Applying interim patch '30128191' to OH '/u01/app/oracle/product/19.3.0/dbhome_1'Patching component oracle.javavm.server, 19.0.0.0.0...Patching component oracle.javavm.server.core, 19.0.0.0.0...Patching component oracle.rdbms.dbscripts, 19.0.0.0.0...Patching component oracle.rdbms, 19.0.0.0.0...Patch 30128191 successfully applied.Log file location: /u01/app/oracle/product/19.3.0/dbhome_1/cfgtoollogs/opatch/opatch2020-08-10_20-54-50PM_1.logOPatch succeeded. 再次运行datapatch -verbose 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960[oracle@aproddb19c 30128191]$ /u01/app/oracle/product/19.3.0/dbhome_1/OPatch/datapatch -verboseSQL Patching tool version 19.5.2.0.0 Production on Mon Aug 10 20:58:41 2020Copyright (c) 2012, 2020, Oracle. All rights reserved.Log file for this invocation: /u01/app/oracle/cfgtoollogs/sqlpatch/sqlpatch_25968_2020_08_10_20_58_41/sqlpatch_invocation.logConnecting to database...OKGathering database info...doneNote: Datapatch will only apply or rollback SQL fixes for PDBs that are in an open state, no patches will be applied to closed PDBs. Please refer to Note: Datapatch: Database 12c Post Patch SQL Automation (Doc ID 1585822.1)Bootstrapping registry and package to current versions...doneDetermining current state...doneCurrent state of interim SQL patches:Interim patch 30128191 (OJVM RELEASE UPDATE: 19.5.0.0.191015 (30128191)): Binary registry: Installed PDB CDB$ROOT: Not installed PDB PDB$SEED: Not installed PDB PDB1: Not installedCurrent state of release update SQL patches: Binary registry: 19.5.2.0.0 Release_Update_Revision 200330044204: Installed PDB CDB$ROOT: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 10.44.12.165096 PM PDB PDB$SEED: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 10.44.14.863020 PM PDB PDB1: Applied 19.5.2.0.0 Release_Update_Revision 200330044204 with errors on 09-AUG-20 10.44.16.806494 PMAdding patches to installation queue and performing prereq checks...doneInstallation queue: For the following PDBs: CDB$ROOT PDB$SEED PDB1 No interim patches need to be rolled back Patch 30830913 (Database Release Update Revision : 19.5.2.0.200414 (30830913)): Apply from 19.1.0.0.0 Feature Release to 19.5.2.0.0 Release_Update_Revision 200330044204 The following interim patches will be applied: 30128191 (OJVM RELEASE UPDATE: 19.5.0.0.191015 (30128191))Installing patches...Patch installation complete. Total patches installed: 6Validating logfiles...donePatch 30830913 apply (pdb CDB$ROOT): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_CDBROOT_2020Aug10_21_02_35.log (no errors)Patch 30128191 apply (pdb CDB$ROOT): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30128191/23093535/30128191_apply_ORCL_CDBROOT_2020Aug10_21_00_36.log (no errors)Patch 30830913 apply (pdb PDB$SEED): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_PDBSEED_2020Aug10_21_32_48.log (no errors)Patch 30128191 apply (pdb PDB$SEED): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30128191/23093535/30128191_apply_ORCL_PDBSEED_2020Aug10_21_32_34.log (no errors)Patch 30830913 apply (pdb PDB1): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30830913/23492483/30830913_apply_ORCL_PDB1_2020Aug10_21_32_46.log (no errors)Patch 30128191 apply (pdb PDB1): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/30128191/23093535/30128191_apply_ORCL_PDB1_2020Aug10_21_32_33.log (no errors)SQL Patching tool complete on Mon Aug 10 22:51:06 2020 编译无效对象 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687SQL&gt; @?/rdbms/admin/utlrp.sqlSession altered.TIMESTAMP--------------------------------------------------------------------------------COMP_TIMESTAMP UTLRP_BGN 2020-08-10 22:54:34DOC&gt; The following PL/SQL block invokes UTL_RECOMP to recompile invalidDOC&gt; objects in the database. Recompilation time is proportional to theDOC&gt; number of invalid objects in the database, so this command may takeDOC&gt; a long time to execute on a database with a large number of invalidDOC&gt; objects.DOC&gt;DOC&gt; Use the following queries to track recompilation progress:DOC&gt;DOC&gt; 1. Query returning the number of invalid objects remaining. ThisDOC&gt; number should decrease with time.DOC&gt; SELECT COUNT(*) FROM obj$ WHERE status IN (4, 5, 6);DOC&gt;DOC&gt; 2. Query returning the number of objects compiled so far. This numberDOC&gt; should increase with time.DOC&gt; SELECT COUNT(*) FROM UTL_RECOMP_COMPILED;DOC&gt;DOC&gt; This script automatically chooses serial or parallel recompilationDOC&gt; based on the number of CPUs available (parameter cpu_count) multipliedDOC&gt; by the number of threads per CPU (parameter parallel_threads_per_cpu).DOC&gt; On RAC, this number is added across all RAC nodes.DOC&gt;DOC&gt; UTL_RECOMP uses DBMS_SCHEDULER to create jobs for parallelDOC&gt; recompilation. Jobs are created without instance affinity so that theyDOC&gt; can migrate across RAC nodes. Use the following queries to verifyDOC&gt; whether UTL_RECOMP jobs are being created and run correctly:DOC&gt;DOC&gt; 1. Query showing jobs created by UTL_RECOMPDOC&gt; SELECT job_name FROM dba_scheduler_jobsDOC&gt; WHERE job_name like 'UTL_RECOMP_SLAVE_%';DOC&gt;DOC&gt; 2. Query showing UTL_RECOMP jobs that are runningDOC&gt; SELECT job_name FROM dba_scheduler_running_jobsDOC&gt; WHERE job_name like 'UTL_RECOMP_SLAVE_%';DOC&gt;#PL/SQL procedure successfully completed.TIMESTAMP--------------------------------------------------------------------------------COMP_TIMESTAMP UTLRP_END 2020-08-10 22:55:03DOC&gt; The following query reports the number of invalid objects.DOC&gt;DOC&gt; If the number is higher than expected, please examine the errorDOC&gt; messages reported with each object (using SHOW ERRORS) to see if theyDOC&gt; point to system misconfiguration or resource constraints that must beDOC&gt; fixed before attempting to recompile these objects.DOC&gt;#OBJECTS WITH ERRORS------------------- 0DOC&gt; The following query reports the number of exceptions caught duringDOC&gt; recompilation. If this number is non-zero, please query the errorDOC&gt; messages in the table UTL_RECOMP_ERRORS to see if any of these errorsDOC&gt; are due to misconfiguration or resource constraints that must beDOC&gt; fixed before objects can compile successfully.DOC&gt; Note: Typical compilation errors (due to coding errors) are notDOC&gt; logged into this table: they go into DBA_ERRORS instead.DOC&gt;#ERRORS DURING RECOMPILATION--------------------------- 0Function created.PL/SQL procedure successfully completed.Function dropped.PL/SQL procedure successfully completed. 检查无效对象 123SQL&gt; SELECT owner, object_name, object_type,status FROM dba_objects WHERE status = 'INVALID';no rows selected 再次检查组件注册 123456789101112131415161718192021222324SQL&gt; select comp_id,comp_name,version,status from dba_registry;COMP_ID COMP_NAME VERSION STATUS-------------------- -------------------------------------------------- ---------- ----------CATALOG Oracle Database Catalog Views 19.0.0.0.0 VALIDCATPROC Oracle Database Packages and Types 19.0.0.0.0 VALIDRAC Oracle Real Application Clusters 19.0.0.0.0 OPTION OFFJAVAVM JServer JAVA Virtual Machine 19.0.0.0.0 VALIDXML Oracle XDK 19.0.0.0.0 VALIDCATJAVA Oracle Database Java Packages 19.0.0.0.0 VALIDAPS OLAP Analytic Workspace 19.0.0.0.0 VALIDXDB Oracle XML Database 19.0.0.0.0 VALIDOWM Oracle Workspace Manager 19.0.0.0.0 VALIDCONTEXT Oracle Text 19.0.0.0.0 VALIDORDIM Oracle Multimedia 19.0.0.0.0 VALIDCOMP_ID COMP_NAME VERSION STATUS-------------------- -------------------------------------------------- ---------- ----------SDO Spatial 19.0.0.0.0 VALIDXOQ Oracle OLAP API 19.0.0.0.0 VALIDOLS Oracle Label Security 19.0.0.0.0 VALIDDV Oracle Database Vault 19.0.0.0.0 VALID15 rows selected. 再次检查PDB_PLUG_IN_VIOLATION 123456789101112131415161718SQL&gt; select * from pdb_plug_in_violations;TIME NAME CAUSE TYPE ERROR_NUMBER LINE MESSAGE STATUS ACTION CON_ID--------------- -------- ------------ --------- ------------ ---------- -------------------------------------------------- --------- ------------------------------ ----------10-AUG-20 10.51 PDB$SEED SQL Patch ERROR 0 1 19.5.2.0.0 Release_Update_Revision 2003300442: APP RESOLVED Call datapatch to install in t 2.02.625907 PM LY with status WITH ERRORS in the CDB he PDB or the CDB10-AUG-20 10.51 PDB$SEED SQL Patch ERROR 0 2 19.5.2.0.0 Release_Update_Revision 2003300442: APP RESOLVED Call datapatch to install in t 2.02.625907 PM LY with status WITH ERRORS in the PDB he PDB or the CDB10-AUG-20 11.04 PDB1 SQL Patch ERROR 0 1 19.5.2.0.0 Release_Update_Revision 2003300442: APP RESOLVED Call datapatch to install in t 3.52.399087 PM LY with status WITH ERRORS in the CDB he PDB or the CDB10-AUG-20 11.04 PDB1 SQL Patch ERROR 0 2 19.5.2.0.0 Release_Update_Revision 2003300442: APP RESOLVED Call datapatch to install in t 3.52.399087 PM LY with status WITH ERRORS in the PDB he PDB or the CDBTIME NAME CAUSE TYPE ERROR_NUMBER LINE MESSAGE STATUS ACTION CON_ID--------------- -------- ------------ --------- ------------ ---------- -------------------------------------------------- --------- ------------------------------ ----------","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"19c","slug":"19c","permalink":"http://mudbub.com/tags/19c/"},{"name":"OJVM","slug":"OJVM","permalink":"http://mudbub.com/tags/OJVM/"}],"author":["Falkon"]},{"title":"深入了解Oracle Flex ASM及其优点","slug":"database/oracle-flex-asm-advantages-and-disadvantages","date":"2021-01-27T09:37:22.667Z","updated":"2021-03-26T10:23:51.227Z","comments":true,"path":"2021/01/27/database/oracle-flex-asm-advantages-and-disadvantages/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-flex-asm-advantages-and-disadvantages/","excerpt":"","text":"","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ASM","slug":"ASM","permalink":"http://mudbub.com/tags/ASM/"},{"name":"19g","slug":"19g","permalink":"http://mudbub.com/tags/19g/"},{"name":"Flex","slug":"Flex","permalink":"http://mudbub.com/tags/Flex/"}],"author":["Falkon"]},{"title":"Oracle Audit目录中文件的内容以及是否可以删除","slug":"database/oracle-audit-files-delete-test","date":"2021-01-27T09:37:22.657Z","updated":"2021-03-26T10:23:27.998Z","comments":true,"path":"2021/01/27/database/oracle-audit-files-delete-test/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-audit-files-delete-test/","excerpt":"先看下官方文档的说明 Property Description Parameter type String Syntax AUDIT_TRAIL = { none | os | db | db,extended | xml | xml,extended } Default value none Modifiable No Basic No","text":"先看下官方文档的说明 Property Description Parameter type String Syntax AUDIT_TRAIL = { none | os | db | db,extended | xml | xml,extended } Default value none Modifiable No Basic No 详细的AUDIT_TRAIL可设置选项描述 none Disables database auditing. os Enables database auditing and directs all audit records to the operating system’s audit trail. db Enables database auditing and directs all audit records to the database audit trail (the SYS.AUD$ table). db,extended Enables database auditing and directs all audit records to the database audit trail (the SYS.AUD$ table). In addition, populates the SQLBIND and SQLTEXT CLOB columns of the SYS.AUD$ table. xml Enables database auditing and writes all audit records to XML format OS files. xml,extended Enables database auditing and prints all columns of the audit trail, including SqlText and SqlBind values. 这里使用的数据库版本是11.2.0.4，可以看到默认的审计模式为DB 12345678SQL&gt; show parameter auditNAME TYPE VALUE------------------------------------ ----------- ----------------------------------audit_file_dest string /u01/app/oracle/admin/ystdb/adumpaudit_sys_operations boolean FALSEaudit_syslog_level stringaudit_trail string DB 清空/u01/app/oracle/admin/ystdb/adump下面的文件，然后关闭数据库看看会产生什么？ 123[oracle@ystdb11g adump]$ lltotal 4-rw-r----- 1 oracle oinstall 1019 Mar 29 00:50 ystdb_ora_40351_20200329005008204591143795.aud 关闭数据库后，adump目录下产生一个实例名开头的.aud的文件，文件内容描述的是进行了数据库关闭操作的相关信息 1234567891011121314151617181920212223242526272829303132333435[oracle@ystdb11g adump]$ cat ystdb_ora_40351_20200329005008204591143795.aud Audit file /u01/app/oracle/admin/ystdb/adump/ystdb_ora_40351_20200329005008204591143795.audOracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsORACLE_HOME = /u01/app/oracle/product/11.2.0/dbhome_1System name: LinuxNode name: ystdb11gRelease: 4.1.12-124.16.4.el6uek.x86_64Version: #2 SMP Thu Jun 14 18:55:52 PDT 2018Machine: x86_64VM name: VMWare Version: 6Instance name: ystdbRedo thread mounted by this instance: 1Oracle process number: 29Unix process pid: 40351, image: oracle@ystdb11g (TNS V1-V3)Sun Mar 29 00:50:08 2020 +08:00LENGTH : '160'ACTION :[7] 'CONNECT'DATABASE USER:[1] '/'PRIVILEGE :[6] 'SYSDBA'CLIENT USER:[6] 'oracle'CLIENT TERMINAL:[5] 'pts/0'STATUS:[1] '0'DBID:[10] '1907125504'Sun Mar 29 00:50:45 2020 +08:00LENGTH : '150'ACTION :[8] 'SHUTDOWN'DATABASE USER:[1] '/'PRIVILEGE :[6] 'SYSDBA'CLIENT USER:[6] 'oracle'CLIENT TERMINAL:[5] 'pts/0'STATUS:[1] '0'DBID:[0] '' 启动数据库后，产生了五个.aud的文件，前4个文件内容都差不多，最后一个文件内容记录了较为详细的信息，client user显示为我的笔记本用户，aud的文件内容可以做为查找依据的基本方式，每次以 SYS用户登录都会生成一个.aud的审计文件，普通用户则不产生.aud的文件，普通的用户的登录被记录到了SYS.AUD$表中，开启基于用户的审计后，并不会记录sqltext和sqlbind信息 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859# .aud审计文件中的内容[oracle@ystdb11g adump]$ cat ystdb_ora_40438_20200329005627295922143795.audAudit file /u01/app/oracle/admin/ystdb/adump/ystdb_ora_40438_20200329005627295922143795.audOracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsORACLE_HOME = /u01/app/oracle/product/11.2.0/dbhome_1System name: LinuxNode name: ystdb11gRelease: 4.1.12-124.16.4.el6uek.x86_64Version: #2 SMP Thu Jun 14 18:55:52 PDT 2018Machine: x86_64VM name: VMWare Version: 6Instance name: ystdbRedo thread mounted by this instance: 1Oracle process number: 25Unix process pid: 40438, image: oracle@ystdb11gSun Mar 29 00:56:27 2020 +08:00LENGTH : '164'ACTION :[7] 'CONNECT'DATABASE USER:[3] 'SYS'PRIVILEGE :[6] 'SYSDBA'CLIENT USER:[6] 'Falkon'CLIENT TERMINAL:[7] 'unknown'STATUS:[1] '0'DBID:[10] '1907125504'# 对表进行操作SQL&gt; create table audit_test (id number);Table created.SQL&gt; insert into audit_test values(1);1 row created.SQL&gt; commit;Commit complete.SQL&gt; select * from audit_test; ID---------- 1SQL&gt; drop table audit_test;Table dropped.# 审计内容SQL&gt; select userid,userhost,terminal,sqltext,sqlbind from sys.aud$ where obj$name='AUDIT_TEST';USERID USERHOST TERMINAL SQLTEXT SQLBIND---------- ---------- --------------- ---------------------------------------- ----------SH ystdb11g pts/1SH ystdb11g pts/1SH ystdb11g pts/1SH ystdb11g pts/1 下面分别实验其他几种审计模式所记录的内容，修改数据库的审计模式为NONE 123456789SQL&gt; alter system set audit_trail=\"NONE\" scope=spfile;# 设置为none之后按照官方文档的说法应该是关闭了审计，这里说的关闭是指关闭了SYS.AUD$表中的记录，# DB模式普通用户登录的时候，登录的信息被记录到了SYS.AUD$表中，设置为NONE后，使用普通用户登录，# SYS.AUD$表中不记录普通用户的行为SQL&gt; select userid,userhost,terminal from sys.aud$;USERID USERHOST TERMINAL---------- ---------- --------------- 修改数据库的审计模式为OS，使用普通用户登录，信息被记录在了.aud文件中 1234567891011121314151617181920212223[oracle@ystdb11g adump]$ cat ystdb_ora_42397_20200329031721325427143795.audAudit file /u01/app/oracle/admin/ystdb/adump/ystdb_ora_42397_20200329031721325427143795.audOracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsORACLE_HOME = /u01/app/oracle/product/11.2.0/dbhome_1System name: LinuxNode name: ystdb11gRelease: 4.1.12-124.16.4.el6uek.x86_64Version: #2 SMP Thu Jun 14 18:55:52 PDT 2018Machine: x86_64VM name: VMWare Version: 6Instance name: ystdbRedo thread mounted by this instance: 1Oracle process number: 26Unix process pid: 42397, image: oracle@ystdb11g (TNS V1-V3)Sun Mar 29 03:17:21 2020 +08:00LENGTH: \"269\"SESSIONID:[7] \"3120213\" ENTRYID:[1] \"1\" STATEMENT:[1] \"1\" USERID:[4] \"TEST\" USERHOST:[8] \"ystdb11g\" TERMINAL:[5] \"pts/1\" ACTION:[3] \"100\" RETURNCODE:[1] \"0\" COMMENT$TEXT:[26] \"Authenticated by: DATABASE\" OS$USERID:[6] \"oracle\" DBID:[10] \"1907125504\" PRIV$USED:[1] \"5\"Sun Mar 29 03:17:23 2020 +08:00LENGTH: \"222\"SESSIONID:[7] \"3120213\" ENTRYID:[1] \"1\" USERID:[4] \"TEST\" ACTION:[3] \"101\" RETURNCODE:[1] \"0\" LOGOFF$PREAD:[1] \"0\" LOGOFF$LREAD:[2] \"57\" LOGOFF$LWRITE:[1] \"0\" LOGOFF$DEAD:[1] \"0\" DBID:[10] \"1907125504\" SESSIONCPU:[1] \"0\" 修改数据库的审计模式为XML，记录格式变成XML格式，普通用户的登录也会被记录XML文件中 123456789101112131415161718[oracle@ystdb11g adump]$ lltotal 20-rw-r----- 1 oracle oinstall 778 Mar 29 03:27 ystdb_ora_42529_20200329032710062346143795.aud-rw-r----- 1 oracle oinstall 812 Mar 29 03:27 ystdb_ora_42529_20200329032713467937143795.aud-rw-r----- 1 oracle oinstall 709 Mar 29 03:27 ystdb_ora_42570_20200329032713493144044040.xml-rw-r----- 1 oracle oinstall 732 Mar 29 03:27 ystdb_ora_42575_20200329032717564695928477.xml-rw-r----- 1 oracle oinstall 1288 Mar 29 03:28 ystdb_ora_42604_20200329032812912408263719.xml[oracle@ystdb11g adump]$ cat ystdb_ora_42604_20200329032812912408263719.xml&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;Audit xmlns=\"http://xmlns.oracle.com/oracleas/schema/dbserver_audittrail-11_2.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://xmlns.oracle.com/oracleas/schema/dbserver_audittrail-11_2.xsd\"&gt; &lt;Version&gt;11.2&lt;/Version&gt;&lt;AuditRecord&gt;&lt;Audit_Type&gt;1&lt;/Audit_Type&gt;&lt;Session_Id&gt;3130220&lt;/Session_Id&gt;&lt;StatementId&gt;1&lt;/StatementId&gt;&lt;EntryId&gt;1&lt;/EntryId&gt;&lt;Extended_Timestamp&gt;2020-03-28T19:28:12.912688Z&lt;/Extended_Timestamp&gt;&lt;DB_User&gt;SH&lt;/DB_User&gt;&lt;OS_User&gt;oracle&lt;/OS_User&gt;&lt;Userhost&gt;ystdb11g&lt;/Userhost&gt;&lt;OS_Process&gt;42604&lt;/OS_Process&gt;&lt;Terminal&gt;pts/1&lt;/Terminal&gt;&lt;Instance_Number&gt;0&lt;/Instance_Number&gt;&lt;Action&gt;100&lt;/Action&gt;&lt;TransactionId&gt;0000000000000000&lt;/TransactionId&gt;&lt;Returncode&gt;0&lt;/Returncode&gt;&lt;Comment_Text&gt;Authenticated by: DATABASE&lt;/Comment_Text&gt;&lt;Priv_Used&gt;5&lt;/Priv_Used&gt;&lt;DBID&gt;1907125504&lt;/DBID&gt;&lt;/AuditRecord&gt;&lt;AuditRecord&gt;&lt;Audit_Type&gt;1&lt;/Audit_Type&gt;&lt;Session_Id&gt;3130220&lt;/Session_Id&gt;&lt;EntryId&gt;2&lt;/EntryId&gt;&lt;Extended_Timestamp&gt;2020-03-28T19:28:14.163803Z&lt;/Extended_Timestamp&gt;&lt;DB_User&gt;SH&lt;/DB_User&gt;&lt;OS_User&gt;oracle&lt;/OS_User&gt;&lt;Userhost&gt;ystdb11g&lt;/Userhost&gt;&lt;OS_Process&gt;42604&lt;/OS_Process&gt;&lt;Terminal&gt;pts/1&lt;/Terminal&gt;&lt;Instance_Number&gt;0&lt;/Instance_Number&gt;&lt;Action&gt;101&lt;/Action&gt;&lt;Returncode&gt;0&lt;/Returncode&gt;&lt;DBID&gt;1907125504&lt;/DBID&gt;&lt;/AuditRecord&gt;&lt;/Audit&gt; 修改数据库的审计模式为db,extended 12345678910111213141516171819202122232425262728293031323334353637383940414243444546SQL&gt; alter system set audit_trail=\"DB_EXTENDED\" scope=spfile;# 开启基于用户的审计SQL&gt; audit all by sh by access;Audit succeeded.SQL&gt; audit select table,update table,insert table,delete table by access;Audit succeeded.# 对表进行操作SQL&gt; create table audit_test (id number);Table created.SQL&gt; insert into audit_test values(1);1 row created.SQL&gt; commit;Commit complete.SQL&gt; SQL&gt; select * from audit_test; ID---------- 1SQL&gt; SQL&gt; SQL&gt; drop table audit_test;Table dropped.# 审计信息SQL&gt; select userid,userhost,terminal,sqltext,sqlbind from sys.aud$ where obj$name='AUDIT_TEST';USERID USERHOST TERMINAL SQLTEXT SQLBIND---------- ---------- --------------- ---------------------------------------- ----------SH ystdb11g pts/1 create table audit_test (id number)SH ystdb11g pts/1 insert into audit_test values(1)SH ystdb11g pts/1 select * from audit_testSH ystdb11g pts/1 drop table audit_test 查看SYS.AUD$属于那个表空间 12345SQL&gt; select table_name,tablespace_name from dba_tables where table_name='AUD$';TABLE_NAME TABLESPACE_NAME------------------------------ ------------------------------AUD$ SYSTEM 总结：SYS用户的审计信息会被记录在audit_file_dest所对应的目录下，DB、DB_EXTENDED会把普通用户的审计信息记录在SYS.AUD$表中，OS、XML、XML_EXTENDED会把普通用户的审计信息记录在audit_file_dest所对应的审计目录下，XML和XML_EXTENDED的格式都是XML格式，NONE不会将普通用户的审计信息记录在SYS.AUD$表中，SYS.AUD$属于SYSTEM表空间，如果数据库的审计模式是DB或者DB_EXTENDED模式，将有可能导致SYSTEM表空间很大的情况出现，如果是OS或者XML模式，将有可能会导致admp目录过大的情况出现，在默认或者手动开启其他模式的情况下，需要定期检查和清理adump目录下的审计文件和SYS.AUD$表中的内容 如果较长时间没有关注adump和SYS.AUD$的空间，造成adump下生成了大量的审计文件的情况下，直接使用rm命令无法删除，会提示”Argument list too long“，需要使用ls | xargs -n 10 rm -rf 进行删除，其中的10是指以10个文件为一组进行删除，这个参数可以自行调整。对于SYS.AUD$表过大的情况，可以直接truncate SYS.AUD$表，在可能的情况下，尽量定期进行审计目录进行压缩备份和清理","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"11g","slug":"11g","permalink":"http://mudbub.com/tags/11g/"},{"name":"Audit","slug":"Audit","permalink":"http://mudbub.com/tags/Audit/"}],"author":["Falkon"]},{"title":"Oracle ASM LUN Size","slug":"database/oracle-asm-lun-size","date":"2021-01-27T09:37:22.651Z","updated":"2021-03-26T10:23:14.340Z","comments":true,"path":"2021/01/27/database/oracle-asm-lun-size/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-asm-lun-size/","excerpt":"","text":"","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ASM","slug":"ASM","permalink":"http://mudbub.com/tags/ASM/"},{"name":"LUN","slug":"LUN","permalink":"http://mudbub.com/tags/LUN/"}],"author":["Falkon"]},{"title":"Oracle 12c varchar2字段长度扩展","slug":"database/oracle-12c-varchar2-extended","date":"2021-01-27T09:37:22.645Z","updated":"2021-03-26T10:23:05.637Z","comments":true,"path":"2021/01/27/database/oracle-12c-varchar2-extended/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-12c-varchar2-extended/","excerpt":"修改max_string参数为extended 1234567891011SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 3 ORCLPDB MOUNTED SQL&gt; startupORA-14694: database must in UPGRADE mode to begin MAX_STRING_SIZE migrationSQL&gt; exitDisconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production","text":"修改max_string参数为extended 1234567891011SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 3 ORCLPDB MOUNTED SQL&gt; startupORA-14694: database must in UPGRADE mode to begin MAX_STRING_SIZE migrationSQL&gt; exitDisconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production 以upgrade模式启动PDB 123456789101112131415161718192021222324252627282930313233343536[oracle@te-orcl-orcldb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Tue Sep 22 16:38:02 2020Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit ProductionSQL&gt; select open_mode from v$database;OPEN_MODE--------------------READ WRITESQL&gt; alter session set container=orclpdb;Session altered.SQL&gt;SQL&gt;SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 3 ORCLPDB MOUNTEDSQL&gt;SQL&gt;SQL&gt; startup UPGRADE;Pluggable Database opened.SQL&gt; show parameter max_stringNAME TYPE VALUE------------------------------------ ----------- ------------------------------max_string_size string EXTENDED 运行utl32k脚本 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135SQL&gt; @?/rdbms/admin/utl32kSP2-0042: unknown command \"aRem\" - rest of line ignored.Session altered.DOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt; The following statement will cause an \"ORA-01722: invalid number\"DOC&gt; error if the database has not been opened for UPGRADE.DOC&gt;DOC&gt; Perform a \"SHUTDOWN ABORT\" andDOC&gt; restart using UPGRADE.DOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt;#no rows selectedDOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt; The following statement will cause an \"ORA-01722: invalid number\"DOC&gt; error if the database does not have compatible &gt;= 12.0.0DOC&gt;DOC&gt; Set compatible &gt;= 12.0.0 and retry.DOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt;#PL/SQL procedure successfully completed.Session altered.0 rows updated.Commit complete.System altered.PL/SQL procedure successfully completed.Commit complete.System altered.Session altered.Session altered.Table created.Table created.Table created.Table truncated.0 rows created.PL/SQL procedure successfully completed.STARTTIME--------------------------------------------------------------------------------09/22/2020 16:39:45.972279000PL/SQL procedure successfully completed.No errors.PL/SQL procedure successfully completed.Session altered.Session altered.0 rows created.no rows selectedno rows selectedDOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt; The following statement will cause an \"ORA-01722: invalid number\"DOC&gt; error if we encountered an error while modifying a column toDOC&gt; account for data type length change as a result of enabling orDOC&gt; disabling 32k types.DOC&gt;DOC&gt; Contact Oracle support for assistance.DOC&gt;#######################################################################DOC&gt;#######################################################################DOC&gt;#PL/SQL procedure successfully completed.PL/SQL procedure successfully completed.Commit complete.Package altered.Package altered.SQL&gt; shutdown Pluggable Database closed.SQL&gt; startupPluggable Database opened.SQL&gt;","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"PDB","slug":"PDB","permalink":"http://mudbub.com/tags/PDB/"},{"name":"CDB","slug":"CDB","permalink":"http://mudbub.com/tags/CDB/"}],"author":["Falkon"]},{"title":"Oracle 12c单节点RAC安装PSU补丁程序","slug":"database/oracle-12c-single-node-installation-psu-patch","date":"2021-01-27T09:37:22.639Z","updated":"2021-03-26T10:22:55.022Z","comments":true,"path":"2021/01/27/database/oracle-12c-single-node-installation-psu-patch/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-12c-single-node-installation-psu-patch/","excerpt":"描述：单节点RAC，数据库版本12.2.0.1下载最新OPatch，补丁编号6880880,升级Grid和OracleHome的OPatch 123456789101112131415161718# 升级Grid的OPatch[root@auxsbdb12c grid]# mv OPatch/ OPatch.bak[root@auxsbdb12c home]# cp -r OPatch/ /u01/app/12.2.0/grid/[root@auxsbdb12c grid]# chown -R grid:oinstall OPatch[grid@auxsbdb12c ~]$ opatch versionOPatch Version: 12.2.0.1.18OPatch succeeded.# 升级OracleHome的OPatch[oracle@auxsbdb12c dbhome_1]$ mv OPatch/ OPatch.bak[root@auxsbdb12c home]# cp -r OPatch/ /u01/app/oracle/product/12.2.0/dbhome_1/[root@auxsbdb12c dbhome_1]# chown -R oracle:oinstall OPatch[root@auxsbdb12c dbhome_1]# cd OPatch[root@auxsbdb12c OPatch]# ./opatch versionOPatch Version: 12.2.0.1.18OPatch succeeded.","text":"描述：单节点RAC，数据库版本12.2.0.1下载最新OPatch，补丁编号6880880,升级Grid和OracleHome的OPatch 123456789101112131415161718# 升级Grid的OPatch[root@auxsbdb12c grid]# mv OPatch/ OPatch.bak[root@auxsbdb12c home]# cp -r OPatch/ /u01/app/12.2.0/grid/[root@auxsbdb12c grid]# chown -R grid:oinstall OPatch[grid@auxsbdb12c ~]$ opatch versionOPatch Version: 12.2.0.1.18OPatch succeeded.# 升级OracleHome的OPatch[oracle@auxsbdb12c dbhome_1]$ mv OPatch/ OPatch.bak[root@auxsbdb12c home]# cp -r OPatch/ /u01/app/oracle/product/12.2.0/dbhome_1/[root@auxsbdb12c dbhome_1]# chown -R oracle:oinstall OPatch[root@auxsbdb12c dbhome_1]# cd OPatch[root@auxsbdb12c OPatch]# ./opatch versionOPatch Version: 12.2.0.1.18OPatch succeeded. 补丁冲突检测（视情况而定，需要配置OPath的环境变量） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990[grid@auxsbdb12c ~]$ opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /home/29708720/29757449Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-23-32PM_1.logInvoking prereq \"checkconflictagainstohwithdetail\"Prereq \"checkConflictAgainstOHWithDetail\" passed.OPatch succeeded.[grid@auxsbdb12c ~]$ opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /home/29708720/26839277/Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-24-38PM_1.logInvoking prereq \"checkconflictagainstohwithdetail\"Prereq \"checkConflictAgainstOHWithDetail\" passed.OPatch succeeded.[grid@auxsbdb12c ~]$ opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /home/29708720/28566910/Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-24-45PM_1.logInvoking prereq \"checkconflictagainstohwithdetail\"Prereq \"checkConflictAgainstOHWithDetail\" passed.OPatch succeeded.[grid@auxsbdb12c ~]$ opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /home/29708720/29770040/Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-24-55PM_1.logInvoking prereq \"checkconflictagainstohwithdetail\"Prereq \"checkConflictAgainstOHWithDetail\" passed.OPatch succeeded.[grid@auxsbdb12c ~]$ opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /home/29708720/29770090/Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-25-00PM_1.logInvoking prereq \"checkconflictagainstohwithdetail\"Prereq \"checkConflictAgainstOHWithDetail\" passed.OPatch succeeded. 系统空间检测（视情况而定） 123456789101112131415161718192021222324252627[grid@auxsbdb12c ~]$ vi /tmp/patch_list_gihome.txt[grid@auxsbdb12c ~]$ cat /tmp/patch_list_gihome.txt/home/29708720/29757449/home/29708720/29770040/home/29708720/29770090/home/29708720/26839277/home/29708720/28566910[grid@auxsbdb12c ~]$ opatch prereq CheckSystemSpace -phBaseFile /tmp/patch_list_gihome.txtOracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.PREREQ sessionOracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_12-31-29PM_1.logInvoking prereq \"checksystemspace\"Prereq \"checkSystemSpace\" passed.OPatch succeeded. 设置root用户环境变量，使用opathcauto来自动安装补丁集 1[root@auxsbdb12c ~]# export PATH=$PATH:/u01/app/12.2.0/grid/OPatch 安装补丁，有bug，文档编号：2336186.1 1234567891011121314151617[root@auxsbdb12c ~]# opatchauto apply /home/29708720/OPatchauto session is initiated at Sat Nov 30 12:45:23 2019System initialization log file is /u01/app/12.2.0/grid/cfgtoollogs/opatchautodb/systemconfig2019-11-30_12-45-26PM.log.Session log file is /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/opatchauto2019-11-30_12-45-30PM.logThe id for this session is HRWYOPATCHAUTO-72141: Grid patching cannot be performed in rolling mode.OPATCHAUTO-72141: Grid is installed only on a single node.OPATCHAUTO-72141: Execute opatchauto in non-rolling mode.OPatchAuto failed.OPatchauto session completed at Sat Nov 30 12:45:42 2019Time taken to complete the session 0 minute, 19 secondsopatchauto failed with error code 42 -nonrolling 模式安装补丁 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[root@auxsbdb12c ~]# opatchauto apply /home/29708720/ -nonrollingOPatchauto session is initiated at Sat Nov 30 13:06:32 2019System initialization log file is /u01/app/12.2.0/grid/cfgtoollogs/opatchautodb/systemconfig2019-11-30_01-06-35PM.log.Session log file is /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/opatchauto2019-11-30_01-06-41PM.logThe id for this session is NIHRExecuting OPatch prereq operations to verify patch applicability on home /u01/app/12.2.0/gridPatch applicability verified successfully on home /u01/app/12.2.0/gridBringing down CRS service on home /u01/app/12.2.0/gridPrepatch operation log file location: /u01/app/grid/crsdata/auxsbdb12c/crsconfig/crspatch_auxsbdb12c_2019-11-30_01-07-11PM.logCRS service brought down successfully on home /u01/app/12.2.0/gridStart applying binary patch on home /u01/app/12.2.0/gridBinary patch applied successfully on home /u01/app/12.2.0/gridStarting CRS service on home /u01/app/12.2.0/gridPostpatch operation log file location: /u01/app/grid/crsdata/auxsbdb12c/crsconfig/crspatch_auxsbdb12c_2019-11-30_01-10-53PM.logCRS service started successfully on home /u01/app/12.2.0/gridOPatchAuto successful.--------------------------------Summary--------------------------------Patching is completed successfully. Please find the summary as follows:Host:auxsbdb12cCRS Home:/u01/app/12.2.0/gridVersion:12.2.0.1.0Summary:==Following patches were SUCCESSFULLY applied:Patch: /home/29708720/26839277Log: /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/core/opatch/opatch2019-11-30_13-08-23PM_1.logPatch: /home/29708720/28566910Log: /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/core/opatch/opatch2019-11-30_13-08-23PM_1.logPatch: /home/29708720/29757449Log: /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/core/opatch/opatch2019-11-30_13-08-23PM_1.logPatch: /home/29708720/29770040Log: /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/core/opatch/opatch2019-11-30_13-08-23PM_1.logPatch: /home/29708720/29770090Log: /u01/app/12.2.0/grid/cfgtoollogs/opatchauto/core/opatch/opatch2019-11-30_13-08-23PM_1.logOPatchauto session completed at Sat Nov 30 13:14:42 2019Time taken to complete the session 8 minutes, 10 seconds 查看补丁信息 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970[grid@auxsbdb12c ~]$ opatch lsinventoryOracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.Oracle Home : /u01/app/12.2.0/gridCentral Inventory : /u01/app/oraInventory from : /u01/app/12.2.0/grid/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/opatch2019-11-30_13-16-12PM_1.logLsinventory Output file location : /u01/app/12.2.0/grid/cfgtoollogs/opatch/lsinv/lsinventory2019-11-30_13-16-12PM.txt--------------------------------------------------------------------------------Local Machine Information::Hostname: auxsbdb12cARU platform id: 226ARU platform description:: Linux x86-64Installed Top-level Products (1):Oracle Grid Infrastructure 12c 12.2.0.1.0There are 1 products installed in this Oracle Home.Interim patches (5) :Patch 29770090 : applied on Sat Nov 30 13:10:51 CST 2019Unique Patch ID: 22918814Patch description: \"ACFS JUL 2019 RELEASE UPDATE 12.2.0.1.190716 (29770090)\" Created on 10 Jun 2019, 15:42:50 hrs PST8PDT Bugs fixed: 21129279, 22591010, 23059642, 23152694, 23181299, 23625427, 24285969 ...Patch 29770040 : applied on Sat Nov 30 13:10:08 CST 2019Unique Patch ID: 22917824Patch description: \"OCW JUL 2019 RELEASE UPDATE 12.2.0.1.190716 (29770040)\" Created on 19 Jun 2019, 13:36:44 hrs PST8PDT Bugs fixed: 12816839, 13250991, 18701017, 20559126, 20674742, 21477269, 21679331 ...Patch 29757449 : applied on Sat Nov 30 13:09:20 CST 2019Unique Patch ID: 23009673Patch description: \"Database Jul 2019 Release Update : 12.2.0.1.190716 (29757449)\" Created on 9 Jul 2019, 21:38:38 hrs PST8PDT Bugs fixed: 8480838, 8932139, 12763598, 13554903, 14221306, 14690846, 15931756 ...Patch 28566910 : applied on Sat Nov 30 13:08:39 CST 2019Unique Patch ID: 22413436Patch description: \"TOMCAT RELEASE UPDATE 12.2.0.1.0(ID:180802.1448.S) (28566910)\" Created on 28 Aug 2018, 23:01:25 hrs PST8PDT Bugs fixed: 25728967, 26934551, 28402313Patch 26839277 : applied on Sat Nov 30 13:08:32 CST 2019Unique Patch ID: 21578760Patch description: \"DBWLM RELEASE UPDATE 12.2.0.1.0(ID:170913) (26839277)\" Created on 21 Sep 2017, 03:13:10 hrs PST8PDT Bugs fixed: 26584906--------------------------------------------------------------------------------OPatch succeeded. 注：如果在安装的补丁的时候数据库已经建好了，在给Grid安装补丁的时候，会把数据库的补丁一起安装上，如果只是安装了Grid和数据库软件就开始安装补丁的话，数据库需要单独安装补丁。给数据库安装补丁需要先关闭数据库，如果出现Prerequisite check “CheckActiveFilesAndExecutables” failed需要关闭数据库以及清理进程。 设置oracle用户环境变量，给数据库安装补丁 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138[oracle@auxsbdb12c 29757449]$ opatch applyOracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.Oracle Home : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1Central Inventory : &#x2F;u01&#x2F;app&#x2F;oraInventory from : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;cfgtoollogs&#x2F;opatch&#x2F;opatch2019-11-30_15-17-14PM_1.logVerifying environment and performing prerequisite checks...--------------------------------------------------------------------------------Start OOP by Prereq process.Launch OOP...Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.Oracle Home : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1Central Inventory : &#x2F;u01&#x2F;app&#x2F;oraInventory from : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;cfgtoollogs&#x2F;opatch&#x2F;opatch2019-11-30_15-17-26PM_1.logVerifying environment and performing prerequisite checks...OPatch continues with these patches: 29757449 Do you want to proceed? [y|n]Y (auto-answered by -silent)User Responded with: YAll checks passed.Please shutdown Oracle instances running out of this ORACLE_HOME on the local system.(Oracle Home &#x3D; &#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#39;)Is the local system ready for patching? [y|n]Y (auto-answered by -silent)User Responded with: YBacking up files...Applying interim patch &#39;29757449&#39; to OH &#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#39;ApplySession: Optional component(s) [ oracle.has.crs, 12.2.0.1.0 ] , [ oracle.ons.daemon, 12.2.0.1.0 ] , [ oracle.oid.client, 12.2.0.1.0 ] , [ oracle.network.cman, 12.2.0.1.0 ] , [ oracle.jdk, 1.8.0.211.12 ] not present in the Oracle Home or a higher version is found.Patching component oracle.rdbms.rsf, 12.2.0.1.0...Patching component oracle.rdbms, 12.2.0.1.0...Patching component oracle.network.rsf, 12.2.0.1.0...Patching component oracle.rdbms.util, 12.2.0.1.0...Patching component oracle.ctx, 12.2.0.1.0...Patching component oracle.ctx.rsf, 12.2.0.1.0...Patching component oracle.ldap.rsf, 12.2.0.1.0...Patching component oracle.rdbms.dbscripts, 12.2.0.1.0...Patching component oracle.rdbms.rsf.ic, 12.2.0.1.0...Patching component oracle.sdo, 12.2.0.1.0...Patching component oracle.sdo.locator, 12.2.0.1.0...Patching component oracle.tfa, 12.2.0.1.0...Patching component oracle.xdk.rsf, 12.2.0.1.0...Patching component oracle.rdbms.rman, 12.2.0.1.0...Patching component oracle.assistants.deconfig, 12.2.0.1.0...Patching component oracle.xdk, 12.2.0.1.0...Patching component oracle.precomp.rsf, 12.2.0.1.0...Patching component oracle.sqlplus, 12.2.0.1.0...Patching component oracle.assistants.acf, 12.2.0.1.0...Patching component oracle.ldap.rsf.ic, 12.2.0.1.0...Patching component oracle.rdbms.oci, 12.2.0.1.0...Patching component oracle.rdbms.dv, 12.2.0.1.0...Patching component oracle.rdbms.crs, 12.2.0.1.0...Patching component oracle.rdbms.install.plugins, 12.2.0.1.0...Patching component oracle.oraolap, 12.2.0.1.0...Patching component oracle.install.deinstalltool, 12.2.0.1.0...Patching component oracle.oracore.rsf, 12.2.0.1.0...Patching component oracle.xdk.parser.java, 12.2.0.1.0...Patching component oracle.sqlplus.ic, 12.2.0.1.0...Patching component oracle.ldap.client, 12.2.0.1.0...Patching component oracle.nlsrtl.rsf, 12.2.0.1.0...Patching component oracle.rdbms.lbac, 12.2.0.1.0...Patching component oracle.assistants.server, 12.2.0.1.0...Patching component oracle.ons, 12.2.0.1.0...Patching component oracle.rdbms.deconfig, 12.2.0.1.0...Patching component oracle.precomp.common, 12.2.0.1.0...Patching component oracle.precomp.lang, 12.2.0.1.0...Patching component oracle.ctx.atg, 12.2.0.1.0...OPatch found the word &quot;error&quot; in the stderr of the make command.Please look at this stderr. You can re-run this make command.Stderr output:chmod: changing permissions of &#96;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;bin&#x2F;extjobO&#39;: Operation not permittedmake: [iextjob] Error 1 (ignored)Patch 29757449 successfully applied.OPatch Session completed with warnings.Log file location: &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;dbhome_1&#x2F;cfgtoollogs&#x2F;opatch&#x2F;opatch2019-11-30_15-17-26PM_1.logOPatch completed with warnings.error可以安全忽略，文档编号：2265726.1 开启数据库，运行datapatch 1234567891011121314151617181920212223242526272829303132333435363738[oracle@auxsbdb12c 29757449]$ ./datapatch -verbose-bash: ./datapatch: No such file or directory[oracle@auxsbdb12c 29757449]$ datapatch -verboseSQL Patching tool version 12.2.0.1.0 Production on Sat Nov 30 16:09:35 2019Copyright (c) 2012, 2019, Oracle. All rights reserved.Log file for this invocation: /u01/app/oracle/cfgtoollogs/sqlpatch/sqlpatch_11189_2019_11_30_16_09_35/sqlpatch_invocation.logConnecting to database...OKNote: Datapatch will only apply or rollback SQL fixes for PDBs that are in an open state, no patches will be applied to closed PDBs. Please refer to Note: Datapatch: Database 12c Post Patch SQL Automation (Doc ID 1585822.1)Bootstrapping registry and package to current versions...doneDetermining current state...doneCurrent state of SQL patches:Bundle series DBRU: ID 190716 in the binary registry and not installed in any PDBAdding patches to installation queue and performing prereq checks...Installation queue: For the following PDBs: CDB$ROOT PDB$SEED PDB1 Nothing to roll back The following patches will be applied: 29757449 (DATABASE JUL 2019 RELEASE UPDATE 12.2.0.1.190716)Installing patches...Patch installation complete. Total patches installed: 3Validating logfiles...Patch 29757449 apply (pdb CDB$ROOT): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/29757449/23009673/29757449_apply_AUXDB_CDBROOT_2019Nov30_16_10_07.log (no errors)Patch 29757449 apply (pdb PDB$SEED): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/29757449/23009673/29757449_apply_AUXDB_PDBSEED_2019Nov30_16_11_38.log (no errors)Patch 29757449 apply (pdb PDB1): SUCCESS logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/29757449/23009673/29757449_apply_AUXDB_PDB1_2019Nov30_16_11_38.log (no errors)SQL Patching tool complete on Sat Nov 30 16:14:16 2019 编译无效对象 123456789101112[oracle@auxsbdb12c 29757449]$ sqlplus /nologSQL*Plus: Release 12.2.0.1.0 Production on Sat Nov 30 16:15:58 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.SQL&gt; conn / as sysdbaConnected.SQL&gt;SQL&gt;SQL&gt;SQL&gt; @?/rdbms/admin/utlrp","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"PSU","slug":"PSU","permalink":"http://mudbub.com/tags/PSU/"}],"author":["Falkon"]},{"title":"Oracle 12c PDB克隆","slug":"database/oracle-12c-pdb-clone","date":"2021-01-27T09:37:22.633Z","updated":"2021-03-26T10:22:47.138Z","comments":true,"path":"2021/01/27/database/oracle-12c-pdb-clone/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-12c-pdb-clone/","excerpt":"本地克隆官方图示","text":"本地克隆官方图示 本地克隆 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[oracle@testdb12c01 ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.1.0.2.0 Production on Sat Mar 21 07:48:02 2020Copyright (c) 1982, 2014, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit ProductionWith the Partitioning, Real Application Clusters, Automatic Storage Management, OLAP,Advanced Analytics and Real Application Testing options-- 查看现有PDBSQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO-- 从pdb1克隆pdb2SQL&gt; create pluggable database pdb2 from pdb1;Pluggable database created.SQL&gt;SQL&gt;SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO 4 PDB2 MOUNTED-- 打开已经克隆的PDBSQL&gt; alter pluggable database pdb2 open;Pluggable database altered.SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 READ WRITE NO 4 PDB2 READ WRITE NO 远端克隆官方图示 远端克隆，配置TNSNAMES，源端pdb的监听和目标端一致 12345678PDB1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = testdb12c-scan)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = pdb1) ) ) 源端启用pdbadmin用户 1234567891011SQL&gt; alter session set container=pdb1;Session altered.SQL&gt; alter user pdbadmin identified by pdbadmin;User altered.SQL&gt; grant dba to pdbadmin;Grant succeeded. 目标端现有PDB（我在安装的时候开启了CDB，但没有创建PDB所有只有PDB$SEED） 12345SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 目标端创建dblink 123SQL&gt; create public database link clone_pdb_dblink connect to pdbadmin identified by pdbadmin using 'PDB1';Database link created. 目标端验证dblink 12345SQL&gt; select * from dual@clone_pdb_dblink;D-X 目标端开始远程克隆 123SQL&gt; create pluggable database pdb1 from pdb1@clone_pdb_dblink;Pluggable database created. 目标端检查克隆后的PDB 123456SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 3 PDB1 MOUNTED 在克隆期间注意观察alert日志 1234567891011121314151617181920212223242526272829303132333435363738create pluggable database pdb1 from pdb1@clone_pdb_dblink;Sat Mar 21 20:44:11 2020****************************************************************Pluggable Database PDB1 with pdb id - 3 is created as UNUSABLE.If any errors are encountered before the pdb is marked as NEW,then the pdb must be dropped****************************************************************This instance was first to open pluggable database PDB1 (container=3)Database Characterset for PDB1 is AL32UTF8Deleting old file#9 from file$Deleting old file#10 from file$Deleting old file#11 from file$Deleting old file#12 from file$Deleting old file#13 from file$Deleting old file#14 from file$Adding new file#8 to file$(old file#9)Adding new file#9 to file$(old file#10)Adding new file#10 to file$(old file#11)Adding new file#11 to file$(old file#13)Adding new file#12 to file$(old file#14)Successfully created internal service pdb1 at openALTER SYSTEM: Flushing buffer cache inst=1 container=3 local****************************************************************Post plug operations are now complete.Pluggable database PDB1 with pdb id - 3 is now marked as NEW.****************************************************************Completed: create pluggable database pdb1 from pdb1@clone_pdbalter pluggable database openORA-65000 signalled during: alter pluggable database open...alter pluggable database pdb1 openSat Mar 21 20:44:43 2020This instance was first to open pluggable database PDB1 (container=3)Pluggable database PDB1 dictionary check beginningPluggable Database PDB1 Dictionary check completeDatabase Characterset for PDB1 is AL32UTF8Opening pdb PDB1 (3) with no Resource Manager plan activePluggable database PDB1 opened read writeCompleted: alter pluggable database pdb1 open","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"PDB","slug":"PDB","permalink":"http://mudbub.com/tags/PDB/"}],"author":["Falkon"]},{"title":"Oracle 12c 云上部署和本地静默安装","slug":"database/oracle-12c-cloud-depoly-and-local-silent-installation","date":"2021-01-27T09:37:22.626Z","updated":"2021-03-26T10:22:39.278Z","comments":true,"path":"2021/01/27/database/oracle-12c-cloud-depoly-and-local-silent-installation/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oracle-12c-cloud-depoly-and-local-silent-installation/","excerpt":"平台：Oracle Linux 7.2 最小化安装 数据库版本：12.2.01","text":"平台：Oracle Linux 7.2 最小化安装 数据库版本：12.2.01 配置ip地址 12345678910111213141516171819[root@orcldb12c ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens33TYPE=EthernetPROXY_METHOD=noneBROWSER_ONLY=noBOOTPROTO=staticDEFROUTE=yesIPV4_FAILURE_FATAL=noIPV6INIT=yesIPV6_AUTOCONF=yesIPV6_DEFROUTE=yesIPV6_FAILURE_FATAL=noIPV6_ADDR_GEN_MODE=stable-privacyNAME=ens33UUID=9726931d-4a1f-4fcb-a2cf-6fd567b72458DEVICE=ens33ONBOOT=yesIPADDR=192.168.112.60NETMASK=255.255.255.0GATEWAY=192.168.112.1 关闭防火墙 1[root@orcldb12c ~]# hostnamectl set-hostname orcldb12c 关闭selinix 123456789101112[root@orcldb12c ~]# vi /etc/sysconfig/selinux# This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=disabled# SELINUXTYPE= can take one of three values:# targeted - Targeted processes are protected,# minimum - Modification of targeted policy. Only selected processes are protected.# mls - Multi Level Security protection.SELINUXTYPE=targeted 配置软件包仓库 1234567[root@orcldb12c ~]# vi /etc/yum.repos.d/oracle-linux-ol7.repo[ol7_latest]name=Oracle Linux $releasever Latest ($basearch)baseurl=file:///mediagpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oraclegpgcheck=1enabled=1 创建用户组和用户 1234[root@orcldb12c ~]# groupadd -g 1001 oinstall[root@orcldb12c ~]# groupadd -g 1002 dba[root@orcldb12c ~]# groupadd -g 1003 oper[root@orcldb12c ~]# useradd -g oinstall -G dba,oper oracle 设置用户名密码并验证 12345678[root@orcldb12c ~]# passwd oracleChanging password for user oracle.New password: Retype new password: passwd: all authentication tokens updated successfully.[root@orcldb12c ~]# id oracleuid=1001(oracle) gid=1001(oinstall) groups=1001(oinstall),1002(dba),1003(oper) 创建目录并改变属组及权限 123[root@orcldb12c ~]# mkdir -p /u01/app/oracle[root@orcldb12c ~]# chown -R oracle:oinstall /u01/[root@orcldb12c ~]# chmod -R 775 /u01/ 配置系统参数 1234567891011[root@orcldb12c ~]# vi /etc/sysctl.d/97-oracle-database-sysctl.conf# Oracle kernel parameters fs.aio-max-nr = 1048576fs.file-max = 6815744kernel.shmmni = 4096kernel.sem = 32000 1024000000 500 32000net.ipv4.ip_local_port_range = 9000 65500net.core.rmem_default = 4194304net.core.rmem_max = 4194304net.core.wmem_default = 4194304net.core.wmem_max = 4194304 配置资源限制 12345678910[root@orcldb12c ~]# vi /etc/security/limits.conf# Oracle resource limitsoracle soft nofile 131072oracle soft nproc 131072oracle hard nofile 131072oracle hard nproc 131072oracle soft core unlimitedoracle hard core unlimitedoracle soft stack 10240oracle hard stack 32768 配置用户环境变量 123456789101112131415161718[oracle@orcldb12c ~]$ vi .bash_profile# Oracle user environment variableexport ORACLE_SID=orcldbexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/12.2.0/dbhome_1export PATH=$ORACLE_HOME/bin:$PATH# 验证环境变量配置[oracle@orcldb12c ~]$ source .bash_profile [oracle@orcldb12c ~]$ echo $ORACLE_SIDorcldb[oracle@orcldb12c ~]$ echo $ORACLE_BASE/u01/app/oracle[oracle@orcldb12c ~]$ echo $ORACLE_HOME/u01/app/oracle/product/12.2.0/dbhome_1[oracle@orcldb12c ~]$ echo $PATH/u01/app/oracle/product/12.2.0/dbhome_1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/oracle/.local/bin:/home/oracle/bin:/home/oracle/.local/bin:/home/oracle/bin 安装依赖包 12# 官方文档依赖包链接https://docs.oracle.com/en/database/oracle/oracle-database/12.2/ladbi/supported-red-hat-enterprise-linux-7-distributions-for-x86-64.html#GUID-2E11B561-6587-4789-A583-2E33D705E498 上传数据库安装包并解压缩 12345sftp:/opt&gt; putUploading linuxx64_12201_database.zip to remote:/opt/linuxx64_12201_database.zipsftp: sent 3.21 GB in 30.44 seconds[root@orcldb12c opt]# unzip linuxx64_12201_database.zip 对比后配置db_inst.rsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354[oracle@orcldb12c response]$ cat db_install.rsp | grep -Ev \"^#|^$\"oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v12.2.0oracle.install.option=INSTALL_DB_SWONLYUNIX_GROUP_NAME=oinstallINVENTORY_LOCATION=/u01/app/oraInventoryORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1ORACLE_BASE=/u01/app/oracleoracle.install.db.InstallEdition=EEoracle.install.db.OSDBA_GROUP=dbaoracle.install.db.OSOPER_GROUP=operoracle.install.db.OSBACKUPDBA_GROUP=dbaoracle.install.db.OSDGDBA_GROUP=dbaoracle.install.db.OSKMDBA_GROUP=dbaoracle.install.db.OSRACDBA_GROUP=dbaoracle.install.db.rac.configurationType=oracle.install.db.CLUSTER_NODES=oracle.install.db.isRACOneInstall=oracle.install.db.racOneServiceName=oracle.install.db.rac.serverpoolName=oracle.install.db.rac.serverpoolCardinality=oracle.install.db.config.starterdb.type=oracle.install.db.config.starterdb.globalDBName=oracle.install.db.config.starterdb.SID=oracle.install.db.ConfigureAsContainerDB=oracle.install.db.config.PDBName=oracle.install.db.config.starterdb.characterSet=oracle.install.db.config.starterdb.memoryOption=oracle.install.db.config.starterdb.memoryLimit=oracle.install.db.config.starterdb.installExampleSchemas=oracle.install.db.config.starterdb.password.ALL=oracle.install.db.config.starterdb.password.SYS=oracle.install.db.config.starterdb.password.SYSTEM=oracle.install.db.config.starterdb.password.DBSNMP=oracle.install.db.config.starterdb.password.PDBADMIN=oracle.install.db.config.starterdb.managementOption=oracle.install.db.config.starterdb.omsHost=oracle.install.db.config.starterdb.omsPort=oracle.install.db.config.starterdb.emAdminUser=oracle.install.db.config.starterdb.emAdminPassword=oracle.install.db.config.starterdb.enableRecovery=oracle.install.db.config.starterdb.storageType=oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=oracle.install.db.config.asm.diskGroup=oracle.install.db.config.asm.ASMSNMPPassword=MYORACLESUPPORT_USERNAME=MYORACLESUPPORT_PASSWORD=SECURITY_UPDATES_VIA_MYORACLESUPPORT=DECLINE_SECURITY_UPDATES=PROXY_HOST=PROXY_PORT=PROXY_USER=PROXY_PWD=COLLECTOR_SUPPORTHUB_URL= 执行安装前检查 1234567[oracle@orcldb12c database]$ ./runInstaller -silent -executeprereqsStarting Oracle Universal Installer...Checking Temp space: must be greater than 500 MB. Actual 32523 MB PassedChecking swap space: must be greater than 150 MB. Actual 8191 MB PassedPreparing to launch Oracle Universal Installer from /tmp/OraInstall2020-04-27_11-48-01AM. Please wait ...[oracle@orcldb12c database]$ Prerequisite checks executed successfully.A log of this session is currently saved as: /tmp/OraInstall2020-04-27_11-48-01AM/installActions2020-04-27_11-48-01AM.log. Oracle recommends that if you want to keep this log, you should move it from the temporary location. 执行db_install.rsp 1234567891011121314151617[oracle@orcldb12c database]$ ./runInstaller -silent -responseFile /opt/database/response/db_install.rspStarting Oracle Universal Installer...Checking Temp space: must be greater than 500 MB. Actual 31745 MB PassedChecking swap space: must be greater than 150 MB. Actual 8191 MB PassedPreparing to launch Oracle Universal Installer from /tmp/OraInstall2020-04-27_11-49-37AM. Please wait ...[oracle@orcldb12c database]$ You can find the log of this install session at: /u01/app/oraInventory/logs/installActions2020-04-27_11-49-37AM.logThe installation of Oracle Database 12c was successful.Please check '/u01/app/oraInventory/logs/silentInstall2020-04-27_11-49-37AM.log' for more details.As a root user, execute the following script(s): 1. /u01/app/oraInventory/orainstRoot.sh 2. /u01/app/oracle/product/12.2.0/dbhome_1/root.shSuccessfully Setup Software. 执行root脚本 1234567891011[root@orcldb12c ~]# /u01/app/oraInventory/orainstRoot.shChanging permissions of /u01/app/oraInventory.Adding read,write permissions for group.Removing read,write,execute permissions for world.Changing groupname of /u01/app/oraInventory to oinstall.The execution of the script is complete.[root@orcldb12c ~]# [root@orcldb12c ~]# [root@orcldb12c ~]# /u01/app/oracle/product/12.2.0/dbhome_1/root.shCheck /u01/app/oracle/product/12.2.0/dbhome_1/install/root_orcldb12c_2020-04-27_12-08-39-430357181.log for the output of root script 检查netca.rsp 12345678910111213141516[oracle@orcldb12c response]$ cat netca.rsp| grep -Ev \"^#|^$\"[GENERAL]RESPONSEFILE_VERSION=\"12.2\"CREATE_TYPE=\"CUSTOM\"[oracle.net.ca]INSTALLED_COMPONENTS=&#123;\"server\",\"net8\",\"javavm\"&#125;INSTALL_TYPE=\"\"typical\"\"LISTENER_NUMBER=1LISTENER_NAMES=&#123;\"LISTENER\"&#125;LISTENER_PROTOCOLS=&#123;\"TCP;1521\"&#125;LISTENER_START=\"\"LISTENER\"\"NAMING_METHODS=&#123;\"TNSNAMES\",\"ONAMES\",\"HOSTNAME\"&#125;NSN_NUMBER=1NSN_NAMES=&#123;\"EXTPROC_CONNECTION_DATA\"&#125;NSN_SERVICE=&#123;\"PLSExtProc\"&#125;NSN_PROTOCOLS=&#123;\"TCP;HOSTNAME;1521\"&#125; 执行netca.rsp 1234567891011121314151617181920212223242526272829303132333435363738394041[oracle@orcldb12c bin]$ ./netca -silent -responseFile /opt/database/response/netca.rspParsing command line arguments: Parameter \"silent\" = true Parameter \"responsefile\" = /opt/database/response/netca.rspDone parsing command line arguments.Oracle Net Services Configuration:Profile configuration complete.Oracle Net Listener Startup: Running Listener Control: /u01/app/oracle/product/12.2.0/dbhome_1/bin/lsnrctl start LISTENER Listener Control complete. Listener started successfully.Listener configuration complete.Oracle Net Services configuration successful. The exit code is 0[oracle@orcldb12c bin]$ # 检查监听[oracle@orcldb12c bin]$ lsnrctl statusLSNRCTL for Linux: Version 12.2.0.1.0 - Production on 27-APR-2020 14:54:48Copyright (c) 1991, 2016, Oracle. All rights reserved.Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=orcldb12c)(PORT=1521)))STATUS of the LISTENER------------------------Alias LISTENERVersion TNSLSNR for Linux: Version 12.2.0.1.0 - ProductionStart Date 27-APR-2020 14:54:36Uptime 0 days 0 hr. 0 min. 11 secTrace Level offSecurity ON: Local OS AuthenticationSNMP OFFListener Parameter File /u01/app/oracle/product/12.2.0/dbhome_1/network/admin/listener.oraListener Log File /u01/app/oracle/diag/tnslsnr/orcldb12c/listener/alert/log.xmlListening Endpoints Summary... (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=orcldb12c)(PORT=1521))) (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))The listener supports no servicesThe command completed successfully 配置并执行dbca.rsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990dbca.rsp[root@orcldb12c response]# cat dbca.rsp | grep -Ev \"^#|^$\"responseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v12.2.0gdbName=orcldbsid=orcldbdatabaseConfigType=RACOneNodeServiceName=policyManaged=createServerPool=serverPoolName=cardinality=force=pqPoolName=pqCardinality=createAsContainerDatabase=truenumberOfPDBs=1pdbName=testpdb1useLocalUndoForPDBs=pdbAdminPassword=nodelist=templateName=General_Purpose.dbcsysPassword=PP--ssw00rdsystemPassword=PP--ssw00rdoracleHomeUserPassword=emConfiguration=emExpressPort=5500runCVUChecks=dbsnmpPassword=omsHost=omsPort=emUser=emPassword=dvConfiguration=dvUserName=dvUserPassword=dvAccountManagerName=dvAccountManagerPassword=olsConfiguration=datafileJarLocation=datafileDestination=recoveryAreaDestination=storageType=diskGroupName=asmsnmpPassword=recoveryGroupName=characterSet=AL32UTF8nationalCharacterSet=registerWithDirService=dirServiceUserName=dirServicePassword=walletPassword=listeners=LISTENERvariablesFile=variables=initParams=sampleSchema=memoryPercentage=80databaseType=automaticMemoryManagement=totalMemory=# 执行dbca.rsp[oracle@orcldb12c ~]$ dbca -silent -createDatabase -responseFile /opt/database/response/dbca.rspEnter PDBADMIN User Password: Copying database files1% complete13% complete25% completeCreating and starting Oracle instance26% complete30% complete31% complete35% complete38% complete39% complete41% completeCompleting Database Creation42% complete43% complete44% complete46% complete49% complete50% completeCreating Pluggable Databases55% complete75% completeExecuting Post Configuration Actions100% completeLook at the log file \"/u01/app/oracle/cfgtoollogs/dbca/orcldb/orcldb.log\" for further details.","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"Cloud","slug":"Cloud","permalink":"http://mudbub.com/tags/Cloud/"},{"name":"Silent","slug":"Silent","permalink":"http://mudbub.com/tags/Silent/"}],"author":["Falkon"]},{"title":"ORA-65500 could not modify DB_UNIQUE_NAME, resource exists","slug":"database/ora-65500-could-not-modify-db_unique_name-resource-exists","date":"2021-01-27T09:37:22.620Z","updated":"2021-03-26T10:22:30.352Z","comments":true,"path":"2021/01/27/database/ora-65500-could-not-modify-db_unique_name-resource-exists/","link":"","permalink":"http://mudbub.com/2021/01/27/database/ora-65500-could-not-modify-db_unique_name-resource-exists/","excerpt":"描述：单节点RAC，数据库版本12.2.0.112345678910111213141516171819202122232425262728SQL&gt; show parameter db_uniqNAME TYPE VALUE------------------------------------ ----------- ------------------------------db_unique_name string auxdbSQL&gt; alter system set db_unique_name=auxsbdb scope=spfile;alter system set db_unique_name=auxsbdb scope=spfile*ERROR at line 1:ORA-32017: failure in updating SPFILEORA-65500: could not modify DB_UNIQUE_NAME, resource exists[oracle@auxsbdb12c ~]$ srvctl remove database -d auxdb -f[oracle@auxsbdb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Wed Dec 4 15:46:07 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit ProductionSQL&gt; alter system set db_unique_name='auxsbdb' scope=spfile;System altered.","text":"描述：单节点RAC，数据库版本12.2.0.112345678910111213141516171819202122232425262728SQL&gt; show parameter db_uniqNAME TYPE VALUE------------------------------------ ----------- ------------------------------db_unique_name string auxdbSQL&gt; alter system set db_unique_name=auxsbdb scope=spfile;alter system set db_unique_name=auxsbdb scope=spfile*ERROR at line 1:ORA-32017: failure in updating SPFILEORA-65500: could not modify DB_UNIQUE_NAME, resource exists[oracle@auxsbdb12c ~]$ srvctl remove database -d auxdb -f[oracle@auxsbdb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Wed Dec 4 15:46:07 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit ProductionSQL&gt; alter system set db_unique_name='auxsbdb' scope=spfile;System altered. 重启数据库 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455[oracle@auxsbdb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Wed Dec 4 16:51:51 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to an idle instance.SQL&gt; startupORA-01078: failure in processing system parametersLRM-00109: could not open parameter file '/u01/app/oracle/product/12.2.0/dbhome_1/dbs/initauxdb.ora'SQL&gt; create pfile from spfile='+DATA/auxdb/PARAMETERFILE/spfile.274.1026060487';File created.# 再次启动数据库[oracle@auxsbdb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Wed Dec 4 16:51:51 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to an idle instance.SQL&gt; startupORACLE instance started.Total System Global Area 8.1068E+10 bytesFixed Size 30036880 bytesVariable Size 1.4496E+10 bytesDatabase Buffers 6.6304E+10 bytesRedo Buffers 238395392 bytesDatabase mounted.Database opened.SQL&gt; show parameter nameNAME TYPE VALUE------------------------------------ ----------- ------------------------------cdb_cluster_name string auxsbdbcell_offloadgroup_name stringdb_file_name_convert string auxdb, auxsbdbdb_name string auxdbdb_unique_name string auxsbdbglobal_names boolean FALSEinstance_name string auxdblock_name_space stringlog_file_name_convert string auxdb, auxsbdbpdb_file_name_convert stringprocessor_group_name stringNAME TYPE VALUE------------------------------------ ----------- ------------------------------service_names string auxsbdb.fanger.org 检查集群服务 123456789101112131415161718192021222324252627282930313233343536[grid@auxsbdb12c ~]$ crsctl stat res -t--------------------------------------------------------------------------------Name Target State Server State details --------------------------------------------------------------------------------Local Resources--------------------------------------------------------------------------------ora.ASMNET1LSNR_ASM.lsnr ONLINE ONLINE auxsbdb12c STABLEora.DATA.dg ONLINE ONLINE auxsbdb12c STABLEora.LISTENER.lsnr ONLINE ONLINE auxsbdb12c STABLEora.RECO.dg ONLINE ONLINE auxsbdb12c STABLEora.net1.network ONLINE ONLINE auxsbdb12c STABLEora.ons ONLINE ONLINE auxsbdb12c STABLE--------------------------------------------------------------------------------Cluster Resources--------------------------------------------------------------------------------ora.LISTENER_SCAN1.lsnr 1 ONLINE ONLINE auxsbdb12c STABLEora.asm 1 ONLINE ONLINE auxsbdb12c Started,STABLE 2 OFFLINE OFFLINE STABLE 3 OFFLINE OFFLINE STABLEora.auxsbdb12c.vip 1 ONLINE ONLINE auxsbdb12c STABLEora.cvu 1 ONLINE ONLINE auxsbdb12c STABLEora.qosmserver 1 OFFLINE OFFLINE STABLEora.scan1.vip 1 ONLINE ONLINE auxsbdb12c STABLE-------------------------------------------------------------------------------- 重新注册数据库服务 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859[oracle@auxsbdb12c ~]$ sqlplus / as sysdbaSQL*Plus: Release 12.2.0.1.0 Production on Wed Dec 4 18:01:27 2019Copyright (c) 1982, 2016, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit ProductionSQL&gt; shutdown immediateDatabase closed.Database dismounted.ORACLE instance shut down.[oracle@auxsbdb12c ~]$ srvctl add database -d auxsbdb -o $ORACLE_HOME[oracle@auxsbdb12c ~]$ srvctl add instance -d auxsbdb -i auxdb -n auxsbdb12c[oracle@auxsbdb12c ~]$ srvctl start database -d auxsbdb[grid@auxsbdb12c ~]$ crsctl stat res -t--------------------------------------------------------------------------------Name Target State Server State details --------------------------------------------------------------------------------Local Resources--------------------------------------------------------------------------------ora.ASMNET1LSNR_ASM.lsnr ONLINE ONLINE auxsbdb12c STABLEora.DATA.dg ONLINE ONLINE auxsbdb12c STABLEora.LISTENER.lsnr ONLINE ONLINE auxsbdb12c STABLEora.RECO.dg ONLINE ONLINE auxsbdb12c STABLEora.net1.network ONLINE ONLINE auxsbdb12c STABLEora.ons ONLINE ONLINE auxsbdb12c STABLE--------------------------------------------------------------------------------Cluster Resources--------------------------------------------------------------------------------ora.LISTENER_SCAN1.lsnr 1 ONLINE ONLINE auxsbdb12c STABLEora.asm 1 ONLINE ONLINE auxsbdb12c Started,STABLE 2 OFFLINE OFFLINE STABLE 3 OFFLINE OFFLINE STABLEora.auxsbdb.db 1 ONLINE ONLINE auxsbdb12c Open,HOME=/u01/app/o racle/product/12.2.0 /dbhome_1,STABLEora.auxsbdb12c.vip 1 ONLINE ONLINE auxsbdb12c STABLEora.cvu 1 ONLINE ONLINE auxsbdb12c STABLEora.qosmserver 1 OFFLINE OFFLINE STABLEora.scan1.vip 1 ONLINE ONLINE auxsbdb12c STABLE--------------------------------------------------------------------------------","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ORA-65500","slug":"ORA-65500","permalink":"http://mudbub.com/tags/ORA-65500/"}],"author":["Falkon"]},{"title":"ORA-28000 the account is locked","slug":"database/ora-28000-the-account-is-locked","date":"2021-01-27T09:37:22.614Z","updated":"2021-03-26T10:22:22.815Z","comments":true,"path":"2021/01/27/database/ora-28000-the-account-is-locked/","link":"","permalink":"http://mudbub.com/2021/01/27/database/ora-28000-the-account-is-locked/","excerpt":"今天有个客户反应账户锁了，我给发了解锁账户的语句，过了一会告诉我解锁的语句不起作用，截图我看语句也执行成功了，有点没想明白，通过远程直接上手，下面是排查过程，这里隐去了客户的相关账户和监听日志信息","text":"今天有个客户反应账户锁了，我给发了解锁账户的语句，过了一会告诉我解锁的语句不起作用，截图我看语句也执行成功了，有点没想明白，通过远程直接上手，下面是排查过程，这里隐去了客户的相关账户和监听日志信息 查看资源限制，用户的数据库是12.2.0.1 12345678SQL&gt; show parameter resourceNAME TYPE VALUE------------------------------------ --------------------------------- ------------------------------resource_limit boolean TRUEresource_manage_goldengate boolean FALSEresource_manager_cpu_allocation integer 8resource_manager_plan string 资源限制启动了，查看默认资源限制的相关参数看到连续登录失败FAILED_LOGIN_ATTEMPTS的参数是10，初步怀疑是使用不正确的密码连续登录造成的账户锁定 1234567891011121314151617181920212223242526272829SQL&gt; col resource_name for a30SQL&gt; col limit for a15SQL&gt; SQL&gt; select resource_name,limit from dba_profiles where profile='DEFAULT';RESOURCE_NAME LIMIT------------------------------ ---------------COMPOSITE_LIMIT UNLIMITEDSESSIONS_PER_USER UNLIMITEDCPU_PER_SESSION UNLIMITEDCPU_PER_CALL UNLIMITEDLOGICAL_READS_PER_SESSION UNLIMITEDLOGICAL_READS_PER_CALL UNLIMITEDIDLE_TIME UNLIMITEDCONNECT_TIME UNLIMITEDPRIVATE_SGA UNLIMITEDFAILED_LOGIN_ATTEMPTS 10PASSWORD_LIFE_TIME 180RESOURCE_NAME LIMIT------------------------------ ---------------PASSWORD_REUSE_TIME UNLIMITEDPASSWORD_REUSE_MAX UNLIMITEDPASSWORD_VERIFY_FUNCTION NULLPASSWORD_LOCK_TIME 1PASSWORD_GRACE_TIME 7INACTIVE_ACCOUNT_TIME UNLIMITED17 rows selected. 重新解锁账户，查看user$视图中的连续登录次数，不到30s连续登录了14次 123456789SQL&gt; alter user test account unlock;User altered.SQL&gt; select name, lcount from user$ where name='TEST';NAME LCOUNT---------- ----------TEST 14 查找是哪个主机的应用在登录，查看listener.log 123413-MAR-2020 06:02:41 * (CONNECT_DATA=(SID=ystdb)(CID=(PROGRAM=perl@ystdb11g)(HOST=ystdb11g)(USER=oracle))) * (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.112.12)(PORT=29941)) * establish * ystdb * 013-MAR-2020 06:02:41 * (CONNECT_DATA=(SID=ystdb)(CID=(PROGRAM=perl@ystdb11g)(HOST=ystdb11g)(USER=oracle))) * (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.112.12)(PORT=29942)) * establish * ystdb * 0 找到这台主机后，联系应用的人把应用停掉，重新解锁账号，并让应用重新配置新的密码后问题解决","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ORA-28000","slug":"ORA-28000","permalink":"http://mudbub.com/tags/ORA-28000/"}],"author":["Falkon"]},{"title":"ORA-01804 failure to initialize timezone information","slug":"database/ora-01804-failure-to-initialize-timezone-information","date":"2021-01-27T09:37:22.608Z","updated":"2021-03-26T10:22:14.160Z","comments":true,"path":"2021/01/27/database/ora-01804-failure-to-initialize-timezone-information/","link":"","permalink":"http://mudbub.com/2021/01/27/database/ora-01804-failure-to-initialize-timezone-information/","excerpt":"描述：单节点RAC备库，版本12.2.0.1123456789101112RMAN&gt; CONFIGURE ARCHIVELOG DELETION POLICY TO applied on all standby;old RMAN configuration parameters:CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY;new RMAN configuration parameters:CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY;new RMAN configuration parameters are successfully storedRMAN-00571: ===========================================================RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============RMAN-00571: ===========================================================RMAN-03009: failure of REFAF command on default channel at 12/05/2019 18:38:02ORA-01804: failure to initialize timezone information","text":"描述：单节点RAC备库，版本12.2.0.1123456789101112RMAN&gt; CONFIGURE ARCHIVELOG DELETION POLICY TO applied on all standby;old RMAN configuration parameters:CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY;new RMAN configuration parameters:CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY;new RMAN configuration parameters are successfully storedRMAN-00571: ===========================================================RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============RMAN-00571: ===========================================================RMAN-03009: failure of REFAF command on default channel at 12/05/2019 18:38:02ORA-01804: failure to initialize timezone information 因为我这里是主备库，所以先查看主库的时区文件版本情况，造成这个问题的原因应该是，在做同步的时候，把时区版本的系统同步到了备库，而备库没有该时区文件。所以先查看主库文件信息 123456789101112131415161718192021-- 查看主库的时区文件SQL&gt; select * from v$timezone_file;FILENAME VERSION CON_ID-------------------- ---------- ----------timezlrg_31.dat 31 0-- 查看主库时区版本SQL&gt; col PROPERTY_NAME for a25SQL&gt; col VALUE for a15SQL&gt; SELECT PROPERTY_NAME, SUBSTR(property_value, 1, 30) value FROM DATABASE_PROPERTIESWHERE PROPERTY_NAME LIKE 'DST_%'ORDER BY PROPERTY_NAME; 2 3 4 PROPERTY_NAME VALUE------------------------- ---------------DST_PRIMARY_TT_VERSION 31DST_SECONDARY_TT_VERSION 0DST_UPGRADE_STATE NONE 查找主库的时区文件，发现对应版本的时区文件是存在的 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970-- 查看主库时区文件[oracle@auxdb12c1 ~]$ cd /u01/app/oracle/product/12.2.0.1/dbhome_1/oracore/zoneinfo/[oracle@auxdb12c1 zoneinfo]$ lltotal 32452drwxr-xr-x 2 oracle oinstall 4096 Feb 7 2019 bigdrwxr-xr-x 2 oracle oinstall 4096 Feb 7 2019 little-rw-r--r-- 1 oracle oinstall 58132 Sep 10 2018 readme.txt-rw-r--r-- 1 oracle oinstall 47612 May 2 2016 timezdif.csv-rw-r--r-- 1 oracle oinstall 792894 Aug 10 2016 timezlrg_10.dat-rw-r--r-- 1 oracle oinstall 787272 Aug 10 2016 timezlrg_11.dat-rw-r--r-- 1 oracle oinstall 785621 Aug 10 2016 timezlrg_12.dat-rw-r--r-- 1 oracle oinstall 782475 Aug 10 2016 timezlrg_13.dat-rw-r--r-- 1 oracle oinstall 791430 Aug 10 2016 timezlrg_14.dat-rw-r--r-- 1 oracle oinstall 791476 Aug 10 2016 timezlrg_15.dat-rw-r--r-- 1 oracle oinstall 800913 Aug 10 2016 timezlrg_16.dat-rw-r--r-- 1 oracle oinstall 779003 Aug 10 2016 timezlrg_17.dat-rw-r--r-- 1 oracle oinstall 781669 Aug 10 2016 timezlrg_18.dat-rw-r--r-- 1 oracle oinstall 785786 Aug 10 2016 timezlrg_19.dat-rw-r--r-- 1 oracle oinstall 493675 Aug 10 2016 timezlrg_1.dat-rw-r--r-- 1 oracle oinstall 789973 Aug 10 2016 timezlrg_20.dat-rw-r--r-- 1 oracle oinstall 782517 Aug 10 2016 timezlrg_21.dat-rw-r--r-- 1 oracle oinstall 784497 Aug 10 2016 timezlrg_22.dat-rw-r--r-- 1 oracle oinstall 788897 Aug 10 2016 timezlrg_23.dat-rw-r--r-- 1 oracle oinstall 777086 Aug 10 2016 timezlrg_24.dat-rw-r--r-- 1 oracle oinstall 780468 Aug 10 2016 timezlrg_25.dat-rw-r--r-- 1 oracle oinstall 785474 Aug 10 2016 timezlrg_26.dat-rwxr-xr-x 1 oracle oinstall 785408 Sep 10 2018 timezlrg_27.dat-rwxr-xr-x 1 oracle oinstall 782585 Sep 10 2018 timezlrg_28.dat-rwxr-xr-x 1 oracle oinstall 788462 Sep 10 2018 timezlrg_29.dat-rw-r--r-- 1 oracle oinstall 507957 Aug 10 2016 timezlrg_2.dat-rwxr-xr-x 1 oracle oinstall 785841 Sep 10 2018 timezlrg_30.dat-rwxr-xr-x 1 oracle oinstall 786708 Sep 10 2018 timezlrg_31.dat-rw-r--r-- 1 oracle oinstall 527717 Aug 10 2016 timezlrg_3.dat-rw-r--r-- 1 oracle oinstall 531137 Aug 10 2016 timezlrg_4.dat-rw-r--r-- 1 oracle oinstall 587487 Dec 9 2015 timezlrg_5.dat-rw-r--r-- 1 oracle oinstall 586750 Aug 10 2016 timezlrg_6.dat-rw-r--r-- 1 oracle oinstall 601242 Aug 10 2016 timezlrg_7.dat-rw-r--r-- 1 oracle oinstall 616723 Dec 9 2015 timezlrg_8.dat-rw-r--r-- 1 oracle oinstall 801410 Aug 10 2016 timezlrg_9.dat-rw-r--r-- 1 oracle oinstall 345637 Dec 9 2015 timezone_10.dat-rw-r--r-- 1 oracle oinstall 345356 Dec 9 2015 timezone_11.dat-rw-r--r-- 1 oracle oinstall 345024 Aug 10 2016 timezone_12.dat-rw-r--r-- 1 oracle oinstall 344425 Aug 10 2016 timezone_13.dat-rw-r--r-- 1 oracle oinstall 344448 Dec 9 2015 timezone_14.dat-rw-r--r-- 1 oracle oinstall 344448 Aug 10 2016 timezone_15.dat-rw-r--r-- 1 oracle oinstall 343044 Aug 10 2016 timezone_16.dat-rw-r--r-- 1 oracle oinstall 341718 Dec 9 2015 timezone_17.dat-rw-r--r-- 1 oracle oinstall 341718 Aug 10 2016 timezone_18.dat-rw-r--r-- 1 oracle oinstall 343167 Aug 10 2016 timezone_19.dat-rw-r--r-- 1 oracle oinstall 274427 Aug 10 2016 timezone_1.dat-rw-r--r-- 1 oracle oinstall 343167 Aug 10 2016 timezone_20.dat-rw-r--r-- 1 oracle oinstall 343249 Aug 10 2016 timezone_21.dat-rw-r--r-- 1 oracle oinstall 343594 Aug 10 2016 timezone_22.dat-rw-r--r-- 1 oracle oinstall 343768 Aug 10 2016 timezone_23.dat-rw-r--r-- 1 oracle oinstall 340192 Dec 9 2015 timezone_24.dat-rw-r--r-- 1 oracle oinstall 340197 Aug 10 2016 timezone_25.dat-rw-r--r-- 1 oracle oinstall 342602 Aug 10 2016 timezone_26.dat-rwxr-xr-x 1 oracle oinstall 342602 Sep 10 2018 timezone_27.dat-rwxr-xr-x 1 oracle oinstall 341401 Sep 10 2018 timezone_28.dat-rwxr-xr-x 1 oracle oinstall 341401 Sep 10 2018 timezone_29.dat-rw-r--r-- 1 oracle oinstall 274900 Dec 9 2015 timezone_2.dat-rwxr-xr-x 1 oracle oinstall 340884 Sep 10 2018 timezone_30.dat-rwxr-xr-x 1 oracle oinstall 340892 Sep 10 2018 timezone_31.dat-rw-r--r-- 1 oracle oinstall 286651 Aug 10 2016 timezone_3.dat-rw-r--r-- 1 oracle oinstall 286264 Dec 9 2015 timezone_4.dat-rw-r--r-- 1 oracle oinstall 286310 Aug 10 2016 timezone_5.dat-rw-r--r-- 1 oracle oinstall 286217 Dec 9 2015 timezone_6.dat-rw-r--r-- 1 oracle oinstall 286815 Aug 10 2016 timezone_7.dat-rw-r--r-- 1 oracle oinstall 302100 Dec 9 2015 timezone_8.dat-rw-r--r-- 1 oracle oinstall 351525 Aug 10 2016 timezone_9.dat 查看备库的时区文件信息发现为空，而DST_PRIMARY_TT_VERSION信息是存在的 123456789101112131415161718-- 查看备库时区文件SQL&gt; select * from v$timezone_file;no rows selected-- 查看备库时区版本SQL&gt; col PROPERTY_NAME for a25SQL&gt; col VALUE for a15SELECT PROPERTY_NAME, SUBSTR(property_value, 1, 30) value FROM DATABASE_PROPERTIESWHERE PROPERTY_NAME LIKE 'DST_%'ORDER BY PROPERTY_NAME; SQL&gt; SQL&gt; 2 3 4 PROPERTY_NAME VALUE------------------------- ---------------DST_PRIMARY_TT_VERSION 31DST_SECONDARY_TT_VERSION 0DST_UPGRADE_STATE NONE 查看备库时区文件，没有31号时区文件 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859[oracle@auxsbdb12c admin]$ cd /u01/app/oracle/product/12.2.0/dbhome_1/oracore/zoneinfo/[oracle@auxsbdb12c zoneinfo]$ lltotal 26664drwxr-xr-x 2 oracle oinstall 4096 Dec 3 16:28 bigdrwxr-xr-x 2 oracle oinstall 4096 Dec 3 16:28 little-rw-r--r-- 1 oracle oinstall 52603 May 1 2016 readme.txt-rw-r--r-- 1 oracle oinstall 47612 May 1 2016 timezdif.csv-rw-r--r-- 1 oracle oinstall 792894 Aug 10 2016 timezlrg_10.dat-rw-r--r-- 1 oracle oinstall 787272 Aug 10 2016 timezlrg_11.dat-rw-r--r-- 1 oracle oinstall 785621 Aug 10 2016 timezlrg_12.dat-rw-r--r-- 1 oracle oinstall 782475 Aug 10 2016 timezlrg_13.dat-rw-r--r-- 1 oracle oinstall 791430 Aug 10 2016 timezlrg_14.dat-rw-r--r-- 1 oracle oinstall 791476 Aug 10 2016 timezlrg_15.dat-rw-r--r-- 1 oracle oinstall 800913 Aug 10 2016 timezlrg_16.dat-rw-r--r-- 1 oracle oinstall 779003 Aug 10 2016 timezlrg_17.dat-rw-r--r-- 1 oracle oinstall 781669 Aug 10 2016 timezlrg_18.dat-rw-r--r-- 1 oracle oinstall 785786 Aug 10 2016 timezlrg_19.dat-rw-r--r-- 1 oracle oinstall 493675 Aug 10 2016 timezlrg_1.dat-rw-r--r-- 1 oracle oinstall 789973 Aug 10 2016 timezlrg_20.dat-rw-r--r-- 1 oracle oinstall 782517 Aug 10 2016 timezlrg_21.dat-rw-r--r-- 1 oracle oinstall 784497 Aug 10 2016 timezlrg_22.dat-rw-r--r-- 1 oracle oinstall 788897 Aug 10 2016 timezlrg_23.dat-rw-r--r-- 1 oracle oinstall 777086 Aug 10 2016 timezlrg_24.dat-rw-r--r-- 1 oracle oinstall 780468 Aug 10 2016 timezlrg_25.dat-rw-r--r-- 1 oracle oinstall 785474 Aug 10 2016 timezlrg_26.dat-rw-r--r-- 1 oracle oinstall 507957 Aug 10 2016 timezlrg_2.dat-rw-r--r-- 1 oracle oinstall 527717 Aug 10 2016 timezlrg_3.dat-rw-r--r-- 1 oracle oinstall 531137 Aug 10 2016 timezlrg_4.dat-rw-r--r-- 1 oracle oinstall 587487 Dec 9 2015 timezlrg_5.dat-rw-r--r-- 1 oracle oinstall 586750 Aug 10 2016 timezlrg_6.dat-rw-r--r-- 1 oracle oinstall 601242 Aug 10 2016 timezlrg_7.dat-rw-r--r-- 1 oracle oinstall 616723 Dec 9 2015 timezlrg_8.dat-rw-r--r-- 1 oracle oinstall 801410 Aug 10 2016 timezlrg_9.dat-rw-r--r-- 1 oracle oinstall 345637 Dec 9 2015 timezone_10.dat-rw-r--r-- 1 oracle oinstall 345356 Dec 9 2015 timezone_11.dat-rw-r--r-- 1 oracle oinstall 345024 Aug 10 2016 timezone_12.dat-rw-r--r-- 1 oracle oinstall 344425 Aug 10 2016 timezone_13.dat-rw-r--r-- 1 oracle oinstall 344448 Dec 9 2015 timezone_14.dat-rw-r--r-- 1 oracle oinstall 344448 Aug 10 2016 timezone_15.dat-rw-r--r-- 1 oracle oinstall 343044 Aug 10 2016 timezone_16.dat-rw-r--r-- 1 oracle oinstall 341718 Dec 9 2015 timezone_17.dat-rw-r--r-- 1 oracle oinstall 341718 Aug 10 2016 timezone_18.dat-rw-r--r-- 1 oracle oinstall 343167 Aug 10 2016 timezone_19.dat-rw-r--r-- 1 oracle oinstall 274427 Aug 10 2016 timezone_1.dat-rw-r--r-- 1 oracle oinstall 343167 Aug 10 2016 timezone_20.dat-rw-r--r-- 1 oracle oinstall 343249 Aug 10 2016 timezone_21.dat-rw-r--r-- 1 oracle oinstall 343594 Aug 10 2016 timezone_22.dat-rw-r--r-- 1 oracle oinstall 343768 Aug 10 2016 timezone_23.dat-rw-r--r-- 1 oracle oinstall 340192 Dec 9 2015 timezone_24.dat-rw-r--r-- 1 oracle oinstall 340197 Aug 10 2016 timezone_25.dat-rw-r--r-- 1 oracle oinstall 342602 Aug 10 2016 timezone_26.dat-rw-r--r-- 1 oracle oinstall 274900 Dec 9 2015 timezone_2.dat-rw-r--r-- 1 oracle oinstall 286651 Aug 10 2016 timezone_3.dat-rw-r--r-- 1 oracle oinstall 286264 Dec 9 2015 timezone_4.dat-rw-r--r-- 1 oracle oinstall 286310 Aug 10 2016 timezone_5.dat-rw-r--r-- 1 oracle oinstall 286217 Dec 9 2015 timezone_6.dat-rw-r--r-- 1 oracle oinstall 286815 Aug 10 2016 timezone_7.dat-rw-r--r-- 1 oracle oinstall 302100 Dec 9 2015 timezone_8.dat-rw-r--r-- 1 oracle oinstall 351525 Aug 10 2016 timezone_9.dat 去Oracle官网下载相应的时区文件补丁，文档编号：412160.1 12345678910111213141516171819202122232425262728293031323334353637Oracle DST Timezone database RDBMS DST patch OJVM DST patchversion release number number----------- -------------------- ------------------- --------------Version 1 N&#x2F;A N&#x2F;AVersion 2 patch 3171059 N&#x2F;AVersion 3 patch 4689959 N&#x2F;AVersion 4 - tzdata2006g update - patch 5632264 patch 5865568Version 5 patch 5880630 N&#x2F;AVersion 6 - tzdata2007f update - patch 6113507 patch 6113568Version 7 - tzdata2007k update - patch 6672979 patch 6708377Version 8 N&#x2F;A N&#x2F;AVersion 9 - tzdata2008f update - patch 7181943 patch 7449057Version 10 - tzdata2008i update - patch 7580744 patch 7708501Version 11 - tzdata2009g update - patch 8524113 * patch 8603182Version 12 N&#x2F;A N&#x2F;AVersion 13 - tzdata2009s update - patch 9146268 * patch 9197935Version 14 - tzdata2010j update - patch 9742718 * patch 9751299Version 15 - tzdata2010o update - patch 10272702 * patch 10406470Version 16 - tzdata2011g update - patch 12320006 * patch 12565410Version 17 - tzdata2011j update - patch 12949905 * patch 12949919 ( tzdata2011i for OJVM )Version 18 - tzdata2012c update - patch 13417321 * patch 14112098Version 19 - tzdata2012j update - patch 15897859 * patch 15897884Version 20 - tzdata2013c update - patch 16799735 * patch 16799766Version 21 - tzdata2013e update - patch 17432124 * patch 17443054Version 22 - tzdata2014c update - patch 18759211 * patch 18759260Version 23 - tzdata2014f update - patch 19396455 * patch 19397646Version 24 - tzdata2015d update - patch 20875898 * patch 20875943Version 25 - tzdata2015g update - patch 22037014 * patch 22037067Version 26 - tzdata2016d update - patch 22873635 * patch 22873666Version 27 - tzdata2016f update - patch 23614158 * patch 23614160Version 28 - tzdata2016g update - patch 24701840 * patch 24701882Version 29 - tzdata2016j update - patch 25173124 * patch 25173172Version 30 - tzdata2017b update - patch 25881255 * patch 25881271Version 31 - tzdata2017c update - patch 27015449 * patch 27015468Version 32 - tzdata2018e update - patch 28125601 * patch 28127287Version 33 - tzdata2018g update - patch 28852325 * patch 28852334Version 34 - tzdata2019b update - patch 29997937 * patch 29997959 安装时区文件补丁 123456789101112131415161718192021222324252627[oracle@subjsbdb12c OPatch]$ ./opatch apply /home/27015449/Oracle Interim Patch Installer version 12.2.0.1.18Copyright (c) 2019, Oracle Corporation. All rights reserved.Oracle Home : /u01/app/oracle/product/12.2.0/dbhome_1Central Inventory : /u01/app/oraInventory from : /u01/app/oracle/product/12.2.0/dbhome_1/oraInst.locOPatch version : 12.2.0.1.18OUI version : 12.2.0.1.4Log file location : /u01/app/oracle/product/12.2.0/dbhome_1/cfgtoollogs/opatch/opatch2019-12-06_11-13-05AM_1.logVerifying environment and performing prerequisite checks...OPatch continues with these patches: 27015449 Do you want to proceed? [y|n]yUser Responded with: YAll checks passed.Backing up files...Applying interim patch '27015449' to OH '/u01/app/oracle/product/12.2.0/dbhome_1'Patching component oracle.oracore.rsf, 12.2.0.1.0...Patch 27015449 successfully applied.Log file location: /u01/app/oracle/product/12.2.0/dbhome_1/cfgtoollogs/opatch/opatch2019-12-06_11-13-05AM_1.logOPatch succeeded. 修改时区文件版本后，再次检查发现已经正常 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950SQL&gt; EXEC DBMS_DST.BEGIN_UPGRADE(31);BEGIN DBMS_DST.BEGIN_UPGRADE(31); END;*ERROR at line 1:ORA-56926: database must be in UPGRADE mode in order to start an upgrade windowORA-06512: at \"SYS.DBMS_SYS_ERROR\", line 79ORA-06512: at \"SYS.DBMS_DST\", line 1241ORA-06512: at line 1SQL&gt; shutdown immediatSP2-0717: illegal SHUTDOWN optionSQL&gt; shutdown immediateDatabase closed.Database dismounted.ORACLE instance shut down.SQL&gt; startup upgradeORACLE instance started.Total System Global Area 8.1068E+10 bytesFixed Size 30036880 bytesVariable Size 1.4496E+10 bytesDatabase Buffers 6.6304E+10 bytesRedo Buffers 238395392 bytesDatabase mounted.Database opened.SQL&gt; EXEC DBMS_DST.BEGIN_UPGRADE(31);PL/SQL procedure successfully completed.SQL&gt; shutdown immediateDatabase closed.Database dismounted.ORACLE instance shut down.SQL&gt; startupORACLE instance started.Total System Global Area 8.1068E+10 bytesFixed Size 30036880 bytesVariable Size 1.4496E+10 bytesDatabase Buffers 6.6304E+10 bytesRedo Buffers 238395392 bytesDatabase mounted.Database opened.SQL&gt; select * from v$timezone_file;FILENAME VERSION CON_ID-------------------- ---------- ----------timezlrg_31.dat 31 0","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"ORA-01804","slug":"ORA-01804","permalink":"http://mudbub.com/tags/ORA-01804/"}],"author":["Falkon"]},{"title":"ORA-00980 synonym translation is no longer valid","slug":"database/ora-00980-synonym-translation-is-no-longer-valid","date":"2021-01-27T09:37:22.601Z","updated":"2021-03-26T10:22:05.700Z","comments":true,"path":"2021/01/27/database/ora-00980-synonym-translation-is-no-longer-valid/","link":"","permalink":"http://mudbub.com/2021/01/27/database/ora-00980-synonym-translation-is-no-longer-valid/","excerpt":"同义词创建时，不会去检查内容的准确性，即使表不存在，也可以创建该表的同义词，但是select的时候会报ORA-00980 synonym translation is no longer valid的错误","text":"同义词创建时，不会去检查内容的准确性，即使表不存在，也可以创建该表的同义词，但是select的时候会报ORA-00980 synonym translation is no longer valid的错误 给一张不存在的表创建同义词 1234567891011121314151617181920SQL&gt; show userUSER is \"SH\"-- 查看aa表存不存在SQL&gt; select * from aa;select * from aa *ERROR at line 1:ORA-00942: table or view does not exist-- 创建同义词SQL&gt; create public synonym tt for aa;Synonym created.SQL&gt; select * from tt;select * from tt *ERROR at line 1:ORA-00980: synonym translation is no longer valid 给一张存在的表创建同义词，然后删除该表 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859-- 创建a1表SQL&gt; show userUSER is \"SH\"SQL&gt; create table a1 (id number);Table created.SQL&gt; insert into a1 values(1);1 row created.SQL&gt; commit;Commit complete.SQL&gt; select * from a1; ID---------- 1-- 创建同义词SQL&gt; show userUSER is \"TEST\" SQL&gt; create public synonym t1 for sh.a1;Synonym created.SQL&gt; select * from t1; ID---------- 1-- 查看数据字典中的定义SQL&gt; select * from dba_synonyms where table_name='A1';OWNER SYNONYM_NAME TABLE_OWNE TABLE_NAME DB_LINK---------- ------------------------------ ---------- ---------- ----------PUBLIC T1 SH A1-- 删除源表SQL&gt; drop table a1 purge;Table dropped.-- 查询创建的同义词SQL&gt; select * from t1;select * from t1 *ERROR at line 1:ORA-00980: synonym translation is no longer valid-- 再次查看数据字典中的定义SQL&gt; select * from dba_synonyms where table_name='A1';OWNER SYNONYM_NAME TABLE_OWNE TABLE_NAME DB_LINK---------- ------------------------------ ---------- ---------- ----------PUBLIC T1 SH A1 总结：出现ORA-00980: synonym translation is no longer valid的原因基本为同义词在数据字典中的定义还在，但是其源表对象不在存在或者不可访问","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"Synonym","slug":"Synonym","permalink":"http://mudbub.com/tags/Synonym/"}],"author":["Falkon"]},{"title":"ORA-00600 内部错误代码 参数 [4511]","slug":"database/ora-00600-internal-error-code-parameter-4511","date":"2021-01-27T09:37:22.595Z","updated":"2021-03-26T10:21:58.397Z","comments":true,"path":"2021/01/27/database/ora-00600-internal-error-code-parameter-4511/","link":"","permalink":"http://mudbub.com/2021/01/27/database/ora-00600-internal-error-code-parameter-4511/","excerpt":"平台：AIX 5.3 数据库：10.2.0.1.0 客户反映告警日志增长过快，发现告警日志中有大量的600错误，由于保密原因，一些敏感信息将被替换或者删除 1234567Tue Apr 28 17:09:14 2020Errors in file /oracle/admin/racdb/udump/racdb2_ora_1581514.trc:ORA-00600: 内部错误代码, 参数: [4511], [], [], [], [], [], [], []Tue Apr 28 17:09:44 2020Errors in file /oracle/admin/racdb/udump/racdb2_ora_496078.trc:ORA-00600: 内部错误代码, 参数: [4511], [], [], [], [], [], [], []Tue Apr 28 17:09:45 2020","text":"平台：AIX 5.3 数据库：10.2.0.1.0 客户反映告警日志增长过快，发现告警日志中有大量的600错误，由于保密原因，一些敏感信息将被替换或者删除 1234567Tue Apr 28 17:09:14 2020Errors in file /oracle/admin/racdb/udump/racdb2_ora_1581514.trc:ORA-00600: 内部错误代码, 参数: [4511], [], [], [], [], [], [], []Tue Apr 28 17:09:44 2020Errors in file /oracle/admin/racdb/udump/racdb2_ora_496078.trc:ORA-00600: 内部错误代码, 参数: [4511], [], [], [], [], [], [], []Tue Apr 28 17:09:45 2020 查看racdb2_ora_496078.trc 1234567891011121314Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - 64bit ProductionWith the Partitioning, Real Application Clusters, OLAP and Data Mining optionsORACLE_HOME = /oracle/product/10.2.0/db_1System name: AIXNode name: p570-2*** SERVICE NAME:(SYS$USERS) 2020-04-28 14:09:44.124*** SESSION ID:(933.22812) 2020-04-28 14:09:44.124*** 2020-04-28 14:09:44.124ksedmp: internal or fatal errorORA-00600: 内部错误代码, 参数: [4511], [], [], [], [], [], [], []Current SQL statement for this session:update test_default_test set value='1' where key='hello.world' and value='0' 查找Block Header所对应的对象 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768Block header dump: 0x0b088aef Object id on Block? Y seg/obj: 0xfd8ab csc: 0xd03.27e67c2a itc: 2 flg: E typ: 1 - DATA brn: 0 bdba: 0xb088ae9 ver: 0x01 opc: 0 inc: 0 exflg: 0Block header dump: 0x0b088aef Object id on Block? Y seg/obj: 0x1112a6 csc: 0xd03.27e67c2a itc: 2 flg: E typ: 1 - DATA brn: 0 bdba: 0xb088ae9 ver: 0x01 opc: 0 inc: 0 exflg: 0Block header dump: 0x0ad3db04 Object id on Block? Y seg/obj: 0x1112a7 csc: 0xd03.27fcb042 itc: 2 flg: E typ: 2 - INDEX brn: 0 bdba: 0xad3db01 ver: 0x01 opc: 0 inc: 0 exflg: 0Block header dump: 0x0ad3daff Object id on Block? Y seg/obj: 0xfd9e5 csc: 0xd03.27fcb59f itc: 2 flg: E typ: 1 - DATA brn: 0 bdba: 0xad3daf9 ver: 0x01 opc: 0 inc: 0 exflg: 0- MOS ORA-600 [4511] \"Row locked by inactive ITL\" (Doc ID 39553.1)描述PURPOSE: This article discusses the internal error \"ORA-600 [4511]\", what it means and possible actions. The information here is only applicable to the versions listed and is provided only for guidance. ERROR: Format: ORA-600 [4511] [a] [b] [c] [d] [e] VERSIONS: Versions 6.0 and later DESCRIPTION: We receive this error when a row lock is being tested and the lock is not active at the time. This may also be caused by having more than 4095 rows in a single data block. Only blocks of 32Kb can contain this many rows. The workaround is to limit the number of rows in the block, by setting pctfree to a higher value.FUNCTIONALITY: TRANSACTION BLOCK OPERATIONS IMPACT: PROCESS FAILURE POSSIBLE BLOCK CORRUPTION.SUGGESTIONS: If you know the table(s) involved, use ANALYZE TABLE &lt;table_name&gt; VALIDATE STRUCTURE CASCADE; to check for possible problems. Run DBVERIFY on any datafiles associated with the table(s) This can be related to a Consistent Read (CR) problem, so shutdown and restart the instance and see if the problem reproduces. Submit all trace files and the alert.log to Oracle Support Services for further review and analysis. 结合MOS的描述查找所对应的对象 12345678SQL&gt; select object_name,object_type,owner from dba_objects where data_object_id in (1038507,1118886,1118887,1038821);OBJECT_NAME OBJECT_TYPE OWNER------------------------------ ------------------- ----------PK_SYS_AUTOTASK_MONITOR INDEX TEST_2019SYS_AUTOTASK_MONITOR TABLE TEST_2019TEST_DEFAULT_TEST_PK2 INDEX TEST_2019TEST_DEFAULT_TEST TABLE TEST_2019 统计表行数 1234567891011SQL&gt; select count(1) from TEST_2019.SYS_AUTOTASK_MONITOR; COUNT(1)---------- 10SQL&gt; select count(1) from TEST_2019.test_default_test; COUNT(1)---------- 146 对表进行复制备份 1234567SQL&gt; create table TEST_2019.SYS_AUTOTASK_MONITOR_BAK as select * from TEST_2019.SYS_AUTOTASK_MONITOR;Table created.SQL&gt; create table TEST_2019.TEST_DEFAULT_TEST_BAK as select * from TEST_2019.TEST_DEFAULT_TEST;Table created. 进行rebuild index和 analyze table 123456789101112131415161718SQL&gt; alter index TEST_2019.PK_SYS_AUTOTASK_MONITOR rebuild;Index altered.SQL&gt; alter index TEST_2019.test_default_test_PK2 rebuild;Index altered.SQL&gt; SQL&gt; analyze table TEST_2019.SYS_AUTOTASK_MONITOR validate structure cascade;Table analyzed.SQL&gt; analyze table TEST_2019.TEST_DEFAULT_TEST validate structure cascade;analyze table TEST_2019.test_default_test validate structure cascade*ERROR at line 1:ORA-01498: block check failure - see trace file 发现TEST_2019.test_default_test表有块错误提示，但没有看到详细的告警日志文件，决定先对表进行重建后再分析表 12345678910SQL&gt; drop table TEST_2019.TEST_DEFAULT_TEST;Table dropped.SQL&gt; create table TEST_2019.TEST_DEFAULT_TEST as select * from TEST_2019.TEST_DEFAULT_TEST_BAK;Table created.SQL&gt; analyze table TEST_2019.TEST_DEFAULT_TEST validate structure cascade;Table analyzed. 检查告警日志发现错误已经消失","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"RAC","slug":"RAC","permalink":"http://mudbub.com/tags/RAC/"},{"name":"10g","slug":"10g","permalink":"http://mudbub.com/tags/10g/"},{"name":"ORA-600","slug":"ORA-600","permalink":"http://mudbub.com/tags/ORA-600/"}],"author":["Falkon"]},{"title":"ODA最新补丁文档和下载地址","slug":"database/oda-latest-patch-address","date":"2021-01-27T09:37:22.589Z","updated":"2021-03-26T10:21:45.560Z","comments":true,"path":"2021/01/27/database/oda-latest-patch-address/","link":"","permalink":"http://mudbub.com/2021/01/27/database/oda-latest-patch-address/","excerpt":"登录官网链接","text":"登录官网链接 点击Oracle Database Applicance Version Patchs前面的+号进入相关ODA一体机的补丁列表 点击相应的补丁号，如27604623进入不行下载页面 经测试ODA最新版本的补丁可以应用与较早的ODA一体机产品，如18.7的补丁可以应用早期的X6、X5以及X4，X3没有测试过","categories":[{"name":"Oracle Database Appliance","slug":"Oracle-Database-Appliance","permalink":"http://mudbub.com/categories/Oracle-Database-Appliance/"}],"tags":[{"name":"ODA","slug":"ODA","permalink":"http://mudbub.com/tags/ODA/"},{"name":"Patch","slug":"Patch","permalink":"http://mudbub.com/tags/Patch/"}],"author":["Falkon"]},{"title":"MySQL5.7在CentOS7.8平台上的部署","slug":"database/mysql57-installation-for-centos78","date":"2021-01-27T09:37:22.580Z","updated":"2021-03-26T10:21:37.408Z","comments":true,"path":"2021/01/27/database/mysql57-installation-for-centos78/","link":"","permalink":"http://mudbub.com/2021/01/27/database/mysql57-installation-for-centos78/","excerpt":"","text":"关于下MySQL5.7数据库在CentOS7.8平台上的安装部署 （文档ID 20121601.1） 下载安装包https://dev.mysql.com/downloads/mysql/5.7.html#downloads 上传安装包到home目录使用sftp或者ftp工具将下载的tar包上传到服务的home目录下 MySQL安装 查询MariaDB及组件 12[root@mysql57 home]# rpm -qa | grep mariadbmariadb-libs-5.5.68-1.el7.x86_64 卸载MaridDB及组件 1234[root@mysql57 home]# rpm -e mariadb-libs-5.5.68-1.el7.x86_64error: Failed dependencies: &lt;&lt;&lt;&lt;&lt;&lt;&lt; libmysqlclient.so.18()(64bit) is needed by (installed) postfix-2:2.10.1-9.el7.x86_64 libmysqlclient.so.18(libmysqlclient_18)(64bit) is needed by (installed) postfix-2:2.10.1-9.el7.x86_64 强制卸载MariaDB及组件 1[root@mysql57 home]# rpm -e mariadb-libs-5.5.68-1.el7.x86_64 --nodeps 安装MySQL 5.x所需的依赖包 1[root@mysql57 home]# yum -y install libaio* perl* net-tools* 解压上传的MySQL安装包 1[root@mysql57 home]# tar xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar 查看解压后的安装包 12345678910111213[root@mysql57 home]# lltotal 1036896-rw-r--r--. 1 root root 530882560 Dec 9 13:50 mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar-rw-r--r--. 1 7155 31415 25381952 Apr 15 2019 mysql-community-client-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 280904 Apr 15 2019 mysql-community-common-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 3838100 Apr 15 2019 mysql-community-devel-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 47076368 Apr 15 2019 mysql-community-embedded-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 24086952 Apr 15 2019 mysql-community-embedded-compat-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 130023844 Apr 15 2019 mysql-community-embedded-devel-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 2274268 Apr 15 2019 mysql-community-libs-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 2118444 Apr 15 2019 mysql-community-libs-compat-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 173541272 Apr 15 2019 mysql-community-server-5.7.26-1.el7.x86_64.rpm-rw-r--r--. 1 7155 31415 122249684 Apr 15 2019 mysql-community-test-5.7.26-1.el7.x86_64.rpm 进行RPM安装 1234567891011121314[root@mysql57 home]# rpm -ivh *.rpmwarning: mysql-community-client-5.7.26-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEYPreparing... ################################# [100%]Updating / installing... 1:mysql-community-common-5.7.26-1.e################################# [ 10%] 2:mysql-community-libs-5.7.26-1.el7################################# [ 20%] 3:mysql-community-client-5.7.26-1.e################################# [ 30%] 4:mysql-community-server-5.7.26-1.e################################# [ 40%] 5:mysql-community-devel-5.7.26-1.el################################# [ 50%] 6:mysql-community-embedded-5.7.26-1################################# [ 60%] 7:mysql-community-embedded-devel-5.################################# [ 70%] 8:mysql-community-test-5.7.26-1.el7################################# [ 80%] 9:mysql-community-libs-compat-5.7.2################################# [ 90%] 10:mysql-community-embedded-compat-5################################# [100%] 查看mysqld服务状态 123456[root@mysql57 home]# systemctl status mysqld● mysqld.service - MySQL Server Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled) Active: inactive (dead) Docs: man:mysqld(8) http://dev.mysql.com/doc/refman/en/using-systemd.html 启动mysqld服务 12345678910111213141516[root@mysql57 home]# systemctl start mysqld[root@mysql57 home]# systemctl status mysqld● mysqld.service - MySQL Server Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2020-12-09 14:23:27 CST; 4s ago Docs: man:mysqld(8) http://dev.mysql.com/doc/refman/en/using-systemd.html Process: 2812 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS) Process: 2738 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS) Main PID: 2815 (mysqld) Tasks: 27 CGroup: /system.slice/mysqld.service └─2815 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pidDec 09 14:23:25 mysql57 systemd[1]: Starting MySQL Server...Dec 09 14:23:27 mysql57 systemd[1]: Started MySQL Server. 开启mysqld开机启动服务 1[root@mysql57 home]# systemctl enable mysqld 查找默认的安装密码 12[root@mysql57 home]# grep password /var/log/mysqld.log2020-12-09T06:23:25.478974Z 1 [Note] A temporary password is generated for root@localhost: ylN+.*=w1Zl9 登入MySQL数据库 123456789101112131415[root@mysql57 home]# mysql -u root -pEnter password: Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 2Server version: 5.7.26Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; 修改默认密码 12mysql&gt; set password = password(\"PP--ssw00rd\");Query OK, 0 rows affected, 1 warning (0.01 sec) 开启远程连接 12mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'PP--ssw00rd' WITH GRANT OPTION;Query OK, 0 rows affected, 1 warning (0.00 sec) my.conf配置 修改数据库字符集 1character_set_server = utf8mb4 配置binlog 12345678log-bin=mysql-binserver_id=2sync_binlog=0binlog_format=mixedexpire_logs_days=7max_binlog_size=100mbinlog_cache_size=4mmax_binlog_cache_size=512m","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://mudbub.com/categories/MySQL/"}],"tags":[{"name":"Install","slug":"Install","permalink":"http://mudbub.com/tags/Install/"}],"author":["Falkon"]},{"title":"Oracle 数据泵的基本使用","slug":"database/expdp-impdp","date":"2021-01-27T09:37:22.574Z","updated":"2021-03-26T10:21:21.076Z","comments":true,"path":"2021/01/27/database/expdp-impdp/","link":"","permalink":"http://mudbub.com/2021/01/27/database/expdp-impdp/","excerpt":"关于数据泵(data pump)的说明，数据泵是exp/imp的升级，exp/imp是客户端程序，既可以在客户点使用，也可以在服务端使用，利用Oracle客户端工具，可以直接将服务器上的数据导入被本地电脑。expdp/impdp是服务端工具，只能在服务端使用。两种工具也无法混用，就是说exp导出的数据无法使用impdp导入。对于小于GB的数据可以exp/imp，对于大于GB的数据来说exp/imp的效率较为低下，建议对于Oracle 11g以上版本的数据库都采用expdp/impdp","text":"关于数据泵(data pump)的说明，数据泵是exp/imp的升级，exp/imp是客户端程序，既可以在客户点使用，也可以在服务端使用，利用Oracle客户端工具，可以直接将服务器上的数据导入被本地电脑。expdp/impdp是服务端工具，只能在服务端使用。两种工具也无法混用，就是说exp导出的数据无法使用impdp导入。对于小于GB的数据可以exp/imp，对于大于GB的数据来说exp/imp的效率较为低下，建议对于Oracle 11g以上版本的数据库都采用expdp/impdp expdp/impdp的使用方法主要有四种方式（完全、用户、表空间、表）,需要dba权限使用expdp/impdp需要创建逻辑目录，逻辑目录所对应的实际目录应存在于操作系统中，如果逻辑目录所对应的实际目录不存在将会报如下错误，RAC两节点都需要创建，创建的目录需要oracle:oinstall属组 12345678910111213[oracle@ystdb11g backups]$ expdp system@ystdb directory=dir_dmp dumpfile=full_expdp_20200313.dmp logfile=full_expdp_20200313.log full=yExport: Release 11.2.0.4.0 - Production on Fri Mar 13 00:29:28 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsORA-39002: invalid operationORA-39070: Unable to open the log file.ORA-39087: directory name DIR_DMP is invalid 创建逻辑目录并授权 123456SQL&gt; create directory dir_dmp as '/backups'; Directory created.SQL&gt; grant read,write on directory dir_dmp to public;Grant succeeded. 查看逻辑目录 12345678910111213SQL&gt; set linesize 300col owner for a5col directory_name for a25col directory_path for a80select * from dba_directories;OWNER DIRECTORY_NAME DIRECTORY_PATH----- ------------------------- -----------------------------------------------------------------SYS DIR_DMP /backupsSYS XMLDIR /u01/app/oracle/product/11.2.0/dbhome_1/rdbms/xmlSYS ORACLE_OCM_CONFIG_DIR /u01/app/oracle/product/11.2.0/dbhome_1/ccr/hosts/ystdb11g/stateSYS DATA_PUMP_DIR /u01/app/oracle/admin/ystdb/dpdump/SYS ORACLE_OCM_CONFIG_DIR2 /u01/app/oracle/product/11.2.0/dbhome_1/ccr/state EXPDP 完全 12[oracle@ystdb11g backups]$ expdp system@ystdb directory=dir_dmp dumpfile=full_expdp_20200313.dmp logfile=full_expdp_20200313.log full=y EXPDP 用户 1234567891011121314151617181920212223242526272829303132333435363738[oracle@ystdb11g backups]$ expdp test@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_expdp_20200313.log schemas=testExport: Release 11.2.0.4.0 - Production on Fri Mar 13 00:52:16 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsStarting \"TEST\".\"SYS_EXPORT_SCHEMA_01\": test/********@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_expdp_20200313.log schemas=testEstimate in progress using BLOCKS method...Processing object type SCHEMA_EXPORT/TABLE/TABLE_DATATotal estimation using BLOCKS method: 3.062 MBProcessing object type SCHEMA_EXPORT/USERProcessing object type SCHEMA_EXPORT/SYSTEM_GRANTProcessing object type SCHEMA_EXPORT/ROLE_GRANTProcessing object type SCHEMA_EXPORT/DEFAULT_ROLEProcessing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMAProcessing object type SCHEMA_EXPORT/TABLE/TABLEProcessing object type SCHEMA_EXPORT/TABLE/COMMENTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/INDEXProcessing object type SCHEMA_EXPORT/TABLE/CONSTRAINT/CONSTRAINTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICSProcessing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS. . exported \"TEST\".\"TTB05\" 772.4 KB 15000 rows. . exported \"TEST\".\"TTB04\" 513.7 KB 10000 rows. . exported \"TEST\".\"TTB03\" 361.4 KB 7000 rows. . exported \"TEST\".\"TTB02\" 310.6 KB 6000 rows. . exported \"TEST\".\"TTB01\" 259.9 KB 5000 rows. . exported \"TEST\".\"TTB06\" 5.015 KB 1 rowsMaster table \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully loaded/unloaded******************************************************************************Dump file set for TEST.SYS_EXPORT_SCHEMA_01 is: /backups/test_expdp_20200313.dmpJob \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully completed at Fri Mar 13 00:52:32 2020 elapsed 0 00:00:12 EXPDP 表空间 123456789101112131415161718192021222324252627282930313233[oracle@ystdb11g backups]$ expdp test@ystdb directory=dir_dmp dumpfile=tbs_test_expdp_20200313.dmp logfile=tbs_test_expdp_20200313.log tablespaces=TESTExport: Release 11.2.0.4.0 - Production on Fri Mar 13 00:54:07 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsStarting \"TEST\".\"SYS_EXPORT_TABLESPACE_01\": test/********@ystdb directory=dir_dmp dumpfile=tbs_test_expdp_20200313.dmp logfile=tbs_test_expdp_20200313.log tablespaces=TESTEstimate in progress using BLOCKS method...Processing object type TABLE_EXPORT/TABLE/TABLE_DATATotal estimation using BLOCKS method: 3.062 MBProcessing object type TABLE_EXPORT/TABLE/TABLEProcessing object type TABLE_EXPORT/TABLE/COMMENTProcessing object type TABLE_EXPORT/TABLE/INDEX/INDEXProcessing object type TABLE_EXPORT/TABLE/CONSTRAINT/CONSTRAINTProcessing object type TABLE_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICSProcessing object type TABLE_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS. . exported \"TEST\".\"TTB05\" 772.4 KB 15000 rows. . exported \"TEST\".\"TTB04\" 513.7 KB 10000 rows. . exported \"TEST\".\"TTB03\" 361.4 KB 7000 rows. . exported \"TEST\".\"TTB02\" 310.6 KB 6000 rows. . exported \"TEST\".\"TTB01\" 259.9 KB 5000 rows. . exported \"TEST\".\"TTB06\" 5.015 KB 1 rowsMaster table \"TEST\".\"SYS_EXPORT_TABLESPACE_01\" successfully loaded/unloaded******************************************************************************Dump file set for TEST.SYS_EXPORT_TABLESPACE_01 is: /backups/tbs_test_expdp_20200313.dmpJob \"TEST\".\"SYS_EXPORT_TABLESPACE_01\" successfully completed at Fri Mar 13 00:54:20 2020 elapsed 0 00:00:10 EXPDP 表 1234567891011121314151617181920212223[oracle@ystdb11g backups]$ expdp test@ystdb directory=dir_dmp dumpfile=test_ttb01_expdp_20200313.dmp logfile=test_ttb01_expdp_20200313.log tables=TTB01Export: Release 11.2.0.4.0 - Production on Fri Mar 13 00:56:26 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsStarting \"TEST\".\"SYS_EXPORT_TABLE_01\": test/********@ystdb directory=dir_dmp dumpfile=test_ttb01_expdp_20200313.dmp logfile=test_ttb01_expdp_20200313.log tables=TTB01Estimate in progress using BLOCKS method...Processing object type TABLE_EXPORT/TABLE/TABLE_DATATotal estimation using BLOCKS method: 384 KBProcessing object type TABLE_EXPORT/TABLE/TABLEProcessing object type TABLE_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS. . exported \"TEST\".\"TTB01\" 259.9 KB 5000 rowsMaster table \"TEST\".\"SYS_EXPORT_TABLE_01\" successfully loaded/unloaded******************************************************************************Dump file set for TEST.SYS_EXPORT_TABLE_01 is: /backups/test_ttb01_expdp_20200313.dmpJob \"TEST\".\"SYS_EXPORT_TABLE_01\" successfully completed at Fri Mar 13 00:56:33 2020 elapsed 0 00:00:03 parallel参数 12345678910111213141516171819202122232425262728293031323334353637383940[oracle@ystdb11g backups]$ expdp test@ystdb directory=dir_dmp dumpfile=test_expdp_20200313_%U.dmp logfile=test_expdp_20200313_4.log schemas=test parallel=4Export: Release 11.2.0.4.0 - Production on Fri Mar 13 00:59:21 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsStarting \"TEST\".\"SYS_EXPORT_SCHEMA_01\": test/********@ystdb directory=dir_dmp dumpfile=test_expdp_20200313_%U.dmp logfile=test_expdp_20200313_4.log schemas=test parallel=4Estimate in progress using BLOCKS method...Processing object type SCHEMA_EXPORT/TABLE/TABLE_DATATotal estimation using BLOCKS method: 3.062 MBProcessing object type SCHEMA_EXPORT/USERProcessing object type SCHEMA_EXPORT/SYSTEM_GRANTProcessing object type SCHEMA_EXPORT/ROLE_GRANTProcessing object type SCHEMA_EXPORT/DEFAULT_ROLE. . exported \"TEST\".\"TTB05\" 772.4 KB 15000 rows. . exported \"TEST\".\"TTB04\" 513.7 KB 10000 rows. . exported \"TEST\".\"TTB03\" 361.4 KB 7000 rowsProcessing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMA. . exported \"TEST\".\"TTB02\" 310.6 KB 6000 rows. . exported \"TEST\".\"TTB01\" 259.9 KB 5000 rows. . exported \"TEST\".\"TTB06\" 5.015 KB 1 rowsProcessing object type SCHEMA_EXPORT/TABLE/TABLEProcessing object type SCHEMA_EXPORT/TABLE/COMMENTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/INDEXProcessing object type SCHEMA_EXPORT/TABLE/CONSTRAINT/CONSTRAINTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICSProcessing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICSMaster table \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully loaded/unloaded******************************************************************************Dump file set for TEST.SYS_EXPORT_SCHEMA_01 is: /backups/test_expdp_20200313_01.dmp /backups/test_expdp_20200313_02.dmp /backups/test_expdp_20200313_03.dmpJob \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully completed at Fri Mar 13 00:59:35 2020 elapsed 0 00:00:12 通过attach观察，数据量较小时，开启并行也只有一个进程在工作，其他的进程处于等待状态，可启用进程数等于：预估数据量 % 250M来计算 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455[oracle@ystdb11g backups]$ expdp test/test attach=SYS_EXPORT_SCHEMA_01Export: Release 11.2.0.4.0 - Production on Fri Mar 13 01:28:03 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsJob: SYS_EXPORT_SCHEMA_01 Owner: TEST Operation: EXPORT Creator Privs: TRUE GUID: A0ACACA983CE325AE0530C70A8C0453C Start Time: Friday, 13 March, 2020 1:28:00 Mode: SCHEMA Instance: ystdb Max Parallelism: 4 EXPORT Job Parameters: Parameter Name Parameter Value: CLIENT_COMMAND test/********@ystdb directory=dir_dmp dumpfile=test_expdp_20200313_%U.dmp logfile=test_expdp_20200313_4.log schemas=test parallel=4 State: EXECUTING Bytes Processed: 10,219,928 Percent Done: 99 Current Parallelism: 4 Job Error Count: 0 Dump File: /backups/test_expdp_20200313_%u.dmp Dump File: /backups/test_expdp_20200313_01.dmp bytes written: 4,096 Dump File: /backups/test_expdp_20200313_02.dmp bytes written: 1,499,136 Dump File: /backups/test_expdp_20200313_03.dmp bytes written: 8,744,960 Worker 1 Status: Process Name: DW00 State: EXECUTING Object Schema: TEST Object Type: SCHEMA_EXPORT/DEFAULT_ROLE Completed Objects: 1 Total Objects: 1 Worker Parallelism: 1 Worker 2 Status: Process Name: DW01 State: WORK WAITING Worker 3 Status: Process Name: DW02 State: WORK WAITING Worker 4 Status: Process Name: DW03 State: WORK WAITING version参数指定导出的数据库版本，关键字compatible 123456789101112131415161718192021222324252627282930313233343536373839404142434445SQL&gt; show parameter compatibleNAME TYPE VALUE------------------------------------ ----------- ------------------------------compatible string 11.2.0.4.0[oracle@ystdb11g backups]$ expdp test@ystdb directory=dir_dmp dumpfile=test_expdp_11.2.0.4.0_%U.dmp logfile=test_expdp_11.2.0.4.0_4.log schemas=test version=11.2.0.4.0Export: Release 11.2.0.4.0 - Production on Fri Mar 13 01:46:27 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsStarting \"TEST\".\"SYS_EXPORT_SCHEMA_01\": test/********@ystdb directory=dir_dmp dumpfile=test_expdp_11.2.0.4.0_%U.dmp logfile=test_expdp_11.2.0.4.0_4.log schemas=test version=11.2.0.4.0Estimate in progress using BLOCKS method...Processing object type SCHEMA_EXPORT/TABLE/TABLE_DATATotal estimation using BLOCKS method: 12.06 MBProcessing object type SCHEMA_EXPORT/USERProcessing object type SCHEMA_EXPORT/SYSTEM_GRANTProcessing object type SCHEMA_EXPORT/ROLE_GRANTProcessing object type SCHEMA_EXPORT/DEFAULT_ROLEProcessing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMAProcessing object type SCHEMA_EXPORT/TABLE/TABLEProcessing object type SCHEMA_EXPORT/TABLE/COMMENTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/INDEXProcessing object type SCHEMA_EXPORT/TABLE/CONSTRAINT/CONSTRAINTProcessing object type SCHEMA_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICSProcessing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS. . exported \"TEST\".\"TTB07\" 7.575 MB 150000 rows. . exported \"TEST\".\"TTB05\" 772.4 KB 15000 rows. . exported \"TEST\".\"TTB04\" 513.7 KB 10000 rows. . exported \"TEST\".\"TTB03\" 361.4 KB 7000 rows. . exported \"TEST\".\"TTB02\" 310.6 KB 6000 rows. . exported \"TEST\".\"TTB01\" 259.9 KB 5000 rows. . exported \"TEST\".\"TTB06\" 5.015 KB 1 rowsMaster table \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully loaded/unloaded******************************************************************************Dump file set for TEST.SYS_EXPORT_SCHEMA_01 is: /backups/test_expdp_11.2.0.4.0_01.dmpJob \"TEST\".\"SYS_EXPORT_SCHEMA_01\" successfully completed at Fri Mar 13 01:46:44 2020 elapsed 0 00:00:12 IMPDP 完全 12[oracle@ystdb11g backups]$ impdp system@ystdb directory=dir_dmp dumpfile=full_expdp_20200313.dmp logfile=full_impdp_20200313.log full=y IMPDP 用户 12[oracle@ystdb11g backups]$ impdp test@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_imp_20200313.log schemas=test IMPDP 表空间 12[oracle@ystdb11g backups]$ impdp test@ystdb directory=dir_dmp dumpfile=tbs_test_expdp_20200313.dmp logfile=tbs_test_impdp_20200313.log tablespaces=TEST IMPDP 表 12[oracle@ystdb11g backups]$ impdp test@ystdb directory=dir_dmp dumpfile=test_ttb01_expdp_20200313.dmp logfile=test_ttb01_impdp_20200313.log tables=TTB01 remap_schema，导入时重新指定用户，多个用户以英文逗号隔开 12345678910111213141516171819202122232425262728293031[oracle@ystdb11g backups]$ impdp sh@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_impdp_20200313.log remap_schema=test:shImport: Release 11.2.0.4.0 - Production on Fri Mar 13 02:09:25 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsMaster table \"SH\".\"SYS_IMPORT_FULL_01\" successfully loaded/unloadedStarting \"SH\".\"SYS_IMPORT_FULL_01\": sh/********@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_impdp_20200313.log remap_schema=test:shProcessing object type SCHEMA_EXPORT/USERORA-31684: Object type USER:\"SH\" already existsProcessing object type SCHEMA_EXPORT/SYSTEM_GRANTProcessing object type SCHEMA_EXPORT/ROLE_GRANTProcessing object type SCHEMA_EXPORT/DEFAULT_ROLEProcessing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMAProcessing object type SCHEMA_EXPORT/TABLE/TABLEProcessing object type SCHEMA_EXPORT/TABLE/TABLE_DATA. . imported \"SH\".\"TTB07\" 7.575 MB 150000 rows. . imported \"SH\".\"TTB05\" 772.4 KB 15000 rows. . imported \"SH\".\"TTB04\" 513.7 KB 10000 rows. . imported \"SH\".\"TTB03\" 361.4 KB 7000 rows. . imported \"SH\".\"TTB02\" 310.6 KB 6000 rows. . imported \"SH\".\"TTB01\" 259.9 KB 5000 rows. . imported \"SH\".\"TTB06\" 5.015 KB 1 rowsProcessing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICSJob \"SH\".\"SYS_IMPORT_FULL_01\" completed with 1 error(s) at Fri Mar 13 02:09:28 2020 elapsed 0 00:00:01 remap_tablespace，导入时重新指定表空间，多个表空间以英文逗号隔开 12345678910111213141516171819202122232425262728293031[oracle@ystdb11g backups]$ impdp test@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_impdp_20200313.log remap_tablespace=test:shtbsImport: Release 11.2.0.4.0 - Production on Fri Mar 13 02:16:14 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsMaster table \"TEST\".\"SYS_IMPORT_FULL_01\" successfully loaded/unloadedStarting \"TEST\".\"SYS_IMPORT_FULL_01\": test/********@ystdb directory=dir_dmp dumpfile=test_expdp_20200313.dmp logfile=test_impdp_20200313.log remap_tablespace=test:shtbsProcessing object type SCHEMA_EXPORT/USERORA-31684: Object type USER:\"TEST\" already existsProcessing object type SCHEMA_EXPORT/SYSTEM_GRANTProcessing object type SCHEMA_EXPORT/ROLE_GRANTProcessing object type SCHEMA_EXPORT/DEFAULT_ROLEProcessing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMAProcessing object type SCHEMA_EXPORT/TABLE/TABLEProcessing object type SCHEMA_EXPORT/TABLE/TABLE_DATA. . imported \"TEST\".\"TTB07\" 7.575 MB 150000 rows. . imported \"TEST\".\"TTB05\" 772.4 KB 15000 rows. . imported \"TEST\".\"TTB04\" 513.7 KB 10000 rows. . imported \"TEST\".\"TTB03\" 361.4 KB 7000 rows. . imported \"TEST\".\"TTB02\" 310.6 KB 6000 rows. . imported \"TEST\".\"TTB01\" 259.9 KB 5000 rows. . imported \"TEST\".\"TTB06\" 5.015 KB 1 rowsProcessing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICSJob \"TEST\".\"SYS_IMPORT_FULL_01\" completed with 1 error(s) at Fri Mar 13 02:16:19 2020 elapsed 0 00:00:01","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"EXPDP","slug":"EXPDP","permalink":"http://mudbub.com/tags/EXPDP/"},{"name":"IMPDP","slug":"IMPDP","permalink":"http://mudbub.com/tags/IMPDP/"}],"author":["Falkon"]},{"title":"Oracle 导入导出工具的基本使用","slug":"database/exp-imp","date":"2021-01-27T09:37:22.567Z","updated":"2021-03-26T10:21:28.510Z","comments":true,"path":"2021/01/27/database/exp-imp/","link":"","permalink":"http://mudbub.com/2021/01/27/database/exp-imp/","excerpt":"exp/imp的使用方法主要有三种方式（完全、用户、表），需要dba权限 EXP 完全 12[oracle@ystdb11g ~]$ exp system@ystdb file=/backups/full_exp_20200313.dmp log=/backups/full_exp_20200313.log full=y","text":"exp/imp的使用方法主要有三种方式（完全、用户、表），需要dba权限 EXP 完全 12[oracle@ystdb11g ~]$ exp system@ystdb file=/backups/full_exp_20200313.dmp log=/backups/full_exp_20200313.log full=y EXP 用户 12345678910111213141516171819202122232425262728293031323334353637383940414243444546[oracle@ystdb11g ~]$ exp test@ystdb file=/backups/test_exp_20200313.dmp log=/backups/test_exp_20200313.log owner=testExport: Release 11.2.0.4.0 - Production on Thu Mar 12 23:07:45 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsExport done in AL32UTF8 character set and AL16UTF16 NCHAR character setAbout to export specified users .... exporting pre-schema procedural objects and actions. exporting foreign function library names for user TEST. exporting PUBLIC type synonyms. exporting private type synonyms. exporting object type definitions for user TESTAbout to export TEST's objects .... exporting database links. exporting sequence numbers. exporting cluster definitions. about to export TEST's tables via Conventional Path .... . exporting table TTB01 5000 rows exported. . exporting table TTB02 6000 rows exported. . exporting table TTB03 7000 rows exported. . exporting table TTB04 10000 rows exported. . exporting table TTB05 15000 rows exported. exporting synonyms. exporting views. exporting stored procedures. exporting operators. exporting referential integrity constraints. exporting triggers. exporting indextypes. exporting bitmap, functional and extensible indexes. exporting posttables actions. exporting materialized views. exporting snapshot logs. exporting job queues. exporting refresh groups and children. exporting dimensions. exporting post-schema procedural objects and actions. exporting statisticsExport terminated successfully without warnings. EXP 表 12345678910111213141516[oracle@ystdb11g ~]$ exp test@ystdb file=/backups/test_ttb01_exp_20200313.dmp log=/backups/test_ttb01_exp_20200313.log tables=TTB01Export: Release 11.2.0.4.0 - Production on Thu Mar 12 23:23:05 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsExport done in AL32UTF8 character set and AL16UTF16 NCHAR character setAbout to export specified tables via Conventional Path .... . exporting table TTB01 5000 rows exportedExport terminated successfully without warnings. IMP 完全 12[oracle@ystdb11g ~]$ imp system@ystdb file=/backups/full_exp_20200313.dmp log=/backups/full_imp_20200313.log full=y IMP 用户 1234567891011121314151617181920[oracle@ystdb11g ~]$ imp test@ystdb file=/backups/test_exp_20200313.dmp log=/backups/test_imp_20200313.log fromuser=test touser=testImport: Release 11.2.0.4.0 - Production on Thu Mar 12 23:49:14 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsExport file created by EXPORT:V11.02.00 via conventional pathimport done in AL32UTF8 character set and AL16UTF16 NCHAR character set. . importing table \"TTB01\" 5000 rows imported. . importing table \"TTB02\" 6000 rows imported. . importing table \"TTB03\" 7000 rows imported. . importing table \"TTB04\" 10000 rows imported. . importing table \"TTB05\" 15000 rows importedImport terminated successfully without warnings. IMP 表 123456789101112131415161718[oracle@ystdb11g backups]$ imp test@ystdb file=/backups/test_ttb02_exp_20200313.dmp log=/backups/test_ttb02_imp_20200313.log tables=TTB02Import: Release 11.2.0.4.0 - Production on Thu Mar 12 23:58:57 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsExport file created by EXPORT:V11.02.00 via conventional pathimport done in AL32UTF8 character set and AL16UTF16 NCHAR character set. importing TEST's objects into TEST. importing TEST's objects into TEST. . importing table \"TTB02\" 6000 rows importedImport terminated successfully without warnings. EXP-00091: Exporting questionable statistics出现EXP-00091: Exporting questionable statistics的原因是因为客户端的字符集和数据库的字符集不一致，根据数据库的字符集修改客户端的字符集即可 123456SQL&gt; col value for a20SQL&gt; select * from nls_database_parameters where parameter like 'NLS_CHAR%';PARAMETER VALUE------------------------------ --------------------NLS_CHARACTERSET AL32UTF8 Linux系统临时修改，永久需要在Oracle用户的.bash_profile文件中增加 1[oracle@ystdb11g ~]$ export NLS_LANG=AMERICAN_AMERICA.AL32UTF8 Windows系统临时修改，永久修改需要添加系统环境环境变量 1C:\\Users\\Falkon&gt;set NLS_LANG=AMERICAN_AMERICA.AL32UTF8 如果导出的dmp文件没有明确的命名和表示，那么我们将不能确认导出的方式是exp还是expdp，在使用impdp导入的时候将会报如下错误 12345678910111213[oracle@ystdb11g backups]$ impdp test@ystdb file=/backups/test_exp_20200313.dmp log=/backups/test_imp_20200313.log fromuser=test touser=testImport: Release 11.2.0.4.0 - Production on Fri Mar 13 00:02:32 2020Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.Password:Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsORA-39002: invalid operationORA-39070: Unable to open the log file.ORA-39088: file name cannot contain a path specification 关于exp buffer的说明官网说明链接 https://docs.oracle.com/cd/A84870_01/doc/server.816/a76955/ch01.htmDefault: operating system-dependent. See your Oracle operating system-specific documentation to determine the default value for this parameter. Specifies the size, in bytes, of the buffer used to fetch rows. As a result, this parameter determines the maximum number of rows in an array fetched by Export. Use the following formula to calculate the buffer size: buffer_size = rows_in_array * maximum_row_size If you specify zero, the Export utility fetches only one row at a time.Tables with LONG, LOB, BFILE, REF, ROWID, LOGICAL ROWID, DATE, or type columns are fetched one row at a time.Note: The BUFFER parameter applies only to conventional path Export. It has no effect on a direct path Export. ExampleThis section shows an example of how to calculate buffer size.Consider that the following table is created: create table sample (name varchar(30), weight number); The maximum size of the name column is 30, plus 2 bytes for the indicator. The maximum size of the weight column is 22 (the size of the internal representation for Oracle numbers), plus 2 bytes for the indicator.Therefore, the maximum row size is 56 (30+2+22+2).To perform array operations for 100 rows, a buffer size of 5600 should be specified. 对于数据量较大的可以通过设置buffer来增加导出的速度，具体的计算方式：需要导出的行数 * （每个字段的字节数+2）","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"EXP","slug":"EXP","permalink":"http://mudbub.com/tags/EXP/"},{"name":"IMP","slug":"IMP","permalink":"http://mudbub.com/tags/IMP/"}],"author":["Falkon"]},{"title":"EMCC 13.4启动遭遇Oracle Management Server Could Not Be Started","slug":"database/emcc134-oracle-management-server-could-not-be-started","date":"2021-01-27T09:37:22.561Z","updated":"2021-03-26T10:21:12.314Z","comments":true,"path":"2021/01/27/database/emcc134-oracle-management-server-could-not-be-started/","link":"","permalink":"http://mudbub.com/2021/01/27/database/emcc134-oracle-management-server-could-not-be-started/","excerpt":"","text":"EMCC 13.4启动遭遇Oracle Management Server Could Not Be Started123456789101112[oracle@pe-dbmonitor-emcc bin]$ ./emctl start omsOracle Enterprise Manager Cloud Control 13c Release 4 Copyright (c) 1996, 2020 Oracle Corporation. All rights reserved.Starting Oracle Management Server...WebTier Successfully StartedOracle Management Server Could Not Be StartedCheck EM Server log file for details: /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/servers/EMGC_OMS1/logs/EMGC_OMS1.outAdminServer Could Not Be StartedCheck Admin Server log file for details: /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/servers/EMGC_ADMINSERVER/logs/EMGC_ADMINSERVER.outOracle Management Server is DownJVMD Engine is DownStarting BI Publisher Server ... 查看具体日志 123456789101112131415161718192021222324252627282930313233343536373839404142434445[oracle@pe-dbmonitor-emcc ~]$ more /u01/app/oracle/gc_inst/user_projects/domains/GCDomain/servers/EMGC_OMS1/logs/EMGC_OMS1.outJul 31, 2020 6:08:19 PM oracle.security.jps.internal.policystore.util.JpsDataManagerUtil getDBConnectionWARNING: Can not connect DB with URL jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=10.10.251.102)(PORT=1521)))(CONNECT_DATA=(SID=emcc))) &lt;&lt;&lt;&lt;&lt;&lt;java.sql.SQLRecoverableException: IO Error: The Network Adapter could not establish the connection at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:775) at oracle.jdbc.driver.PhysicalConnection.connect(PhysicalConnection.java:819) at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:40) at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:704) at java.sql.DriverManager.getConnection(DriverManager.java:664) at java.sql.DriverManager.getConnection(DriverManager.java:208) at oracle.security.jps.internal.policystore.util.JpsDataManagerUtil.getDBConnection(JpsDataManagerUtil.java:405) at oracle.security.jps.internal.policystore.util.JpsDataManagerUtil.isNewSchema(JpsDataManagerUtil.java:246) at oracle.security.jps.internal.core.datamanager.DataManagerFactoryImpl.isNewSchema(DataManagerFactoryImpl.java:252) at oracle.security.jps.internal.core.datamanager.DataManagerFactoryImpl.getDBDataManager(DataManagerFactoryImpl.java:320) at oracle.security.jps.internal.core.datamanager.DataManagerFactoryImpl.getDataManager(DataManagerFactoryImpl.java:186) at oracle.security.jps.internal.core.datamanager.DataManagerFactoryImpl.getDataManager(DataManagerFactoryImpl.java:137) at oracle.security.jps.internal.common.config.AbstractSecurityStore.createDataManager(AbstractSecurityStore.java:96) at oracle.security.jps.internal.common.config.AbstractSecurityStore.getSecurityStoreVersionInternal(AbstractSecurityStore.java:164) at oracle.security.jps.internal.common.config.AbstractSecurityStore.getSecurityStoreVersion(AbstractSecurityStore.java:146) at oracle.security.jps.internal.credstore.ldap.LdapCredentialStore.init(LdapCredentialStore.java:185) at oracle.security.jps.internal.credstore.ldap.LdapCredentialStore.start(LdapCredentialStore.java:1020) at oracle.security.opss.internal.runtime.ServiceContextImpl.start(ServiceContextImpl.java:220) at oracle.security.opss.internal.runtime.ServiceContextManagerImpl.createDefaultContext(ServiceContextManagerImpl.java:325) at oracle.security.opss.internal.runtime.ServiceContextManagerImpl.initialize(ServiceContextManagerImpl.java:242) at oracle.security.jps.internal.config.OpssCommonStartup$1.run(OpssCommonStartup.java:166) at java.security.AccessController.doPrivileged(Native Method) at oracle.security.jps.internal.config.OpssCommonStartup.start(OpssCommonStartup.java:159) at oracle.security.jps.wls.JpsWlsStartup.start(JpsWlsStartup.java:105) at oracle.security.jps.JpsStartup.startWithRetry(JpsStartup.java:287) at oracle.security.jps.JpsStartup.start(JpsStartup.java:252) at oracle.security.jps.wls.JpsDefaultService.start(JpsDefaultService.java:103) at weblogic.server.AbstractServerService.postConstruct(AbstractServerService.java:76) at sun.reflect.GeneratedMethodAccessor26.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.glassfish.hk2.utilities.reflection.ReflectionHelper.invoke(ReflectionHelper.java:1287) at org.jvnet.hk2.internal.ClazzCreator.postConstructMe(ClazzCreator.java:333) at org.jvnet.hk2.internal.ClazzCreator.create(ClazzCreator.java:375) at org.jvnet.hk2.internal.SystemDescriptor.create(SystemDescriptor.java:487) at org.glassfish.hk2.runlevel.internal.AsyncRunLevelContext.findOrCreate(AsyncRunLevelContext.java:305) at org.glassfish.hk2.runlevel.RunLevelContext.findOrCreate(RunLevelContext.java:85) at org.jvnet.hk2.internal.Utilities.createService(Utilities.java:2126) at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:116) at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:90) at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunner.oneJob(CurrentTaskFuture.java:1237) 发现无法连接到DB，检查监听 12345678910111213141516[oracle@pe-dbmonitor-emcc ~]$ lsnrctl statusLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 02-DEC-2020 15:45:22Copyright (c) 1991, 2019, Oracle. All rights reserved.Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=pe-dbmonitor-emcc)(PORT=1521)))TNS-12541: TNS:no listener TNS-12560: TNS:protocol adapter error TNS-00511: No listener Linux Error: 111: Connection refusedConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))TNS-12541: TNS:no listener TNS-12560: TNS:protocol adapter error TNS-00511: No listener Linux Error: 2: No such file or directory 启动监听后，再启动OMS 1234567891011[oracle@pe-dbmonitor-emcc bin]$ ./emctl start omsOracle Enterprise Manager Cloud Control 13c Release 4 Copyright (c) 1996, 2020 Oracle Corporation. All rights reserved.Starting Oracle Management Server...WebTier Successfully StartedOracle Management Server Successfully StartedOracle Management Server is UpJVMD Engine is UpStarting BI Publisher Server ...BI Publisher Server Successfully StartedBI Publisher Server is Up","categories":[{"name":"Oracle Enterprise Manager Cloud Control","slug":"Oracle-Enterprise-Manager-Cloud-Control","permalink":"http://mudbub.com/categories/Oracle-Enterprise-Manager-Cloud-Control/"}],"tags":[{"name":"EMCC","slug":"EMCC","permalink":"http://mudbub.com/tags/EMCC/"}],"author":["Falkon"]},{"title":"ASM中的Req_mir_free_MB实验","slug":"database/asm-req_mir_free_mb-test","date":"2021-01-27T09:37:22.554Z","updated":"2021-04-20T07:35:07.595Z","comments":true,"path":"2021/01/27/database/asm-req_mir_free_mb-test/","link":"","permalink":"http://mudbub.com/2021/01/27/database/asm-req_mir_free_mb-test/","excerpt":"先看下官网对lsdg给出的各个列属性的说明 属性 描述 State State of the disk group. Values include BROKEN, CONNECTED, DISMOUNTED, MOUNTED, QUIESCING, and UNKNOWN. Type Disk group redundancy (NORMAL, HIGH, EXTERNAL). Rebal Y if a rebalance operation is in progress. Sector Sector size in bytes. Block Block size in bytes. AU Allocation unit size in bytes. Total_MB Size of the disk group in megabytes. Free_MB Free space in the disk group in megabytes, without regard to redundancy. From the V$ASM_DISKGROUP view. Req_mir_free_MB Amount of space that must be available in the disk group to restore full redundancy after the most severe failure that can be tolerated by the disk group. This is the REQUIRED_MIRROR_FREE_MB column from the V$ASM_DISKGROUP view. Usable_file_MB Amount of free space, adjusted for mirroring, that is available for new files. From the V$ASM_DISKGROUP view. Offline_disks Number of offline disks in the disk group. Offline disks are eventually dropped. Voting_files Specifies whether the disk group contains voting files (Y or N). Name Disk group name.","text":"先看下官网对lsdg给出的各个列属性的说明 属性 描述 State State of the disk group. Values include BROKEN, CONNECTED, DISMOUNTED, MOUNTED, QUIESCING, and UNKNOWN. Type Disk group redundancy (NORMAL, HIGH, EXTERNAL). Rebal Y if a rebalance operation is in progress. Sector Sector size in bytes. Block Block size in bytes. AU Allocation unit size in bytes. Total_MB Size of the disk group in megabytes. Free_MB Free space in the disk group in megabytes, without regard to redundancy. From the V$ASM_DISKGROUP view. Req_mir_free_MB Amount of space that must be available in the disk group to restore full redundancy after the most severe failure that can be tolerated by the disk group. This is the REQUIRED_MIRROR_FREE_MB column from the V$ASM_DISKGROUP view. Usable_file_MB Amount of free space, adjusted for mirroring, that is available for new files. From the V$ASM_DISKGROUP view. Offline_disks Number of offline disks in the disk group. Offline disks are eventually dropped. Voting_files Specifies whether the disk group contains voting files (Y or N). Name Disk group name. 从描述上看：Free_MB是不考虑冗余度的空闲空间，从V$ASM_DISKGROUP视图和lsdg命令都可以获得相关容量，也就是说如果的你ASM磁盘组是基于External，那么磁盘组在未使用的情况下，TOTAL_MB约等于FREE_MB，少的空间为ASM元数据占用，FREE_MB等于USABLE_FILE_MB，REQUIRED_MIRROR_FREE_MB等于0，因为没有独立FAILGROUP，冗余是基于存储本身的RAID技术进行冗余 12345678910111213141516171819202122[grid@testdb12c01 ~]$ sqlplus / as sysasmSQL*Plus: Release 12.1.0.2.0 Production on Sun Mar 22 00:26:20 2020Copyright (c) 1982, 2014, Oracle. All rights reserved.Connected to:Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit ProductionWith the Real Application Clusters and Automatic Storage Management optionsSQL&gt; create diskgroup GP_EXTERNAL external redundancy disk '/dev/asmdisk/TESTDISK01';Diskgroup created.SQL&gt; col name for a20SQL&gt; set linesize 200SQL&gt; select group_number,name,type,state,total_mb,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup where name='GP_EXTERNAL';GROUP_NUMBER NAME TYPE STATE TOTAL_MB FREE_MB REQUIRED_MIRROR_FREE_MB USABLE_FILE_MB------------ ------------- ------ ----------- ---------- -------- ----------------------- -------------- 4 GP_EXTERNAL EXTERN MOUNTED 1024 974 0 974 查看FAILGROUP，发现FAILGROUP等于磁盘本身 12345SQL&gt; select group_number,name,failgroup from v$asm_disk where group_number=4;GROUP_NUMBER NAME FAILGROUP------------ -------------------- ------------------------------ 4 GP_EXTERNAL_0000 GP_EXTERNAL_0000 创建一个表空间看看会发生什么，发现每个段只有1份，在0号磁盘上进行了复制，copy=1 1234567891011121314151617181920212223242526272829303132333435363738SQL&gt; create tablespace ext_test datafile '+GP_EXTERNAL' size 1m;Tablespace created.SQL&gt; col tablespace_name for a15SQL&gt; col file_name for a100SQL&gt; set linesize 200SQL&gt; select tablespace_name,file_name from dba_data_files where tablespace_name='EXTER01';TABLESPACE_NAME FILE_NAME--------------- ---------------------------------------------------------------------------------EXTER01 +GP_EXTERNAL/PRODDB/A14CD6FDD3B55795E0531570A8C04632/DATAFILE/exter01.256.1035685075SQL&gt; SELECT disk_kffxp disk#, xnum_kffxp extent#, CASE lxn_kffxp WHEN 0 THEN 'Primary Copy' WHEN 1 THEN 'Mirrored Copy' WHEN 2 THEN '2nd Mirrored Copy or metadata' ELSE 'Unknown' END typeFROM x$kffxpWHERE number_kffxp = 256 AND group_kffxp = 4ORDER BY 2; DISK# EXTENT# TYPE---------- ---------- ----------------------------- 0 0 Primary Copy 0 1 Primary Copy 基于normal，normal是双重数据镜像，至少要求有两块磁盘，按照最少要求两块磁盘创建，发现REQUIRED_MIRROR_FREE_MB依旧等于等于0 12345678SQL&gt; create diskgroup GP_NORMAL normal redundancy disk '/dev/asmdisk/TESTDISK02','/dev/asmdisk/TESTDISK03';Diskgroup created.SQL&gt; select group_number,name,type,state,total_mb,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup where name='GP_NORMAL';GROUP_NUMBER NAME TYPE STATE TOTAL_MB FREE_MB REQUIRED_MIRROR_FREE_MB USABLE_FILE_MB------------ ------------- ------ ----------- ---------- ---------- --------------------- -------------- 5 GP_NORMAL NORMAL MOUNTED 2048 1946 0 973 查看FAILGROUP，发现FAILGROUP依旧等于等于磁盘本身，没有多余的磁盘来提供给Req_mir_free_MB使用 123456SQL&gt; select group_number,name,failgroup from v$asm_disk where group_number=5;GROUP_NUMBER NAME FAILGROUP------------ ------------------------------ ------------------------------ 5 GP_NORMAL_0001 GP_NORMAL_0001 5 GP_NORMAL_0000 GP_NORMAL_0000 创建一个表空间看看会发生什么，发现每个段被分成了两份，在0号磁盘和1号磁盘上，copy=2 12345678910111213141516171819202122232425262728293031323334353637SQL&gt; create tablespace normal01 datafile '+GP_NORMAL' size 1m;Tablespace created.SQL&gt; select tablespace_name,file_name from dba_data_files where tablespace_name='NORMAL01';TABLESPACE_NAME FILE_NAME--------------- --------------------------------------------------------------------------------NORMAL01 +GP_NORMAL/PRODDB/A14CD6FDD3B55795E0531570A8C04632/DATAFILE/normal01.256.1035685391SQL&gt; SELECT disk_kffxp disk#, xnum_kffxp extent#, CASE lxn_kffxp WHEN 0 THEN 'Primary Copy' WHEN 1 THEN 'Mirrored Copy' WHEN 2 THEN '2nd Mirrored Copy or metadata' ELSE 'Unknown' END typeFROM x$kffxpWHERE number_kffxp = 256 AND group_kffxp = 5ORDER BY 2; DISK# EXTENT# TYPE---------- ---------- ----------------------------- 1 0 Primary Copy 0 0 Mirrored Copy 0 1 Primary Copy 1 1 Mirrored Copy Req_mir_free_MB是在磁盘组出现故障之后，磁盘组组必须有足够的空间来重新定义冗余度，normal模式，使用三块磁盘创建磁盘组，创建完成后发现REQUIRED_MIRROR_FREE_MB的空间为1G，是一块物理磁盘大小，也就意味着如果在创建的磁盘组的时候，按照最小要求磁盘数（normal最小2块、high最小3块）去创建的话，磁盘组的冗余只能是基于磁盘本身，当超出最小磁盘组要求的磁盘数时，会取其中的一块（normal）或两块（high）做为REQUIRED_MIRROR_FREE_MB的空间 123456789SQL&gt; create diskgroup GP_NORMAL01 normal redundancy disk '/dev/asmdisk/TESTDISK04','/dev/asmdisk/TESTDISK05','/dev/asmdisk/TESTDISK06';Diskgroup created.SQL&gt; select group_number,name,type,state,total_mb,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup where name='GP_NORMAL01';GROUP_NUMBER NAME TYPE STATE TOTAL_MB FREE_MB REQUIRED_MIRROR_FREE_MB USABLE_FILE_MB------------ ---------- --------- ------ ---------- ---------- --------------------- -------------- 6 GP_NORMAL01 NORMAL MOUNTED 3072 2919 1024 947 查看FAILGROUP，发现FAILGROUP多出来一块磁盘，REQUIRED_MIRROR_FREE_MB空间等于多出来的那块磁盘 1234567SQL&gt; select group_number,name,failgroup from v$asm_disk where group_number=6;GROUP_NUMBER NAME FAILGROUP------------ ------------------------------ ------------------------------ 6 GP_NORMAL01_0002 GP_NORMAL01_0002 6 GP_NORMAL01_0001 GP_NORMAL01_0001 6 GP_NORMAL01_0000 GP_NORMAL01_0000 在继续创建一个表空间，看看复制情况，发现每个段依旧被分成了两份，随机写入到0、1、2号磁盘，copy=2 12345678910111213141516171819202122232425262728293031323334353637SQL&gt; create tablespace normal02 datafile '+GP_NORMAL01' size 1m;Tablespace created.SQL&gt; select tablespace_name,file_name from dba_data_files where tablespace_name='NORMAL02';TABLESPACE_NAME FILE_NAME--------------- ---------------------------------------------------------------------------------NORMAL02 +GP_NORMAL01/PRODDB/A14CD6FDD3B55795E0531570A8C04632/DATAFILE/normal02.256.1035689003SQL&gt; SELECT disk_kffxp disk#, xnum_kffxp extent#, CASE lxn_kffxp WHEN 0 THEN 'Primary Copy' WHEN 1 THEN 'Mirrored Copy' WHEN 2 THEN '2nd Mirrored Copy or metadata' ELSE 'Unknown' END typeFROM x$kffxpWHERE number_kffxp = 256 AND group_kffxp = 6ORDER BY 2; DISK# EXTENT# TYPE---------- ---------- ----------------------------- 0 0 Primary Copy 2 0 Mirrored Copy 1 1 Primary Copy 2 1 Mirrored Copy 第二次创建表空间，观察段写入情况 12345678910111213141516171819202122232425262728293031323334353637SQL&gt; create tablespace normal03 datafile '+GP_NORMAL01' size 1m;Tablespace created.SQL&gt; select tablespace_name,file_name from dba_data_files where tablespace_name='NORMAL03';TABLESPACE_NAME FILE_NAME--------------- ---------------------------------------------------------------------------------NORMAL03 +GP_NORMAL01/PRODDB/A14CD6FDD3B55795E0531570A8C04632/DATAFILE/normal03.257.1035693469SQL&gt; SELECT disk_kffxp disk#, xnum_kffxp extent#, CASE lxn_kffxp WHEN 0 THEN 'Primary Copy' WHEN 1 THEN 'Mirrored Copy' WHEN 2 THEN '2nd Mirrored Copy or metadata' ELSE 'Unknown' END typeFROM x$kffxpWHERE number_kffxp = 257 AND group_kffxp = 6ORDER BY 2; DISK# EXTENT# TYPE---------- ---------- ----------------------------- 1 0 Primary Copy 0 0 Mirrored Copy 2 1 Primary Copy 0 1 Mirrored Copy Usable_file_MB是在满足了冗余度之后，还有多少剩余空间可使用，通过上面的实验发现，Usable_file_MB本身就是在满足冗余度之后，还有多少剩余空间可用，也可以使用（Free_MB - Req_mir_free_MB）/ 冗余度 = 剩余可用空间，尝试来计算下，在external模式下为：（974 - 0）/ 1 = 974，在normal模式下：（1946 - 0）/ 2 = 973，在normal模式带Req_mir_free_MB空间下：（2919 - 1024） / 2 = 947.5，因为是MB所以小数部分不显示","categories":[{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"}],"tags":[{"name":"Req_mir_free_MB","slug":"Req-mir-free-MB","permalink":"http://mudbub.com/tags/Req-mir-free-MB/"},{"name":"ASM","slug":"ASM","permalink":"http://mudbub.com/tags/ASM/"}],"author":["Falkon"]}],"categories":[{"name":"PostgreSQL","slug":"PostgreSQL","permalink":"http://mudbub.com/categories/PostgreSQL/"},{"name":"Oracle Database Appliance","slug":"Oracle-Database-Appliance","permalink":"http://mudbub.com/categories/Oracle-Database-Appliance/"},{"name":"Oracle","slug":"Oracle","permalink":"http://mudbub.com/categories/Oracle/"},{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/categories/Linux/"},{"name":"DevOps","slug":"DevOps","permalink":"http://mudbub.com/categories/DevOps/"},{"name":"NAS","slug":"NAS","permalink":"http://mudbub.com/categories/NAS/"},{"name":"Oracle Enterprise Manager Cloud Control","slug":"Oracle-Enterprise-Manager-Cloud-Control","permalink":"http://mudbub.com/categories/Oracle-Enterprise-Manager-Cloud-Control/"},{"name":"SQL Server","slug":"SQL-Server","permalink":"http://mudbub.com/categories/SQL-Server/"},{"name":"MySQL","slug":"MySQL","permalink":"http://mudbub.com/categories/MySQL/"}],"tags":[{"name":"Install","slug":"Install","permalink":"http://mudbub.com/tags/Install/"},{"name":"PostgreSQL","slug":"PostgreSQL","permalink":"http://mudbub.com/tags/PostgreSQL/"},{"name":"Ksplice","slug":"Ksplice","permalink":"http://mudbub.com/tags/Ksplice/"},{"name":"Datafile","slug":"Datafile","permalink":"http://mudbub.com/tags/Datafile/"},{"name":"SSH","slug":"SSH","permalink":"http://mudbub.com/tags/SSH/"},{"name":"ALUA","slug":"ALUA","permalink":"http://mudbub.com/tags/ALUA/"},{"name":"SYS","slug":"SYS","permalink":"http://mudbub.com/tags/SYS/"},{"name":"ORA-01031","slug":"ORA-01031","permalink":"http://mudbub.com/tags/ORA-01031/"},{"name":"ODA","slug":"ODA","permalink":"http://mudbub.com/tags/ODA/"},{"name":"RAID","slug":"RAID","permalink":"http://mudbub.com/tags/RAID/"},{"name":"Recovery","slug":"Recovery","permalink":"http://mudbub.com/tags/Recovery/"},{"name":"Flashback","slug":"Flashback","permalink":"http://mudbub.com/tags/Flashback/"},{"name":"Parse","slug":"Parse","permalink":"http://mudbub.com/tags/Parse/"},{"name":"Crontab","slug":"Crontab","permalink":"http://mudbub.com/tags/Crontab/"},{"name":"Docker","slug":"Docker","permalink":"http://mudbub.com/tags/Docker/"},{"name":"MySQL","slug":"MySQL","permalink":"http://mudbub.com/tags/MySQL/"},{"name":"Zabbix","slug":"Zabbix","permalink":"http://mudbub.com/tags/Zabbix/"},{"name":"Openfiler","slug":"Openfiler","permalink":"http://mudbub.com/tags/Openfiler/"},{"name":"VNC","slug":"VNC","permalink":"http://mudbub.com/tags/VNC/"},{"name":"SWAP","slug":"SWAP","permalink":"http://mudbub.com/tags/SWAP/"},{"name":"Linux","slug":"Linux","permalink":"http://mudbub.com/tags/Linux/"},{"name":"Zombie","slug":"Zombie","permalink":"http://mudbub.com/tags/Zombie/"},{"name":"CentOS8","slug":"CentOS8","permalink":"http://mudbub.com/tags/CentOS8/"},{"name":"EMCC","slug":"EMCC","permalink":"http://mudbub.com/tags/EMCC/"},{"name":"19c","slug":"19c","permalink":"http://mudbub.com/tags/19c/"},{"name":"12c","slug":"12c","permalink":"http://mudbub.com/tags/12c/"},{"name":"PDB","slug":"PDB","permalink":"http://mudbub.com/tags/PDB/"},{"name":"RAC","slug":"RAC","permalink":"http://mudbub.com/tags/RAC/"},{"name":"AFD","slug":"AFD","permalink":"http://mudbub.com/tags/AFD/"},{"name":"11g","slug":"11g","permalink":"http://mudbub.com/tags/11g/"},{"name":"UDEV","slug":"UDEV","permalink":"http://mudbub.com/tags/UDEV/"},{"name":"GoldenGate","slug":"GoldenGate","permalink":"http://mudbub.com/tags/GoldenGate/"},{"name":"ORA-00700","slug":"ORA-00700","permalink":"http://mudbub.com/tags/ORA-00700/"},{"name":"OJVM","slug":"OJVM","permalink":"http://mudbub.com/tags/OJVM/"},{"name":"ASM","slug":"ASM","permalink":"http://mudbub.com/tags/ASM/"},{"name":"19g","slug":"19g","permalink":"http://mudbub.com/tags/19g/"},{"name":"Flex","slug":"Flex","permalink":"http://mudbub.com/tags/Flex/"},{"name":"Audit","slug":"Audit","permalink":"http://mudbub.com/tags/Audit/"},{"name":"LUN","slug":"LUN","permalink":"http://mudbub.com/tags/LUN/"},{"name":"CDB","slug":"CDB","permalink":"http://mudbub.com/tags/CDB/"},{"name":"PSU","slug":"PSU","permalink":"http://mudbub.com/tags/PSU/"},{"name":"Cloud","slug":"Cloud","permalink":"http://mudbub.com/tags/Cloud/"},{"name":"Silent","slug":"Silent","permalink":"http://mudbub.com/tags/Silent/"},{"name":"ORA-65500","slug":"ORA-65500","permalink":"http://mudbub.com/tags/ORA-65500/"},{"name":"ORA-28000","slug":"ORA-28000","permalink":"http://mudbub.com/tags/ORA-28000/"},{"name":"ORA-01804","slug":"ORA-01804","permalink":"http://mudbub.com/tags/ORA-01804/"},{"name":"Synonym","slug":"Synonym","permalink":"http://mudbub.com/tags/Synonym/"},{"name":"10g","slug":"10g","permalink":"http://mudbub.com/tags/10g/"},{"name":"ORA-600","slug":"ORA-600","permalink":"http://mudbub.com/tags/ORA-600/"},{"name":"Patch","slug":"Patch","permalink":"http://mudbub.com/tags/Patch/"},{"name":"EXPDP","slug":"EXPDP","permalink":"http://mudbub.com/tags/EXPDP/"},{"name":"IMPDP","slug":"IMPDP","permalink":"http://mudbub.com/tags/IMPDP/"},{"name":"EXP","slug":"EXP","permalink":"http://mudbub.com/tags/EXP/"},{"name":"IMP","slug":"IMP","permalink":"http://mudbub.com/tags/IMP/"},{"name":"Req_mir_free_MB","slug":"Req-mir-free-MB","permalink":"http://mudbub.com/tags/Req-mir-free-MB/"}]}