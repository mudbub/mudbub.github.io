<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Valour Fang</title>
  
  <subtitle>Stay hungry Stay foolish</subtitle>
  <link href="http://mudbub.com/atom.xml" rel="self"/>
  
  <link href="http://mudbub.com/"/>
  <updated>2021-06-22T09:05:32.234Z</updated>
  <id>http://mudbub.com/</id>
  
  <author>
    <name>Falkon</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Error getting repository data for ol6_x86_64_userspace_ksplice, repository not found</title>
    <link href="http://mudbub.com/2021/06/22/linux/ol6-x86-64-userspace-ksplice-repository-not-found/"/>
    <id>http://mudbub.com/2021/06/22/linux/ol6-x86-64-userspace-ksplice-repository-not-found/</id>
    <published>2021-06-22T09:02:32.331Z</published>
    <updated>2021-06-22T09:05:32.234Z</updated>
    
    <content type="html"><![CDATA[<h6 id="1-ODA（Oracle-Database-Appliance）在OAK-18-6以上的版本，每间隔半小时会在-var-mail-root邮件中提示一个错误Error-getting-repository-data-for-ol6-x86-64-userspace-ksplice-repository-not-found-具体邮件内容如下："><a href="#1-ODA（Oracle-Database-Appliance）在OAK-18-6以上的版本，每间隔半小时会在-var-mail-root邮件中提示一个错误Error-getting-repository-data-for-ol6-x86-64-userspace-ksplice-repository-not-found-具体邮件内容如下：" class="headerlink" title="1. ODA（Oracle Database Appliance）在OAK 18.6以上的版本，每间隔半小时会在/var/mail/root邮件中提示一个错误Error getting repository data for ol6_x86_64_userspace_ksplice, repository not found,具体邮件内容如下："></a>1. ODA（Oracle Database Appliance）在OAK 18.6以上的版本，每间隔半小时会在<code>/var/mail/root</code>邮件中提示一个错误<code>Error getting repository data for ol6_x86_64_userspace_ksplice, repository not found</code>,具体邮件内容如下：</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">From root@valdb01.oracle.com  Wed Jun 16 19:09:02 2021</span><br><span class="line">Return-Path: &lt;root@valdb01.oracle.com&gt;</span><br><span class="line">Received: from valdb01.oracle.com (localhost [127.0.0.1])</span><br><span class="line">        by valdb01.oracle.com (8.14.7/8.14.7) with ESMTP id 15GB92da008414</span><br><span class="line">        <span class="keyword">for</span> &lt;root@valdb01.oracle.com&gt;; Wed, 16 Jun 2021 19:09:02 +0800</span><br><span class="line">Received: (from root@localhost)</span><br><span class="line">        by valdb01.oracle.com (8.14.7/8.14.7/Submit) id 15GB924p008263;</span><br><span class="line">        Wed, 16 Jun 2021 19:09:02 +0800</span><br><span class="line">Date: Wed, 16 Jun 2021 19:09:02 +0800</span><br><span class="line">Message-Id: &lt;202106161109.15GB924p008263@valdb01.oracle.com&gt;</span><br><span class="line">From: <span class="string">"(Cron Daemon)"</span> &lt;root@valdb01.oracle.com&gt;</span><br><span class="line">To: root@valdb01.oracle.com</span><br><span class="line">Subject: Cron &lt;root@valdb01&gt; <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin &amp;&amp; [ -x /usr/bin/ksplice ] &amp;&amp; (/usr/bin/ksplice --cron user upgra</span><br><span class="line">de; /usr/bin/ksplice --cron xen upgrade)</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Auto-Submitted: auto-generated</span><br><span class="line">Precedence: bulk</span><br><span class="line">X-Cron-Env: &lt;XDG_SESSION_ID=91&gt;</span><br><span class="line">X-Cron-Env: &lt;XDG_RUNTIME_DIR=/run/user/0&gt;</span><br><span class="line">X-Cron-Env: &lt;LANG=en_US.UTF-8&gt;</span><br><span class="line">X-Cron-Env: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X-Cron-Env: &lt;HOME=/root&gt;</span><br><span class="line">X-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;</span><br><span class="line">X-Cron-Env: &lt;LOGNAME=root&gt;</span><br><span class="line">X-Cron-Env: &lt;USER=root&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error getting repository data <span class="keyword">for</span> ol7_x86_64_userspace_ksplice, repository not found</span><br></pre></td></tr></table></figure><h6 id="2-在Oracle官网可以看到关于Ksplice的相关介绍。Linux系统会定期接收核心操作系统组件的安全更新，这些操作需要打补丁和重启。在传统的操作上需要手动获取并安装更新的RPM包，并且需要安排停机时间，将服务器进行重启，以便更新的到新的程序包的版本。但是随着系统的建设变得越来月复杂，存在许多相互的依赖关系，对应服务和应用程序的访问必须尽可能的保持不中断。通过Ksplice，可以使用最新的内核和关键用户空间安全和错误修复更新。从而保证系统的安全性和高可用性。"><a href="#2-在Oracle官网可以看到关于Ksplice的相关介绍。Linux系统会定期接收核心操作系统组件的安全更新，这些操作需要打补丁和重启。在传统的操作上需要手动获取并安装更新的RPM包，并且需要安排停机时间，将服务器进行重启，以便更新的到新的程序包的版本。但是随着系统的建设变得越来月复杂，存在许多相互的依赖关系，对应服务和应用程序的访问必须尽可能的保持不中断。通过Ksplice，可以使用最新的内核和关键用户空间安全和错误修复更新。从而保证系统的安全性和高可用性。" class="headerlink" title="2. 在Oracle官网可以看到关于Ksplice的相关介绍。Linux系统会定期接收核心操作系统组件的安全更新，这些操作需要打补丁和重启。在传统的操作上需要手动获取并安装更新的RPM包，并且需要安排停机时间，将服务器进行重启，以便更新的到新的程序包的版本。但是随着系统的建设变得越来月复杂，存在许多相互的依赖关系，对应服务和应用程序的访问必须尽可能的保持不中断。通过Ksplice，可以使用最新的内核和关键用户空间安全和错误修复更新。从而保证系统的安全性和高可用性。"></a>2. 在<a href="https://docs.oracle.com/en/operating-systems/oracle-linux/ksplice-user/ol_ksabout.html" target="_blank" rel="noopener">Oracle官网</a>可以看到关于Ksplice的相关介绍。Linux系统会定期接收核心操作系统组件的安全更新，这些操作需要打补丁和重启。在传统的操作上需要手动获取并安装更新的RPM包，并且需要安排停机时间，将服务器进行重启，以便更新的到新的程序包的版本。但是随着系统的建设变得越来月复杂，存在许多相互的依赖关系，对应服务和应用程序的访问必须尽可能的保持不中断。通过Ksplice，可以使用最新的内核和关键用户空间安全和错误修复更新。从而保证系统的安全性和高可用性。</h6><h6 id="3-通过对官网文档关于Ksplice的解读，发现这是一个会自动进行内核安全更新的一个工具，但是在ODA的使用环境绝大数都是拒绝连接外网，Ksplice在执行的使用需要使用ULN（Unbreakable-Linux-Network），但是YUM源中没有Ksplice的repo，，所以在Ksplice在发起更新的时候发现没有对应的repo。即便有也不能连接外网。关于Ksplice具体的脚本路径和内容如下："><a href="#3-通过对官网文档关于Ksplice的解读，发现这是一个会自动进行内核安全更新的一个工具，但是在ODA的使用环境绝大数都是拒绝连接外网，Ksplice在执行的使用需要使用ULN（Unbreakable-Linux-Network），但是YUM源中没有Ksplice的repo，，所以在Ksplice在发起更新的时候发现没有对应的repo。即便有也不能连接外网。关于Ksplice具体的脚本路径和内容如下：" class="headerlink" title="3. 通过对官网文档关于Ksplice的解读，发现这是一个会自动进行内核安全更新的一个工具，但是在ODA的使用环境绝大数都是拒绝连接外网，Ksplice在执行的使用需要使用ULN（Unbreakable Linux Network），但是YUM源中没有Ksplice的repo，，所以在Ksplice在发起更新的时候发现没有对应的repo。即便有也不能连接外网。关于Ksplice具体的脚本路径和内容如下："></a>3. 通过对官网文档关于Ksplice的解读，发现这是一个会自动进行内核安全更新的一个工具，但是在ODA的使用环境绝大数都是拒绝连接外网，Ksplice在执行的使用需要使用<a href="https://docs.oracle.com/en/operating-systems/oracle-linux/uln-user/ol_about_uln.html#ol_oci_uln" target="_blank" rel="noopener">ULN（Unbreakable Linux Network）</a>，但是YUM源中没有Ksplice的repo，，所以在Ksplice在发起更新的时候发现没有对应的repo。即便有也不能连接外网。关于Ksplice具体的脚本路径和内容如下：</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@valdb01 cron.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/cron.d</span><br><span class="line">[root@valdb01 cron.d]<span class="comment"># </span></span><br><span class="line">[root@valdb01 cron.d]<span class="comment"># cat ksplice </span></span><br><span class="line"><span class="comment"># Replaced by Ksplice on 2020-11-23</span></span><br><span class="line"><span class="comment"># /etc/cron.d/ksplice: cron job for the Ksplice client</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># PLEASE DO NOT MODIFY THIS CRON JOB.</span></span><br><span class="line"><span class="comment"># Instead, contact Ksplice Support at ksplice-support_ww@oracle.com.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The offsets below are chosen specifically to distribute server load</span></span><br><span class="line"><span class="comment"># and allow for Ksplice server maintenance windows. This cron job</span></span><br><span class="line"><span class="comment"># also only contacts the Ksplice server every Nth time it runs,</span></span><br><span class="line"><span class="comment"># depending on a load control setting on the Ksplice server.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you would like to adjust the frequency with which your</span></span><br><span class="line"><span class="comment"># systems check for updates, please contact Ksplice Support at</span></span><br><span class="line"><span class="comment"># ksplice-support_ww@oracle.com</span></span><br><span class="line">9,39 * * * * root <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin &amp;&amp; [ -x /usr/bin/ksplice ] &amp;&amp; (/usr/bin/ksplice --cron user upgrade; /usr/bin/ksplice --cron xen upgrade)</span><br></pre></td></tr></table></figure><h6 id="4-既然不能连接外网，那么我们通过将Ksplice的脚本移出cron-d，放到其他位置，来解决因这个脚本定时运行而导致的这个错误。"><a href="#4-既然不能连接外网，那么我们通过将Ksplice的脚本移出cron-d，放到其他位置，来解决因这个脚本定时运行而导致的这个错误。" class="headerlink" title="4. 既然不能连接外网，那么我们通过将Ksplice的脚本移出cron.d，放到其他位置，来解决因这个脚本定时运行而导致的这个错误。"></a>4. 既然不能连接外网，那么我们通过将Ksplice的脚本移出cron.d，放到其他位置，来解决因这个脚本定时运行而导致的这个错误。</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@valdb01 cron.d]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">-rw-r--r--. 1 root root 128 Jun  9  2019 0hourly</span><br><span class="line">-rw-r--r--. 1 root root 817 Nov 23  2020 ksplice</span><br><span class="line">-rw-r--r--. 1 root root 108 Apr  1  2020 raid-check</span><br><span class="line">-rw-------. 1 root root 235 Apr  1  2020 sysstat</span><br><span class="line">-rw-r--r--. 1 root root 748 Nov 23  2020 uptrack</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动</span></span><br><span class="line">[root@valdb01 cron.d]<span class="comment"># mv ksplice /root/Extras/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line">[root@valdb01 cron.d]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">-rw-r--r--. 1 root root 128 Jun  9  2019 0hourly</span><br><span class="line">-rw-r--r--. 1 root root 108 Apr  1  2020 raid-check</span><br><span class="line">-rw-------. 1 root root 235 Apr  1  2020 sysstat</span><br><span class="line">-rw-r--r--. 1 root root 748 Nov 23  2020 uptrack</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h6 id=&quot;1-ODA（Oracle-Database-Appliance）在OAK-18-6以上的版本，每间隔半小时会在-var-mail-root邮件中提示一个错误Error-getting-repository-data-for-ol6-x86-64-userspace</summary>
      
    
    
    
    <category term="Oracle Database Appliance" scheme="http://mudbub.com/categories/Oracle-Database-Appliance/"/>
    
    
    <category term="Ksplice" scheme="http://mudbub.com/tags/Ksplice/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQL离线下载与安装</title>
    <link href="http://mudbub.com/2021/06/22/database/installed-postgresql13-on-centos7/"/>
    <id>http://mudbub.com/2021/06/22/database/installed-postgresql13-on-centos7/</id>
    <published>2021-06-22T02:57:31.326Z</published>
    <updated>2021-06-22T08:57:04.567Z</updated>
    
    <content type="html"><![CDATA[<h6 id="1-软件包说明"><a href="#1-软件包说明" class="headerlink" title="1. 软件包说明"></a>1. 软件包说明</h6><table><thead><tr><th>软件包</th><th>描述</th></tr></thead><tbody><tr><td>postgresql-client</td><td>libraries and client binaries</td></tr><tr><td>postgresql-server</td><td>core database server</td></tr><tr><td>postgresql-contrib</td><td>additional supplied modules</td></tr><tr><td>postgresql-devel</td><td>libraries and headers for C language development</td></tr></tbody></table><h6 id="2-下载离线安装包"><a href="#2-下载离线安装包" class="headerlink" title="2. 下载离线安装包"></a>2. 下载离线安装包</h6><p> Direct RPM download -&gt;  <a href="https://yum.postgresql.org/rpmchart/" target="_blank" rel="noopener">direct download</a>-&gt;选择对应的版本对应的操作系统 -&gt; <a href="https://yum.postgresql.org/13/redhat/rhel-7-x86_64/repoview/postgresqldbserver13.group.html" target="_blank" rel="noopener">PostgreSQL Database Server 13 PGDG</a> -&gt; 下载离线安装包</p><h6 id="3-进行PostgresSQL的安装"><a href="#3-进行PostgresSQL的安装" class="headerlink" title="3. 进行PostgresSQL的安装"></a>3. 进行PostgresSQL的安装</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@db-postgresql13 home]<span class="comment"># rpm -ivh postgresql13-*</span></span><br><span class="line">warning: postgresql13-13.3-1PGDG.rhel7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 442df0f8: NOKEY</span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:postgresql13-libs-13.3-1PGDG.rhel<span class="comment">################################# [ 25%]</span></span><br><span class="line">   2:postgresql13-13.3-1PGDG.rhel7    <span class="comment">################################# [ 50%]</span></span><br><span class="line">   3:postgresql13-server-13.3-1PGDG.rh<span class="comment">################################# [ 75%]</span></span><br><span class="line">   4:postgresql13-contrib-13.3-1PGDG.r<span class="comment">################################# [100%]</span></span><br></pre></td></tr></table></figure><h6 id="4-初始化db"><a href="#4-初始化db" class="headerlink" title="4. 初始化db"></a>4. 初始化db</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@db-postgresql13 home]<span class="comment"># /usr/pgsql-13/bin/postgresql-13-setup initdb</span></span><br><span class="line">Initializing database ... OK</span><br></pre></td></tr></table></figure><h6 id="5-启动PostgreSQL服务"><a href="#5-启动PostgreSQL服务" class="headerlink" title="5. 启动PostgreSQL服务"></a>5. 启动PostgreSQL服务</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@db-postgresql13 home]<span class="comment"># systemctl start postgresql-13</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">[root@db-postgresql13 ~]<span class="comment"># systemctl status postgresql-13</span></span><br><span class="line">● postgresql-13.service - PostgreSQL 13 database server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/postgresql-13.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2021-06-22 10:58:04 CST; 13min ago</span><br><span class="line">     Docs: https://www.postgresql.org/docs/13/static/</span><br><span class="line">  Process: 13539 ExecStartPre=/usr/pgsql-13/bin/postgresql-13-check-db-dir <span class="variable">$&#123;PGDATA&#125;</span> (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 13545 (postmaster)</span><br><span class="line">    Tasks: 8</span><br><span class="line">   CGroup: /system.slice/postgresql-13.service</span><br><span class="line">           ├─13545 /usr/pgsql-13/bin/postmaster -D /var/lib/pgsql/13/data/</span><br><span class="line">           ├─13547 postgres: logger </span><br><span class="line">           ├─13549 postgres: checkpointer </span><br><span class="line">           ├─13550 postgres: background writer </span><br><span class="line">           ├─13551 postgres: walwriter </span><br><span class="line">           ├─13552 postgres: autovacuum launcher </span><br><span class="line">           ├─13553 postgres: stats collector </span><br><span class="line">           └─13554 postgres: logical replication launcher </span><br><span class="line"></span><br><span class="line">Jun 22 10:58:04 db-postgresql13 systemd[1]: Starting PostgreSQL 13 database server...</span><br><span class="line">Jun 22 10:58:04 db-postgresql13 postmaster[13545]: 2021-06-22 10:58:04.147 CST [13545] LOG:  redirecting <span class="built_in">log</span> output to logging collector process</span><br><span class="line">Jun 22 10:58:04 db-postgresql13 postmaster[13545]: 2021-06-22 10:58:04.147 CST [13545] HINT:  Future <span class="built_in">log</span> output will appear <span class="keyword">in</span> directory <span class="string">"log"</span>.</span><br><span class="line">Jun 22 10:58:04 db-postgresql13 systemd[1]: Started PostgreSQL 13 database server.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入开机启动</span></span><br><span class="line">[root@db-postgresql13 ~]<span class="comment"># systemctl enable postgresql-13</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/postgresql-13.service to /usr/lib/systemd/system/postgresql-13.service.</span><br></pre></td></tr></table></figure><h6 id="6-进入PostgreSQL数据库"><a href="#6-进入PostgreSQL数据库" class="headerlink" title="6. 进入PostgreSQL数据库"></a>6. 进入PostgreSQL数据库</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到postgres用户</span></span><br><span class="line">[root@db-postgresql13 ~]<span class="comment"># su - postgres</span></span><br><span class="line">Last login: Tue Jun 22 11:13:17 CST 2021 on pts/1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看postgresql版本</span></span><br><span class="line">-bash-4.2$ psql --version</span><br><span class="line">psql (PostgreSQL) 13.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入数据库</span></span><br><span class="line">-bash-4.2$ psql</span><br><span class="line">psql (13.3)</span><br><span class="line">Type <span class="string">"help"</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">postgres=<span class="comment"># \l</span></span><br><span class="line">                                  List of databases</span><br><span class="line">   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   </span><br><span class="line">-----------+----------+----------+-------------+-------------+-----------------------</span><br><span class="line"> postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | </span><br><span class="line"> template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</span><br><span class="line">           |          |          |             |             | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</span><br><span class="line">           |          |          |             |             | postgres=CTc/postgres</span><br><span class="line">(3 rows)</span><br><span class="line"></span><br><span class="line">postgres=<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h6 id=&quot;1-软件包说明&quot;&gt;&lt;a href=&quot;#1-软件包说明&quot; class=&quot;headerlink&quot; title=&quot;1. 软件包说明&quot;&gt;&lt;/a&gt;1. 软件包说明&lt;/h6&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;软件包&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;</summary>
      
    
    
    
    <category term="PostgreSQL" scheme="http://mudbub.com/categories/PostgreSQL/"/>
    
    
    <category term="Install" scheme="http://mudbub.com/tags/Install/"/>
    
    <category term="PostgreSQL" scheme="http://mudbub.com/tags/PostgreSQL/"/>
    
  </entry>
  
  <entry>
    <title>Alter database move datafile</title>
    <link href="http://mudbub.com/2021/05/07/database/alter-database-move-datafile-to/"/>
    <id>http://mudbub.com/2021/05/07/database/alter-database-move-datafile-to/</id>
    <published>2021-05-07T02:03:27.903Z</published>
    <updated>2021-05-07T07:40:23.490Z</updated>
    
    <content type="html"><![CDATA[<p>在我们日常工作中，会经常发现客户的数据库因为应用方操作问题导致数据文件没有建立在正确的位置上，在数据库意外关闭后，发现某个节点无法启动，无法启动的节点报ORA-01157、ORA-01110的错误，在12.2以前的版本我们需要将表空间offline后进行移动，或者删除后重建，后者会造成数据的丢失。在12.2以后的版本中Oracle提供了可以在线移动数据文件的操作，很大方便了DBA的日常工作，下面演示了19c CDB数据库中PDB1的数据文件路径创建错误的境况下，如何在线移动数据文件。</p><ul><li>查看现有的数据文件</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; show pdbs</span><br><span class="line"></span><br><span class="line">    CON_ID CON_NAME                       OPEN MODE  RESTRICTED</span><br><span class="line"><span class="comment">---------- ------------------------------ ---------- ----------</span></span><br><span class="line">         2 PDB$SEED                       READ ONLY  NO</span><br><span class="line">         3 PDB1                           READ WRITE NO</span><br><span class="line">         4 TESTPDB                        READ WRITE NO</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; alter session set container=pdb1;</span><br><span class="line"></span><br><span class="line">Session altered.</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; select file_name from dba_data_files;</span><br><span class="line"></span><br><span class="line">FILE_NAME</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.1062002667</span><br><span class="line"></span><br><span class="line">6 rows selected.</span><br></pre></td></tr></table></figure><ul><li>模拟数据文件路径创建错误</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create tablespace test01 datafile '/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf' size 1m;</span><br><span class="line"></span><br><span class="line">Tablespace created.</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; select file_name from dba_data_files;</span><br><span class="line"></span><br><span class="line">FILE_NAME</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.1062002667</span><br><span class="line">/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf</span><br></pre></td></tr></table></figure><ul><li>节点1和节点2关闭PDB后重启</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; show pdbs</span><br><span class="line"></span><br><span class="line">    CON_ID CON_NAME                       OPEN MODE  RESTRICTED</span><br><span class="line"><span class="comment">---------- ------------------------------ ---------- ----------</span></span><br><span class="line">         2 PDB$SEED                       READ ONLY  NO</span><br><span class="line">         3 PDB1                           MOUNTED</span><br><span class="line">         4 TESTPDB                        READ WRITE NO</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; alter pluggable database pdb1 open;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">pluggable</span> <span class="keyword">database</span> pdb1 <span class="keyword">open</span></span><br><span class="line">*</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-01157</span>: cannot identify/<span class="keyword">lock</span> <span class="keyword">data</span> <span class="keyword">file</span> <span class="number">25</span> - see DBWR <span class="keyword">trace</span> <span class="keyword">file</span></span><br><span class="line">ORA<span class="number">-01110</span>: <span class="keyword">data</span> <span class="keyword">file</span> <span class="number">25</span>:</span><br><span class="line"><span class="string">'/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf'</span></span><br></pre></td></tr></table></figure><ul><li>在节点1移动数据文件到正确路径</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter database move datafile '/u01/app/oracle/product/19.0.0.0/dbhome_1/dbs/test01.dbf' to '+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/test01.dbf';</span><br><span class="line"></span><br><span class="line">Database altered.</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; select file_name from dba_data_files;</span><br><span class="line"></span><br><span class="line">FILE_NAME</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/system.277.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/sysaux.278.1061813625</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undotbs1.276.1061813623</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/undo_2.280.1061813739</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/users.281.1061813771</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/helloworld.287.1062002667</span><br><span class="line">+DATA/GRASDT/B8D57AF9DAF32B4DE0532FFB0A0AB52F/DATAFILE/test01.dbf</span><br><span class="line"></span><br><span class="line">7 rows selected.</span><br></pre></td></tr></table></figure><ul><li>再次启动节点2的PDB<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter pluggable database pdb1 open;</span><br><span class="line"></span><br><span class="line">Pluggable database altered.</span><br><span class="line"></span><br><span class="line">SQL&gt; show pdbs</span><br><span class="line"></span><br><span class="line">    CON_ID CON_NAME                       OPEN MODE  RESTRICTED</span><br><span class="line"><span class="comment">---------- ------------------------------ ---------- ----------</span></span><br><span class="line">         2 PDB$SEED                       READ ONLY  NO</span><br><span class="line">         3 PDB1                           READ WRITE NO</span><br><span class="line">         4 TESTPDB                        READ WRITE NO</span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure></li><li>在数据文件移动到正确的位置后，PDB已经可以正常启动</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在我们日常工作中，会经常发现客户的数据库因为应用方操作问题导致数据文件没有建立在正确的位置上，在数据库意外关闭后，发现某个节点无法启动，无法启动的节点报ORA-01157、ORA-01110的错误，在12.2以前的版本我们需要将表空间offline后进行移动，或者删除后重建</summary>
      
    
    
    
    <category term="Oracle" scheme="http://mudbub.com/categories/Oracle/"/>
    
    
    <category term="Datafile" scheme="http://mudbub.com/tags/Datafile/"/>
    
  </entry>
  
  <entry>
    <title>Linux SSH限制IP登录</title>
    <link href="http://mudbub.com/2021/04/22/linux/ssh-limit-ip-login/"/>
    <id>http://mudbub.com/2021/04/22/linux/ssh-limit-ip-login/</id>
    <published>2021-04-22T07:13:20.110Z</published>
    <updated>2021-05-06T07:07:38.807Z</updated>
    
    <content type="html"><![CDATA[<p>在不开启防火墙的情况下，通过使用hosts的方式来实现限制某些IP登录到主机</p><ol><li>方法1</li></ol><p>通过配置hosts.allow和hosts.deny实现SSH限制IP登录</p><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在/etc/hosts.allow添加允许的IP地址或者IP段</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hosts.allowThis file contains access rules <span class="built_in">which</span> are used to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">allow or deny connections to network services that</span></span><br><span class="line"><span class="meta">#</span><span class="bash">either use the tcp_wrappers library or that have been</span></span><br><span class="line"><span class="meta">#</span><span class="bash">started through a tcp_wrappers-enabled xinetd.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">See <span class="string">'man 5 hosts_options'</span> and <span class="string">'man 5 hosts_access'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">for</span> information on rule syntax.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">See <span class="string">'man tcpd'</span> <span class="keyword">for</span> information on tcp_wrappers</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sshd:192.168.56.1:allow</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在/etc/hosts.deny中拒绝所有</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hosts.denyThis file contains access rules <span class="built_in">which</span> are used to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">deny connections to network services that either use</span></span><br><span class="line"><span class="meta">#</span><span class="bash">the tcp_wrappers library or that have been</span></span><br><span class="line"><span class="meta">#</span><span class="bash">started through a tcp_wrappers-enabled xinetd.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">The rules <span class="keyword">in</span> this file can also be <span class="built_in">set</span> up <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">/etc/hosts.allow with a <span class="string">'deny'</span> option instead.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">See <span class="string">'man 5 hosts_options'</span> and <span class="string">'man 5 hosts_access'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">for</span> information on rule syntax.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">See <span class="string">'man tcpd'</span> <span class="keyword">for</span> information on tcp_wrappers</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line">sshd:ALL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启sshd服务</span></span><br><span class="line">[root@localhost ~]# service sshd restart</span><br><span class="line">Stopping sshd:                                             [  OK  ]</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试把/etc/hosts.allow修改为非本机IP登录</span></span><br><span class="line"></span><br><span class="line">[C:\~]$ ssh 192.168.56.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Connecting to 192.168.56.20:22...</span><br><span class="line">Connection established.</span><br><span class="line">To escape to local shell, press 'Ctrl+Alt+]'.</span><br><span class="line">Connection closing...Socket close.</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br><span class="line"></span><br><span class="line">Disconnected from remote host(192.168.56.20:22) at 15:20:29.</span><br><span class="line"></span><br><span class="line">Type `help' to learn how to use Xshell prompt.</span><br></pre></td></tr></table></figure><ol start="2"><li>方法2</li></ol><p>在sshd_config添加allowusers，限制SSH的IP访问</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在sshd_config的末尾添加如下内容，其说明为允许某个IP的某个用户登录</span></span><br><span class="line">[root@localhost ~]# cat /etc/ssh/sshd_config | grep allowusers</span><br><span class="line">allowusers root@192.168.56.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启sshd服务</span></span><br><span class="line">[root@localhost ~]# service sshd restart</span><br><span class="line">Stopping sshd:                                             [  OK  ]</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在不开启防火墙的情况下，通过使用hosts的方式来实现限制某些IP登录到主机&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;方法1&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过配置hosts.allow和hosts.deny实现SSH限制IP登录&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="SSH" scheme="http://mudbub.com/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>ALUA port group messages</title>
    <link href="http://mudbub.com/2021/04/12/linux/alua-port-group-messages/"/>
    <id>http://mudbub.com/2021/04/12/linux/alua-port-group-messages/</id>
    <published>2021-04-12T01:35:25.065Z</published>
    <updated>2021-06-22T09:38:12.444Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>环境<br>CentOS Linux release 7.9.2009 (Core)</p></li><li><p>Messages日志</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Apr  8 07:44:27 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:44:33 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:44:41 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:44:46 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:44:59 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:45:02 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:45:07 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNA</span><br><span class="line">Apr  8 07:45:14 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA</span><br></pre></td></tr></table></figure><ul><li><p>原因<br>如果存储支持ALUA（非对称逻辑单元访问），这些消息将显示检测到端口组及其支持的ALUA的状态。</p></li><li><p>处理<br>这些消息只是一些信息，不能表明在使用的环境有没有问题，如果现在使用的系统中有问题则这些消息具有参考的价值。</p></li><li><p>附加信息</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Example：</span><br><span class="line">&gt; Apr  8 07:44:27 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:44:33 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:44:41 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:44:46 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:44:59 testdb02 kernel: sd 1:0:1:67: alua: port group 3e9 state N non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:45:02 testdb02 kernel: sd 3:0:0:67: alua: port group 3e8 state A non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:45:07 testdb02 kernel: sd 3:0:1:67: alua: port group 3e8 state A non-preferred supports TolUsNA  </span><br><span class="line">&gt; Apr  8 07:45:14 testdb02 kernel: sd 1:0:0:67: alua: port group 3e9 state N non-preferred supports TolUsNA</span><br></pre></td></tr></table></figure><p><code>tolUsNA</code>中的每字母代表SCSI多路径配置中由LUN服务的目标端口组的非对称访问状态Transitioning/Offline/LBA/Unavail/Standby/Non-Opt active/Active.</p><p>在初始化和配置目标端口组时，改配置规定了目标端口组可以使用哪些的非对称端口组状态进行报告，大写字母记录的状态是当前报告的目标端口组对给定的LUN能够使用的非对称访问状态.</p><p><strong>对记录信息进行细分</strong></p><p><code>&#39;alua: port group 3e9&#39;</code><br>此消息部分标识要报告的目标端口组，在本例中端口组是3e9</p><p><code>&#39;state N preferred&#39;</code><br>目标端口组所处的非对称访问的当前状态，此时目标端口组3e9的状态是Non-Optimized</p><p><code>&#39;supports tolUsNA&#39;</code></p><p>报告目标端口组提供的一组受支持的非对称访问状态，在这种情况下，目标端口组3e9的多路径配置支持Unavailable, Non-Optimized Active and Active-Optimized</p>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;环境&lt;br&gt;CentOS Linux release 7.9.2009 (Core)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Messages日志&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="ALUA" scheme="http://mudbub.com/tags/ALUA/"/>
    
  </entry>
  
  <entry>
    <title>Rename SYS</title>
    <link href="http://mudbub.com/2021/03/31/database/oracle-rename-sys/"/>
    <id>http://mudbub.com/2021/03/31/database/oracle-rename-sys/</id>
    <published>2021-03-31T01:19:17.478Z</published>
    <updated>2021-05-07T07:50:32.610Z</updated>
    
    <content type="html"><![CDATA[<ul><li>等保2.0其中的一项要求，重命名默认的SYS和SYSTEM账户。根据测试12.2.0.1的之前版本是可以进行重命名的，但是启动数据库会报ORA-01092、ORA-00600错误，12.2.0.1以后的版本进行重命名操作提示无权限，MOS官网也告知是不能从命名这些账户，文章ID 2552175.1，但是可以通过禁用或者锁定的方式来进行SYS和SYSTEM的访问控制，具体测试如下</li></ul><ul><li>12.2.0.1重命名SYS</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; update user$ set name='SYSDB21' where user#=0;</span><br><span class="line"></span><br><span class="line">1 row updated. </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查修改后的结果</span></span><br><span class="line">SQL&gt; select name,user# from user$ where user#=0;</span><br><span class="line"></span><br><span class="line">NAME    USER<span class="comment">#</span></span><br><span class="line"><span class="comment">------------------------------ ----------</span></span><br><span class="line">SYSDB21 0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重新启动数据库进行验证</span></span><br><span class="line">SQL&gt; startup   </span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 2304909312 bytes</span><br><span class="line">Fixed Size    2290896 bytes</span><br><span class="line">Variable Size  721423152 bytes</span><br><span class="line">Database Buffers 1577058304 bytes</span><br><span class="line">Redo Buffers    4136960 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">ORA-01092: ORACLE instance terminated. Disconnection forced</span><br><span class="line">ORA-00600: internal error code, arguments: [kokasgi1], [], [], [], [], [], [],</span><br><span class="line">[], [], [], [], []</span><br><span class="line">Process ID: 32096</span><br><span class="line">Session ID: 1 Serial number: 5</span><br></pre></td></tr></table></figure><ul><li><p>12.2.0.1之前的版本都可以重新命名SYS和SYSTEM用户，但带来的结果是数据库无法启动，因此针对等保给出要求，建议采用禁用SYS用户和SYSTEM</p></li><li><p>19.0.0.0重命名SYS</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select banner from v$version;</span><br><span class="line"></span><br><span class="line">BANNER</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">Oracle Database 19c Enterprise Edition <span class="keyword">Release</span> <span class="number">19.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.0</span> - Production</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> <span class="keyword">name</span>,<span class="keyword">user</span><span class="comment"># from user$ where name='SYS';</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">NAME</span>    <span class="keyword">USER</span><span class="comment">#</span></span><br><span class="line"><span class="comment">------------------------------ ----------</span></span><br><span class="line"><span class="keyword">SYS</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">update</span> <span class="keyword">user</span>$ <span class="keyword">set</span> <span class="keyword">name</span>=<span class="string">'SYSDB20'</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="comment">#=0;</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span>$ <span class="keyword">set</span> <span class="keyword">name</span>=<span class="string">'SYSDB20'</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="comment">#=0</span></span><br><span class="line">       *</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-01031</span>: insufficient <span class="keyword">privileges</span></span><br></pre></td></tr></table></figure><ul><li>通过其他的方式来禁用或者锁定SYSTEM用户</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 锁定SYS用户</span></span><br><span class="line">SQL&gt; alter user sys account lock;</span><br><span class="line"></span><br><span class="line">User altered.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重启数据库验证</span></span><br><span class="line">SQL&gt; startup</span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 2304909312 bytes</span><br><span class="line">Fixed Size    2290896 bytes</span><br><span class="line">Variable Size  721423152 bytes</span><br><span class="line">Database Buffers 1577058304 bytes</span><br><span class="line">Redo Buffers    4136960 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接验证</span></span><br><span class="line">[oracle@oracle ~]$ sqlplus sys/yourpassword@10.10.251.58/ora as sysdba</span><br><span class="line"></span><br><span class="line">SQL*Plus: Release 12.1.0.1.0 Production on Fri Apr 23 02:51:47 2021</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">ORA-28000: the account is locked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter user-name:</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;等保2.0其中的一项要求，重命名默认的SYS和SYSTEM账户。根据测试12.2.0.1的之前版本是可以进行重命名的，但是启动数据库会报ORA-01092、ORA-00600错误，12.2.0.1以后的版本进行重命名操作提示无权限，MOS官网也告知是不能从命名这</summary>
      
    
    
    
    <category term="Oracle" scheme="http://mudbub.com/categories/Oracle/"/>
    
    
    <category term="SYS" scheme="http://mudbub.com/tags/SYS/"/>
    
    <category term="ORA-01031" scheme="http://mudbub.com/tags/ORA-01031/"/>
    
  </entry>
  
  <entry>
    <title>ODA X8-2 HA RAID模式错误处理</title>
    <link href="http://mudbub.com/2021/03/26/database/oda-x8-2-ha-nvme-raid/"/>
    <id>http://mudbub.com/2021/03/26/database/oda-x8-2-ha-nvme-raid/</id>
    <published>2021-03-26T09:28:17.607Z</published>
    <updated>2021-03-26T10:18:28.188Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>客户的一套ODA X8-2 HA的数据库一体机说是无法罐装系统，看完之后发现工程师电脑的JDK版本有有问题，无法调用ODA一体机的虚拟控制台，在使用自己电脑罐装系统后发现有一台节点的本地磁盘变成了两块，默认是两块NVMe的SSD做好了RAID，进入BIOS查看后发现有问题的节点（节点1）的Boot Option和节点2的不一样。具体如下：</p></li><li><p>节点1和节点2的Boot Option对比</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">节点1</span><br><span class="line">Boot Option <span class="comment">#1 [Oracle DB Appliance (P4: INTEL SSDSCKKB480GB)]</span></span><br><span class="line"></span><br><span class="line">节点2</span><br><span class="line">Boot Option <span class="comment">#1 [Oracle DB Appliance (Intel Volume0)]</span></span><br></pre></td></tr></table></figure><ul><li>检查PCH SATA Configuration</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">节点1</span><br><span class="line">Configure SATA as [AHCI]</span><br><span class="line">节点2</span><br><span class="line">Configure SATA as [RAID]</span><br><span class="line"></span><br><span class="line">发下节点的1的模式被修改成了AHCI</span><br></pre></td></tr></table></figure><ul><li><p>将节点的模式改回RAID后，创建RAID名称Volume0，创建完成后保存配置重启。重新启动后检查RAID模式是否正常，然后再重新刷机。</p></li><li><p>刷机完成后检查正常，数据库可以正常安装和使用</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;客户的一套ODA X8-2 HA的数据库一体机说是无法罐装系统，看完之后发现工程师电脑的JDK版本有有问题，无法调用ODA一体机的虚拟控制台，在使用自己电脑罐装系统后发现有一台节点的本地磁盘变成了两块，默认是两块NVMe的SSD做好了RAID，进入BIOS</summary>
      
    
    
    
    <category term="Oracle" scheme="http://mudbub.com/categories/Oracle/"/>
    
    
    <category term="ODA" scheme="http://mudbub.com/tags/ODA/"/>
    
    <category term="RAID" scheme="http://mudbub.com/tags/RAID/"/>
    
  </entry>
  
  <entry>
    <title>Oracle常见误操作数据恢复</title>
    <link href="http://mudbub.com/2021/03/26/database/oracle-database-misoperation-recovery/"/>
    <id>http://mudbub.com/2021/03/26/database/oracle-database-misoperation-recovery/</id>
    <published>2021-03-26T07:33:31.629Z</published>
    <updated>2021-03-26T10:19:40.162Z</updated>
    
    <content type="html"><![CDATA[<p>SQL&gt; select flashback_on from v$database;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FLASHBACK_ON</span><br><span class="line"><span class="comment">------------------</span></span><br><span class="line">NO</span><br></pre></td></tr></table></figure><ul><li><p>查看插入的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from t1;</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line"> 1 Music</span><br><span class="line"> 2 Movies</span><br><span class="line"> 3 TV Shows</span><br><span class="line"> 4 Audiobooks</span><br><span class="line"> 5 90???s Music</span><br><span class="line"> 6 Audiobooks</span><br><span class="line"> 7 Movies</span><br><span class="line"> 8 Music</span><br><span class="line"> 9 Music Videos</span><br><span class="line">10 TV Shows</span><br><span class="line">11 Brazilian Music</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line">12 Classical</span><br><span class="line">13 Classical 101 - Deep Cuts</span><br><span class="line">14 Classical 101 - Next Steps</span><br><span class="line">15 Classical 101 - The Basics</span><br><span class="line">16 Grunge</span><br><span class="line">17 Heavy Metal Classic</span><br><span class="line">18 On-The-Go 1</span><br><span class="line"></span><br><span class="line">18 rows selected.</span><br></pre></td></tr></table></figure></li><li><p>drop t1表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; drop table t1;</span><br><span class="line"></span><br><span class="line">Table dropped.</span><br><span class="line"></span><br><span class="line">SQL&gt; flashback table t1 to before drop;</span><br><span class="line"></span><br><span class="line">Flashback complete.</span><br><span class="line"></span><br><span class="line">SQL&gt; </span><br><span class="line">SQL&gt; select * from t1;</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line"> 1 Music</span><br><span class="line"> 2 Movies</span><br><span class="line"> 3 TV Shows</span><br><span class="line"> 4 Audiobooks</span><br><span class="line"> 5 90???s Music</span><br><span class="line"> 6 Audiobooks</span><br><span class="line"> 7 Movies</span><br><span class="line"> 8 Music</span><br><span class="line"> 9 Music Videos</span><br><span class="line">10 TV Shows</span><br><span class="line">11 Brazilian Music</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line">12 Classical</span><br><span class="line">13 Classical 101 - Deep Cuts</span><br><span class="line">14 Classical 101 - Next Steps</span><br><span class="line">15 Classical 101 - The Basics</span><br><span class="line">16 Grunge</span><br><span class="line">17 Heavy Metal Classic</span><br><span class="line">18 On-The-Go 1</span><br><span class="line"></span><br><span class="line">18 rows selected.</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>delete t1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; delete from t1;</span><br><span class="line"></span><br><span class="line">18 rows deleted.</span><br><span class="line"></span><br><span class="line">SQL&gt; commit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Commit</span> complete.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; </span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line"></span><br><span class="line">no rows selected</span><br><span class="line"></span><br><span class="line">SQL&gt; </span><br><span class="line">SQL&gt; select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss');</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line"> 1 Music</span><br><span class="line"> 2 Movies</span><br><span class="line"> 3 TV Shows</span><br><span class="line"> 4 Audiobooks</span><br><span class="line"> 5 90???s Music</span><br><span class="line"> 6 Audiobooks</span><br><span class="line"> 7 Movies</span><br><span class="line"> 8 Music</span><br><span class="line"> 9 Music Videos</span><br><span class="line">10 TV Shows</span><br><span class="line">11 Brazilian Music</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line">12 Classical</span><br><span class="line">13 Classical 101 - Deep Cuts</span><br><span class="line">14 Classical 101 - Next Steps</span><br><span class="line">15 Classical 101 - The Basics</span><br><span class="line">16 Grunge</span><br><span class="line">17 Heavy Metal Classic</span><br><span class="line">18 On-The-Go 1</span><br><span class="line"></span><br><span class="line">18 rows selected.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQL&gt; insert into t1(id,name) select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss');</span><br><span class="line"></span><br><span class="line">18 rows created.</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from t1;</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line"> 1 Music</span><br><span class="line"> 2 Movies</span><br><span class="line"> 3 TV Shows</span><br><span class="line"> 4 Audiobooks</span><br><span class="line"> 5 90???s Music</span><br><span class="line"> 6 Audiobooks</span><br><span class="line"> 7 Movies</span><br><span class="line"> 8 Music</span><br><span class="line"> 9 Music Videos</span><br><span class="line">10 TV Shows</span><br><span class="line">11 Brazilian Music</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line">12 Classical</span><br><span class="line">13 Classical 101 - Deep Cuts</span><br><span class="line">14 Classical 101 - Next Steps</span><br><span class="line">15 Classical 101 - The Basics</span><br><span class="line">16 Grunge</span><br><span class="line">17 Heavy Metal Classic</span><br><span class="line">18 On-The-Go 1</span><br><span class="line"></span><br><span class="line">18 rows selected.</span><br></pre></td></tr></table></figure></li><li><p>delete t1表的部分数据</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; delete from t1 where id &gt; 10;</span><br><span class="line"></span><br><span class="line">8 rows deleted.</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from t1;</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line"> 1 Music</span><br><span class="line"> 2 Movies</span><br><span class="line"> 3 TV Shows</span><br><span class="line"> 4 Audiobooks</span><br><span class="line"> 5 90???s Music</span><br><span class="line"> 6 Audiobooks</span><br><span class="line"> 7 Movies</span><br><span class="line"> 8 Music</span><br><span class="line"> 9 Music Videos</span><br><span class="line">10 TV Shows</span><br><span class="line"></span><br><span class="line">10 rows selected.</span><br><span class="line"></span><br><span class="line">SQL&gt; commit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Commit</span> complete.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t1 <span class="keyword">as</span> <span class="keyword">of</span> <span class="built_in">timestamp</span> to_timestamp(<span class="string">'2021-03-26 16:00:00'</span>,<span class="string">'yyyy-mm-dd hh24:mi:ss'</span>) <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ID NAME</span><br><span class="line"><span class="comment">---------- --------------------------------------------------</span></span><br><span class="line">11 Brazilian Music</span><br><span class="line">12 Classical</span><br><span class="line">13 Classical 101 - Deep Cuts</span><br><span class="line">14 Classical 101 - Next Steps</span><br><span class="line">15 Classical 101 - The Basics</span><br><span class="line">16 Grunge</span><br><span class="line">17 Heavy Metal Classic</span><br><span class="line">18 On-The-Go 1</span><br><span class="line"></span><br><span class="line">8 rows selected.</span><br></pre></td></tr></table></figure><ul><li>truncate t1表</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; truncate table t1;</span><br><span class="line"></span><br><span class="line">Table truncated.</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from t1 as of timestamp to_timestamp('2021-03-26 16:00:00','yyyy-mm-dd hh24:mi:ss');</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1 <span class="keyword">as</span> <span class="keyword">of</span> <span class="built_in">timestamp</span> to_timestamp(<span class="string">'2021-03-26 16:00:00'</span>,<span class="string">'yyyy-mm-dd hh24:mi:ss'</span>)</span><br><span class="line">              *</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-01466</span>: unable <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">data</span> - <span class="keyword">table</span> definition has <span class="keyword">changed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#truncate 不会产生日志和回滚段空间的使用，不能使用闪回恢复，如需要恢复需要借助第三方工具进行，如ODU,BBED等</span></span><br></pre></td></tr></table></figure><ul><li>drop table purge t1表<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; drop table t1 purge;</span><br><span class="line"></span><br><span class="line">Table dropped.</span><br><span class="line"></span><br><span class="line">SQL&gt; flashback table t1 to before drop;</span><br><span class="line">flashback table t1 to before <span class="keyword">drop</span></span><br><span class="line">*</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-38305</span>: <span class="keyword">object</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="keyword">RECYCLE</span> <span class="keyword">BIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#purge参数删除的表不进回收站，闪回不可以，如果需要恢复参见truncate table</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;SQL&amp;gt; select flashback_on from v$database;&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/s</summary>
      
    
    
    
    <category term="Oracle" scheme="http://mudbub.com/categories/Oracle/"/>
    
    
    <category term="Recovery" scheme="http://mudbub.com/tags/Recovery/"/>
    
    <category term="Flashback" scheme="http://mudbub.com/tags/Flashback/"/>
    
  </entry>
  
  <entry>
    <title>WARNING too many parse errors</title>
    <link href="http://mudbub.com/2021/03/22/database/warning-too-many-parse-errors/"/>
    <id>http://mudbub.com/2021/03/22/database/warning-too-many-parse-errors/</id>
    <published>2021-03-22T05:12:25.735Z</published>
    <updated>2021-06-22T09:41:51.995Z</updated>
    
    <content type="html"><![CDATA[<p>客户数据库巡检的过程中发现大量的WARNING: too many parse errors，客户的数据库版本为12.2.0.1，从12.2开始，当解析失败超过一定的次数，alert日志会记录相关信息，以便对解析失败的语句进行排查</p><ul><li><p>通过查询MOS，<code>_kks_parse_error_warning</code>参数控制相关记录，默认是每100次解析失败便会写入alert日志。</p></li><li><p>查看参数默认值</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; set linesize 200</span><br><span class="line">SQL&gt; col name for a52  </span><br><span class="line">SQL&gt; col value for a24</span><br><span class="line">SQL&gt; col description for a50</span><br><span class="line">SQL&gt; </span><br><span class="line">SQL&gt; </span><br><span class="line">SQL&gt; select a.ksppinm name,b.ksppstvl value,a.ksppdesc description</span><br><span class="line">  from x$ksppi a,x$ksppcv b</span><br><span class="line"> where a.inst_id = USERENV ('Instance')</span><br><span class="line">   and b.inst_id = USERENV ('Instance')</span><br><span class="line">   and a.indx = b.indx</span><br><span class="line">   and upper(a.ksppinm) like upper('%&amp;param%') order by name;  2    3    4    5    6  </span><br><span class="line">Enter value for param: _kks_parse_error_warning</span><br><span class="line">old   6:    and upper(a.ksppinm) like upper('%&amp;param%') order by name</span><br><span class="line">new   6:    and upper(a.ksppinm) like upper('%_kks_parse_error_warning%') order by name</span><br><span class="line"></span><br><span class="line">NAME   VALUE    DESCRIPTION</span><br><span class="line"><span class="comment">-------------------------- ---------------- --------------------------------------------------</span></span><br><span class="line">_kks_parse_error_warning   100    Parse error warning</span><br></pre></td></tr></table></figure><ul><li>为了重现这个错误，将这个默认参数修改为1</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set "_kks_parse_error_warning"=1;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure><ul><li>分别在CDB和PDB中执行一条错误的查询语句</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from t1;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1</span><br><span class="line">              *</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-00942</span>: <span class="keyword">table</span> <span class="keyword">or</span> <span class="keyword">view</span> does <span class="keyword">not</span> exist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> <span class="keyword">container</span>=pdb1;</span><br><span class="line"></span><br><span class="line">Session altered.</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from t2;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t2</span><br><span class="line">              *</span><br><span class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-00942</span>: <span class="keyword">table</span> <span class="keyword">or</span> <span class="keyword">view</span> does <span class="keyword">not</span> exist</span><br></pre></td></tr></table></figure><ul><li>观察测试日志信息</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 advanced to log sequence 101 (LGWR switch),  current SCN: 14562135</span><br><span class="line">  Current log<span class="comment"># 1 seq# 101 mem# 0: +DATA/GRASDT/ONLINELOG/group_1.270.1061811373</span></span><br><span class="line">  Current log<span class="comment"># 1 seq# 101 mem# 1: +RECO/GRASDT/ONLINELOG/group_1.260.1061811377</span></span><br><span class="line">2021-03-22T04:05:52.735099+08:00</span><br><span class="line">ARC1 (PID:14385): Archived Log entry 149 added for T-1.S-100 ID 0xc81485a7 LAD:1</span><br><span class="line">2021-03-22T12:41:20.018404+08:00</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> _kks_parse_error_warning=<span class="number">1</span> <span class="keyword">SCOPE</span>=<span class="keyword">BOTH</span>;</span><br><span class="line">2021-03-22T12:41:58.818554+08:00</span><br><span class="line">WARNING: too many parse errors, count=1 SQL hash=0x85dd68f7             &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">PARSE ERROR: ospid=24715, error=942 for statement: </span><br><span class="line">2021-03-22T12:41:58.819084+08:00</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1</span><br><span class="line">Additional information: hd=<span class="number">0x85c676a8</span> phd=<span class="number">0xa9e0e438</span> flg=<span class="number">0x28</span> cisid=<span class="number">0</span> <span class="keyword">sid</span>=<span class="number">0</span> ciuid=<span class="number">0</span> uid=<span class="number">0</span> sqlid=<span class="number">27</span>uhu2q2xuu7r</span><br><span class="line">...Current username=<span class="keyword">SYS</span></span><br><span class="line">...Application: sqlplus@db-<span class="keyword">oracle</span><span class="number">-193</span>-grasdt01 (TNS V1-V3) <span class="keyword">Action</span>: </span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-22</span>T12:<span class="number">43</span>:<span class="number">10.832224</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">PDB1(<span class="number">3</span>):<span class="keyword">WARNING</span>: too many <span class="keyword">parse</span> <span class="keyword">errors</span>, <span class="keyword">count</span>=<span class="number">1</span> <span class="keyword">SQL</span> <span class="keyword">hash</span>=<span class="number">0x4895f57f</span>     &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">PDB1(<span class="number">3</span>):<span class="keyword">PARSE</span> <span class="keyword">ERROR</span>: ospid=<span class="number">24715</span>, <span class="keyword">error</span>=<span class="number">942</span> <span class="keyword">for</span> <span class="keyword">statement</span>: </span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-22</span>T12:<span class="number">43</span>:<span class="number">10.832785</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">PDB1(<span class="number">3</span>):<span class="keyword">select</span> * <span class="keyword">from</span> t2</span><br><span class="line">PDB1(<span class="number">3</span>):Additional information: hd=<span class="number">0xb4706f70</span> phd=<span class="number">0x9ba64de0</span> flg=<span class="number">0x28</span> cisid=<span class="number">0</span> <span class="keyword">sid</span>=<span class="number">0</span> ciuid=<span class="number">0</span> uid=<span class="number">0</span> sqlid=<span class="number">741</span>xfy549bxbz</span><br><span class="line">PDB1(<span class="number">3</span>):...Current username=<span class="keyword">SYS</span></span><br><span class="line">PDB1(<span class="number">3</span>):...Application: sqlplus@db-<span class="keyword">oracle</span><span class="number">-193</span>-grasdt01 (TNS V1-V3) <span class="keyword">Action</span>:</span><br></pre></td></tr></table></figure><ul><li>总结<br>根据以上测试，发现_kks_parse_error_warning这个参数控制着解析失败后达到参数设置的值，在alert日志中出现<code>WARNING: too many parse errors</code>，<br>可以通过设置<code>_kks_parse_error_warning</code>参数的值为0来规避alert日志的告警信息，但一般不建议这么错，最好是根据日志中的提示，找到相应的语句进行修改。确保这条语句是正确合法的。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;客户数据库巡检的过程中发现大量的WARNING: too many parse errors，客户的数据库版本为12.2.0.1，从12.2开始，当解析失败超过一定的次数，alert日志会记录相关信息，以便对解析失败的语句进行排查&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;通过查询M</summary>
      
    
    
    
    <category term="Oracle" scheme="http://mudbub.com/categories/Oracle/"/>
    
    
    <category term="Parse" scheme="http://mudbub.com/tags/Parse/"/>
    
  </entry>
  
  <entry>
    <title>Linux crontab工作定义详解</title>
    <link href="http://mudbub.com/2021/02/22/linux/crontab-time-format-explain-in-detail/"/>
    <id>http://mudbub.com/2021/02/22/linux/crontab-time-format-explain-in-detail/</id>
    <published>2021-02-22T06:20:36.760Z</published>
    <updated>2021-04-30T07:50:57.196Z</updated>
    
    <content type="html"><![CDATA[<ul><li>工作定义示例</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br></pre></td></tr></table></figure><ul><li><p>由上面的示例可以看到，整个crontab由三个部分组成：第一部分为时间；第二部分为用户；第三部分为命令。我们着重理解时间部分的定义，时间部分默认由5个<code>*</code>组成，从左至右分别代表分钟（0-59）、小时（0-23）、天（1-31）、月（1-12）、周（0-6），从下面的示例中来理解这些时间之间是如何配合的。</p></li><li><p>加入我们的数据库需要在每天晚上11点进行备份，脚本我们已经写好了，那么我们要如何来设置这个计划任务呢？首先我们看下分钟的部分，因为11点是整时，正常的时间显示是：<code>PM 11:00</code>，由于这里是24小时制，所以正确的时间写法是：<code>23:00</code>，由于crontab的时间格式为分钟在前，小时在后，那么时间的写法为：00 23，我们可以如下所示编写计划任务。</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23 * * * backup-database.sh</span><br></pre></td></tr></table></figure><ul><li>脚本写好后，我们需要测试备份脚本，不可能等到晚上11点，我们想每隔10分钟执行一次数据库备份，以便来测试备份脚本，我们需要怎么做呢？我们可以通过<code>/</code>来对时间间隔进行处理，如下所示：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * backup-database.sh</span><br></pre></td></tr></table></figure><ul><li><p>那么如果每隔2小时或者两天、两个月呢？同理，只要在相应的时间位置上<code>*/2</code>就可以。</p></li><li><p>如果我们这样写<code>*/2 */2 */2 */2 */2</code>会出现什么样的效果呢 ，留给各位的思考，哈哈哈？</p></li><li><p>上面演示的都是安装固定的时间或者固定的间隔时间在进行计划任务的，但是我们根据备份周期的要求，备份只能在周一至周五运行，周六和周天不执行备份，那么我们可以使用<code>-</code>来指定从什么时间到什么时间，如下所示：</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23 * * 0-4 backup-database.sh</span><br></pre></td></tr></table></figure><ul><li>其他的指定时间段同理，比如从0-10分钟这个时间段（如果后面的小时为<code>*</code>，如：<code>0-10 * * * *</code>，表示每个小时的0-10分钟都会运行脚本），我们看下时间段内复杂的写法，<code>0-10 0-10 1-10 1-6 0-4</code>，这样的写法代表，1至10月的1号-10号的0点-10点的0份-10分运行这个脚本，这里有个特殊的地方最后一些的周一至周五的时间和1号-10号的时间是怎么处理的</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;工作定义示例&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;</summary>
      
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="Crontab" scheme="http://mudbub.com/tags/Crontab/"/>
    
  </entry>
  
  <entry>
    <title>在Docker中备份MySQL，备份文件中没有数据</title>
    <link href="http://mudbub.com/2021/02/21/linux/backup-in-the-docker-dumpfile-0/"/>
    <id>http://mudbub.com/2021/02/21/linux/backup-in-the-docker-dumpfile-0/</id>
    <published>2021-02-20T16:46:34.382Z</published>
    <updated>2021-04-30T07:50:36.489Z</updated>
    
    <content type="html"><![CDATA[<p>在Docker中使用脚本备份MySQL的时候出现一个奇怪的问题，产生的备份文件大小都为零，没有任何数据。但是手动执行脚本文件时候，备份文件中数据是完整的。</p><ul><li>备份脚本如下</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># cat backup-mysql-redmine.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">bak_dir=<span class="string">"/backups/mysql-redmine"</span></span><br><span class="line">bak_time=`date +%Y%m%d-%H-%M-%S`</span><br><span class="line">docker <span class="built_in">exec</span> -it c51994799113 mysqldump -uroot -proot redmine &gt; <span class="variable">$bak_dir</span>/redmine-<span class="variable">$bak_time</span>.sql</span><br></pre></td></tr></table></figure><ul><li>计划任务如下</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># crontab -l</span></span><br><span class="line">*/5 * * * * /root/backup-mysql-redmine.sh</span><br></pre></td></tr></table></figure><ul><li>crontab产生备份文件如下</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host mysql-redmine]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Feb 21 00:45 redmine-20210221-00-45-01.sql</span><br><span class="line">-rw-r--r--. 1 root root 0 Feb 21 00:50 redmine-20210221-00-50-01.sql</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br></pre></td></tr></table></figure><ul><li>系统产生的邮件内容</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">[root@docker-host mysql-redmine]<span class="comment"># </span></span><br><span class="line">[root@docker-host mysql-redmine]<span class="comment"># </span></span><br><span class="line">[root@docker-host mysql-redmine]<span class="comment"># more /var/spool/mail/root </span></span><br><span class="line">From root@docker-host.localdomain  Sat Feb 20 21:55:01 2021</span><br><span class="line">Return-Path: &lt;root@docker-host.localdomain&gt;</span><br><span class="line">X-Original-To: root</span><br><span class="line">Delivered-To: root@docker-host.localdomain</span><br><span class="line">Received: by docker-host.localdomain (Postfix, from userid 0)</span><br><span class="line">id D3D0E619B686; Sat, 20 Feb 2021 21:55:01 +0800 (CST)</span><br><span class="line">From: <span class="string">"(Cron Daemon)"</span> &lt;root@docker-host.localdomain&gt;</span><br><span class="line">To: root@docker-host.localdomain</span><br><span class="line">Subject: Cron &lt;root@docker-host&gt; /root/backup-mysql-redmine.sh</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Auto-Submitted: auto-generated</span><br><span class="line">Precedence: bulk</span><br><span class="line">X-Cron-Env: &lt;XDG_SESSION_ID=6&gt;</span><br><span class="line">X-Cron-Env: &lt;XDG_RUNTIME_DIR=/run/user/0&gt;</span><br><span class="line">X-Cron-Env: &lt;LANG=en_US.UTF-8&gt;</span><br><span class="line">X-Cron-Env: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X-Cron-Env: &lt;HOME=/root&gt;</span><br><span class="line">X-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;</span><br><span class="line">X-Cron-Env: &lt;LOGNAME=root&gt;</span><br><span class="line">X-Cron-Env: &lt;USER=root&gt;</span><br><span class="line">Message-Id: &lt;20210220135501.D3D0E619B686@docker-host.localdomain&gt;</span><br><span class="line">Date: Sat, 20 Feb 2021 21:55:01 +0800 (CST)</span><br><span class="line"></span><br><span class="line">the input device is not a TTY</span><br></pre></td></tr></table></figure><ul><li><p>分析<br>上面的备份命令中从mysqldump之后的命令我们是理解的，跟正常的MySQL的备份使用是一致的，那么问题应该出现在<code>docker exec -it c51994799113</code>这半条命令里面，首先<code>docker exec</code>根据官网的描述是：Run a command in a running container，意思是说在容器中运行命令，那么排除了这条命令出现问题的可能。其次<code>c51994799113</code>这个只是MySQL的容器ID，那么问题应该就出现在<code>-it</code>这个参数上了，执行<code>docker exec --help</code>来查看命令的帮助： </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># docker exec --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker <span class="built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]</span><br><span class="line"></span><br><span class="line">Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -d, --detach               Detached mode: run <span class="built_in">command</span> <span class="keyword">in</span> the background</span><br><span class="line">      --detach-keys string   Override the key sequence <span class="keyword">for</span> detaching a container</span><br><span class="line">  -e, --env list             Set environment variables</span><br><span class="line">      --env-file list        Read <span class="keyword">in</span> a file of environment variables</span><br><span class="line">  -i, --interactive          Keep STDIN open even <span class="keyword">if</span> not attached</span><br><span class="line">      --privileged           Give extended privileges to the <span class="built_in">command</span></span><br><span class="line">  -t, --tty                  Allocate a pseudo-TTY</span><br><span class="line">  -u, --user string          Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">  -w, --workdir string       Working directory inside the container</span><br></pre></td></tr></table></figure><p>在帮助中找到tty相关，描述为分配一个伪tty终端。</p></li><li><p>总结<br>TTY是终端设备的统称，来源于Teletypes，或者teletypewriters。the input device is not a TTY 这句话的意思是：<br>后台Linux执行的时候不是终端设备。一般在docker里执行命令的时候都喜欢加上<code>-it</code>这个参数，这个参数表示终端设备，所以<br>Docker执行后台任务或者程序时去掉<code>-it</code>这个参数就可以了。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在Docker中使用脚本备份MySQL的时候出现一个奇怪的问题，产生的备份文件大小都为零，没有任何数据。但是手动执行脚本文件时候，备份文件中数据是完整的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;备份脚本如下&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;</summary>
      
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="Docker" scheme="http://mudbub.com/tags/Docker/"/>
    
    <category term="MySQL" scheme="http://mudbub.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7.9 安装 Docker</title>
    <link href="http://mudbub.com/2021/02/20/linux/docker-installation-for-centos79/"/>
    <id>http://mudbub.com/2021/02/20/linux/docker-installation-for-centos79/</id>
    <published>2021-02-20T15:02:32.735Z</published>
    <updated>2021-04-30T07:51:06.484Z</updated>
    
    <content type="html"><![CDATA[<ul><li>查看操作系统版本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br></pre></td></tr></table></figure><ul><li>安装yum-utils</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># yum -y install yum-utils</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package yum-utils.noarch 0:1.1.31-54.el7_8 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-kitchen <span class="keyword">for</span> package: yum-utils-1.1.31-54.el7_8.noarch</span><br><span class="line">--&gt; Processing Dependency: libxml2-python <span class="keyword">for</span> package: yum-utils-1.1.31-54.el7_8.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package libxml2-python.x86_64 0:2.9.1-6.el7.5 will be installed</span><br><span class="line">---&gt; Package python-kitchen.noarch 0:1.1.1-5.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-chardet <span class="keyword">for</span> package: python-kitchen-1.1.1-5.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package python-chardet.noarch 0:2.2.1-3.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==================================================================================</span><br><span class="line"> Package                Arch           Version                 Repository    Size</span><br><span class="line">==================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> yum-utils              noarch         1.1.31-54.el7_8         base         122 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> libxml2-python         x86_64         2.9.1-6.el7.5           base         247 k</span><br><span class="line"> python-chardet         noarch         2.2.1-3.el7             base         227 k</span><br><span class="line"> python-kitchen         noarch         1.1.1-5.el7             base         267 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==================================================================================</span><br><span class="line">Install  1 Package (+3 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 863 k</span><br><span class="line">Installed size: 4.3 M</span><br><span class="line">Downloading packages:</span><br><span class="line">Delta RPMs disabled because /usr/bin/applydeltarpm not installed.</span><br><span class="line">(1/4): libxml2-python-2.9.1-6.el7.5.x86_64.rpm             | 247 kB  00:00:00     </span><br><span class="line">(2/4): yum-utils-1.1.31-54.el7_8.noarch.rpm                | 122 kB  00:00:00     </span><br><span class="line">(3/4): python-chardet-2.2.1-3.el7.noarch.rpm               | 227 kB  00:00:00     </span><br><span class="line">(4/4): python-kitchen-1.1.1-5.el7.noarch.rpm               | 267 kB  00:00:00     </span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line">Total                                                1.5 MB/s | 863 kB  00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : python-chardet-2.2.1-3.el7.noarch                              1/4 </span><br><span class="line">  Installing : python-kitchen-1.1.1-5.el7.noarch                              2/4 </span><br><span class="line">  Installing : libxml2-python-2.9.1-6.el7.5.x86_64                            3/4 </span><br><span class="line">  Installing : yum-utils-1.1.31-54.el7_8.noarch                               4/4 </span><br><span class="line">  Verifying  : libxml2-python-2.9.1-6.el7.5.x86_64                            1/4 </span><br><span class="line">  Verifying  : python-kitchen-1.1.1-5.el7.noarch                              2/4 </span><br><span class="line">  Verifying  : yum-utils-1.1.31-54.el7_8.noarch                               3/4 </span><br><span class="line">  Verifying  : python-chardet-2.2.1-3.el7.noarch                              4/4 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  yum-utils.noarch 0:1.1.31-54.el7_8                                              </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  libxml2-python.x86_64 0:2.9.1-6.el7.5    python-chardet.noarch 0:2.2.1-3.el7   </span><br><span class="line">  python-kitchen.noarch 0:1.1.1-5.el7     </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><ul><li>添加阿里的yum（docker）源</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">adding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">grabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker-ce.repo</span><br></pre></td></tr></table></figure><ul><li>更新yum软件包索引</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># yum makecache fast</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">base                                                       | 3.6 kB  00:00:00     </span><br><span class="line">docker-ce-stable                                           | 3.5 kB  00:00:00     </span><br><span class="line">extras                                                     | 2.9 kB  00:00:00     </span><br><span class="line">updates                                                    | 2.9 kB  00:00:00     </span><br><span class="line">(1/2): docker-ce-stable/7/x86_64/primary_db                |  55 kB  00:00:01     </span><br><span class="line">(2/2): docker-ce-stable/7/x86_64/updateinfo                |   55 B  00:00:02     </span><br><span class="line">Metadata Cache Created</span><br></pre></td></tr></table></figure><ul><li>安装docker</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># yum -y install docker-ce docker-ce-cli containerd.io</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package containerd.io.x86_64 0:1.4.3-3.1.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: container-selinux &gt;= 2:2.74 <span class="keyword">for</span> package: containerd.io-1.4.3-3.1.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libseccomp <span class="keyword">for</span> package: containerd.io-1.4.3-3.1.el7.x86_64</span><br><span class="line">---&gt; Package docker-ce.x86_64 3:20.10.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: docker-ce-rootless-extras <span class="keyword">for</span> package: 3:docker-ce-20.10.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libcgroup <span class="keyword">for</span> package: 3:docker-ce-20.10.3-3.el7.x86_64</span><br><span class="line">---&gt; Package docker-ce-cli.x86_64 1:20.10.3-3.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package container-selinux.noarch 2:2.119.2-1.911c772.el7_8 will be installed</span><br><span class="line">--&gt; Processing Dependency: policycoreutils-python <span class="keyword">for</span> package: 2:container-selinux-2.119.2-1.911c772.el7_8.noarch</span><br><span class="line">---&gt; Package docker-ce-rootless-extras.x86_64 0:20.10.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: fuse-overlayfs &gt;= 0.7 <span class="keyword">for</span> package: docker-ce-rootless-extras-20.10.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: slirp4netns &gt;= 0.4 <span class="keyword">for</span> package: docker-ce-rootless-extras-20.10.3-3.el7.x86_64</span><br><span class="line">---&gt; Package libcgroup.x86_64 0:0.41-21.el7 will be installed</span><br><span class="line">---&gt; Package libseccomp.x86_64 0:2.3.1-4.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package fuse-overlayfs.x86_64 0:0.7.2-6.el7_8 will be installed</span><br><span class="line">--&gt; Processing Dependency: libfuse3.so.3(FUSE_3.2)(64bit) <span class="keyword">for</span> package: fuse-overlayfs-0.7.2-6.el7_8.x86_64</span><br><span class="line">--&gt; Processing Dependency: libfuse3.so.3(FUSE_3.0)(64bit) <span class="keyword">for</span> package: fuse-overlayfs-0.7.2-6.el7_8.x86_64</span><br><span class="line">--&gt; Processing Dependency: libfuse3.so.3()(64bit) <span class="keyword">for</span> package: fuse-overlayfs-0.7.2-6.el7_8.x86_64</span><br><span class="line">---&gt; Package policycoreutils-python.x86_64 0:2.5-34.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: setools-libs &gt;= 3.3.8-4 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libsemanage-python &gt;= 2.5-14 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: audit-libs-python &gt;= 2.1.3-4 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-IPy <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libqpol.so.1(VERS_1.4)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libqpol.so.1(VERS_1.2)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libapol.so.4(VERS_4.0)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: checkpolicy <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libqpol.so.1()(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libapol.so.4()(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span><br><span class="line">---&gt; Package slirp4netns.x86_64 0:0.4.3-4.el7_8 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package audit-libs-python.x86_64 0:2.8.5-4.el7 will be installed</span><br><span class="line">---&gt; Package checkpolicy.x86_64 0:2.5-8.el7 will be installed</span><br><span class="line">---&gt; Package fuse3-libs.x86_64 0:3.6.1-4.el7 will be installed</span><br><span class="line">---&gt; Package libsemanage-python.x86_64 0:2.5-14.el7 will be installed</span><br><span class="line">---&gt; Package python-IPy.noarch 0:0.75-6.el7 will be installed</span><br><span class="line">---&gt; Package setools-libs.x86_64 0:3.3.8-4.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==================================================================================</span><br><span class="line"> Package                  Arch   Version                   Repository        Size</span><br><span class="line">==================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> containerd.io            x86_64 1.4.3-3.1.el7             docker-ce-stable  33 M</span><br><span class="line"> docker-ce                x86_64 3:20.10.3-3.el7           docker-ce-stable  27 M</span><br><span class="line"> docker-ce-cli            x86_64 1:20.10.3-3.el7           docker-ce-stable  33 M</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> audit-libs-python        x86_64 2.8.5-4.el7               base              76 k</span><br><span class="line"> checkpolicy              x86_64 2.5-8.el7                 base             295 k</span><br><span class="line"> container-selinux        noarch 2:2.119.2-1.911c772.el7_8 extras            40 k</span><br><span class="line"> docker-ce-rootless-extras</span><br><span class="line">                          x86_64 20.10.3-3.el7             docker-ce-stable 9.0 M</span><br><span class="line"> fuse-overlayfs           x86_64 0.7.2-6.el7_8             extras            54 k</span><br><span class="line"> fuse3-libs               x86_64 3.6.1-4.el7               extras            82 k</span><br><span class="line"> libcgroup                x86_64 0.41-21.el7               base              66 k</span><br><span class="line"> libseccomp               x86_64 2.3.1-4.el7               base              56 k</span><br><span class="line"> libsemanage-python       x86_64 2.5-14.el7                base             113 k</span><br><span class="line"> policycoreutils-python   x86_64 2.5-34.el7                base             457 k</span><br><span class="line"> python-IPy               noarch 0.75-6.el7                base              32 k</span><br><span class="line"> setools-libs             x86_64 3.3.8-4.el7               base             620 k</span><br><span class="line"> slirp4netns              x86_64 0.4.3-4.el7_8             extras            81 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==================================================================================</span><br><span class="line">Install  3 Packages (+13 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 104 M</span><br><span class="line">Installed size: 428 M</span><br><span class="line">Downloading packages:</span><br><span class="line">(1/16): audit-libs-python-2.8.5-4.el7.x86_64.rpm           |  76 kB  00:00:00     </span><br><span class="line">(2/16): checkpolicy-2.5-8.el7.x86_64.rpm                   | 295 kB  00:00:00     </span><br><span class="line">(3/16): container-selinux-2.119.2-1.911c772.el7_8.noarch.r |  40 kB  00:00:00     </span><br><span class="line">warning: /var/cache/yum/x86_64/7/docker-ce-stable/packages/containerd.io-1.4.3-3.1.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEY</span><br><span class="line">Public key <span class="keyword">for</span> containerd.io-1.4.3-3.1.el7.x86_64.rpm is not installed</span><br><span class="line">(4/16): containerd.io-1.4.3-3.1.el7.x86_64.rpm             |  33 MB  00:00:20     </span><br><span class="line">(5/16): docker-ce-20.10.3-3.el7.x86_64.rpm                 |  27 MB  00:00:25     </span><br><span class="line">(6/16): fuse-overlayfs-0.7.2-6.el7_8.x86_64.rpm            |  54 kB  00:00:00     </span><br><span class="line">(7/16): libcgroup-0.41-21.el7.x86_64.rpm                   |  66 kB  00:00:00     </span><br><span class="line">(8/16): fuse3-libs-3.6.1-4.el7.x86_64.rpm                  |  82 kB  00:00:00     </span><br><span class="line">(9/16): libseccomp-2.3.1-4.el7.x86_64.rpm                  |  56 kB  00:00:00     </span><br><span class="line">(10/16): libsemanage-python-2.5-14.el7.x86_64.rpm          | 113 kB  00:00:00     </span><br><span class="line">(11/16): python-IPy-0.75-6.el7.noarch.rpm                  |  32 kB  00:00:00     </span><br><span class="line">(12/16): policycoreutils-python-2.5-34.el7.x86_64.rpm      | 457 kB  00:00:00     </span><br><span class="line">(13/16): setools-libs-3.3.8-4.el7.x86_64.rpm               | 620 kB  00:00:00     </span><br><span class="line">(14/16): slirp4netns-0.4.3-4.el7_8.x86_64.rpm              |  81 kB  00:00:00     </span><br><span class="line">(15/16): docker-ce-rootless-extras-20.10.3-3.el7.x86_64.rp | 9.0 MB  00:00:04     </span><br><span class="line">(16/16): docker-ce-cli-20.10.3-3.el7.x86_64.rpm            |  33 MB  00:00:09     </span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line">Total                                                3.4 MB/s | 104 MB  00:30     </span><br><span class="line">Retrieving key from https://download.docker.com/linux/centos/gpg</span><br><span class="line">Importing GPG key 0x621E9F35:</span><br><span class="line"> Userid     : <span class="string">"Docker Release (CE rpm) &lt;docker@docker.com&gt;"</span></span><br><span class="line"> Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35</span><br><span class="line"> From       : https://download.docker.com/linux/centos/gpg</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : libseccomp-2.3.1-4.el7.x86_64                                 1/16 </span><br><span class="line">  Installing : libcgroup-0.41-21.el7.x86_64                                  2/16 </span><br><span class="line">  Installing : slirp4netns-0.4.3-4.el7_8.x86_64                              3/16 </span><br><span class="line">  Installing : 1:docker-ce-cli-20.10.3-3.el7.x86_64                          4/16 </span><br><span class="line">  Installing : setools-libs-3.3.8-4.el7.x86_64                               5/16 </span><br><span class="line">  Installing : audit-libs-python-2.8.5-4.el7.x86_64                          6/16 </span><br><span class="line">  Installing : python-IPy-0.75-6.el7.noarch                                  7/16 </span><br><span class="line">  Installing : libsemanage-python-2.5-14.el7.x86_64                          8/16 </span><br><span class="line">  Installing : fuse3-libs-3.6.1-4.el7.x86_64                                 9/16 </span><br><span class="line">  Installing : fuse-overlayfs-0.7.2-6.el7_8.x86_64                          10/16 </span><br><span class="line">  Installing : checkpolicy-2.5-8.el7.x86_64                                 11/16 </span><br><span class="line">  Installing : policycoreutils-python-2.5-34.el7.x86_64                     12/16 </span><br><span class="line">  Installing : 2:container-selinux-2.119.2-1.911c772.el7_8.noarch           13/16 </span><br><span class="line">  Installing : containerd.io-1.4.3-3.1.el7.x86_64                           14/16 </span><br><span class="line">  Installing : docker-ce-rootless-extras-20.10.3-3.el7.x86_64               15/16 </span><br><span class="line">  Installing : 3:docker-ce-20.10.3-3.el7.x86_64                             16/16 </span><br><span class="line">  Verifying  : checkpolicy-2.5-8.el7.x86_64                                  1/16 </span><br><span class="line">  Verifying  : fuse3-libs-3.6.1-4.el7.x86_64                                 2/16 </span><br><span class="line">  Verifying  : 3:docker-ce-20.10.3-3.el7.x86_64                              3/16 </span><br><span class="line">  Verifying  : fuse-overlayfs-0.7.2-6.el7_8.x86_64                           4/16 </span><br><span class="line">  Verifying  : libsemanage-python-2.5-14.el7.x86_64                          5/16 </span><br><span class="line">  Verifying  : slirp4netns-0.4.3-4.el7_8.x86_64                              6/16 </span><br><span class="line">  Verifying  : 2:container-selinux-2.119.2-1.911c772.el7_8.noarch            7/16 </span><br><span class="line">  Verifying  : python-IPy-0.75-6.el7.noarch                                  8/16 </span><br><span class="line">  Verifying  : libseccomp-2.3.1-4.el7.x86_64                                 9/16 </span><br><span class="line">  Verifying  : containerd.io-1.4.3-3.1.el7.x86_64                           10/16 </span><br><span class="line">  Verifying  : policycoreutils-python-2.5-34.el7.x86_64                     11/16 </span><br><span class="line">  Verifying  : docker-ce-rootless-extras-20.10.3-3.el7.x86_64               12/16 </span><br><span class="line">  Verifying  : audit-libs-python-2.8.5-4.el7.x86_64                         13/16 </span><br><span class="line">  Verifying  : setools-libs-3.3.8-4.el7.x86_64                              14/16 </span><br><span class="line">  Verifying  : 1:docker-ce-cli-20.10.3-3.el7.x86_64                         15/16 </span><br><span class="line">  Verifying  : libcgroup-0.41-21.el7.x86_64                                 16/16 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  containerd.io.x86_64 0:1.4.3-3.1.el7      docker-ce.x86_64 3:20.10.3-3.el7     </span><br><span class="line">  docker-ce-cli.x86_64 1:20.10.3-3.el7     </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  audit-libs-python.x86_64 0:2.8.5-4.el7                                          </span><br><span class="line">  checkpolicy.x86_64 0:2.5-8.el7                                                  </span><br><span class="line">  container-selinux.noarch 2:2.119.2-1.911c772.el7_8                              </span><br><span class="line">  docker-ce-rootless-extras.x86_64 0:20.10.3-3.el7                                </span><br><span class="line">  fuse-overlayfs.x86_64 0:0.7.2-6.el7_8                                           </span><br><span class="line">  fuse3-libs.x86_64 0:3.6.1-4.el7                                                 </span><br><span class="line">  libcgroup.x86_64 0:0.41-21.el7                                                  </span><br><span class="line">  libseccomp.x86_64 0:2.3.1-4.el7                                                 </span><br><span class="line">  libsemanage-python.x86_64 0:2.5-14.el7                                          </span><br><span class="line">  policycoreutils-python.x86_64 0:2.5-34.el7                                      </span><br><span class="line">  python-IPy.noarch 0:0.75-6.el7                                                  </span><br><span class="line">  setools-libs.x86_64 0:3.3.8-4.el7                                               </span><br><span class="line">  slirp4netns.x86_64 0:0.4.3-4.el7_8                                              </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><ul><li>启动docker</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># systemctl start docker</span></span><br></pre></td></tr></table></figure><ul><li>查看docker服务的状态</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># systemctl status docker</span></span><br><span class="line">● docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2021-02-20 20:06:57 CST; 10s ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 1833 (dockerd)</span><br><span class="line">    Tasks: 8</span><br><span class="line">   Memory: 43.0M</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           └─1833 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/contai...</span><br><span class="line"></span><br><span class="line">Feb 20 20:06:57 docker-host dockerd[1833]: time=<span class="string">"2021-02-20T20:06:57.564408982...c</span></span><br><span class="line"><span class="string">Feb 20 20:06:57 docker-host dockerd[1833]: time="</span>2021-02-20T20:06:57.564424867...c</span><br><span class="line">Feb 20 20:06:57 docker-host dockerd[1833]: time=<span class="string">"2021-02-20T20:06:57.564434731...c</span></span><br><span class="line"><span class="string">Feb 20 20:06:57 docker-host dockerd[1833]: time="</span>2021-02-20T20:06:57.587687027...<span class="string">"</span></span><br><span class="line"><span class="string">Feb 20 20:06:57 docker-host dockerd[1833]: time="</span>2021-02-20T20:06:57.701550790...<span class="string">"</span></span><br><span class="line"><span class="string">Feb 20 20:06:57 docker-host dockerd[1833]: time="</span>2021-02-20T20:06:57.745648406...<span class="string">"</span></span><br><span class="line"><span class="string">Feb 20 20:06:57 docker-host dockerd[1833]: time="</span>2021-02-20T20:06:57.758999502...3</span><br><span class="line">Feb 20 20:06:57 docker-host dockerd[1833]: time=<span class="string">"2021-02-20T20:06:57.759132059..."</span></span><br><span class="line">Feb 20 20:06:57 docker-host systemd[1]: Started Docker Application Container ...e.</span><br><span class="line">Feb 20 20:06:57 docker-host dockerd[1833]: time=<span class="string">"2021-02-20T20:06:57.793207055..."</span></span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><ul><li>添加开机启动</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># systemctl enable docker</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br></pre></td></tr></table></figure><ul><li>查看docker版本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.3</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        48d30b5</span><br><span class="line"> Built:             Fri Jan 29 14:34:14 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.3</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       46229ca</span><br><span class="line">  Built:            Fri Jan 29 14:32:37 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.3</span><br><span class="line">  GitCommit:        269548fa27e0089a8b8278fc4fc781d7f65a939b</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc92</span><br><span class="line">  GitCommit:        ff819c7e9184c13b7c2607fe6c30ae19403a7aff</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure><ul><li>修改或新增docker镜像源</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host docker]<span class="comment"># vi  /etc/docker/daemon.json</span></span><br><span class="line">[root@docker-host docker]<span class="comment"># cat /etc/docker/daemon.json </span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"registry-mirrors"</span>: [<span class="string">"https://bytkgxyr.mirror.aliyuncs.com"</span>,<span class="string">"https://registry.docker-cn.com"</span>,<span class="string">"http://hub-mirror.c.163.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>测试docker</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-host docker]<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">Digest: sha256:31b9c7d48790f0d8c50ab433d9c3b7e17666d6993084c002c2ff1ca09b96391d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;查看操作系统版本&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;lin</summary>
      
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="Docker" scheme="http://mudbub.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ZABBIX SERVER IS NOT RENNING THE INFORMATION DISPLAYED MAY NOT BE CORRECT</title>
    <link href="http://mudbub.com/2021/01/27/linux/zabbix50-server-is-not-running/"/>
    <id>http://mudbub.com/2021/01/27/linux/zabbix50-server-is-not-running/</id>
    <published>2021-01-27T09:37:22.776Z</published>
    <updated>2021-04-30T07:52:14.040Z</updated>
    
    <content type="html"><![CDATA[<p>Zabbix 5.0 启动后总是弹出ZABBIX SERVER IS NOT RENNING: THE INFORMATION DISPLAYED MAY NOT BE CORRECT，服务器上的zabbix_server和zabbix_client状态都正常，根据网上的资料应该是selinux没有关闭，仔细查看才发现Linux 6.x和Linux 7.x的selinux永久关闭的配置文件的路径时不一样的，处理完错误后赶紧写个操作记录供大家参考学习。</p><a id="more"></a><ul><li>查看队列显示如下错误</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">connection to Zabbix server <span class="string">"localhost"</span> failed. Possible reasons:</span><br><span class="line">1. incorrect server IP/DNS <span class="keyword">in</span> the <span class="string">"zabbix.conf.php"</span>;</span><br><span class="line">2. incorrect DNS server configuration.</span><br><span class="line">Permission denied</span><br></pre></td></tr></table></figure><ul><li>查看操作系统版本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 8.1.1911 (Core)</span><br></pre></td></tr></table></figure><ul><li>查看Zabbix版本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># /usr/local/zabbix/sbin/zabbix_server -V</span></span><br><span class="line">zabbix_server (Zabbix) 5.0.1</span><br><span class="line">Revision c2a0b03480 25 May 2020, compilation time: Jun 10 2020 22:18:13</span><br><span class="line"></span><br><span class="line">Copyright (C) 2020 Zabbix SIA</span><br><span class="line">License GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl.html&gt;.</span><br><span class="line">This is free software: you are free to change and redistribute it according to</span><br><span class="line">the license. There is NO WARRANTY, to the extent permitted by law.</span><br></pre></td></tr></table></figure><ul><li>查看selinux状态</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># getenforce </span></span><br><span class="line">enforcing</span><br></pre></td></tr></table></figure><ul><li>关闭selinux并重启</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：selinux从7.x往后的永久修改关闭的文件跟6.x有很大的却别，6.x关闭的文件为/etc/sysconfig/selinux，而7.x及以后的版本修改的文件为/etc/selinux/config</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># vi /etc/selinux/config #SELINUX=disabled</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># reboot</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># getenforce </span></span><br><span class="line">Disabled</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Zabbix 5.0 启动后总是弹出ZABBIX SERVER IS NOT RENNING: THE INFORMATION DISPLAYED MAY NOT BE CORRECT，服务器上的zabbix_server和zabbix_client状态都正常，根据网上的资料应该是selinux没有关闭，仔细查看才发现Linux 6.x和Linux 7.x的selinux永久关闭的配置文件的路径时不一样的，处理完错误后赶紧写个操作记录供大家参考学习。&lt;/p&gt;</summary>
    
    
    
    <category term="DevOps" scheme="http://mudbub.com/categories/DevOps/"/>
    
    
    <category term="Zabbix" scheme="http://mudbub.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix 5.0 编译安装</title>
    <link href="http://mudbub.com/2021/01/27/linux/zabbix50-compile-installation/"/>
    <id>http://mudbub.com/2021/01/27/linux/zabbix50-compile-installation/</id>
    <published>2021-01-27T09:37:22.770Z</published>
    <updated>2021-04-30T07:52:04.364Z</updated>
    
    <content type="html"><![CDATA[<ul><li>平台：Oracle Linux 7.8</li><li>数据库：MySQL 8.0</li><li>中间件：Apache 2.4</li><li>PHP：PHP 7.2</li></ul><a id="more"></a><ul><li><p>关闭SELINUX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux</span></span><br></pre></td></tr></table></figure></li><li><p>关闭防火墙</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl disable --now firewalld</span></span><br></pre></td></tr></table></figure></li><li><p>安装LAMP</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># dnf install -y httpd php php-gd php-ldap php-mysqlnd php-json php-bcmath php-mbstring php-xml mysql mysql-server mysql-devel libevent-devel pcre-devel gcc gcc-c++ make libcurl-devel curl-* net-snmp* libxml2-* wget tar</span></span><br></pre></td></tr></table></figure></li><li><p>启动相关组件并设置为开机启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl enable --now httpd mysqlnd php-fpm</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl start httpd mysqld php-fpm</span></span><br></pre></td></tr></table></figure></li><li><p>解压并编译Zabbix5.0源码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># tar -zxvf /opt/zabbix-5.0.1.tar.gz</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># cd /opt/zabbix-5.0.1</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># /configure --prefix=/usr/local/zabbix --enable-server --enable-agent --with-mysql  --with-net-snmp --with-libcurl --with-libxml2</span></span><br></pre></td></tr></table></figure></li><li><p>登录mysql数据库，建立zabbix数据库用户等相关信息，先安装的数据为mysql8.0，直接root用户可登录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix mysql]<span class="comment"># mysql -u root</span></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.17 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">Query OK, 1 row affected, 2 warnings (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create user zabbix@localhost identified by <span class="string">'welcome1'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec) </span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure></li><li><p>按顺序导入sql</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/schema.sql</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/images.sql</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># mysql -u zabbix -p zabbix &lt; /opt/zabbix-5.0.1/database/mysql/data.sql</span></span><br></pre></td></tr></table></figure></li><li><p>修改zabbix server配置文件的数据库密码，配置文件位置：/usr/local/zabbix/etc/zabbix_server.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">DBPassword=welcome1</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>为zabbix server添加systemd启动文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vi /lib/systemd/system/zabbix-server.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Server</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line">After=mysql.service</span><br><span class="line">After=mysqld.service</span><br><span class="line">After=mariadb.service</span><br><span class="line">After=postgresql.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">"CONFFILE=/usr/local/zabbix/etc/zabbix_server.conf"</span></span><br><span class="line">EnvironmentFile=-/etc/sysconfig/zabbix-server</span><br><span class="line">Type=forking</span><br><span class="line">Restart=on-failure</span><br><span class="line">PIDFile=/tmp/zabbix_server.pid</span><br><span class="line">KillMode=control-group</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server -c <span class="variable">$CONFFILE</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -SIGTERM <span class="variable">$MAINPID</span></span><br><span class="line">RestartSec=10s</span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>为zabbix agent添加systemd启动文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vi /lib/systemd/system/zabbix-agent.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Agent</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">"CONFFILE=/usr/local/zabbix/etc/zabbix_agentd.conf"</span></span><br><span class="line">EnvironmentFile=-/etc/sysconfig/zabbix-agent</span><br><span class="line">Type=forking</span><br><span class="line">Restart=on-failure</span><br><span class="line">PIDFile=/tmp/zabbix_agentd.pid</span><br><span class="line">KillMode=control-group</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_agentd -c <span class="variable">$CONFFILE</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -SIGTERM <span class="variable">$MAINPID</span></span><br><span class="line">RestartSec=10s</span><br><span class="line">User=zabbix</span><br><span class="line">Group=zabbix</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>设置为开机启动并启动zabbix server和zabbix agent</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl enable --now zabbix-server</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl enable --now zabbix-agent</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl start zabbix-server</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl start zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 观察/tmp/zabbix_server.log有无错误，如果出现如下错误需要对zabbix用户增加授权</span></span><br><span class="line"><span class="comment"># mysql&gt; grant SUPER,SESSION_VARIABLES_ADMIN on *.* to 'zabbix'@'localhost';</span></span><br><span class="line">865:20200610:225723.864 Starting Zabbix Server. Zabbix 5.0.1 (revision c2a0b03480).</span><br><span class="line">865:20200610:225723.864 ****** Enabled features ******</span><br><span class="line">865:20200610:225723.864 SNMP monitoring:           YES</span><br><span class="line">865:20200610:225723.864 IPMI monitoring:            NO</span><br><span class="line">865:20200610:225723.864 Web monitoring:            YES</span><br><span class="line">865:20200610:225723.864 VMware monitoring:         YES</span><br><span class="line">865:20200610:225723.864 SMTP authentication:       YES</span><br><span class="line">865:20200610:225723.864 ODBC:                       NO</span><br><span class="line">865:20200610:225723.864 SSH support:                NO</span><br><span class="line">865:20200610:225723.864 IPv6 support:               NO</span><br><span class="line">865:20200610:225723.864 TLS support:                NO</span><br><span class="line">865:20200610:225723.864 ******************************</span><br><span class="line">865:20200610:225723.864 using configuration file: /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</span><br><span class="line">865:20200610:225723.870 [Z3001] connection to database <span class="string">'zabbix'</span> failed: [1227] Access denied; you need (at least one of) the SUPER, SYSTEM_VARIABLES_ADMIN or SESSION_VARIABLES_ADMIN privilege(s) <span class="keyword">for</span> this operation</span><br><span class="line">865:20200610:225723.870 Cannot connect to the database. Exiting...</span><br></pre></td></tr></table></figure></li><li><p>检查zabbix server的启动状态</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl status zabbix-server</span></span><br><span class="line">● zabbix-server.service - Zabbix Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/zabbix-server.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2020-06-10 22:59:57 CST; 11h ago</span><br><span class="line">  Process: 926 ExecStart=/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server -c <span class="variable">$CONFFILE</span> (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 928 (zabbix_server)</span><br><span class="line">    Tasks: 38 (<span class="built_in">limit</span>: 23588)</span><br><span class="line">   Memory: 47.8M</span><br><span class="line">   CGroup: /system.slice/zabbix-server.service</span><br><span class="line">           ├─928 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server -c /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</span><br><span class="line">           ├─929 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: configuration syncer [synced configuration <span class="keyword">in</span> 0.036692 sec, idle 60 sec]</span><br><span class="line">           ├─930 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: housekeeper [deleted 60 hist/trends, 0 items/triggers, 0 events, 0 sessions, 0 alarms, 0 audit items, 0 records <span class="keyword">in</span> 0.034538 sec, id&gt;</span><br><span class="line">           ├─931 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: timer <span class="comment">#1 [updated 0 hosts, suppressed 0 events in 0.000782 sec, idle 59 sec]</span></span><br><span class="line">           ├─932 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: http poller <span class="comment">#1 [got 0 values in 0.000887 sec, idle 5 sec]</span></span><br><span class="line">           ├─933 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: discoverer <span class="comment">#1 [processed 0 rules in 0.000880 sec, idle 60 sec]</span></span><br><span class="line">           ├─934 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: <span class="built_in">history</span> syncer <span class="comment">#1 [processed 0 values, 0 triggers in 0.000036 sec, idle 1 sec]</span></span><br><span class="line">           ├─935 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: <span class="built_in">history</span> syncer <span class="comment">#2 [processed 0 values, 0 triggers in 0.000049 sec, idle 1 sec]</span></span><br><span class="line">           ├─936 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: <span class="built_in">history</span> syncer <span class="comment">#3 [processed 0 values, 0 triggers in 0.000027 sec, idle 1 sec]</span></span><br><span class="line">           ├─937 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: <span class="built_in">history</span> syncer <span class="comment">#4 [processed 0 values, 0 triggers in 0.000030 sec, idle 1 sec]</span></span><br><span class="line">           ├─938 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: escalator <span class="comment">#1 [processed 0 escalations in 0.001530 sec, idle 3 sec]</span></span><br><span class="line">           ├─939 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: proxy poller <span class="comment">#1 [exchanged data with 0 proxies in 0.000028 sec, idle 5 sec]</span></span><br><span class="line">           ├─940 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: self-monitoring [processed data <span class="keyword">in</span> 0.000035 sec, idle 1 sec]</span><br><span class="line">           ├─941 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: task manager [processed 0 task(s) <span class="keyword">in</span> 0.000552 sec, idle 5 sec]</span><br><span class="line">           ├─942 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: poller <span class="comment">#1 [got 0 values in 0.000041 sec, idle 1 sec]</span></span><br><span class="line">           ├─943 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: poller <span class="comment">#2 [got 1 values in 0.000554 sec, idle 1 sec]</span></span><br><span class="line">           ├─944 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: poller <span class="comment">#3 [got 0 values in 0.000038 sec, idle 1 sec]</span></span><br><span class="line">           ├─945 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: poller <span class="comment">#4 [got 0 values in 0.000022 sec, idle 1 sec]</span></span><br><span class="line">           ├─946 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: poller <span class="comment">#5 [got 0 values in 0.000022 sec, idle 1 sec]</span></span><br><span class="line">           ├─947 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: unreachable poller <span class="comment">#1 [got 0 values in 0.000020 sec, idle 5 sec]</span></span><br><span class="line">           ├─948 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: trapper <span class="comment">#1 [processed data in 0.000532 sec, waiting for connection]</span></span><br><span class="line">           ├─949 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: trapper <span class="comment">#2 [processed data in 0.000589 sec, waiting for connection]</span></span><br><span class="line">           ├─950 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: trapper <span class="comment">#3 [processed data in 0.000450 sec, waiting for connection]</span></span><br><span class="line">           ├─951 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: trapper <span class="comment">#4 [processed data in 0.000663 sec, waiting for connection]</span></span><br><span class="line">           ├─952 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: trapper <span class="comment">#5 [processed data in 0.000391 sec, waiting for connection]</span></span><br><span class="line">           ├─953 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: icmp pinger <span class="comment">#1 [got 0 values in 0.000022 sec, idle 5 sec]</span></span><br><span class="line">           ├─954 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: alert manager <span class="comment">#1 [sent 0, failed 0 alerts, idle 5.005964 sec during 5.006082 sec]</span></span><br><span class="line">           ├─955 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: alerter <span class="comment">#1 started</span></span><br><span class="line">           ├─956 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: alerter <span class="comment">#2 started</span></span><br><span class="line">           ├─957 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: alerter <span class="comment">#3 started</span></span><br><span class="line">           ├─958 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: preprocessing manager <span class="comment">#1 [queued 0, processed 6 values, idle 5.002700 sec during 5.002968 sec]</span></span><br><span class="line">           ├─959 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: preprocessing worker <span class="comment">#1 started</span></span><br><span class="line">           ├─960 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: preprocessing worker <span class="comment">#2 started</span></span><br><span class="line">           ├─961 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: preprocessing worker <span class="comment">#3 started</span></span><br><span class="line">           ├─962 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: lld manager <span class="comment">#1 [processed 0 LLD rules during 5.004781 sec]</span></span><br><span class="line">           ├─963 /usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_server: lld worker <span class="comment">#1 [processed 1 LLD rules, idle 3598.022039 sec during 3598.152512 sec]</span></span><br></pre></td></tr></table></figure></li><li><p>拷贝zabbix的前端文件到apache默认的web目录，进行前端安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># cp -r /opt/zabbix-5.0.0/ui/* /var/www/html/</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># chown -R apache:apache /var/www/html/</span></span><br></pre></td></tr></table></figure></li><li><p>配置php参数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># sed -i 's#post_max_size = 8M#post_max_size = 16M#' /etc/php.ini</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># sed -i 's#max_execution_time = 30#max_execution_time = 300#' /etc/php.ini</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># sed -i 's#max_input_time = 60#max_input_time = 300#' /etc/php.ini</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># sed -i 's#;date.timezone =#date.timezone = Asia/Shanghai#' /etc/php.ini</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># systemctl restart php-fpm</span></span><br></pre></td></tr></table></figure></li><li><p>配置完成后使用浏览器访问Zabbix服务的ip进行web初始化</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-001.png"></li><li><p>检查各个组件是否正常</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-002.png"></li><li><p>输入Zabbix数据库密码</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-003.png"></li><li><p>Zabbix服务器详情</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-004.png"></li><li><p>初始化汇总信息</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-005.png"></li><li><p>初始化安装，如果提示无法创建配置，点击页面上的链接下载配置文件上传到指定位置，并修改属组为apache:apache</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-006.png"></li><li><p>初始化完成后登录，默认账号：Admin，密码：zabbix</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-007.png"></li><li><p>Zabbix主页</p><img src="http://qnlcbj437.mudbub.com/static/images/zbx-server-008.png"></li></ul>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;平台：Oracle Linux 7.8&lt;/li&gt;
&lt;li&gt;数据库：MySQL 8.0&lt;/li&gt;
&lt;li&gt;中间件：Apache 2.4&lt;/li&gt;
&lt;li&gt;PHP：PHP 7.2&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="DevOps" scheme="http://mudbub.com/categories/DevOps/"/>
    
    
    <category term="Zabbix" scheme="http://mudbub.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix5.0添加中文</title>
    <link href="http://mudbub.com/2021/01/27/linux/zabbix50-add-chinese-language/"/>
    <id>http://mudbub.com/2021/01/27/linux/zabbix50-add-chinese-language/</id>
    <published>2021-01-27T09:37:22.765Z</published>
    <updated>2021-04-30T07:51:54.687Z</updated>
    
    <content type="html"><![CDATA[<ul><li>Zabbix安装完成后模式英文显示，问了方便后期的使用，将通过安装相关中文包，将语言由原来的英文切换到中文</li></ul><a id="more"></a><ul><li>检查中文依赖包和相关组件的安装</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># locale -a | grep zh_CN</span></span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># dnf install langpacks-zh_CN.noarch</span></span><br><span class="line">CentOS-BaseOS-8 - Media                                                                                                                     243 kB/s | 3.9 kB     00:00</span><br><span class="line">CentOS-AppStream-8 - Media                                                                                                                  505 kB/s | 4.3 kB     00:00</span><br><span class="line">Dependencies resolved.</span><br><span class="line">============================================================================================================================================================================ Package                                      Architecture                      Version                                 Repository                                     Size</span><br><span class="line">============================================================================================================================================================================Installing:</span><br><span class="line"> langpacks-zh_CN                              noarch                            1.0-12.el8                              c8-media-AppStream                            9.6 k</span><br><span class="line">Installing weak dependencies:</span><br><span class="line"> glibc-langpack-zh                            x86_64                            2.28-72.el8                             c8-media-BaseOS                               2.1 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">============================================================================================================================================================================Install  2 Packages</span><br><span class="line"></span><br><span class="line">Total size: 2.2 M</span><br><span class="line">Installed size: 15 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                                                                                                                    1/1</span><br><span class="line">  Installing       : glibc-langpack-zh-2.28-72.el8.x86_64                                                                                                               1/2</span><br><span class="line">  Installing       : langpacks-zh_CN-1.0-12.el8.noarch                                                                                                                  2/2</span><br><span class="line">  Running scriptlet: langpacks-zh_CN-1.0-12.el8.noarch                                                                                                                  2/2</span><br><span class="line">  Verifying        : glibc-langpack-zh-2.28-72.el8.x86_64                                                                                                               1/2</span><br><span class="line">  Verifying        : langpacks-zh_CN-1.0-12.el8.noarch                                                                                                                  2/2</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  langpacks-zh_CN-1.0-12.el8.noarch                                                   glibc-langpack-zh-2.28-72.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># dnf install glibc-common</span></span><br><span class="line">Last metadata expiration check: 0:00:25 ago on Tue 18 Aug 2020 03:24:08 PM CST.</span><br><span class="line">Package glibc-common-2.28-72.el8.x86_64 is already installed.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">Nothing to <span class="keyword">do</span>.</span><br><span class="line">Complete!</span><br><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># dnf reinstall glibc-common</span></span><br><span class="line">Last metadata expiration check: 0:02:55 ago on Tue 18 Aug 2020 03:24:08 PM CST.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">============================================================================================================================================================================ Package                                   Architecture                        Version                                   Repository                                    Size</span><br><span class="line">============================================================================================================================================================================Reinstalling:</span><br><span class="line"> glibc-common                              x86_64                              2.28-72.el8                               c8-media-BaseOS                              811 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">============================================================================================================================================================================</span><br><span class="line">Total size: 811 k</span><br><span class="line">Installed size: 3.6 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                                                                                                                    1/1</span><br><span class="line">  Reinstalling     : glibc-common-2.28-72.el8.x86_64                                                                                                                    1/2</span><br><span class="line">  Cleanup          : glibc-common-2.28-72.el8.x86_64                                                                                                                    2/2</span><br><span class="line">  Running scriptlet: glibc-common-2.28-72.el8.x86_64                                                                                                                    2/2</span><br><span class="line">  Verifying        : glibc-common-2.28-72.el8.x86_64                                                                                                                    1/2</span><br><span class="line">  Verifying        : glibc-common-2.28-72.el8.x86_64                                                                                                                    2/2</span><br><span class="line"></span><br><span class="line">Reinstalled:</span><br><span class="line">  glibc-common-2.28-72.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><ul><li>查看中文包安装后的信息</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@pe-sysmonitor-zabbix ~]<span class="comment"># locale -a | grep zh_CN</span></span><br><span class="line">zh_CN</span><br><span class="line">zh_CN.gb18030</span><br><span class="line">zh_CN.gbk</span><br><span class="line">zh_CN.utf8</span><br></pre></td></tr></table></figure><ul><li>切换到中文后，部分监控项出现乱码</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/chrome_202008201639495.png"><ul><li>上传字体<br>把C:\Windows\Fonts下的黑体（simhei.ttf）字体上传到Zabbix服务器，并复制到/var/www/html/assets/fonts目录（注意文件权限），每个人的Zabbix的安装目录都不一样，查找下对应的assets/fonts即可,上传完成后修改include/defines.inc.php，具体修改内容如下：<br>复制define(‘ZBX_GRAPH_FONT_NAME’,           ‘DejaVuSans’); // font file name这一行并注释掉<br>修改字体名称为我们上传的字体define(‘ZBX_GRAPH_FONT_NAME’,           ‘DejaVuSans’); // font file name</li></ul><ul><li>刷新后再次查看监控项中文已经正常显示</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/chrome_202008201702326.png">]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;Zabbix安装完成后模式英文显示，问了方便后期的使用，将通过安装相关中文包，将语言由原来的英文切换到中文&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="DevOps" scheme="http://mudbub.com/categories/DevOps/"/>
    
    
    <category term="Zabbix" scheme="http://mudbub.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Openfiler安装配置</title>
    <link href="http://mudbub.com/2021/01/27/linux/openfiler-installation-and-configuration/"/>
    <id>http://mudbub.com/2021/01/27/linux/openfiler-installation-and-configuration/</id>
    <published>2021-01-27T09:37:22.758Z</published>
    <updated>2021-03-26T10:26:46.372Z</updated>
    
    <content type="html"><![CDATA[<ul><li>在workstation或者virtual box中创建一个内核为其他内核2.6x 64位的虚拟机，添加两块网卡，使用两块网卡来模拟磁盘多路径聚合，两块大小分别为10g和50g的硬盘，10g做为openfiler系统的安装磁盘，50g用来做LUN</li></ul><a id="more"></a><ul><li>挂在镜像，直接按回车</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile01.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>进入下一步</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile02.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>选择键盘</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile03.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>选择系统安装磁盘，添加两块磁盘，一定不要另外一块磁盘</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile04.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>选择卡网，默认选择后面再配置</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile05.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>选择时区</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile06.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>设置root密码</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile07.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>进入下一步进行安装</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile08.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>安装进度</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile09.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>安装完成后重启</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile10.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>启动后显示了web GUI信息</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile11.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>配置静态IP地址</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置eth0</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></span><br><span class="line"><span class="comment"># Intel Corporation 82545EM Gigabit Ethernet Controller (Copper)</span></span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=yes</span><br><span class="line">HWADDR=00:0C:29:9A:3B:BA</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.112.154</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.112.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置eth1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-eth1 </span></span><br><span class="line"><span class="comment"># Intel Corporation 82545EM Gigabit Ethernet Controller (Copper)</span></span><br><span class="line">DEVICE=eth1</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">HWADDR=00:0C:29:9A:3B:C4</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.112.155</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.112.1</span><br></pre></td></tr></table></figure><ul><li>访问web GUI页面，默认的用户名为<code>openfiler</code>，密码为<code>password</code></li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile12.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>status显示当前NAS的物理信息</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile13.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>开启iSCSI target</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile14.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击System设置目标主机信息，Network/Host可以填写IP地址或者是主机名，如果是主机名的话，需要配置hosts解析</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile15.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击Volume-&gt;Block Devices创建PV，系统预留5%，整块磁盘创建完成后，剩余的5%无法创建</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile17.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><p>&nbsp;</p><img src="http://qnlcbj437.mudbub.com/static/images/openfile18.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><p>&nbsp;</p><img src="http://qnlcbj437.mudbub.com/static/images/openfile19.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击Volume-&gt;Volume Groups创建VG</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile20.png"><p>&nbsp;</p><img src="http://qnlcbj437.mudbub.com/static/images/openfile21.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击Volume-&gt;Add Volume创建LV</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile22.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><img src="http://qnlcbj437.mudbub.com/static/images/openfile23.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击Volume-&gt;iSCSI Targets-&gt;Target Configuration设置IQN</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile24.png"><ul><li>点击Volume-&gt;iSCSI Targets-&gt;LUN Mapping挂载LUN</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile25.png?imageMogr2/auto-orient/thumbnail/700x/blur/1x0/quality/100|imageslim"><ul><li>点击Volume-&gt;iSCSI Targets-&gt;Network ACL设置目标主机访问权限</li></ul><img src="http://qnlcbj437.mudbub.com/static/images/openfile26.png"><ul><li>目标主机安装iSCSI包</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># yum -y install iscsi-initiator-utils</span></span><br><span class="line">Loaded plugins: security, ulninfo</span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package iscsi-initiator-utils.x86_64 0:6.2.0.873-27.0.3.el6_9 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line"> Package                                               Arch                                   Version                                                  Repository                                         Size</span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> iscsi-initiator-utils                                 x86_64                                 6.2.0.873-27.0.3.el6_9                                   public_ol6_latest                                 738 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 738 k</span><br><span class="line">Installed size: 2.5 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">warning: rpmts_HdrFromFdno: Header V3 RSA/SHA256 Signature, key ID ec551f03: NOKEY</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracle</span><br><span class="line">Importing GPG key 0xEC551F03:</span><br><span class="line"> Userid : Oracle OSS group (Open Source Software group) &lt;build@oss.oracle.com&gt;</span><br><span class="line"> Package: 6:oraclelinux-release-6Server-10.0.2.x86_64 (@anaconda-OracleLinuxServer-201806251353.x86_64/6.10)</span><br><span class="line"> From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-oracle</span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : iscsi-initiator-utils-6.2.0.873-27.0.3.el6_9.x86_64                                                                                                                                         1/1 </span><br><span class="line">  Verifying  : iscsi-initiator-utils-6.2.0.873-27.0.3.el6_9.x86_64                                                                                                                                         1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  iscsi-initiator-utils.x86_64 0:6.2.0.873-27.0.3.el6_9                                                                                                                                                        </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><ul><li>查找存储对外提供的卷</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># iscsiadm -m discovery -t st -p 192.168.112.154</span></span><br><span class="line">Starting iscsid:                                           [  OK  ]</span><br><span class="line">192.168.112.154:3260,1 iqn.2006-01.com.openfiler:tsn.dev019527</span><br><span class="line">192.168.112.155:3260,1 iqn.2006-01.com.openfiler:tsn.dev019527</span><br></pre></td></tr></table></figure><ul><li>映射逻辑卷到系统中</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.154:3260 -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.154,3260] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.154,3260] successful.</span><br><span class="line">[root@dev01 ~]<span class="comment"># iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.155:3260 -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.155,3260] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.2006-01.com.openfiler:tsn.dev019527, portal: 192.168.112.155,3260] successful.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看LUN的映射，两条路径对应两块分盘</span></span><br><span class="line">Disk /dev/sdb: 51.2 GB, 51170508800 bytes</span><br><span class="line">64 heads, 32 sectors/track, 48800 cylinders</span><br><span class="line">Units = cylinders of 2048 * 512 = 1048576 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sdc: 51.2 GB, 51170508800 bytes</span><br><span class="line">64 heads, 32 sectors/track, 48800 cylinders</span><br><span class="line">Units = cylinders of 2048 * 512 = 1048576 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br></pre></td></tr></table></figure><ul><li>设置开机自动映射</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.154:3260 -o update -n node.startup -v automatic</span></span><br><span class="line">[root@dev01 ~]<span class="comment"># iscsiadm -m node -T iqn.2006-01.com.openfiler:tsn.dev019527 -p 192.168.112.155:3260 -o update -n node.startup -v automatic</span></span><br></pre></td></tr></table></figure><ul><li>安装多路径包</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># yum -y install device-mapper-multipath</span></span><br><span class="line">Loaded plugins: security, ulninfo</span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package device-mapper-multipath.x86_64 0:0.4.9-106.0.1.el6 will be installed</span><br><span class="line">--&gt; Processing Dependency: device-mapper-multipath-libs = 0.4.9-106.0.1.el6 <span class="keyword">for</span> package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64</span><br><span class="line">--&gt; Processing Dependency: libmultipath.so()(64bit) <span class="keyword">for</span> package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64</span><br><span class="line">--&gt; Processing Dependency: libmpathpersist.so.0()(64bit) <span class="keyword">for</span> package: device-mapper-multipath-0.4.9-106.0.1.el6.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package device-mapper-multipath-libs.x86_64 0:0.4.9-106.0.1.el6 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line"> Package                                                      Arch                                   Version                                           Repository                                         Size</span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> device-mapper-multipath                                      x86_64                                 0.4.9-106.0.1.el6                                 public_ol6_latest                                 134 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> device-mapper-multipath-libs                                 x86_64                                 0.4.9-106.0.1.el6                                 public_ol6_latest                                 205 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===============================================================================================================================================================================================================</span><br><span class="line">Install       2 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 339 k</span><br><span class="line">Installed size: 699 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                           39 MB/s | 339 kB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : device-mapper-multipath-libs-0.4.9-106.0.1.el6.x86_64                                                                                                                                       1/2 </span><br><span class="line">  Installing : device-mapper-multipath-0.4.9-106.0.1.el6.x86_64                                                                                                                                            2/2 </span><br><span class="line">  Verifying  : device-mapper-multipath-libs-0.4.9-106.0.1.el6.x86_64                                                                                                                                       1/2 </span><br><span class="line">  Verifying  : device-mapper-multipath-0.4.9-106.0.1.el6.x86_64                                                                                                                                            2/2 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  device-mapper-multipath.x86_64 0:0.4.9-106.0.1.el6                                                                                                                                                           </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  device-mapper-multipath-libs.x86_64 0:0.4.9-106.0.1.el6                                                                                                                                                      </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制multipath.conf到etc</span></span><br><span class="line">[root@dev01 ~]<span class="comment"># cp /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf /etc/</span></span><br></pre></td></tr></table></figure><ul><li>配置多路径聚合</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取磁盘的WWID号</span></span><br><span class="line">[root@dev01 ~]<span class="comment"># scsi_id -g -u -d /dev/sdb </span></span><br><span class="line">14f504e46494c4552523758456c352d437752492d59774b6e</span><br><span class="line">[root@dev01 ~]<span class="comment"># scsi_id -g -u -d /dev/sdc</span></span><br><span class="line">14f504e46494c4552523758456c352d437752492d59774b6e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑multipath.conf</span></span><br><span class="line">defaults &#123;</span><br><span class="line">user_friendly_names yes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">blacklist &#123; </span><br><span class="line">devnode <span class="string">"^sda"</span> </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">multipaths &#123;</span><br><span class="line">multipath &#123; </span><br><span class="line">wwid <span class="string">"14f504e46494c4552523758456c352d437752492d59774b6e"</span></span><br><span class="line"><span class="built_in">alias</span> lv_dev01</span><br><span class="line">path_grouping_policymultibus</span><br><span class="line">path_selector<span class="string">"round-robin 0"</span> </span><br><span class="line">  failbackmanual </span><br><span class="line">  rr_weightpriorities </span><br><span class="line">  no_path_retry5 </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>查看聚合后的磁盘信息</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># multipath -ll</span></span><br><span class="line">lv_dev01 (14f504e46494c4552523758456c352d437752492d59774b6e) dm-3 OPNFILER,VIRTUAL-DISK</span><br><span class="line">size=48G features=<span class="string">'1 queue_if_no_path'</span> hwhandler=<span class="string">'0'</span> wp=rw</span><br><span class="line">`-+- policy=<span class="string">'round-robin 0'</span> prio=1 status=active</span><br><span class="line">  |- 3:0:0:0 sdb 8:16 active ready running</span><br><span class="line">  `- 4:0:0:0 sdc 8:32 active ready running</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看磁盘映射</span></span><br><span class="line">[root@dev01 ~]<span class="comment"># ll /dev/mapper/*</span></span><br><span class="line">crw-rw----. 1 root root 10, 236 Mar 26 15:00 /dev/mapper/control</span><br><span class="line">lrwxrwxrwx. 1 root root       7 Mar 30 19:41 /dev/mapper/lv_dev01 -&gt; ../dm-3</span><br><span class="line">lrwxrwxrwx. 1 root root       7 Mar 26 15:00 /dev/mapper/VolGroup-lv_home -&gt; ../dm-2</span><br><span class="line">lrwxrwxrwx. 1 root root       7 Mar 26 15:00 /dev/mapper/VolGroup-lv_root -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx. 1 root root       7 Mar 26 15:00 /dev/mapper/VolGroup-lv_swap -&gt; ../dm-1</span><br></pre></td></tr></table></figure><ul><li>将iSCSI服务和multipathd服务设置为开启启动</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dev01 ~]<span class="comment"># chkconfig --level 2345 iscsi on</span></span><br><span class="line">[root@dev01 ~]<span class="comment"># chkconfig --level 2345 multipathd on</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;在workstation或者virtual box中创建一个内核为其他内核2.6x 64位的虚拟机，添加两块网卡，使用两块网卡来模拟磁盘多路径聚合，两块大小分别为10g和50g的硬盘，10g做为openfiler系统的安装磁盘，50g用来做LUN&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="NAS" scheme="http://mudbub.com/categories/NAS/"/>
    
    
    <category term="Openfiler" scheme="http://mudbub.com/tags/Openfiler/"/>
    
  </entry>
  
  <entry>
    <title>Linux 7.8安装配置VNCSERVER</title>
    <link href="http://mudbub.com/2021/01/27/linux/linux78-config-vncserver/"/>
    <id>http://mudbub.com/2021/01/27/linux/linux78-config-vncserver/</id>
    <published>2021-01-27T09:37:22.752Z</published>
    <updated>2021-04-30T07:51:15.891Z</updated>
    
    <content type="html"><![CDATA[<ul><li>查看系统版本<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 7.8.2003 (Core)</span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><ul><li>关闭防火墙</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@aproddb19c ~]<span class="comment"># systemctl status firewalld</span></span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"></span><br><span class="line">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: <span class="string">'/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --in-interface virbr0 --out-interface virbr...hat chain?).</span></span><br><span class="line"><span class="string">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '</span>/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --out-interface virbr0 --jump REJECT<span class="string">' faile...y that name.</span></span><br><span class="line"><span class="string">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '</span>/usr/sbin/iptables -w10 -w --table filter --delete FORWARD --<span class="keyword">in</span>-interface virbr0 --jump REJECT<span class="string">' failed...y that name.</span></span><br><span class="line"><span class="string">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '</span>/usr/sbin/iptables -w10 -w --table filter --delete INPUT --<span class="keyword">in</span>-interface virbr0 --protocol udp --destin...hat chain?).</span><br><span class="line">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: <span class="string">'/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol tcp --destin...hat chain?).</span></span><br><span class="line"><span class="string">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '</span>/usr/sbin/iptables -w10 -w --table filter --delete OUTPUT --out-interface virbr0 --protocol udp --dest...hat chain?).</span><br><span class="line">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: <span class="string">'/usr/sbin/iptables -w10 -w --table filter --delete INPUT --in-interface virbr0 --protocol udp --destin...hat chain?).</span></span><br><span class="line"><span class="string">Jun 30 10:59:40 aproddb19c firewalld[6550]: WARNING: COMMAND_FAILED: '</span>/usr/sbin/iptables -w10 -w --table filter --delete INPUT --<span class="keyword">in</span>-interface virbr0 --protocol tcp --destin...hat chain?).</span><br><span class="line">Jun 30 10:59:48 aproddb19c systemd[1]: Stopping firewalld - dynamic firewall daemon...</span><br><span class="line">Jun 30 10:59:49 aproddb19c systemd[1]: Stopped firewalld - dynamic firewall daemon.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br><span class="line">[root@aproddb19c ~]<span class="comment"># systemctl disable firewalld</span></span><br></pre></td></tr></table></figure><ul><li>安装vncserver</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c ~]<span class="comment"># yum -y install tigervnc-server</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package tigervnc-server.x86_64 0:1.8.0-19.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line">Dependencies Resolved</span><br><span class="line">===========================================================================================================================================================================================</span><br><span class="line"> Package                                          Arch                                    Version                                          Repository                                 Size</span><br><span class="line">===========================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> tigervnc-server                                  x86_64                                  1.8.0-19.el7                                     c7-media                                  216 k</span><br><span class="line">Transaction Summary</span><br><span class="line">===========================================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line">Total download size: 216 k</span><br><span class="line">Installed size: 510 k</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : tigervnc-server-1.8.0-19.el7.x86_64                                                                                                                                     1/1 </span><br><span class="line">  Verifying  : tigervnc-server-1.8.0-19.el7.x86_64                                                                                                                                     1/1 </span><br><span class="line">Installed:</span><br><span class="line">  tigervnc-server.x86_64 0:1.8.0-19.el7                                                                                                                                                    </span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><ul><li>复制并修改配置文件</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c ~]<span class="comment"># cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@.service</span></span><br><span class="line">[root@aproddb19c ~]<span class="comment"># vi /etc/systemd/system/vncserver@.service </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑完成后的内容</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Remote desktop service (VNC)</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clean any existing files in /tmp/.X11-unix environment</span></span><br><span class="line">ExecStartPre=/bin/sh -c <span class="string">'/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || :'</span></span><br><span class="line"><span class="comment"># ExecStart=/usr/bin/vncserver_wrapper &lt;USER&gt; %i</span></span><br><span class="line">ExecStart=/sbin/runuser -l root -c <span class="string">"/usr/bin/vncserver %i"</span></span><br><span class="line">PIDFile=/root/.vnc/%H%i.pid</span><br><span class="line">ExecStop=/bin/sh -c <span class="string">'/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || :'</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><ul><li>设置vnc密码</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c ~]<span class="comment"># vncpasswd</span></span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br><span class="line">Would you like to enter a view-only password (y/n)? </span><br><span class="line">A view-only password is not used</span><br></pre></td></tr></table></figure><ul><li>启动vnc服务并查看服务的状态</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@aproddb19c system]<span class="comment"># systemctl daemon-reload</span></span><br><span class="line">[root@aproddb19c system]<span class="comment"># systemctl start vncserver@:1</span></span><br><span class="line">[root@aproddb19c system]<span class="comment"># systemctl status vncserver@:1</span></span><br><span class="line">● vncserver@:1.service - Remote desktop service (VNC)</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/vncserver@.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2020-06-27 17:27:52 CST; 5s ago</span><br><span class="line">  Process: 7301 ExecStartPre=/bin/sh -c /usr/bin/vncserver -<span class="built_in">kill</span> %i &gt; /dev/null 2&gt;&amp;1 || : (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 7325 (Xvnc)</span><br><span class="line">   CGroup: /system.slice/system-vncserver.slice/vncserver@:1.service</span><br><span class="line">           ‣ 7325 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop aproddb19c:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 590...</span><br><span class="line"></span><br><span class="line">Jun 27 17:27:52 aproddb19c systemd[1]: Starting Remote desktop service (VNC)...</span><br><span class="line">Jun 27 17:27:52 aproddb19c systemd[1]: Started Remote desktop service (VNC).</span><br></pre></td></tr></table></figure><ul><li>测试连接<img src="http://qnlcbj437.mudbub.com/static/images/testvcnserver01.png"></li></ul>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;查看系统版本&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@aproddb19c ~]&lt;span class=&quot;comment&quot;&gt;# cat /etc/redhat-release &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CentOS Linux release 7.8.2003 (Core)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="VNC" scheme="http://mudbub.com/tags/VNC/"/>
    
  </entry>
  
  <entry>
    <title>Linux扩展swap分区</title>
    <link href="http://mudbub.com/2021/01/27/linux/linux-extend-swap/"/>
    <id>http://mudbub.com/2021/01/27/linux/linux-extend-swap/</id>
    <published>2021-01-27T09:37:22.745Z</published>
    <updated>2021-03-26T10:26:38.073Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>查看现有的swap分区大小</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ystdb11g ~]<span class="comment"># free -m</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          1725       1618        106          8         81        872</span><br><span class="line">-/+ buffers/cache:        664       1060</span><br><span class="line">Swap:         2047         13       2034</span><br></pre></td></tr></table></figure><a id="more"></a></li><li><p>增加交换分区文件大小，bs为块大小，count为块的数量，增加2GB大小的swap交换分区，写法如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ystdb11g ~]<span class="comment"># dd if=/dev/zero of=/opt/swap01 bs=1M count=2048</span></span><br><span class="line">2048+0 records <span class="keyword">in</span></span><br><span class="line">2048+0 records out</span><br></pre></td></tr></table></figure></li><li><p>设置交换文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ystdb11g ~]<span class="comment"># mkswap /opt/swap01</span></span><br><span class="line">Setting up swapspace version 1, size = 2097148 KiB</span><br><span class="line">no label, UUID=739f980d-ab1a-4858-bcc5-f5389d4365ef</span><br></pre></td></tr></table></figure></li><li><p>启用交换分区文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ystdb11g ~]<span class="comment"># swapon /opt/swap01</span></span><br></pre></td></tr></table></figure></li><li><p>查看扩展后的交换分区</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ystdb11g ~]<span class="comment"># free -m</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          1725       1631         93          8          2       1041</span><br><span class="line">-/+ buffers/cache:        587       1137</span><br><span class="line">Swap:         4095         36       4059</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;查看现有的swap分区大小&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@ystdb11g ~]&lt;span class=&quot;comment&quot;&gt;# free -m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             total       used       free     shared    buffers     cached&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mem:          1725       1618        106          8         81        872&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-/+ buffers/cache:        664       1060&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Swap:         2047         13       2034&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="SWAP" scheme="http://mudbub.com/tags/SWAP/"/>
    
  </entry>
  
  <entry>
    <title>Linux下创建模拟僵尸进程并杀死</title>
    <link href="http://mudbub.com/2021/01/27/linux/linux-create-zombie-processes-and-killed/"/>
    <id>http://mudbub.com/2021/01/27/linux/linux-create-zombie-processes-and-killed/</id>
    <published>2021-01-27T09:37:22.740Z</published>
    <updated>2021-03-26T10:26:30.474Z</updated>
    
    <content type="html"><![CDATA[<p>僵尸进程是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出，子进程被init接管，子进程退出后init会回收其占用的相关资源。我们都知道进程的工作原理。我们启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。进程停止后，该进程就会从进程表中移除。下面通过一个示例，在Linux下模拟创建僵尸进程，并通过查找僵尸进程并杀死僵尸进程的过程。</p><a id="more"></a><ul><li>创建僵尸进程</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/wait.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">pid_t</span> pid=fork();</span><br><span class="line">        <span class="keyword">if</span>(pid==<span class="number">-1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pid==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"son pid is %d\n"</span>,getpid());</span><br><span class="line">                <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">"son---i=%d\n"</span>,i);</span><br><span class="line">                        i++;</span><br><span class="line">                        sleep(<span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">if</span>(i==<span class="number">5</span>)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"son is over!\n"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(pid&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"parent pid is %d\n"</span>,getpid());</span><br><span class="line">                <span class="keyword">while</span>(<span class="number">1</span>) sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>查看僵尸进程</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">top - 11:20:26 up 5 days, 1 min,  2 users,  load average: 0.18, 0.32, 0.44</span><br><span class="line">Tasks: 379 total,   1 running, 376 sleeping,   1 stopped,   1 zombie                 &lt;&lt;&lt;&lt;&lt;&lt; 僵尸进程</span><br><span class="line">Cpu(s):  6.1%us,  5.5%sy,  0.0%ni, 84.4%id,  3.8%wa,  0.0%hi,  0.2%si,  0.0%st</span><br><span class="line">Mem:   4045668k total,  3835188k used,   210480k free,   231976k buffers</span><br><span class="line">Swap:  4194300k total,  1039544k used,  3154756k free,  2101984k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND  </span><br><span class="line"> 4577 grid      RT   0 1103m 128m  58m S  3.9  3.2  58:10.06 ocssd.bin</span><br><span class="line"> 9946 root      RT   0  828m  95m  60m S  3.9  2.4 171:54.39 osysmond.bin</span><br><span class="line">10158 root      RT  -5  826m 158m  66m S  3.9  4.0 112:46.22 ologgerd</span><br><span class="line">   18 root      20   0     0    0    0 S  1.9  0.0   9:53.31 rcuos/1</span><br><span class="line"> 4474 grid      20   0 1137m  38m  24m S  1.9  1.0  25:10.52 oraagent.bin</span><br><span class="line"> 5594 oracle    -2   0 1953m  40m  40m S  1.9  1.0 140:08.02 oracle</span><br><span class="line"> 5608 oracle    20   0 1966m  65m  57m S  1.9  1.7  26:11.98 oracle</span><br><span class="line"> 5614 oracle    -2   0 1968m 686m 675m S  1.9 17.4  20:10.71 oracle</span><br><span class="line">19583 root      20   0     0    0    0 S  1.9  0.0   0:01.02 kworker/u4:1</span><br><span class="line">26619 root      20   0     0    0    0 S  1.9  0.0   0:00.02 kworker/u4:0</span><br><span class="line">26717 root      20   0 15216 2240 1720 R  1.9  0.1   0:00.02 top</span><br><span class="line">    1 root      20   0 19396 1736 1532 S  0.0  0.0   0:04.20 init</span><br><span class="line">    2 root      20   0     0    0    0 S  0.0  0.0   0:00.07 kthreadd</span><br><span class="line">    3 root      20   0     0    0    0 S  0.0  0.0   2:33.69 ksoftirqd/0</span><br><span class="line">    5 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 kworker/0:0H</span><br><span class="line">    7 root      20   0     0    0    0 S  0.0  0.0  20:46.80 rcu_sched</span><br><span class="line">    8 root      20   0     0    0    0 S  0.0  0.0   0:00.00 rcu_bh</span><br><span class="line">    9 root      20   0     0    0    0 S  0.0  0.0   9:45.87 rcuos/0</span><br><span class="line">   10 root      20   0     0    0    0 S  0.0  0.0   0:00.00 rcuob/0</span><br><span class="line">   11 root      RT   0     0    0    0 S  0.0  0.0   0:01.38 migration/0</span><br><span class="line">   12 root      RT   0     0    0    0 S  0.0  0.0   0:01.40 watchdog/0</span><br><span class="line">   13 root      RT   0     0    0    0 S  0.0  0.0   0:01.38 watchdog/1</span><br><span class="line">   14 root      RT   0     0    0    0 S  0.0  0.0   0:01.33 migration/1</span><br><span class="line">   15 root      20   0     0    0    0 S  0.0  0.0   2:01.14 ksoftirqd/1</span><br><span class="line">   17 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 kworker/1:0H</span><br><span class="line">   19 root      20   0     0    0    0 S  0.0  0.0   0:00.00 rcuob/1</span><br><span class="line">   20 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 khelper</span><br><span class="line">   21 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kdevtmpfs</span><br><span class="line">   22 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 netns</span><br><span class="line">   23 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 perf</span><br><span class="line">   24 root      20   0     0    0    0 S  0.0  0.0   0:00.49 khungtaskd</span><br><span class="line">   25 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 writeback</span><br><span class="line">   26 root      25   5     0    0    0 S  0.0  0.0   0:00.00 ksmd</span><br><span class="line">   28 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 crypto</span><br><span class="line">   29 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 kintegrityd</span><br><span class="line">   30 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 bioset</span><br><span class="line">   31 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 kblockd</span><br><span class="line">   32 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 ata_sff</span><br><span class="line">   33 root       0 -20     0    0    0 S  0.0  0.0   0:00.00 md</span><br><span class="line">   36 root      20   0     0    0    0 S  0.0  0.0   0:08.09 kswapd0:0</span><br><span class="line">   37 root      20   0     0    0    0 S  0.0  0.0   0:00.00 fsnotify_mark</span><br></pre></td></tr></table></figure><ul><li>查找具体的僵尸进程</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># ps aux | grep Z</span></span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root     26698  0.0  0.0      0     0 pts/0    Z+   11:20   0:00 [<span class="built_in">test</span>] &lt;defunct&gt;</span><br><span class="line">root     26732  0.0  0.0 103392  2076 pts/1    S+   11:20   0:00 grep Z</span><br></pre></td></tr></table></figure><ul><li>查找僵尸进程的父进程</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># ps aux | grep test</span></span><br><span class="line">root     26697  0.0  0.0   3984   400 pts/0    S+   11:20   0:00 ./<span class="built_in">test</span></span><br><span class="line">root     26698  0.0  0.0      0     0 pts/0    Z+   11:20   0:00 [<span class="built_in">test</span>] &lt;defunct&gt;     &lt;&lt;&lt;&lt;&lt;&lt;&lt; 进程子ID</span><br><span class="line">root     26874  0.0  0.0 103388  2148 pts/1    S+   11:20   0:00 grep <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[root@rac1 ~]<span class="comment"># ps -ef | grep 26698</span></span><br><span class="line">root     26698 26697  0 11:20 pts/0    00:00:00 [<span class="built_in">test</span>] &lt;defunct&gt;                      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; 进程父ID</span><br><span class="line">root     26906 23344  0 11:20 pts/1    00:00:00 grep 26698</span><br></pre></td></tr></table></figure><ul><li>杀死僵尸进程</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># kill -s 9 26697</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;僵尸进程是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出，子进程被init接管，子进程退出后init会回收其占用的相关资源。我们都知道进程的工作原理。我们启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。进程停止后，该进程就会从进程表中移除。下面通过一个示例，在Linux下模拟创建僵尸进程，并通过查找僵尸进程并杀死僵尸进程的过程。&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://mudbub.com/tags/Linux/"/>
    
    <category term="Zombie" scheme="http://mudbub.com/tags/Zombie/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 8 Mini installed then installation Desktop</title>
    <link href="http://mudbub.com/2021/01/27/linux/centos8-mini-installed-then-install-desktop/"/>
    <id>http://mudbub.com/2021/01/27/linux/centos8-mini-installed-then-install-desktop/</id>
    <published>2021-01-27T09:37:22.734Z</published>
    <updated>2021-04-30T07:50:47.124Z</updated>
    
    <content type="html"><![CDATA[<ul><li>CentOS 8 系列默认以文本模式或者最小化安装，后期图形桌面的安装和图形桌面的卸载过程。</li></ul><a id="more"></a><ul><li>列出可以安装的选项 </li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@yongstoneinc yum.repos.d]<span class="comment"># yum grouplist</span></span><br><span class="line">CentOS-BaseOS-8 - Media                                                                                                                      71 MB/s | 2.2 MB     00:00</span><br><span class="line">CentOS-AppStream-8 - Media                                                                                                                   85 MB/s | 5.7 MB     00:00</span><br><span class="line">Available Environment Groups:</span><br><span class="line">   Server with GUI</span><br><span class="line">   Server</span><br><span class="line">   Workstation</span><br><span class="line">   Custom Operating System</span><br><span class="line">   Virtualization Host</span><br><span class="line">Installed Environment Groups:</span><br><span class="line">   Minimal Install</span><br><span class="line">Available Groups:</span><br><span class="line">   Legacy UNIX Compatibility</span><br><span class="line">   Container Management</span><br><span class="line">   Development Tools</span><br><span class="line">   .NET Core Development</span><br><span class="line">   Graphical Administration Tools</span><br><span class="line">   Headless Management</span><br><span class="line">   Network Servers</span><br><span class="line">   RPM Development Tools</span><br><span class="line">   Scientific Support</span><br><span class="line">   Security Tools</span><br><span class="line">   Smart Card Support</span><br><span class="line">   System Tools</span><br></pre></td></tr></table></figure><ul><li>安装Server with GUI</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@yongstoneinc yum.repos.d]<span class="comment"># yum groupinstall "Server with GUI"</span></span><br><span class="line">Last metadata expiration check: 0:05:31 ago on Thu 13 Aug 2020 12:47:36 AM CST.</span><br><span class="line">no group <span class="string">'dns-server'</span> from environment <span class="string">'graphical-server-environment'</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"insights-client"</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"hpijs"</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"centos-release-eula"</span></span><br><span class="line">Dependencies resolved.</span><br><span class="line">......</span><br><span class="line">Transaction Summary</span><br><span class="line">==============================================================================================</span><br><span class="line">Install  929 Packages</span><br></pre></td></tr></table></figure><ul><li>将模式的命令行模式修改图形模式</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yongstoneinc ~]<span class="comment"># systemctl get-default</span></span><br><span class="line">multi-user.target</span><br><span class="line">[root@yongstoneinc ~]<span class="comment"># systemctl set-default graphical.target</span></span><br><span class="line">Removed /etc/systemd/system/default.target.</span><br><span class="line">Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/graphical.target.</span><br></pre></td></tr></table></figure><ul><li>卸载Server with GUI</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@yongstoneinc yum.repos.d]<span class="comment"># yum groupremove "Server with GUI"</span></span><br><span class="line">Last metadata expiration check: 0:05:31 ago on Thu 13 Aug 2020 12:47:36 AM CST.</span><br><span class="line">no group <span class="string">'dns-server'</span> from environment <span class="string">'graphical-server-environment'</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"insights-client"</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"hpijs"</span></span><br><span class="line">No match <span class="keyword">for</span> group package <span class="string">"centos-release-eula"</span></span><br><span class="line">Dependencies resolved.</span><br><span class="line">......</span><br><span class="line">Transaction Summary</span><br><span class="line">==============================================================================================</span><br><span class="line">Install  929 Packages</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;CentOS 8 系列默认以文本模式或者最小化安装，后期图形桌面的安装和图形桌面的卸载过程。&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://mudbub.com/categories/Linux/"/>
    
    
    <category term="CentOS8" scheme="http://mudbub.com/tags/CentOS8/"/>
    
  </entry>
  
</feed>
